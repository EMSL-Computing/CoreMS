<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>corems.mass_spectra.factory.lc_class API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../factory.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;corems.mass_spectra.factory</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#MassSpectraBase">MassSpectraBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MassSpectraBase.__init__">MassSpectraBase</a>
                        </li>
                        <li>
                                <a class="variable" href="#MassSpectraBase.file_location">file_location</a>
                        </li>
                        <li>
                                <a class="variable" href="#MassSpectraBase.analyzer">analyzer</a>
                        </li>
                        <li>
                                <a class="variable" href="#MassSpectraBase.instrument_label">instrument_label</a>
                        </li>
                        <li>
                                <a class="function" href="#MassSpectraBase.add_mass_spectrum">add_mass_spectrum</a>
                        </li>
                        <li>
                                <a class="function" href="#MassSpectraBase.add_mass_spectra">add_mass_spectra</a>
                        </li>
                        <li>
                                <a class="function" href="#MassSpectraBase.get_time_of_scan_id">get_time_of_scan_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#MassSpectraBase.scan_df">scan_df</a>
                        </li>
                        <li>
                                <a class="variable" href="#MassSpectraBase.ms">ms</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LCMSBase">LCMSBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LCMSBase.__init__">LCMSBase</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.polarity">polarity</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.eics">eics</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.mass_features">mass_features</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.spectral_search_results">spectral_search_results</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.get_parameters_json">get_parameters_json</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.remove_unprocessed_data">remove_unprocessed_data</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.add_associated_ms2_dda">add_associated_ms2_dda</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.add_associated_ms1">add_associated_ms1</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.mass_features_to_df">mass_features_to_df</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.mass_features_ms1_annot_to_df">mass_features_ms1_annot_to_df</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.mass_features_ms2_annot_to_df">mass_features_ms2_annot_to_df</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.plot_composite_mz_features">plot_composite_mz_features</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.set_tic_list_from_data">set_tic_list_from_data</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.set_retention_time_from_data">set_retention_time_from_data</a>
                        </li>
                        <li>
                                <a class="function" href="#LCMSBase.set_scans_number_from_data">set_scans_number_from_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.ms1_scans">ms1_scans</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.parameters">parameters</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.scans_number">scans_number</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.retention_time">retention_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#LCMSBase.tic">tic</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../../corems.html">corems</a><wbr>.<a href="./../../mass_spectra.html">mass_spectra</a><wbr>.<a href="./../factory.html">factory</a><wbr>.lc_class    </h1>

                
                        <input id="mod-lc_class-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-lc_class-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">from</span> <span class="nn">corems.encapsulation.factory.parameters</span> <span class="kn">import</span> <span class="n">LCMSParameters</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">corems.mass_spectra.calc.lc_calc</span> <span class="kn">import</span> <span class="n">LCCalculations</span><span class="p">,</span> <span class="n">PHCalculations</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">corems.molecular_id.search.lcms_spectral_search</span> <span class="kn">import</span> <span class="n">LCMSSpectralSearch</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">corems.mass_spectrum.input.numpyArray</span> <span class="kn">import</span> <span class="n">ms_from_array_profile</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">corems.mass_spectra.calc.lc_calc</span> <span class="kn">import</span> <span class="n">find_closest</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="k">class</span> <span class="nc">MassSpectraBase</span><span class="p">:</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for mass spectra objects.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    Parameters</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">    -----------</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">        The location of the file containing the mass spectra data.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">    analyzer : str, optional</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">        The type of analyzer used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">    instrument_label : str, optional</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">        The type of instrument used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">    sample_name : str, optional</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        The name of the sample; defaults to the file name if not provided to the parser. Defaults to None.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">    spectra_parser : object, optional</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        The spectra parser object used to create the mass spectra object. Defaults to None.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    Attributes</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    -----------</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    spectra_parser_class : class</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">        The class of the spectra parser used to create the mass spectra object.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">        The location of the file containing the mass spectra data.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">    sample_name : str</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">        The name of the sample; defaults to the file name if not provided to the parser.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    analyzer : str</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">        The type of analyzer used to generate the mass spectra data. Derived from the spectra parser.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    instrument_label : str</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">        The type of instrument used to generate the mass spectra data. Derived from the spectra parser.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    _scan_info : dict</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">        A dictionary containing the scan data with columns for scan number, scan time, ms level, precursor m/z,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">        scan text, and scan window (lower and upper).</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        Associated with the property scan_df, which returns a pandas DataFrame or can set this attribute from a pandas DataFrame.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    _ms : dict</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        A dictionary containing mass spectra for the dataset, keys of dictionary are scan numbers. Initialized as an empty dictionary.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    _ms_unprocessed: dictionary of pandas.DataFrames or None</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        A dictionary of unprocssed mass spectra data, as an (optional) intermediate data product for peak picking.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">        Key is ms_level, and value is dataframe with columns for scan number, m/z, and intensity. Default is None.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    Methods</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">    --------</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    * add_mass_spectra(scan_list, spectrum_mode: str = &#39;profile&#39;, use_parser = True, auto_process=True).</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        Add mass spectra (or singlel mass spectrum) to _ms slot, from a list of scans</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">    * get_time_of_scan_id(scan).</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">        Returns the scan time for the specified scan number.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        <span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>    <span class="p">):</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;File does not exist: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_location</span><span class="p">))</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>        <span class="k">if</span> <span class="n">sample_name</span><span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">sample_name</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">stem</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">analyzer</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">=</span> <span class="n">instrument_label</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>        <span class="c1"># Add the spectra parser class to the object if it is not None</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="k">if</span> <span class="n">spectra_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser_class</span> <span class="o">=</span> <span class="n">spectra_parser</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span> <span class="o">=</span> <span class="n">spectra_parser</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>            <span class="c1"># Check that spectra_pasrser.sample_name is same as sample_name etc, raise warning if not</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">sample_name</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>                    <span class="s2">&quot;sample_name provided to MassSpectraBase object does not match sample_name provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>                <span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                    <span class="s2">&quot;analyzer provided to MassSpectraBase object does not match analyzer provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>                <span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>                    <span class="s2">&quot;instrument provided to MassSpectraBase object does not match instrument provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>                <span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">file_location</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>                    <span class="s2">&quot;file_location provided to MassSpectraBase object does not match file_location provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>                <span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="c1"># Instantiate empty dictionaries for scan information and mass spectra</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>    <span class="k">def</span> <span class="nf">add_mass_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass_spec</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a mass spectrum to the dataset.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        Parameters</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        -----------</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        mass_spec : MassSpectrum</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">            The corems MassSpectrum object to be added to the dataset.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        Notes</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        -----</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">        This is a helper function for the add_mass_spectra() method, and is not intended to be called directly.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>        <span class="c1"># check if mass_spec has a scan_number attribute</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mass_spec</span><span class="p">,</span> <span class="s2">&quot;scan_number&quot;</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                <span class="s2">&quot;Mass spectrum must have a scan_number attribute to be added to the dataset correctly&quot;</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span><span class="n">mass_spec</span><span class="o">.</span><span class="n">scan_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_spec</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="k">def</span> <span class="nf">add_mass_spectra</span><span class="p">(</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="n">scan_list</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="n">ms_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="p">):</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add mass spectra to _ms dictionary, from a list of scans or single scan</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        Notes</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        -----</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        The mass spectra will inherit the mass_spectrum, ms_peak, and molecular_search parameters from the LCMSBase object.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        Parameters</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        -----------</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">        scan_list : list of ints</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">            List of scans to use to populate _ms slot</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        spectrum_mode : str or None</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">            The spectrum mode to use for the mass spectra.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">            If None, method will use the spectrum mode from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">            Defaults to None.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        ms_level : int, optional</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">            The MS level to use for the mass spectra.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">            This is used to pass the molecular_search parameters from the LCMS object to the individual MassSpectrum objects.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">            Defaults to 1.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        using_parser : bool</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">            Whether to use the mass spectra parser to get the mass spectra.  Defaults to True.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        auto_process : bool</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">            Whether to auto-process the mass spectra.  Defaults to True.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        ms_params : MSParameters or None</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">            The mass spectrum parameters to use for the mass spectra.  If None, uses the globally set MSParameters.</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        Raises</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        ------</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">        TypeError</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">            If scan_list is not a list of ints</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        ValueError</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">            If polarity is not &#39;positive&#39; or &#39;negative&#39;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">            If ms_level is not 1 or 2</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="c1"># check if scan_list is a list or a single int; if single int, convert to list</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="n">scan_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan_list</span><span class="p">]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scan_list must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_list</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scan_list must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="c1"># set polarity to -1 if negative mode, 1 if positive mode (for mass spectrum creation)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                <span class="s2">&quot;Polarity not set for dataset, must be a either &#39;positive&#39; or &#39;negative&#39;&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>            <span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="c1"># is not using_parser, check that ms1 and ms2 are not None</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                    <span class="s2">&quot;ms_level </span><span class="si">{}</span><span class="s2"> not found in _ms_unprocessed dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                        <span class="n">ms_level</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                    <span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>                <span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="n">scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_list</span><span class="p">))</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>        <span class="n">scan_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                    <span class="s2">&quot;No unprocessed data found for ms_level </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>                <span class="nb">len</span><span class="p">(</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>                        <span class="n">scan_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                    <span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                <span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>                <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                    <span class="s2">&quot;Not all scans in scan_list are present in the unprocessed data&quot;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>                <span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="c1"># Prepare the ms_df for parsing</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>            <span class="n">ms_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_list</span><span class="p">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="k">if</span> <span class="n">spectrum_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>                <span class="c1"># get spectrum mode from _scan_info</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>                <span class="n">spectrum_mode_scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;ms_format&quot;</span><span class="p">]</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>                <span class="n">spectrum_mode_scan</span> <span class="o">=</span> <span class="n">spectrum_mode</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>            <span class="c1"># Instantiate the mass spectrum object using the parser or the unprocessed data</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>                <span class="n">my_ms_df</span> <span class="o">=</span> <span class="n">ms_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scan</span><span class="p">]</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>                <span class="k">if</span> <span class="n">spectrum_mode_scan</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>                    <span class="c1"># Check this - it might be better to use the MassSpectrumProfile class to instantiate the mass spectrum</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                    <span class="n">ms</span> <span class="o">=</span> <span class="n">ms_from_array_profile</span><span class="p">(</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                        <span class="n">my_ms_df</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>                        <span class="n">my_ms_df</span><span class="o">.</span><span class="n">intensity</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>                        <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>                        <span class="n">auto_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                    <span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                        <span class="s2">&quot;Only profile mode is supported for unprocessed data&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                    <span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>            <span class="k">if</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>                <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">get_mass_spectrum_from_scan</span><span class="p">(</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>                    <span class="n">scan_number</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>                    <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode_scan</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                    <span class="n">auto_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>                <span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="c1"># Set the mass spectrum parameters, auto-process if auto_process is True, and add to the dataset</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="k">if</span> <span class="n">ms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>                <span class="k">if</span> <span class="n">ms_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>                    <span class="n">ms</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">ms_params</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                <span class="n">ms</span><span class="o">.</span><span class="n">scan_number</span> <span class="o">=</span> <span class="n">scan</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                <span class="k">if</span> <span class="n">auto_process</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                    <span class="n">ms</span><span class="o">.</span><span class="n">process_mass_spec</span><span class="p">()</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectrum</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>    <span class="k">def</span> <span class="nf">get_time_of_scan_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the scan time for the specified scan number.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        Parameters</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">        -----------</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        scan : int</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">            The scan number of the desired scan time.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">        Returns</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        --------</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        float</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">            The scan time for the specified scan number (in minutes).</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">        Raises</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">        ------</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        ValueError</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">            If no scan time is found for the specified scan number.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="c1"># Check if _retenion_time_list is empty and raise error if so</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No retention times found in dataset&quot;</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="n">rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">scan</span><span class="p">)]</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="k">return</span> <span class="n">rt</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>    <span class="nd">@property</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="k">def</span> <span class="nf">scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        pandas.DataFrame : A pandas DataFrame containing the scan info data with columns for scan number, scan time, ms level, precursor m/z, scan text, and scan window (lower and upper).</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="k">return</span> <span class="n">scan_df</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="nd">@property</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        dictionary : contains the key associated with mass spectra and values are the associated MassSpecProfiles</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>    <span class="nd">@scan_df</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>    <span class="k">def</span> <span class="nf">scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        Sets the scan data for the dataset.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        Parameters</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        -----------</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">            A pandas DataFrame containing the scan data with columns for scan number, scan time, ms level,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">            precursor m/z, scan text, and scan window (lower and upper).</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scan_number</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="k">class</span> <span class="nc">LCMSBase</span><span class="p">(</span><span class="n">MassSpectraBase</span><span class="p">,</span> <span class="n">LCCalculations</span><span class="p">,</span> <span class="n">PHCalculations</span><span class="p">,</span> <span class="n">LCMSSpectralSearch</span><span class="p">):</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A class representing a liquid chromatography-mass spectrometry (LC-MS) data object.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">    This class is not intended to be instantiated directly, but rather to be instantiated by an appropriate mass spectra parser using the get_lcms_obj() method.</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">    Parameters</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">    -----------</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">        The location of the file containing the mass spectra data.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">    analyzer : str, optional</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        The type of analyzer used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">    instrument_label : str, optional</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">        The type of instrument used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">    sample_name : str, optional</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">        The name of the sample; defaults to the file name if not provided to the parser. Defaults to None.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">    spectra_parser : object, optional</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        The spectra parser object used to create the mass spectra object. Defaults to None.</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">    Attributes</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">    -----------</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">    polarity : str</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        The polarity of the ionization mode used for the dataset.</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">    _parameters : LCMSParameters</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        The parameters used for all methods called on the LCMSBase object. Set upon instantiation from LCMSParameters.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">    _retention_time_list : numpy.ndarray</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        An array of retention times for the dataset.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">    _scans_number_list : list</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        A list of scan numbers for the dataset.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">    _tic_list : numpy.ndarray</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">        An array of total ion current (TIC) values for the dataset.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">    eics : dict</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">        A dictionary containing extracted ion chromatograms (EICs) for the dataset.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">        Key is the mz of the EIC. Initialized as an empty dictionary.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">    mass_features : dictionary of LCMSMassFeature objects</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">        A dictionary containing mass features for the dataset.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">        Key is mass feature ID. Initialized as an empty dictionary.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">    spectral_search_results : dictionary of MS2SearchResults objects</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">        A dictionary containing spectral search results for the dataset.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">        Key is scan number : precursor mz. Initialized as an empty dictionary.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">    Methods</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">    --------</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">    * get_parameters_json().</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">        Returns the parameters used for the LC-MS analysis in JSON format.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">    * add_associated_ms2_dda(add_to_lcmsobj=True, auto_process=True, use_parser=True)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        Adds which MS2 scans are associated with each mass feature to the</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        mass_features dictionary and optionally adds the MS2 spectra to the _ms dictionary.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">    * add_associated_ms1(add_to_lcmsobj=True, auto_process=True, use_parser=True)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        Adds the MS1 spectra associated with each mass feature to the</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        mass_features dictionary and adds the MS1 spectra to the _ms dictionary.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">    * mass_features_to_df()</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        Returns a pandas dataframe summarizing the mass features in the dataset.</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">    * set_tic_list_from_data(overwrite=False)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">        Sets the TIC list from the mass spectrum objects within the _ms dictionary.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">    * set_retention_time_from_data(overwrite=False)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">        Sets the retention time list from the data in the _ms dictionary.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">    * set_scans_number_from_data(overwrite=False)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">        Sets the scan number list from the data in the _ms dictionary.</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">    * plot_composite_mz_features(binsize = 1e-4, ph_int_min_thresh = 0.001, mf_plot = True, ms2_plot = True, return_fig = False)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        Generates plot of M/Z features comparing scan time vs M/Z value</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="p">):</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="n">file_location</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">instrument_label</span><span class="p">,</span> <span class="n">sample_name</span><span class="p">,</span> <span class="n">spectra_parser</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">LCMSParameters</span><span class="p">()</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_search_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>    <span class="k">def</span> <span class="nf">get_parameters_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the parameters stored for the LC-MS object in JSON format.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        Returns</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        --------</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">        str</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">            The parameters used for the LC-MS analysis in JSON format.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>    <span class="k">def</span> <span class="nf">remove_unprocessed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms_level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the unprocessed data from the LCMSBase object.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">        Parameters</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">        -----------</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        ms_level : int, optional</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">            The MS level to remove the unprocessed data for. If None, removes unprocessed data for all MS levels.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        Raises</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        ------</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        ValueError</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">            If ms_level is not 1 or 2.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        Notes</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        -----</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        This method is useful for freeing up memory after the data has been processed.</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="k">for</span> <span class="n">ms_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ms_level must be 1 or 2&quot;</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>    <span class="k">def</span> <span class="nf">add_associated_ms2_dda</span><span class="p">(</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="n">ms_params_key</span><span class="o">=</span><span class="s2">&quot;ms2&quot;</span><span class="p">,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">scan_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="p">):</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MS2 spectra associated with mass features to the dataset.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        Populates the mass_features ms2_scan_numbers attribute (on mass_features dictionary on LCMSObject)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">        Parameters</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        -----------</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">            If True, auto-processes the MS2 spectra before adding it to the object&#39;s _ms dictionary. Default is True.</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        use_parser : bool, optional</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">            If True, envoke the spectra parser to get the MS2 spectra. Default is True.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        spectrum_mode : str or None, optional</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">            The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">            from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">            Defaults to None. (faster if defined, otherwise will check each scan)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        ms_params_key : string, optional</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">            The key of the mass spectrum parameters to use for the mass spectra, accessed from the LCMSObject.parameters.mass_spectrum attribute.</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">            Defaults to &#39;ms2&#39;.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">        scan_filter : str</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">            A string to filter the scans to add to the _ms dictionary.  If None, all scans are added.  Defaults to None.</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">            &quot;hcd&quot; will pull out only HCD scans.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">        Raises</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">        ------</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        ValueError</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">            If mass_features is not set, must run find_mass_features() first.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">            If no MS2 scans are found in the dataset.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">            If no precursor m/z values are found in MS2 scans, not a DDA dataset.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="c1"># reconfigure ms_params to get the correct mass spectrum parameters from the key</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="n">ms_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="n">ms_params_key</span><span class="p">]</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="c1"># Find ms2 scans that have a precursor m/z value</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="o">~</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">precursor_mz</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="c1"># drop ms2 scans that have no tic</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">tic</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="k">if</span> <span class="n">ms2_scans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No DDA scans found in dataset&quot;</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="k">if</span> <span class="n">scan_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">scan_text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">scan_filter</span><span class="p">)]</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="c1"># set tolerance in rt space (in minutes) and mz space (in daltons)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="n">time_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms2_dda_rt_tolerance</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="n">mz_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms2_dda_mz_tolerance</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="c1"># for each mass feature, find the ms2 scans that are within the roi scan time and mz range</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">dda_scans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="n">ms2_scans_filtered</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="n">ms2_scans</span><span class="o">.</span><span class="n">scan_time</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">scan_time</span> <span class="o">-</span> <span class="n">time_tol</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">scan_time</span> <span class="o">+</span> <span class="n">time_tol</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                <span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>            <span class="p">]</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="n">ms2_scans_filtered</span> <span class="o">=</span> <span class="n">ms2_scans_filtered</span><span class="p">[</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">precursor_mz</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">mz</span> <span class="o">-</span> <span class="n">mz_tol</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">mz</span> <span class="o">+</span> <span class="n">mz_tol</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                <span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="p">]</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="n">dda_scans</span> <span class="o">=</span> <span class="n">dda_scans</span> <span class="o">+</span> <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>                <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>            <span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="c1"># add to _ms attribute</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectra</span><span class="p">(</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>            <span class="n">scan_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dda_scans</span><span class="p">)),</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>            <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode</span><span class="p">,</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>            <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>            <span class="n">ms_params</span><span class="o">=</span><span class="n">ms_params</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="c1"># associate appropriate _ms attribute to appropriate mass feature&#39;s ms2_mass_spectra attribute</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                <span class="k">for</span> <span class="n">dda_scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span><span class="p">:</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                    <span class="k">if</span> <span class="n">dda_scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_mass_spectra</span><span class="p">[</span><span class="n">dda_scan</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                            <span class="n">dda_scan</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                        <span class="p">]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>    <span class="k">def</span> <span class="nf">add_associated_ms1</span><span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="p">):</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MS1 spectra associated with mass features to the dataset.</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        Parameters</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        -----------</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">            If True, auto-processes the MS1 spectra before adding it to the object&#39;s _ms dictionary. Default is True.</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        use_parser : bool, optional</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">            If True, envoke the spectra parser to get the MS1 spectra. Default is True.</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        spectrum_mode : str or None, optional</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">            The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">            from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">            Defaults to None. (faster if defined, otherwise will check each scan)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        Raises</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        ------</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        ValueError</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            If mass_features is not set, must run find_mass_features() first.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">            If apex scans are not profile mode, all apex scans must be profile mode for averaging.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">            If number of scans to average is not  1 or an integer with an integer median (i.e. 3, 5, 7, 9).</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">            If deconvolute is True and no EICs are found, did you run integrate_mass_features() first?</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="n">scans_to_average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms1_scans_to_average</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="n">scans_to_average</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="c1"># Add to LCMSobj</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectra</span><span class="p">(</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                <span class="n">scan_list</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">apex_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                <span class="p">],</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>                <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>                <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>                <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode</span><span class="p">,</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>                <span class="n">ms_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="s2">&quot;ms1&quot;</span><span class="p">],</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>            <span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="p">(</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># scans_to_average = 3, 5, 7 etc, mirror l/r around apex</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>            <span class="n">apex_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">apex_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="c1"># Check if all apex scans are profile mode, raise error if not</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">apex_scans</span><span class="p">,</span> <span class="s2">&quot;ms_format&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">):</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All apex scans must be profile mode for averaging&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="c1"># First get sets of scans to average</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>            <span class="k">def</span> <span class="nf">get_scans_from_apex</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">,</span> <span class="n">apex_scan</span><span class="p">,</span> <span class="n">scans_to_average</span><span class="p">):</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="n">ms1_idx_start</span> <span class="o">=</span> <span class="n">ms1_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">apex_scan</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                    <span class="p">(</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                <span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                <span class="k">if</span> <span class="n">ms1_idx_start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                    <span class="n">ms1_idx_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                <span class="n">ms1_idx_end</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                    <span class="n">ms1_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">apex_scan</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                <span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                <span class="k">if</span> <span class="n">ms1_idx_end</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                    <span class="n">ms1_idx_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                <span class="n">scan_list</span> <span class="o">=</span> <span class="n">ms1_scans</span><span class="p">[</span><span class="n">ms1_idx_start</span><span class="p">:</span><span class="n">ms1_idx_end</span><span class="p">]</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                <span class="k">return</span> <span class="n">scan_list</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="n">ms1_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_scans</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="n">scans_lists</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                <span class="n">get_scans_from_apex</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">,</span> <span class="n">apex_scan</span><span class="p">,</span> <span class="n">scans_to_average</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                <span class="k">for</span> <span class="n">apex_scan</span> <span class="ow">in</span> <span class="n">apex_scans</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>            <span class="p">]</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="c1"># set polarity to -1 if negative mode, 1 if positive mode (for mass spectrum creation)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>                <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>                <span class="c1"># Perform checks and prepare _ms_unprocessed dictionary if use_parser is False (saves time to do this once)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                <span class="c1"># Set the index on _ms_unprocessed[1] to scan number</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>                <span class="c1"># Check that all the scans in scan_lists are indexs in self._ms_unprocessed[1]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>                <span class="n">scans_lists_flat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>                    <span class="nb">set</span><span class="p">([</span><span class="n">scan</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">scans_lists</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>                <span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                    <span class="nb">len</span><span class="p">(</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">scans_lists_flat</span><span class="p">),</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                        <span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                    <span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                    <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                <span class="p">):</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                        <span class="s2">&quot;Not all scans to average are present in the unprocessed data&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                    <span class="p">)</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="k">for</span> <span class="n">scan_list_average</span><span class="p">,</span> <span class="n">apex_scan</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans_lists</span><span class="p">,</span> <span class="n">apex_scans</span><span class="p">):</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>                <span class="c1"># Get unprocessed mass spectrum from scans</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>                <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_mass_spectrum</span><span class="p">(</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                    <span class="n">scan_list</span><span class="o">=</span><span class="n">scan_list_average</span><span class="p">,</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                    <span class="n">apex_scan</span><span class="o">=</span><span class="n">apex_scan</span><span class="p">,</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>                    <span class="n">spectrum_mode</span><span class="o">=</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                    <span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>                    <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                    <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                    <span class="n">perform_checks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                    <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                    <span class="n">ms_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="s2">&quot;ms1&quot;</span><span class="p">],</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                <span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                <span class="c1"># Add mass spectrum to LCMS object and associated with mass feature</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectrum</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                <span class="c1"># Reset the index on _ms_unprocessed[1] to not be scan number</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                <span class="s2">&quot;Number of scans to average must be 1 or an integer with an integer median (i.e. 3, 5, 7, 9)&quot;</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>        <span class="c1"># Associate the ms1 spectra with the mass features</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">apex_scan</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="p">]</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">update_mz</span><span class="p">()</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="c1"># Re-process clustering if persistent homology is selected to remove duplicate mass features after adding and processing MS1 spectra</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">peak_picking_method</span> <span class="o">==</span> <span class="s2">&quot;persistent homology&quot;</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cluster_mass_features</span><span class="p">(</span><span class="n">drop_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;persistence&quot;</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="k">def</span> <span class="nf">mass_features_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the mass features.</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        The dataframe contains the following columns: mf_id, mz, apex_scan, scan_time, intensity,</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        persistence, area, monoisotopic_mf_id, and isotopologue_type.  The index is set to mf_id (mass feature ID).</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">        Returns</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        --------</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">            A pandas dataframe of mass features with the following columns:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">            mf_id, mz, apex_scan, scan_time, intensity, persistence, area.</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="k">def</span> <span class="nf">mass_spectrum_to_string</span><span class="p">(</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="n">mass_spec</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_normalized_abun</span><span class="o">=</span><span class="mf">0.01</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="p">):</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Converts a mass spectrum to a string of m/z:abundance pairs.</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">            Parameters</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">            -----------</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">            mass_spec : MassSpectrum</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">                A MassSpectrum object to be converted to a string.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">            normalize : bool, optional</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">                If True, normalizes the abundance values to a maximum of 1. Defaults to True.</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">            min_normalized_abun : float, optional</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">                The minimum normalized abundance value to include in the string, only used if normalize is True. Defaults to 0.01.</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">            Returns</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">            --------</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">            str</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">                A string of m/z:abundance pairs from the mass spectrum, separated by a semicolon.</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="n">mz_np</span> <span class="o">=</span> <span class="n">mass_spec</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s2">&quot;m/z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>            <span class="n">abun_np</span> <span class="o">=</span> <span class="n">mass_spec</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s2">&quot;Peak Height&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="n">abun_np</span> <span class="o">=</span> <span class="n">abun_np</span> <span class="o">/</span> <span class="n">abun_np</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="n">mz_abun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">mz_np</span><span class="p">,</span> <span class="n">abun_np</span><span class="p">))</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">mz_abun</span> <span class="o">=</span> <span class="n">mz_abun</span><span class="p">[</span><span class="n">mz_abun</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_normalized_abun</span><span class="p">]</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>            <span class="n">mz_abun_str</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">abun</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">abun</span> <span class="ow">in</span> <span class="n">mz_abun</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="p">]</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="k">return</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mz_abun_str</span><span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="n">cols_in_df</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="s2">&quot;_apex_scan&quot;</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>            <span class="s2">&quot;start_scan&quot;</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>            <span class="s2">&quot;final_scan&quot;</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="s2">&quot;_retention_time&quot;</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="s2">&quot;_intensity&quot;</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="s2">&quot;_persistence&quot;</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>            <span class="s2">&quot;_area&quot;</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="s2">&quot;_dispersity_index&quot;</span><span class="p">,</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="s2">&quot;_tailing_factor&quot;</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>            <span class="s2">&quot;monoisotopic_mf_id&quot;</span><span class="p">,</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="s2">&quot;isotopologue_type&quot;</span><span class="p">,</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="s2">&quot;mass_spectrum_deconvoluted_parent&quot;</span><span class="p">,</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="p">]</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="n">df_mf_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>            <span class="c1"># Find cols_in_df that are in single_mf</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>            <span class="n">df_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">cols_in_df</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="n">dict_mf</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">df_keys</span><span class="p">:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>                <span class="c1"># Add MS2 spectra info</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                <span class="n">best_ms2_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">best_ms2</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;ms2_spectrum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_spectrum_to_string</span><span class="p">(</span><span class="n">best_ms2_spectrum</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">associated_mass_features_deconvoluted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;associated_mass_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>                    <span class="nb">map</span><span class="p">(</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>                        <span class="nb">str</span><span class="p">,</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">associated_mass_features_deconvoluted</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                    <span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                <span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">_half_height_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;half_height_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                    <span class="n">mf_id</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">half_height_width</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="c1"># Check if EIC for mass feature is set</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="n">df_mf_single</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_mf</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">mf_id</span><span class="p">])</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>            <span class="n">df_mf_single</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mz</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="n">df_mf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_mf_single</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_mf_list</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="c1"># rename _area to area and id to mf_id</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                <span class="s2">&quot;_area&quot;</span><span class="p">:</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mf_id&quot;</span><span class="p">,</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                <span class="s2">&quot;_apex_scan&quot;</span><span class="p">:</span> <span class="s2">&quot;apex_scan&quot;</span><span class="p">,</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>                <span class="s2">&quot;_retention_time&quot;</span><span class="p">:</span> <span class="s2">&quot;scan_time&quot;</span><span class="p">,</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>                <span class="s2">&quot;_intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>                <span class="s2">&quot;_persistence&quot;</span><span class="p">:</span> <span class="s2">&quot;persistence&quot;</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                <span class="s2">&quot;_dispersity_index&quot;</span><span class="p">:</span> <span class="s2">&quot;dispersity_index&quot;</span><span class="p">,</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                <span class="s2">&quot;_tailing_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;tailing_factor&quot;</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="p">}</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="c1"># reorder columns</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="s2">&quot;mf_id&quot;</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="s2">&quot;scan_time&quot;</span><span class="p">,</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="s2">&quot;mz&quot;</span><span class="p">,</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="s2">&quot;apex_scan&quot;</span><span class="p">,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="s2">&quot;start_scan&quot;</span><span class="p">,</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="s2">&quot;final_scan&quot;</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>            <span class="s2">&quot;persistence&quot;</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="s2">&quot;half_height_width&quot;</span><span class="p">,</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="s2">&quot;tailing_factor&quot;</span><span class="p">,</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="s2">&quot;dispersity_index&quot;</span><span class="p">,</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="s2">&quot;monoisotopic_mf_id&quot;</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="s2">&quot;isotopologue_type&quot;</span><span class="p">,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="s2">&quot;mass_spectrum_deconvoluted_parent&quot;</span><span class="p">,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="s2">&quot;associated_mass_features&quot;</span><span class="p">,</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>            <span class="s2">&quot;ms2_spectrum&quot;</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="p">]</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="c1"># drop columns that are not in col_order</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="n">cols_to_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_order</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="p">[</span><span class="n">cols_to_order</span><span class="p">]</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="c1"># reset index to mf_id</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="n">df_mf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="k">return</span> <span class="n">df_mf</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="k">def</span> <span class="nf">mass_features_ms1_annot_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the MS1 annotations for the mass features in the dataset.</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        Returns</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">        --------</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">            A pandas dataframe of MS1 annotations for the mass features in the dataset.</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">            The index is set to mf_id (mass feature ID)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">        Raises</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        ------</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        Warning</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">            If no MS1 annotations were found for the mass features in the dataset.</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">annot_df_list_ms1</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                <span class="k">pass</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                <span class="c1"># Add ms1 annotations to ms1 annotation list</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                        <span class="p">(</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms1_peak</span><span class="o">.</span><span class="n">mz_exp</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mz</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                        <span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                    <span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                    <span class="o">&lt;</span> <span class="mf">0.01</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>                <span class="p">):</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                    <span class="c1"># Get the molecular formula from the mass spectrum</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                    <span class="c1"># Subset to pull out only the peak associated with the mass feature</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="n">annot_df</span><span class="p">[</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                        <span class="n">annot_df</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms1_peak</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>                    <span class="c1"># Remove the index column and add column for mf_id</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="n">annot_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                    <span class="n">annot_df</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf_id</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                    <span class="n">annot_df_list_ms1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot_df</span><span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_df_list_ms1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">annot_df_list_ms1</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="n">annot_ms1_df_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="n">annot_ms1_df_full</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>            <span class="c1"># Warn that no ms1 annotations were found</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="s2">&quot;No MS1 annotations found for mass features in dataset, were MS1 spectra added and processed within the dataset?&quot;</span><span class="p">,</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="k">return</span> <span class="n">annot_ms1_df_full</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="k">def</span> <span class="nf">mass_features_ms2_annot_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecular_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the MS2 annotations for the mass features in the dataset.</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">        Parameters</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">        -----------</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">        molecular_metadata :  dict of MolecularMetadata objects</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">            A dictionary of MolecularMetadata objects, keyed by metabref_mol_id.  Defaults to None.</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">        Returns</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        --------</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">            A pandas dataframe of MS2 annotations for the mass features in the dataset,</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">            and optionally molecular metadata. The index is set to mf_id (mass feature ID)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        Raises</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        ------</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">        Warning</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">            If no MS2 annotations were found for the mass features in the dataset.</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="n">annot_df_list_ms2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_similarity_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="c1"># Add ms2 annotations to ms2 annotation list</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_similarity_results</span><span class="p">:</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                    <span class="n">annot_df_ms2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                    <span class="n">annot_df_ms2</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf_id</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                    <span class="n">annot_df_list_ms2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot_df_ms2</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_df_list_ms2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">annot_df_list_ms2</span><span class="p">)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>            <span class="k">if</span> <span class="n">molecular_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                <span class="n">molecular_metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                    <span class="p">[</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">molecular_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                    <span class="p">],</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                <span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                <span class="n">molecular_metadata_df</span> <span class="o">=</span> <span class="n">molecular_metadata_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ref_mol_id&quot;</span><span class="p">}</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                <span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>                <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>                    <span class="n">molecular_metadata_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ref_mol_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>                <span class="p">)</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">,</span> <span class="s2">&quot;query_spectrum_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_ms_id&quot;</span><span class="p">]</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="c1"># Warn that no ms2 annotations were found</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="s2">&quot;No MS2 annotations found for mass features in dataset, were MS2 spectra added and searched against a database?&quot;</span><span class="p">,</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="p">)</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="k">return</span> <span class="n">annot_ms2_df_full</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>    <span class="k">def</span> <span class="nf">plot_composite_mz_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binsize</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">ph_int_min_thresh</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">mf_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ms2_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a figure displaying </span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">            (1) thresholded, unprocessed data</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">            (2) the m/z features</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">            (3) which m/z features are associated with MS2 spectra</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">        Parameters</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">        -----------</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">        binsize :  float</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">            Desired binsize for the m/z axis of the composite feature map.  Defaults to 1e-4.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">        mf_plot : boolean</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">            Indicates whether to plot the m/z features. Defaults to True.</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">        ms2_plot : boolean</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">            Indicates whether to identify m/z features with associated MS2 spectra. Defaults to True.</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">        return_fig : boolean</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">            Indicates whether to plot composite feature map (False) or return figure object (True). Defaults to False.</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">        Returns</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">        --------</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">        matplotlib.pyplot.Figure</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">            A figure with the thresholded, unprocessed data on an axis of m/z value with respect to </span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">            scan time. Unprocessed data is displayed in gray scale with darker colors indicating </span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">            higher intensities. If m/z features are plotted, they are displayed in cyan. If m/z</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">            features with associated with MS2 spectra are plotted, they are displayed in red.</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">        Raises</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">        ------</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">        Warning</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">            If m/z features are set to be plot but aren&#39;t in the dataset.</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">            If m/z features with associated MS2 data are set to be plot but no MS2 annotations </span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">            were found for the m/z features in the dataset.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="k">if</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                    <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="p">)</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="c1">## call mass feature data</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                        <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                    <span class="p">)</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="c1">## call m/z feature data</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="c1"># Check if ms2_spectrum is set, raise error if not</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="k">if</span> <span class="s1">&#39;ms2_spectrum&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>                
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                    <span class="s2">&quot;ms2_spectrum not set, must run add_associated_ms2_dda() first&quot;</span>            
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="p">)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="c1">## threshold and grid unprocessed data</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">ph_int_min_thresh</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="n">df_thres</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="p">(</span><span class="n">df_thres</span><span class="p">)</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>        <span class="c1">## format unprocessed data for plotting</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">]],</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;scan&#39;</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="n">mz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">),</span> <span class="n">binsize</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="n">mz_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mz_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_closest</span><span class="p">(</span><span class="n">mz_grid</span><span class="p">,</span> <span class="n">mz_data</span><span class="p">)</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ab_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;mz_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="n">unproc_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;scan_time&#39;</span><span class="p">,</span> <span class="s1">&#39;mz_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;ab_bin&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>        <span class="c1">## generate figure</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="n">unproc_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>            <span class="n">unproc_df</span><span class="o">.</span><span class="n">mz_bin</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="p">),</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="n">alpha</span> <span class="o">=</span> <span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="p">),</span> 
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="p">)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="k">if</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>            <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                    <span class="n">mf_df</span><span class="p">[</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                    <span class="n">mf_df</span><span class="p">[</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features without MS2&#39;</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                <span class="p">)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                    <span class="n">mf_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                    <span class="n">mf_df</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features&#39;</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="p">)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>        <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span> 
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="n">mf_df</span><span class="p">[</span><span class="o">~</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="n">mf_df</span><span class="p">[</span><span class="o">~</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features with MS2&#39;</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>            <span class="p">)</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        <span class="k">if</span> <span class="n">mf_plot</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">ms2_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">),</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Scan time&#39;</span><span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;m/z&#39;</span><span class="p">)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">)))</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">)))</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Composite Feature Map&#39;</span><span class="p">)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">        Returns the number of mass spectra in the dataset.</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        Returns</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">        --------</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        int</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">            The number of mass spectra in the dataset.</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">):</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">        Returns the mass spectrum corresponding to the specified scan number.</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        Parameters</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        -----------</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">        scan_number : int</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">            The scan number of the desired mass spectrum.</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">        Returns</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">        --------</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">        MassSpectrum</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">            The mass spectrum corresponding to the specified scan number.</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scan_number</span><span class="p">)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an iterator over the mass spectra in the dataset.</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">        Returns</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">        --------</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        iterator</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">            An iterator over the mass spectra in the dataset.</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>    <span class="k">def</span> <span class="nf">set_tic_list_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the TIC list from the mass spectrum objects within the _ms dictionary.</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">        Parameters</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">        -----------</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">        overwrite : bool, optional</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">            If True, overwrites the TIC list if it is already set. Defaults to False.</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">        Notes</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        -----</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">        If the _ms dictionary is incomplete, sets the TIC list to an empty list.</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">        Raises</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">        ------</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        ValueError</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">            If the TIC list is already set and overwrite is False.</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="c1"># Check if tic_list is already set and raise error if so</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TIC list already set, use overwrite=True to overwrite&quot;</span><span class="p">)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tic</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">tic</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span><span class="p">]</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>    <span class="k">def</span> <span class="nf">set_retention_time_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the retention time list from the data in the _ms dictionary.</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">        Parameters</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">        -----------</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">        overwrite : bool, optional</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">            If True, overwrites the retention time list if it is already set. Defaults to False.</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">        Notes</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        -----</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">        If the _ms dictionary is empty or incomplete, sets the retention time list to an empty list.</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        Raises</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        ------</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">        ValueError</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">            If the retention time list is already set and overwrite is False.</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="c1"># Check if retention_time_list is already set and raise error if so</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retention_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>                <span class="s2">&quot;Retention time list already set, use overwrite=True to overwrite&quot;</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="n">retention_time_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="k">for</span> <span class="n">key_ms</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="n">retention_time_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_ms</span><span class="p">)</span><span class="o">.</span><span class="n">retention_time</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">retention_time</span> <span class="o">=</span> <span class="n">retention_time_list</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="k">def</span> <span class="nf">set_scans_number_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the scan number list from the data in the _ms dictionary.</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">        Notes</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">        -----</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">        If the _ms dictionary is empty or incomplete, sets the scan number list to an empty list.</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">        Raises</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">        ------</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">        ValueError</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">            If the scan number list is already set and overwrite is False.</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>        <span class="c1"># Check if scans_number_list is already set and raise error if so</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                <span class="s2">&quot;Scan number list already set, use overwrite=True to overwrite&quot;</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="p">)</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>    <span class="nd">@property</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>    <span class="k">def</span> <span class="nf">ms1_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        list : A list of MS1 scan numbers for the dataset.</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>    <span class="nd">@property</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">        LCMSParameters : The parameters used for the LC-MS analysis.</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramsinstance</span><span class="p">):</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">        Sets the parameters used for the LC-MS analysis.</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">        Parameters</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">        -----------</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">        paramsinstance : LCMSParameters</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">            The parameters used for the LC-MS analysis.</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">paramsinstance</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="nd">@property</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>    <span class="k">def</span> <span class="nf">scans_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">        list : A list of scan numbers for the dataset.</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>    <span class="nd">@scans_number</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>    <span class="k">def</span> <span class="nf">scans_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_numbers_list</span><span class="p">):</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">        Sets the scan numbers for the dataset.</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        Parameters</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">        -----------</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a><span class="sd">        scan_numbers_list : list</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">            A list of scan numbers for the dataset.</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="n">scan_numbers_list</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>    <span class="nd">@property</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>    <span class="k">def</span> <span class="nf">retention_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">        numpy.ndarray : An array of retention times for the dataset.</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>    <span class="nd">@retention_time</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>    <span class="k">def</span> <span class="nf">retention_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rt_list</span><span class="p">):</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">        Sets the retention times for the dataset.</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        Parameters</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">        -----------</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">        rt_list : list</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">            A list of retention times for the dataset.</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rt_list</span><span class="p">)</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="nd">@property</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>    <span class="k">def</span> <span class="nf">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">        numpy.ndarray : An array of TIC values for the dataset.</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>    <span class="nd">@tic</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>    <span class="k">def</span> <span class="nf">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tic_list</span><span class="p">):</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        Sets the TIC values for the dataset.</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">        Parameters</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">        -----------</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">        tic_list : list</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">            A list of TIC values for the dataset.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tic_list</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="MassSpectraBase">
                            <input id="MassSpectraBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MassSpectraBase</span>:

                <label class="view-source-button" for="MassSpectraBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MassSpectraBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MassSpectraBase-16"><a href="#MassSpectraBase-16"><span class="linenos"> 16</span></a><span class="k">class</span> <span class="nc">MassSpectraBase</span><span class="p">:</span>
</span><span id="MassSpectraBase-17"><a href="#MassSpectraBase-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for mass spectra objects.</span>
</span><span id="MassSpectraBase-18"><a href="#MassSpectraBase-18"><span class="linenos"> 18</span></a>
</span><span id="MassSpectraBase-19"><a href="#MassSpectraBase-19"><span class="linenos"> 19</span></a><span class="sd">    Parameters</span>
</span><span id="MassSpectraBase-20"><a href="#MassSpectraBase-20"><span class="linenos"> 20</span></a><span class="sd">    -----------</span>
</span><span id="MassSpectraBase-21"><a href="#MassSpectraBase-21"><span class="linenos"> 21</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="MassSpectraBase-22"><a href="#MassSpectraBase-22"><span class="linenos"> 22</span></a><span class="sd">        The location of the file containing the mass spectra data.</span>
</span><span id="MassSpectraBase-23"><a href="#MassSpectraBase-23"><span class="linenos"> 23</span></a><span class="sd">    analyzer : str, optional</span>
</span><span id="MassSpectraBase-24"><a href="#MassSpectraBase-24"><span class="linenos"> 24</span></a><span class="sd">        The type of analyzer used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="MassSpectraBase-25"><a href="#MassSpectraBase-25"><span class="linenos"> 25</span></a><span class="sd">    instrument_label : str, optional</span>
</span><span id="MassSpectraBase-26"><a href="#MassSpectraBase-26"><span class="linenos"> 26</span></a><span class="sd">        The type of instrument used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="MassSpectraBase-27"><a href="#MassSpectraBase-27"><span class="linenos"> 27</span></a><span class="sd">    sample_name : str, optional</span>
</span><span id="MassSpectraBase-28"><a href="#MassSpectraBase-28"><span class="linenos"> 28</span></a><span class="sd">        The name of the sample; defaults to the file name if not provided to the parser. Defaults to None.</span>
</span><span id="MassSpectraBase-29"><a href="#MassSpectraBase-29"><span class="linenos"> 29</span></a><span class="sd">    spectra_parser : object, optional</span>
</span><span id="MassSpectraBase-30"><a href="#MassSpectraBase-30"><span class="linenos"> 30</span></a><span class="sd">        The spectra parser object used to create the mass spectra object. Defaults to None.</span>
</span><span id="MassSpectraBase-31"><a href="#MassSpectraBase-31"><span class="linenos"> 31</span></a>
</span><span id="MassSpectraBase-32"><a href="#MassSpectraBase-32"><span class="linenos"> 32</span></a><span class="sd">    Attributes</span>
</span><span id="MassSpectraBase-33"><a href="#MassSpectraBase-33"><span class="linenos"> 33</span></a><span class="sd">    -----------</span>
</span><span id="MassSpectraBase-34"><a href="#MassSpectraBase-34"><span class="linenos"> 34</span></a><span class="sd">    spectra_parser_class : class</span>
</span><span id="MassSpectraBase-35"><a href="#MassSpectraBase-35"><span class="linenos"> 35</span></a><span class="sd">        The class of the spectra parser used to create the mass spectra object.</span>
</span><span id="MassSpectraBase-36"><a href="#MassSpectraBase-36"><span class="linenos"> 36</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="MassSpectraBase-37"><a href="#MassSpectraBase-37"><span class="linenos"> 37</span></a><span class="sd">        The location of the file containing the mass spectra data.</span>
</span><span id="MassSpectraBase-38"><a href="#MassSpectraBase-38"><span class="linenos"> 38</span></a><span class="sd">    sample_name : str</span>
</span><span id="MassSpectraBase-39"><a href="#MassSpectraBase-39"><span class="linenos"> 39</span></a><span class="sd">        The name of the sample; defaults to the file name if not provided to the parser.</span>
</span><span id="MassSpectraBase-40"><a href="#MassSpectraBase-40"><span class="linenos"> 40</span></a><span class="sd">    analyzer : str</span>
</span><span id="MassSpectraBase-41"><a href="#MassSpectraBase-41"><span class="linenos"> 41</span></a><span class="sd">        The type of analyzer used to generate the mass spectra data. Derived from the spectra parser.</span>
</span><span id="MassSpectraBase-42"><a href="#MassSpectraBase-42"><span class="linenos"> 42</span></a><span class="sd">    instrument_label : str</span>
</span><span id="MassSpectraBase-43"><a href="#MassSpectraBase-43"><span class="linenos"> 43</span></a><span class="sd">        The type of instrument used to generate the mass spectra data. Derived from the spectra parser.</span>
</span><span id="MassSpectraBase-44"><a href="#MassSpectraBase-44"><span class="linenos"> 44</span></a><span class="sd">    _scan_info : dict</span>
</span><span id="MassSpectraBase-45"><a href="#MassSpectraBase-45"><span class="linenos"> 45</span></a><span class="sd">        A dictionary containing the scan data with columns for scan number, scan time, ms level, precursor m/z,</span>
</span><span id="MassSpectraBase-46"><a href="#MassSpectraBase-46"><span class="linenos"> 46</span></a><span class="sd">        scan text, and scan window (lower and upper).</span>
</span><span id="MassSpectraBase-47"><a href="#MassSpectraBase-47"><span class="linenos"> 47</span></a><span class="sd">        Associated with the property scan_df, which returns a pandas DataFrame or can set this attribute from a pandas DataFrame.</span>
</span><span id="MassSpectraBase-48"><a href="#MassSpectraBase-48"><span class="linenos"> 48</span></a><span class="sd">    _ms : dict</span>
</span><span id="MassSpectraBase-49"><a href="#MassSpectraBase-49"><span class="linenos"> 49</span></a><span class="sd">        A dictionary containing mass spectra for the dataset, keys of dictionary are scan numbers. Initialized as an empty dictionary.</span>
</span><span id="MassSpectraBase-50"><a href="#MassSpectraBase-50"><span class="linenos"> 50</span></a><span class="sd">    _ms_unprocessed: dictionary of pandas.DataFrames or None</span>
</span><span id="MassSpectraBase-51"><a href="#MassSpectraBase-51"><span class="linenos"> 51</span></a><span class="sd">        A dictionary of unprocssed mass spectra data, as an (optional) intermediate data product for peak picking.</span>
</span><span id="MassSpectraBase-52"><a href="#MassSpectraBase-52"><span class="linenos"> 52</span></a><span class="sd">        Key is ms_level, and value is dataframe with columns for scan number, m/z, and intensity. Default is None.</span>
</span><span id="MassSpectraBase-53"><a href="#MassSpectraBase-53"><span class="linenos"> 53</span></a>
</span><span id="MassSpectraBase-54"><a href="#MassSpectraBase-54"><span class="linenos"> 54</span></a><span class="sd">    Methods</span>
</span><span id="MassSpectraBase-55"><a href="#MassSpectraBase-55"><span class="linenos"> 55</span></a><span class="sd">    --------</span>
</span><span id="MassSpectraBase-56"><a href="#MassSpectraBase-56"><span class="linenos"> 56</span></a><span class="sd">    * add_mass_spectra(scan_list, spectrum_mode: str = &#39;profile&#39;, use_parser = True, auto_process=True).</span>
</span><span id="MassSpectraBase-57"><a href="#MassSpectraBase-57"><span class="linenos"> 57</span></a><span class="sd">        Add mass spectra (or singlel mass spectrum) to _ms slot, from a list of scans</span>
</span><span id="MassSpectraBase-58"><a href="#MassSpectraBase-58"><span class="linenos"> 58</span></a><span class="sd">    * get_time_of_scan_id(scan).</span>
</span><span id="MassSpectraBase-59"><a href="#MassSpectraBase-59"><span class="linenos"> 59</span></a><span class="sd">        Returns the scan time for the specified scan number.</span>
</span><span id="MassSpectraBase-60"><a href="#MassSpectraBase-60"><span class="linenos"> 60</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-61"><a href="#MassSpectraBase-61"><span class="linenos"> 61</span></a>
</span><span id="MassSpectraBase-62"><a href="#MassSpectraBase-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MassSpectraBase-63"><a href="#MassSpectraBase-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MassSpectraBase-64"><a href="#MassSpectraBase-64"><span class="linenos"> 64</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="MassSpectraBase-65"><a href="#MassSpectraBase-65"><span class="linenos"> 65</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase-66"><a href="#MassSpectraBase-66"><span class="linenos"> 66</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase-67"><a href="#MassSpectraBase-67"><span class="linenos"> 67</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase-68"><a href="#MassSpectraBase-68"><span class="linenos"> 68</span></a>        <span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase-69"><a href="#MassSpectraBase-69"><span class="linenos"> 69</span></a>    <span class="p">):</span>
</span><span id="MassSpectraBase-70"><a href="#MassSpectraBase-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MassSpectraBase-71"><a href="#MassSpectraBase-71"><span class="linenos"> 71</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MassSpectraBase-72"><a href="#MassSpectraBase-72"><span class="linenos"> 72</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase-73"><a href="#MassSpectraBase-73"><span class="linenos"> 73</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MassSpectraBase-74"><a href="#MassSpectraBase-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="MassSpectraBase-75"><a href="#MassSpectraBase-75"><span class="linenos"> 75</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;File does not exist: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_location</span><span class="p">))</span>
</span><span id="MassSpectraBase-76"><a href="#MassSpectraBase-76"><span class="linenos"> 76</span></a>
</span><span id="MassSpectraBase-77"><a href="#MassSpectraBase-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="n">sample_name</span><span class="p">:</span>
</span><span id="MassSpectraBase-78"><a href="#MassSpectraBase-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">sample_name</span>
</span><span id="MassSpectraBase-79"><a href="#MassSpectraBase-79"><span class="linenos"> 79</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase-80"><a href="#MassSpectraBase-80"><span class="linenos"> 80</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">stem</span>
</span><span id="MassSpectraBase-81"><a href="#MassSpectraBase-81"><span class="linenos"> 81</span></a>
</span><span id="MassSpectraBase-82"><a href="#MassSpectraBase-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MassSpectraBase-83"><a href="#MassSpectraBase-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">analyzer</span>
</span><span id="MassSpectraBase-84"><a href="#MassSpectraBase-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">=</span> <span class="n">instrument_label</span>
</span><span id="MassSpectraBase-85"><a href="#MassSpectraBase-85"><span class="linenos"> 85</span></a>
</span><span id="MassSpectraBase-86"><a href="#MassSpectraBase-86"><span class="linenos"> 86</span></a>        <span class="c1"># Add the spectra parser class to the object if it is not None</span>
</span><span id="MassSpectraBase-87"><a href="#MassSpectraBase-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">spectra_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase-88"><a href="#MassSpectraBase-88"><span class="linenos"> 88</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser_class</span> <span class="o">=</span> <span class="n">spectra_parser</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="MassSpectraBase-89"><a href="#MassSpectraBase-89"><span class="linenos"> 89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span> <span class="o">=</span> <span class="n">spectra_parser</span>
</span><span id="MassSpectraBase-90"><a href="#MassSpectraBase-90"><span class="linenos"> 90</span></a>            <span class="c1"># Check that spectra_pasrser.sample_name is same as sample_name etc, raise warning if not</span>
</span><span id="MassSpectraBase-91"><a href="#MassSpectraBase-91"><span class="linenos"> 91</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MassSpectraBase-92"><a href="#MassSpectraBase-92"><span class="linenos"> 92</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MassSpectraBase-93"><a href="#MassSpectraBase-93"><span class="linenos"> 93</span></a>                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">sample_name</span>
</span><span id="MassSpectraBase-94"><a href="#MassSpectraBase-94"><span class="linenos"> 94</span></a>            <span class="p">):</span>
</span><span id="MassSpectraBase-95"><a href="#MassSpectraBase-95"><span class="linenos"> 95</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase-96"><a href="#MassSpectraBase-96"><span class="linenos"> 96</span></a>                    <span class="s2">&quot;sample_name provided to MassSpectraBase object does not match sample_name provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase-97"><a href="#MassSpectraBase-97"><span class="linenos"> 97</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase-98"><a href="#MassSpectraBase-98"><span class="linenos"> 98</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-99"><a href="#MassSpectraBase-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span>
</span><span id="MassSpectraBase-100"><a href="#MassSpectraBase-100"><span class="linenos">100</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase-101"><a href="#MassSpectraBase-101"><span class="linenos">101</span></a>                    <span class="s2">&quot;analyzer provided to MassSpectraBase object does not match analyzer provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase-102"><a href="#MassSpectraBase-102"><span class="linenos">102</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase-103"><a href="#MassSpectraBase-103"><span class="linenos">103</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-104"><a href="#MassSpectraBase-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">:</span>
</span><span id="MassSpectraBase-105"><a href="#MassSpectraBase-105"><span class="linenos">105</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase-106"><a href="#MassSpectraBase-106"><span class="linenos">106</span></a>                    <span class="s2">&quot;instrument provided to MassSpectraBase object does not match instrument provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase-107"><a href="#MassSpectraBase-107"><span class="linenos">107</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase-108"><a href="#MassSpectraBase-108"><span class="linenos">108</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-109"><a href="#MassSpectraBase-109"><span class="linenos">109</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">file_location</span><span class="p">:</span>
</span><span id="MassSpectraBase-110"><a href="#MassSpectraBase-110"><span class="linenos">110</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase-111"><a href="#MassSpectraBase-111"><span class="linenos">111</span></a>                    <span class="s2">&quot;file_location provided to MassSpectraBase object does not match file_location provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase-112"><a href="#MassSpectraBase-112"><span class="linenos">112</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase-113"><a href="#MassSpectraBase-113"><span class="linenos">113</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-114"><a href="#MassSpectraBase-114"><span class="linenos">114</span></a>
</span><span id="MassSpectraBase-115"><a href="#MassSpectraBase-115"><span class="linenos">115</span></a>        <span class="c1"># Instantiate empty dictionaries for scan information and mass spectra</span>
</span><span id="MassSpectraBase-116"><a href="#MassSpectraBase-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MassSpectraBase-117"><a href="#MassSpectraBase-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MassSpectraBase-118"><a href="#MassSpectraBase-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MassSpectraBase-119"><a href="#MassSpectraBase-119"><span class="linenos">119</span></a>
</span><span id="MassSpectraBase-120"><a href="#MassSpectraBase-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">add_mass_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass_spec</span><span class="p">):</span>
</span><span id="MassSpectraBase-121"><a href="#MassSpectraBase-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a mass spectrum to the dataset.</span>
</span><span id="MassSpectraBase-122"><a href="#MassSpectraBase-122"><span class="linenos">122</span></a>
</span><span id="MassSpectraBase-123"><a href="#MassSpectraBase-123"><span class="linenos">123</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase-124"><a href="#MassSpectraBase-124"><span class="linenos">124</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase-125"><a href="#MassSpectraBase-125"><span class="linenos">125</span></a><span class="sd">        mass_spec : MassSpectrum</span>
</span><span id="MassSpectraBase-126"><a href="#MassSpectraBase-126"><span class="linenos">126</span></a><span class="sd">            The corems MassSpectrum object to be added to the dataset.</span>
</span><span id="MassSpectraBase-127"><a href="#MassSpectraBase-127"><span class="linenos">127</span></a>
</span><span id="MassSpectraBase-128"><a href="#MassSpectraBase-128"><span class="linenos">128</span></a><span class="sd">        Notes</span>
</span><span id="MassSpectraBase-129"><a href="#MassSpectraBase-129"><span class="linenos">129</span></a><span class="sd">        -----</span>
</span><span id="MassSpectraBase-130"><a href="#MassSpectraBase-130"><span class="linenos">130</span></a><span class="sd">        This is a helper function for the add_mass_spectra() method, and is not intended to be called directly.</span>
</span><span id="MassSpectraBase-131"><a href="#MassSpectraBase-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-132"><a href="#MassSpectraBase-132"><span class="linenos">132</span></a>        <span class="c1"># check if mass_spec has a scan_number attribute</span>
</span><span id="MassSpectraBase-133"><a href="#MassSpectraBase-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mass_spec</span><span class="p">,</span> <span class="s2">&quot;scan_number&quot;</span><span class="p">):</span>
</span><span id="MassSpectraBase-134"><a href="#MassSpectraBase-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase-135"><a href="#MassSpectraBase-135"><span class="linenos">135</span></a>                <span class="s2">&quot;Mass spectrum must have a scan_number attribute to be added to the dataset correctly&quot;</span>
</span><span id="MassSpectraBase-136"><a href="#MassSpectraBase-136"><span class="linenos">136</span></a>            <span class="p">)</span>
</span><span id="MassSpectraBase-137"><a href="#MassSpectraBase-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span><span class="n">mass_spec</span><span class="o">.</span><span class="n">scan_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_spec</span>
</span><span id="MassSpectraBase-138"><a href="#MassSpectraBase-138"><span class="linenos">138</span></a>
</span><span id="MassSpectraBase-139"><a href="#MassSpectraBase-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">add_mass_spectra</span><span class="p">(</span>
</span><span id="MassSpectraBase-140"><a href="#MassSpectraBase-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MassSpectraBase-141"><a href="#MassSpectraBase-141"><span class="linenos">141</span></a>        <span class="n">scan_list</span><span class="p">,</span>
</span><span id="MassSpectraBase-142"><a href="#MassSpectraBase-142"><span class="linenos">142</span></a>        <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase-143"><a href="#MassSpectraBase-143"><span class="linenos">143</span></a>        <span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MassSpectraBase-144"><a href="#MassSpectraBase-144"><span class="linenos">144</span></a>        <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MassSpectraBase-145"><a href="#MassSpectraBase-145"><span class="linenos">145</span></a>        <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MassSpectraBase-146"><a href="#MassSpectraBase-146"><span class="linenos">146</span></a>        <span class="n">ms_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase-147"><a href="#MassSpectraBase-147"><span class="linenos">147</span></a>    <span class="p">):</span>
</span><span id="MassSpectraBase-148"><a href="#MassSpectraBase-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add mass spectra to _ms dictionary, from a list of scans or single scan</span>
</span><span id="MassSpectraBase-149"><a href="#MassSpectraBase-149"><span class="linenos">149</span></a>
</span><span id="MassSpectraBase-150"><a href="#MassSpectraBase-150"><span class="linenos">150</span></a><span class="sd">        Notes</span>
</span><span id="MassSpectraBase-151"><a href="#MassSpectraBase-151"><span class="linenos">151</span></a><span class="sd">        -----</span>
</span><span id="MassSpectraBase-152"><a href="#MassSpectraBase-152"><span class="linenos">152</span></a><span class="sd">        The mass spectra will inherit the mass_spectrum, ms_peak, and molecular_search parameters from the LCMSBase object.</span>
</span><span id="MassSpectraBase-153"><a href="#MassSpectraBase-153"><span class="linenos">153</span></a>
</span><span id="MassSpectraBase-154"><a href="#MassSpectraBase-154"><span class="linenos">154</span></a>
</span><span id="MassSpectraBase-155"><a href="#MassSpectraBase-155"><span class="linenos">155</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase-156"><a href="#MassSpectraBase-156"><span class="linenos">156</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase-157"><a href="#MassSpectraBase-157"><span class="linenos">157</span></a><span class="sd">        scan_list : list of ints</span>
</span><span id="MassSpectraBase-158"><a href="#MassSpectraBase-158"><span class="linenos">158</span></a><span class="sd">            List of scans to use to populate _ms slot</span>
</span><span id="MassSpectraBase-159"><a href="#MassSpectraBase-159"><span class="linenos">159</span></a><span class="sd">        spectrum_mode : str or None</span>
</span><span id="MassSpectraBase-160"><a href="#MassSpectraBase-160"><span class="linenos">160</span></a><span class="sd">            The spectrum mode to use for the mass spectra.</span>
</span><span id="MassSpectraBase-161"><a href="#MassSpectraBase-161"><span class="linenos">161</span></a><span class="sd">            If None, method will use the spectrum mode from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="MassSpectraBase-162"><a href="#MassSpectraBase-162"><span class="linenos">162</span></a><span class="sd">            Defaults to None.</span>
</span><span id="MassSpectraBase-163"><a href="#MassSpectraBase-163"><span class="linenos">163</span></a><span class="sd">        ms_level : int, optional</span>
</span><span id="MassSpectraBase-164"><a href="#MassSpectraBase-164"><span class="linenos">164</span></a><span class="sd">            The MS level to use for the mass spectra.</span>
</span><span id="MassSpectraBase-165"><a href="#MassSpectraBase-165"><span class="linenos">165</span></a><span class="sd">            This is used to pass the molecular_search parameters from the LCMS object to the individual MassSpectrum objects.</span>
</span><span id="MassSpectraBase-166"><a href="#MassSpectraBase-166"><span class="linenos">166</span></a><span class="sd">            Defaults to 1.</span>
</span><span id="MassSpectraBase-167"><a href="#MassSpectraBase-167"><span class="linenos">167</span></a><span class="sd">        using_parser : bool</span>
</span><span id="MassSpectraBase-168"><a href="#MassSpectraBase-168"><span class="linenos">168</span></a><span class="sd">            Whether to use the mass spectra parser to get the mass spectra.  Defaults to True.</span>
</span><span id="MassSpectraBase-169"><a href="#MassSpectraBase-169"><span class="linenos">169</span></a><span class="sd">        auto_process : bool</span>
</span><span id="MassSpectraBase-170"><a href="#MassSpectraBase-170"><span class="linenos">170</span></a><span class="sd">            Whether to auto-process the mass spectra.  Defaults to True.</span>
</span><span id="MassSpectraBase-171"><a href="#MassSpectraBase-171"><span class="linenos">171</span></a><span class="sd">        ms_params : MSParameters or None</span>
</span><span id="MassSpectraBase-172"><a href="#MassSpectraBase-172"><span class="linenos">172</span></a><span class="sd">            The mass spectrum parameters to use for the mass spectra.  If None, uses the globally set MSParameters.</span>
</span><span id="MassSpectraBase-173"><a href="#MassSpectraBase-173"><span class="linenos">173</span></a>
</span><span id="MassSpectraBase-174"><a href="#MassSpectraBase-174"><span class="linenos">174</span></a><span class="sd">        Raises</span>
</span><span id="MassSpectraBase-175"><a href="#MassSpectraBase-175"><span class="linenos">175</span></a><span class="sd">        ------</span>
</span><span id="MassSpectraBase-176"><a href="#MassSpectraBase-176"><span class="linenos">176</span></a><span class="sd">        TypeError</span>
</span><span id="MassSpectraBase-177"><a href="#MassSpectraBase-177"><span class="linenos">177</span></a><span class="sd">            If scan_list is not a list of ints</span>
</span><span id="MassSpectraBase-178"><a href="#MassSpectraBase-178"><span class="linenos">178</span></a><span class="sd">        ValueError</span>
</span><span id="MassSpectraBase-179"><a href="#MassSpectraBase-179"><span class="linenos">179</span></a><span class="sd">            If polarity is not &#39;positive&#39; or &#39;negative&#39;</span>
</span><span id="MassSpectraBase-180"><a href="#MassSpectraBase-180"><span class="linenos">180</span></a><span class="sd">            If ms_level is not 1 or 2</span>
</span><span id="MassSpectraBase-181"><a href="#MassSpectraBase-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-182"><a href="#MassSpectraBase-182"><span class="linenos">182</span></a>
</span><span id="MassSpectraBase-183"><a href="#MassSpectraBase-183"><span class="linenos">183</span></a>        <span class="c1"># check if scan_list is a list or a single int; if single int, convert to list</span>
</span><span id="MassSpectraBase-184"><a href="#MassSpectraBase-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MassSpectraBase-185"><a href="#MassSpectraBase-185"><span class="linenos">185</span></a>            <span class="n">scan_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan_list</span><span class="p">]</span>
</span><span id="MassSpectraBase-186"><a href="#MassSpectraBase-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="MassSpectraBase-187"><a href="#MassSpectraBase-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scan_list must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MassSpectraBase-188"><a href="#MassSpectraBase-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_list</span><span class="p">:</span>
</span><span id="MassSpectraBase-189"><a href="#MassSpectraBase-189"><span class="linenos">189</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MassSpectraBase-190"><a href="#MassSpectraBase-190"><span class="linenos">190</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scan_list must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MassSpectraBase-191"><a href="#MassSpectraBase-191"><span class="linenos">191</span></a>
</span><span id="MassSpectraBase-192"><a href="#MassSpectraBase-192"><span class="linenos">192</span></a>        <span class="c1"># set polarity to -1 if negative mode, 1 if positive mode (for mass spectrum creation)</span>
</span><span id="MassSpectraBase-193"><a href="#MassSpectraBase-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
</span><span id="MassSpectraBase-194"><a href="#MassSpectraBase-194"><span class="linenos">194</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="MassSpectraBase-195"><a href="#MassSpectraBase-195"><span class="linenos">195</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
</span><span id="MassSpectraBase-196"><a href="#MassSpectraBase-196"><span class="linenos">196</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MassSpectraBase-197"><a href="#MassSpectraBase-197"><span class="linenos">197</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase-198"><a href="#MassSpectraBase-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase-199"><a href="#MassSpectraBase-199"><span class="linenos">199</span></a>                <span class="s2">&quot;Polarity not set for dataset, must be a either &#39;positive&#39; or &#39;negative&#39;&quot;</span>
</span><span id="MassSpectraBase-200"><a href="#MassSpectraBase-200"><span class="linenos">200</span></a>            <span class="p">)</span>
</span><span id="MassSpectraBase-201"><a href="#MassSpectraBase-201"><span class="linenos">201</span></a>
</span><span id="MassSpectraBase-202"><a href="#MassSpectraBase-202"><span class="linenos">202</span></a>        <span class="c1"># is not using_parser, check that ms1 and ms2 are not None</span>
</span><span id="MassSpectraBase-203"><a href="#MassSpectraBase-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase-204"><a href="#MassSpectraBase-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="MassSpectraBase-205"><a href="#MassSpectraBase-205"><span class="linenos">205</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase-206"><a href="#MassSpectraBase-206"><span class="linenos">206</span></a>                    <span class="s2">&quot;ms_level </span><span class="si">{}</span><span class="s2"> not found in _ms_unprocessed dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="MassSpectraBase-207"><a href="#MassSpectraBase-207"><span class="linenos">207</span></a>                        <span class="n">ms_level</span>
</span><span id="MassSpectraBase-208"><a href="#MassSpectraBase-208"><span class="linenos">208</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase-209"><a href="#MassSpectraBase-209"><span class="linenos">209</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-210"><a href="#MassSpectraBase-210"><span class="linenos">210</span></a>
</span><span id="MassSpectraBase-211"><a href="#MassSpectraBase-211"><span class="linenos">211</span></a>        <span class="n">scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_list</span><span class="p">))</span>
</span><span id="MassSpectraBase-212"><a href="#MassSpectraBase-212"><span class="linenos">212</span></a>        <span class="n">scan_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="MassSpectraBase-213"><a href="#MassSpectraBase-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase-214"><a href="#MassSpectraBase-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase-215"><a href="#MassSpectraBase-215"><span class="linenos">215</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase-216"><a href="#MassSpectraBase-216"><span class="linenos">216</span></a>                    <span class="s2">&quot;No unprocessed data found for ms_level </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="MassSpectraBase-217"><a href="#MassSpectraBase-217"><span class="linenos">217</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-218"><a href="#MassSpectraBase-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MassSpectraBase-219"><a href="#MassSpectraBase-219"><span class="linenos">219</span></a>                <span class="nb">len</span><span class="p">(</span>
</span><span id="MassSpectraBase-220"><a href="#MassSpectraBase-220"><span class="linenos">220</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
</span><span id="MassSpectraBase-221"><a href="#MassSpectraBase-221"><span class="linenos">221</span></a>                        <span class="n">scan_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="MassSpectraBase-222"><a href="#MassSpectraBase-222"><span class="linenos">222</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase-223"><a href="#MassSpectraBase-223"><span class="linenos">223</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-224"><a href="#MassSpectraBase-224"><span class="linenos">224</span></a>                <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="MassSpectraBase-225"><a href="#MassSpectraBase-225"><span class="linenos">225</span></a>            <span class="p">):</span>
</span><span id="MassSpectraBase-226"><a href="#MassSpectraBase-226"><span class="linenos">226</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase-227"><a href="#MassSpectraBase-227"><span class="linenos">227</span></a>                    <span class="s2">&quot;Not all scans in scan_list are present in the unprocessed data&quot;</span>
</span><span id="MassSpectraBase-228"><a href="#MassSpectraBase-228"><span class="linenos">228</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-229"><a href="#MassSpectraBase-229"><span class="linenos">229</span></a>            <span class="c1"># Prepare the ms_df for parsing</span>
</span><span id="MassSpectraBase-230"><a href="#MassSpectraBase-230"><span class="linenos">230</span></a>            <span class="n">ms_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MassSpectraBase-231"><a href="#MassSpectraBase-231"><span class="linenos">231</span></a>
</span><span id="MassSpectraBase-232"><a href="#MassSpectraBase-232"><span class="linenos">232</span></a>        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_list</span><span class="p">:</span>
</span><span id="MassSpectraBase-233"><a href="#MassSpectraBase-233"><span class="linenos">233</span></a>            <span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MassSpectraBase-234"><a href="#MassSpectraBase-234"><span class="linenos">234</span></a>            <span class="k">if</span> <span class="n">spectrum_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase-235"><a href="#MassSpectraBase-235"><span class="linenos">235</span></a>                <span class="c1"># get spectrum mode from _scan_info</span>
</span><span id="MassSpectraBase-236"><a href="#MassSpectraBase-236"><span class="linenos">236</span></a>                <span class="n">spectrum_mode_scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;ms_format&quot;</span><span class="p">]</span>
</span><span id="MassSpectraBase-237"><a href="#MassSpectraBase-237"><span class="linenos">237</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase-238"><a href="#MassSpectraBase-238"><span class="linenos">238</span></a>                <span class="n">spectrum_mode_scan</span> <span class="o">=</span> <span class="n">spectrum_mode</span>
</span><span id="MassSpectraBase-239"><a href="#MassSpectraBase-239"><span class="linenos">239</span></a>            <span class="c1"># Instantiate the mass spectrum object using the parser or the unprocessed data</span>
</span><span id="MassSpectraBase-240"><a href="#MassSpectraBase-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase-241"><a href="#MassSpectraBase-241"><span class="linenos">241</span></a>                <span class="n">my_ms_df</span> <span class="o">=</span> <span class="n">ms_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scan</span><span class="p">]</span>
</span><span id="MassSpectraBase-242"><a href="#MassSpectraBase-242"><span class="linenos">242</span></a>                <span class="k">if</span> <span class="n">spectrum_mode_scan</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
</span><span id="MassSpectraBase-243"><a href="#MassSpectraBase-243"><span class="linenos">243</span></a>                    <span class="c1"># Check this - it might be better to use the MassSpectrumProfile class to instantiate the mass spectrum</span>
</span><span id="MassSpectraBase-244"><a href="#MassSpectraBase-244"><span class="linenos">244</span></a>                    <span class="n">ms</span> <span class="o">=</span> <span class="n">ms_from_array_profile</span><span class="p">(</span>
</span><span id="MassSpectraBase-245"><a href="#MassSpectraBase-245"><span class="linenos">245</span></a>                        <span class="n">my_ms_df</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="MassSpectraBase-246"><a href="#MassSpectraBase-246"><span class="linenos">246</span></a>                        <span class="n">my_ms_df</span><span class="o">.</span><span class="n">intensity</span><span class="p">,</span>
</span><span id="MassSpectraBase-247"><a href="#MassSpectraBase-247"><span class="linenos">247</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MassSpectraBase-248"><a href="#MassSpectraBase-248"><span class="linenos">248</span></a>                        <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span>
</span><span id="MassSpectraBase-249"><a href="#MassSpectraBase-249"><span class="linenos">249</span></a>                        <span class="n">auto_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MassSpectraBase-250"><a href="#MassSpectraBase-250"><span class="linenos">250</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase-251"><a href="#MassSpectraBase-251"><span class="linenos">251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase-252"><a href="#MassSpectraBase-252"><span class="linenos">252</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase-253"><a href="#MassSpectraBase-253"><span class="linenos">253</span></a>                        <span class="s2">&quot;Only profile mode is supported for unprocessed data&quot;</span>
</span><span id="MassSpectraBase-254"><a href="#MassSpectraBase-254"><span class="linenos">254</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase-255"><a href="#MassSpectraBase-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase-256"><a href="#MassSpectraBase-256"><span class="linenos">256</span></a>                <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">get_mass_spectrum_from_scan</span><span class="p">(</span>
</span><span id="MassSpectraBase-257"><a href="#MassSpectraBase-257"><span class="linenos">257</span></a>                    <span class="n">scan_number</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
</span><span id="MassSpectraBase-258"><a href="#MassSpectraBase-258"><span class="linenos">258</span></a>                    <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode_scan</span><span class="p">,</span>
</span><span id="MassSpectraBase-259"><a href="#MassSpectraBase-259"><span class="linenos">259</span></a>                    <span class="n">auto_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MassSpectraBase-260"><a href="#MassSpectraBase-260"><span class="linenos">260</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase-261"><a href="#MassSpectraBase-261"><span class="linenos">261</span></a>
</span><span id="MassSpectraBase-262"><a href="#MassSpectraBase-262"><span class="linenos">262</span></a>            <span class="c1"># Set the mass spectrum parameters, auto-process if auto_process is True, and add to the dataset</span>
</span><span id="MassSpectraBase-263"><a href="#MassSpectraBase-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="n">ms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase-264"><a href="#MassSpectraBase-264"><span class="linenos">264</span></a>                <span class="k">if</span> <span class="n">ms_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase-265"><a href="#MassSpectraBase-265"><span class="linenos">265</span></a>                    <span class="n">ms</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">ms_params</span>
</span><span id="MassSpectraBase-266"><a href="#MassSpectraBase-266"><span class="linenos">266</span></a>                <span class="n">ms</span><span class="o">.</span><span class="n">scan_number</span> <span class="o">=</span> <span class="n">scan</span>
</span><span id="MassSpectraBase-267"><a href="#MassSpectraBase-267"><span class="linenos">267</span></a>                <span class="k">if</span> <span class="n">auto_process</span><span class="p">:</span>
</span><span id="MassSpectraBase-268"><a href="#MassSpectraBase-268"><span class="linenos">268</span></a>                    <span class="n">ms</span><span class="o">.</span><span class="n">process_mass_spec</span><span class="p">()</span>
</span><span id="MassSpectraBase-269"><a href="#MassSpectraBase-269"><span class="linenos">269</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectrum</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</span><span id="MassSpectraBase-270"><a href="#MassSpectraBase-270"><span class="linenos">270</span></a>
</span><span id="MassSpectraBase-271"><a href="#MassSpectraBase-271"><span class="linenos">271</span></a>    <span class="k">def</span> <span class="nf">get_time_of_scan_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
</span><span id="MassSpectraBase-272"><a href="#MassSpectraBase-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the scan time for the specified scan number.</span>
</span><span id="MassSpectraBase-273"><a href="#MassSpectraBase-273"><span class="linenos">273</span></a>
</span><span id="MassSpectraBase-274"><a href="#MassSpectraBase-274"><span class="linenos">274</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase-275"><a href="#MassSpectraBase-275"><span class="linenos">275</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase-276"><a href="#MassSpectraBase-276"><span class="linenos">276</span></a><span class="sd">        scan : int</span>
</span><span id="MassSpectraBase-277"><a href="#MassSpectraBase-277"><span class="linenos">277</span></a><span class="sd">            The scan number of the desired scan time.</span>
</span><span id="MassSpectraBase-278"><a href="#MassSpectraBase-278"><span class="linenos">278</span></a>
</span><span id="MassSpectraBase-279"><a href="#MassSpectraBase-279"><span class="linenos">279</span></a><span class="sd">        Returns</span>
</span><span id="MassSpectraBase-280"><a href="#MassSpectraBase-280"><span class="linenos">280</span></a><span class="sd">        --------</span>
</span><span id="MassSpectraBase-281"><a href="#MassSpectraBase-281"><span class="linenos">281</span></a><span class="sd">        float</span>
</span><span id="MassSpectraBase-282"><a href="#MassSpectraBase-282"><span class="linenos">282</span></a><span class="sd">            The scan time for the specified scan number (in minutes).</span>
</span><span id="MassSpectraBase-283"><a href="#MassSpectraBase-283"><span class="linenos">283</span></a>
</span><span id="MassSpectraBase-284"><a href="#MassSpectraBase-284"><span class="linenos">284</span></a><span class="sd">        Raises</span>
</span><span id="MassSpectraBase-285"><a href="#MassSpectraBase-285"><span class="linenos">285</span></a><span class="sd">        ------</span>
</span><span id="MassSpectraBase-286"><a href="#MassSpectraBase-286"><span class="linenos">286</span></a><span class="sd">        ValueError</span>
</span><span id="MassSpectraBase-287"><a href="#MassSpectraBase-287"><span class="linenos">287</span></a><span class="sd">            If no scan time is found for the specified scan number.</span>
</span><span id="MassSpectraBase-288"><a href="#MassSpectraBase-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-289"><a href="#MassSpectraBase-289"><span class="linenos">289</span></a>        <span class="c1"># Check if _retenion_time_list is empty and raise error if so</span>
</span><span id="MassSpectraBase-290"><a href="#MassSpectraBase-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MassSpectraBase-291"><a href="#MassSpectraBase-291"><span class="linenos">291</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No retention times found in dataset&quot;</span><span class="p">)</span>
</span><span id="MassSpectraBase-292"><a href="#MassSpectraBase-292"><span class="linenos">292</span></a>        <span class="n">rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">scan</span><span class="p">)]</span>
</span><span id="MassSpectraBase-293"><a href="#MassSpectraBase-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">rt</span>
</span><span id="MassSpectraBase-294"><a href="#MassSpectraBase-294"><span class="linenos">294</span></a>
</span><span id="MassSpectraBase-295"><a href="#MassSpectraBase-295"><span class="linenos">295</span></a>    <span class="nd">@property</span>
</span><span id="MassSpectraBase-296"><a href="#MassSpectraBase-296"><span class="linenos">296</span></a>    <span class="k">def</span> <span class="nf">scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MassSpectraBase-297"><a href="#MassSpectraBase-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-298"><a href="#MassSpectraBase-298"><span class="linenos">298</span></a><span class="sd">        pandas.DataFrame : A pandas DataFrame containing the scan info data with columns for scan number, scan time, ms level, precursor m/z, scan text, and scan window (lower and upper).</span>
</span><span id="MassSpectraBase-299"><a href="#MassSpectraBase-299"><span class="linenos">299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-300"><a href="#MassSpectraBase-300"><span class="linenos">300</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span><span class="p">)</span>
</span><span id="MassSpectraBase-301"><a href="#MassSpectraBase-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">scan_df</span>
</span><span id="MassSpectraBase-302"><a href="#MassSpectraBase-302"><span class="linenos">302</span></a>        
</span><span id="MassSpectraBase-303"><a href="#MassSpectraBase-303"><span class="linenos">303</span></a>    <span class="nd">@property</span>
</span><span id="MassSpectraBase-304"><a href="#MassSpectraBase-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MassSpectraBase-305"><a href="#MassSpectraBase-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-306"><a href="#MassSpectraBase-306"><span class="linenos">306</span></a><span class="sd">        dictionary : contains the key associated with mass spectra and values are the associated MassSpecProfiles</span>
</span><span id="MassSpectraBase-307"><a href="#MassSpectraBase-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-308"><a href="#MassSpectraBase-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span>
</span><span id="MassSpectraBase-309"><a href="#MassSpectraBase-309"><span class="linenos">309</span></a>
</span><span id="MassSpectraBase-310"><a href="#MassSpectraBase-310"><span class="linenos">310</span></a>    
</span><span id="MassSpectraBase-311"><a href="#MassSpectraBase-311"><span class="linenos">311</span></a>    <span class="nd">@scan_df</span><span class="o">.</span><span class="n">setter</span>
</span><span id="MassSpectraBase-312"><a href="#MassSpectraBase-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="nf">scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="MassSpectraBase-313"><a href="#MassSpectraBase-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-314"><a href="#MassSpectraBase-314"><span class="linenos">314</span></a><span class="sd">        Sets the scan data for the dataset.</span>
</span><span id="MassSpectraBase-315"><a href="#MassSpectraBase-315"><span class="linenos">315</span></a>
</span><span id="MassSpectraBase-316"><a href="#MassSpectraBase-316"><span class="linenos">316</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase-317"><a href="#MassSpectraBase-317"><span class="linenos">317</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase-318"><a href="#MassSpectraBase-318"><span class="linenos">318</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="MassSpectraBase-319"><a href="#MassSpectraBase-319"><span class="linenos">319</span></a><span class="sd">            A pandas DataFrame containing the scan data with columns for scan number, scan time, ms level,</span>
</span><span id="MassSpectraBase-320"><a href="#MassSpectraBase-320"><span class="linenos">320</span></a><span class="sd">            precursor m/z, scan text, and scan window (lower and upper).</span>
</span><span id="MassSpectraBase-321"><a href="#MassSpectraBase-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase-322"><a href="#MassSpectraBase-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="MassSpectraBase-323"><a href="#MassSpectraBase-323"><span class="linenos">323</span></a>
</span><span id="MassSpectraBase-324"><a href="#MassSpectraBase-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">):</span>
</span><span id="MassSpectraBase-325"><a href="#MassSpectraBase-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scan_number</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base class for mass spectra objects.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>file_location</strong> (str or Path):
The location of the file containing the mass spectra data.</li>
<li><strong>analyzer</strong> (str, optional):
The type of analyzer used to generate the mass spectra data. Defaults to 'Unknown'.</li>
<li><strong>instrument_label</strong> (str, optional):
The type of instrument used to generate the mass spectra data. Defaults to 'Unknown'.</li>
<li><strong>sample_name</strong> (str, optional):
The name of the sample; defaults to the file name if not provided to the parser. Defaults to None.</li>
<li><strong>spectra_parser</strong> (object, optional):
The spectra parser object used to create the mass spectra object. Defaults to None.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>spectra_parser_class</strong> (class):
The class of the spectra parser used to create the mass spectra object.</li>
<li><strong>file_location</strong> (str or Path):
The location of the file containing the mass spectra data.</li>
<li><strong>sample_name</strong> (str):
The name of the sample; defaults to the file name if not provided to the parser.</li>
<li><strong>analyzer</strong> (str):
The type of analyzer used to generate the mass spectra data. Derived from the spectra parser.</li>
<li><strong>instrument_label</strong> (str):
The type of instrument used to generate the mass spectra data. Derived from the spectra parser.</li>
<li><strong>_scan_info</strong> (dict):
A dictionary containing the scan data with columns for scan number, scan time, ms level, precursor m/z,
scan text, and scan window (lower and upper).
Associated with the property scan_df, which returns a pandas DataFrame or can set this attribute from a pandas DataFrame.</li>
<li><strong>_ms</strong> (dict):
A dictionary containing mass spectra for the dataset, keys of dictionary are scan numbers. Initialized as an empty dictionary.</li>
<li><strong>_ms_unprocessed</strong> (dictionary of pandas.DataFrames or None):
A dictionary of unprocssed mass spectra data, as an (optional) intermediate data product for peak picking.
Key is ms_level, and value is dataframe with columns for scan number, m/z, and intensity. Default is None.</li>
</ul>

<h6 id="methods">Methods</h6>

<ul>
<li>add_mass_spectra(scan_list, spectrum_mode: str = 'profile', use_parser = True, auto_process=True).
Add mass spectra (or singlel mass spectrum) to _ms slot, from a list of scans</li>
<li>get_time_of_scan_id(scan).
Returns the scan time for the specified scan number.</li>
</ul>
</div>


                            <div id="MassSpectraBase.__init__" class="classattr">
                                        <input id="MassSpectraBase.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MassSpectraBase</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_location</span>,</span><span class="param">	<span class="n">analyzer</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span>,</span><span class="param">	<span class="n">instrument_label</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span>,</span><span class="param">	<span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MassSpectraBase.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MassSpectraBase.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MassSpectraBase.__init__-62"><a href="#MassSpectraBase.__init__-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MassSpectraBase.__init__-63"><a href="#MassSpectraBase.__init__-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-64"><a href="#MassSpectraBase.__init__-64"><span class="linenos"> 64</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-65"><a href="#MassSpectraBase.__init__-65"><span class="linenos"> 65</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-66"><a href="#MassSpectraBase.__init__-66"><span class="linenos"> 66</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-67"><a href="#MassSpectraBase.__init__-67"><span class="linenos"> 67</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-68"><a href="#MassSpectraBase.__init__-68"><span class="linenos"> 68</span></a>        <span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-69"><a href="#MassSpectraBase.__init__-69"><span class="linenos"> 69</span></a>    <span class="p">):</span>
</span><span id="MassSpectraBase.__init__-70"><a href="#MassSpectraBase.__init__-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MassSpectraBase.__init__-71"><a href="#MassSpectraBase.__init__-71"><span class="linenos"> 71</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MassSpectraBase.__init__-72"><a href="#MassSpectraBase.__init__-72"><span class="linenos"> 72</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-73"><a href="#MassSpectraBase.__init__-73"><span class="linenos"> 73</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MassSpectraBase.__init__-74"><a href="#MassSpectraBase.__init__-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="MassSpectraBase.__init__-75"><a href="#MassSpectraBase.__init__-75"><span class="linenos"> 75</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;File does not exist: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_location</span><span class="p">))</span>
</span><span id="MassSpectraBase.__init__-76"><a href="#MassSpectraBase.__init__-76"><span class="linenos"> 76</span></a>
</span><span id="MassSpectraBase.__init__-77"><a href="#MassSpectraBase.__init__-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="n">sample_name</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-78"><a href="#MassSpectraBase.__init__-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">sample_name</span>
</span><span id="MassSpectraBase.__init__-79"><a href="#MassSpectraBase.__init__-79"><span class="linenos"> 79</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-80"><a href="#MassSpectraBase.__init__-80"><span class="linenos"> 80</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">stem</span>
</span><span id="MassSpectraBase.__init__-81"><a href="#MassSpectraBase.__init__-81"><span class="linenos"> 81</span></a>
</span><span id="MassSpectraBase.__init__-82"><a href="#MassSpectraBase.__init__-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MassSpectraBase.__init__-83"><a href="#MassSpectraBase.__init__-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">analyzer</span>
</span><span id="MassSpectraBase.__init__-84"><a href="#MassSpectraBase.__init__-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">=</span> <span class="n">instrument_label</span>
</span><span id="MassSpectraBase.__init__-85"><a href="#MassSpectraBase.__init__-85"><span class="linenos"> 85</span></a>
</span><span id="MassSpectraBase.__init__-86"><a href="#MassSpectraBase.__init__-86"><span class="linenos"> 86</span></a>        <span class="c1"># Add the spectra parser class to the object if it is not None</span>
</span><span id="MassSpectraBase.__init__-87"><a href="#MassSpectraBase.__init__-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">spectra_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-88"><a href="#MassSpectraBase.__init__-88"><span class="linenos"> 88</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser_class</span> <span class="o">=</span> <span class="n">spectra_parser</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="MassSpectraBase.__init__-89"><a href="#MassSpectraBase.__init__-89"><span class="linenos"> 89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span> <span class="o">=</span> <span class="n">spectra_parser</span>
</span><span id="MassSpectraBase.__init__-90"><a href="#MassSpectraBase.__init__-90"><span class="linenos"> 90</span></a>            <span class="c1"># Check that spectra_pasrser.sample_name is same as sample_name etc, raise warning if not</span>
</span><span id="MassSpectraBase.__init__-91"><a href="#MassSpectraBase.__init__-91"><span class="linenos"> 91</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MassSpectraBase.__init__-92"><a href="#MassSpectraBase.__init__-92"><span class="linenos"> 92</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MassSpectraBase.__init__-93"><a href="#MassSpectraBase.__init__-93"><span class="linenos"> 93</span></a>                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">sample_name</span>
</span><span id="MassSpectraBase.__init__-94"><a href="#MassSpectraBase.__init__-94"><span class="linenos"> 94</span></a>            <span class="p">):</span>
</span><span id="MassSpectraBase.__init__-95"><a href="#MassSpectraBase.__init__-95"><span class="linenos"> 95</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase.__init__-96"><a href="#MassSpectraBase.__init__-96"><span class="linenos"> 96</span></a>                    <span class="s2">&quot;sample_name provided to MassSpectraBase object does not match sample_name provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-97"><a href="#MassSpectraBase.__init__-97"><span class="linenos"> 97</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-98"><a href="#MassSpectraBase.__init__-98"><span class="linenos"> 98</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.__init__-99"><a href="#MassSpectraBase.__init__-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">analyzer</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-100"><a href="#MassSpectraBase.__init__-100"><span class="linenos">100</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase.__init__-101"><a href="#MassSpectraBase.__init__-101"><span class="linenos">101</span></a>                    <span class="s2">&quot;analyzer provided to MassSpectraBase object does not match analyzer provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-102"><a href="#MassSpectraBase.__init__-102"><span class="linenos">102</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-103"><a href="#MassSpectraBase.__init__-103"><span class="linenos">103</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.__init__-104"><a href="#MassSpectraBase.__init__-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-105"><a href="#MassSpectraBase.__init__-105"><span class="linenos">105</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase.__init__-106"><a href="#MassSpectraBase.__init__-106"><span class="linenos">106</span></a>                    <span class="s2">&quot;instrument provided to MassSpectraBase object does not match instrument provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-107"><a href="#MassSpectraBase.__init__-107"><span class="linenos">107</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-108"><a href="#MassSpectraBase.__init__-108"><span class="linenos">108</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.__init__-109"><a href="#MassSpectraBase.__init__-109"><span class="linenos">109</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">file_location</span><span class="p">:</span>
</span><span id="MassSpectraBase.__init__-110"><a href="#MassSpectraBase.__init__-110"><span class="linenos">110</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="MassSpectraBase.__init__-111"><a href="#MassSpectraBase.__init__-111"><span class="linenos">111</span></a>                    <span class="s2">&quot;file_location provided to MassSpectraBase object does not match file_location provided to spectra parser object&quot;</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-112"><a href="#MassSpectraBase.__init__-112"><span class="linenos">112</span></a>                    <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="MassSpectraBase.__init__-113"><a href="#MassSpectraBase.__init__-113"><span class="linenos">113</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.__init__-114"><a href="#MassSpectraBase.__init__-114"><span class="linenos">114</span></a>
</span><span id="MassSpectraBase.__init__-115"><a href="#MassSpectraBase.__init__-115"><span class="linenos">115</span></a>        <span class="c1"># Instantiate empty dictionaries for scan information and mass spectra</span>
</span><span id="MassSpectraBase.__init__-116"><a href="#MassSpectraBase.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_info</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MassSpectraBase.__init__-117"><a href="#MassSpectraBase.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MassSpectraBase.__init__-118"><a href="#MassSpectraBase.__init__-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="MassSpectraBase.file_location" class="classattr">
                                <div class="attr variable">
            <span class="name">file_location</span>

        
    </div>
    <a class="headerlink" href="#MassSpectraBase.file_location"></a>
    
    

                            </div>
                            <div id="MassSpectraBase.analyzer" class="classattr">
                                <div class="attr variable">
            <span class="name">analyzer</span>

        
    </div>
    <a class="headerlink" href="#MassSpectraBase.analyzer"></a>
    
    

                            </div>
                            <div id="MassSpectraBase.instrument_label" class="classattr">
                                <div class="attr variable">
            <span class="name">instrument_label</span>

        
    </div>
    <a class="headerlink" href="#MassSpectraBase.instrument_label"></a>
    
    

                            </div>
                            <div id="MassSpectraBase.add_mass_spectrum" class="classattr">
                                        <input id="MassSpectraBase.add_mass_spectrum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_mass_spectrum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mass_spec</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MassSpectraBase.add_mass_spectrum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MassSpectraBase.add_mass_spectrum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MassSpectraBase.add_mass_spectrum-120"><a href="#MassSpectraBase.add_mass_spectrum-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">add_mass_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass_spec</span><span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectrum-121"><a href="#MassSpectraBase.add_mass_spectrum-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a mass spectrum to the dataset.</span>
</span><span id="MassSpectraBase.add_mass_spectrum-122"><a href="#MassSpectraBase.add_mass_spectrum-122"><span class="linenos">122</span></a>
</span><span id="MassSpectraBase.add_mass_spectrum-123"><a href="#MassSpectraBase.add_mass_spectrum-123"><span class="linenos">123</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase.add_mass_spectrum-124"><a href="#MassSpectraBase.add_mass_spectrum-124"><span class="linenos">124</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase.add_mass_spectrum-125"><a href="#MassSpectraBase.add_mass_spectrum-125"><span class="linenos">125</span></a><span class="sd">        mass_spec : MassSpectrum</span>
</span><span id="MassSpectraBase.add_mass_spectrum-126"><a href="#MassSpectraBase.add_mass_spectrum-126"><span class="linenos">126</span></a><span class="sd">            The corems MassSpectrum object to be added to the dataset.</span>
</span><span id="MassSpectraBase.add_mass_spectrum-127"><a href="#MassSpectraBase.add_mass_spectrum-127"><span class="linenos">127</span></a>
</span><span id="MassSpectraBase.add_mass_spectrum-128"><a href="#MassSpectraBase.add_mass_spectrum-128"><span class="linenos">128</span></a><span class="sd">        Notes</span>
</span><span id="MassSpectraBase.add_mass_spectrum-129"><a href="#MassSpectraBase.add_mass_spectrum-129"><span class="linenos">129</span></a><span class="sd">        -----</span>
</span><span id="MassSpectraBase.add_mass_spectrum-130"><a href="#MassSpectraBase.add_mass_spectrum-130"><span class="linenos">130</span></a><span class="sd">        This is a helper function for the add_mass_spectra() method, and is not intended to be called directly.</span>
</span><span id="MassSpectraBase.add_mass_spectrum-131"><a href="#MassSpectraBase.add_mass_spectrum-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase.add_mass_spectrum-132"><a href="#MassSpectraBase.add_mass_spectrum-132"><span class="linenos">132</span></a>        <span class="c1"># check if mass_spec has a scan_number attribute</span>
</span><span id="MassSpectraBase.add_mass_spectrum-133"><a href="#MassSpectraBase.add_mass_spectrum-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mass_spec</span><span class="p">,</span> <span class="s2">&quot;scan_number&quot;</span><span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectrum-134"><a href="#MassSpectraBase.add_mass_spectrum-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectrum-135"><a href="#MassSpectraBase.add_mass_spectrum-135"><span class="linenos">135</span></a>                <span class="s2">&quot;Mass spectrum must have a scan_number attribute to be added to the dataset correctly&quot;</span>
</span><span id="MassSpectraBase.add_mass_spectrum-136"><a href="#MassSpectraBase.add_mass_spectrum-136"><span class="linenos">136</span></a>            <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectrum-137"><a href="#MassSpectraBase.add_mass_spectrum-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span><span class="n">mass_spec</span><span class="o">.</span><span class="n">scan_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_spec</span>
</span></pre></div>


            <div class="docstring"><p>Adds a mass spectrum to the dataset.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mass_spec</strong> (MassSpectrum):
The corems MassSpectrum object to be added to the dataset.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This is a helper function for the add_mass_spectra() method, and is not intended to be called directly.</p>
</div>


                            </div>
                            <div id="MassSpectraBase.add_mass_spectra" class="classattr">
                                        <input id="MassSpectraBase.add_mass_spectra-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_mass_spectra</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">scan_list</span>,</span><span class="param">	<span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">ms_params</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MassSpectraBase.add_mass_spectra-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MassSpectraBase.add_mass_spectra"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MassSpectraBase.add_mass_spectra-139"><a href="#MassSpectraBase.add_mass_spectra-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">add_mass_spectra</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-140"><a href="#MassSpectraBase.add_mass_spectra-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-141"><a href="#MassSpectraBase.add_mass_spectra-141"><span class="linenos">141</span></a>        <span class="n">scan_list</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-142"><a href="#MassSpectraBase.add_mass_spectra-142"><span class="linenos">142</span></a>        <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-143"><a href="#MassSpectraBase.add_mass_spectra-143"><span class="linenos">143</span></a>        <span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-144"><a href="#MassSpectraBase.add_mass_spectra-144"><span class="linenos">144</span></a>        <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-145"><a href="#MassSpectraBase.add_mass_spectra-145"><span class="linenos">145</span></a>        <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-146"><a href="#MassSpectraBase.add_mass_spectra-146"><span class="linenos">146</span></a>        <span class="n">ms_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-147"><a href="#MassSpectraBase.add_mass_spectra-147"><span class="linenos">147</span></a>    <span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectra-148"><a href="#MassSpectraBase.add_mass_spectra-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add mass spectra to _ms dictionary, from a list of scans or single scan</span>
</span><span id="MassSpectraBase.add_mass_spectra-149"><a href="#MassSpectraBase.add_mass_spectra-149"><span class="linenos">149</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-150"><a href="#MassSpectraBase.add_mass_spectra-150"><span class="linenos">150</span></a><span class="sd">        Notes</span>
</span><span id="MassSpectraBase.add_mass_spectra-151"><a href="#MassSpectraBase.add_mass_spectra-151"><span class="linenos">151</span></a><span class="sd">        -----</span>
</span><span id="MassSpectraBase.add_mass_spectra-152"><a href="#MassSpectraBase.add_mass_spectra-152"><span class="linenos">152</span></a><span class="sd">        The mass spectra will inherit the mass_spectrum, ms_peak, and molecular_search parameters from the LCMSBase object.</span>
</span><span id="MassSpectraBase.add_mass_spectra-153"><a href="#MassSpectraBase.add_mass_spectra-153"><span class="linenos">153</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-154"><a href="#MassSpectraBase.add_mass_spectra-154"><span class="linenos">154</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-155"><a href="#MassSpectraBase.add_mass_spectra-155"><span class="linenos">155</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase.add_mass_spectra-156"><a href="#MassSpectraBase.add_mass_spectra-156"><span class="linenos">156</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase.add_mass_spectra-157"><a href="#MassSpectraBase.add_mass_spectra-157"><span class="linenos">157</span></a><span class="sd">        scan_list : list of ints</span>
</span><span id="MassSpectraBase.add_mass_spectra-158"><a href="#MassSpectraBase.add_mass_spectra-158"><span class="linenos">158</span></a><span class="sd">            List of scans to use to populate _ms slot</span>
</span><span id="MassSpectraBase.add_mass_spectra-159"><a href="#MassSpectraBase.add_mass_spectra-159"><span class="linenos">159</span></a><span class="sd">        spectrum_mode : str or None</span>
</span><span id="MassSpectraBase.add_mass_spectra-160"><a href="#MassSpectraBase.add_mass_spectra-160"><span class="linenos">160</span></a><span class="sd">            The spectrum mode to use for the mass spectra.</span>
</span><span id="MassSpectraBase.add_mass_spectra-161"><a href="#MassSpectraBase.add_mass_spectra-161"><span class="linenos">161</span></a><span class="sd">            If None, method will use the spectrum mode from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="MassSpectraBase.add_mass_spectra-162"><a href="#MassSpectraBase.add_mass_spectra-162"><span class="linenos">162</span></a><span class="sd">            Defaults to None.</span>
</span><span id="MassSpectraBase.add_mass_spectra-163"><a href="#MassSpectraBase.add_mass_spectra-163"><span class="linenos">163</span></a><span class="sd">        ms_level : int, optional</span>
</span><span id="MassSpectraBase.add_mass_spectra-164"><a href="#MassSpectraBase.add_mass_spectra-164"><span class="linenos">164</span></a><span class="sd">            The MS level to use for the mass spectra.</span>
</span><span id="MassSpectraBase.add_mass_spectra-165"><a href="#MassSpectraBase.add_mass_spectra-165"><span class="linenos">165</span></a><span class="sd">            This is used to pass the molecular_search parameters from the LCMS object to the individual MassSpectrum objects.</span>
</span><span id="MassSpectraBase.add_mass_spectra-166"><a href="#MassSpectraBase.add_mass_spectra-166"><span class="linenos">166</span></a><span class="sd">            Defaults to 1.</span>
</span><span id="MassSpectraBase.add_mass_spectra-167"><a href="#MassSpectraBase.add_mass_spectra-167"><span class="linenos">167</span></a><span class="sd">        using_parser : bool</span>
</span><span id="MassSpectraBase.add_mass_spectra-168"><a href="#MassSpectraBase.add_mass_spectra-168"><span class="linenos">168</span></a><span class="sd">            Whether to use the mass spectra parser to get the mass spectra.  Defaults to True.</span>
</span><span id="MassSpectraBase.add_mass_spectra-169"><a href="#MassSpectraBase.add_mass_spectra-169"><span class="linenos">169</span></a><span class="sd">        auto_process : bool</span>
</span><span id="MassSpectraBase.add_mass_spectra-170"><a href="#MassSpectraBase.add_mass_spectra-170"><span class="linenos">170</span></a><span class="sd">            Whether to auto-process the mass spectra.  Defaults to True.</span>
</span><span id="MassSpectraBase.add_mass_spectra-171"><a href="#MassSpectraBase.add_mass_spectra-171"><span class="linenos">171</span></a><span class="sd">        ms_params : MSParameters or None</span>
</span><span id="MassSpectraBase.add_mass_spectra-172"><a href="#MassSpectraBase.add_mass_spectra-172"><span class="linenos">172</span></a><span class="sd">            The mass spectrum parameters to use for the mass spectra.  If None, uses the globally set MSParameters.</span>
</span><span id="MassSpectraBase.add_mass_spectra-173"><a href="#MassSpectraBase.add_mass_spectra-173"><span class="linenos">173</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-174"><a href="#MassSpectraBase.add_mass_spectra-174"><span class="linenos">174</span></a><span class="sd">        Raises</span>
</span><span id="MassSpectraBase.add_mass_spectra-175"><a href="#MassSpectraBase.add_mass_spectra-175"><span class="linenos">175</span></a><span class="sd">        ------</span>
</span><span id="MassSpectraBase.add_mass_spectra-176"><a href="#MassSpectraBase.add_mass_spectra-176"><span class="linenos">176</span></a><span class="sd">        TypeError</span>
</span><span id="MassSpectraBase.add_mass_spectra-177"><a href="#MassSpectraBase.add_mass_spectra-177"><span class="linenos">177</span></a><span class="sd">            If scan_list is not a list of ints</span>
</span><span id="MassSpectraBase.add_mass_spectra-178"><a href="#MassSpectraBase.add_mass_spectra-178"><span class="linenos">178</span></a><span class="sd">        ValueError</span>
</span><span id="MassSpectraBase.add_mass_spectra-179"><a href="#MassSpectraBase.add_mass_spectra-179"><span class="linenos">179</span></a><span class="sd">            If polarity is not &#39;positive&#39; or &#39;negative&#39;</span>
</span><span id="MassSpectraBase.add_mass_spectra-180"><a href="#MassSpectraBase.add_mass_spectra-180"><span class="linenos">180</span></a><span class="sd">            If ms_level is not 1 or 2</span>
</span><span id="MassSpectraBase.add_mass_spectra-181"><a href="#MassSpectraBase.add_mass_spectra-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase.add_mass_spectra-182"><a href="#MassSpectraBase.add_mass_spectra-182"><span class="linenos">182</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-183"><a href="#MassSpectraBase.add_mass_spectra-183"><span class="linenos">183</span></a>        <span class="c1"># check if scan_list is a list or a single int; if single int, convert to list</span>
</span><span id="MassSpectraBase.add_mass_spectra-184"><a href="#MassSpectraBase.add_mass_spectra-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectra-185"><a href="#MassSpectraBase.add_mass_spectra-185"><span class="linenos">185</span></a>            <span class="n">scan_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">scan_list</span><span class="p">]</span>
</span><span id="MassSpectraBase.add_mass_spectra-186"><a href="#MassSpectraBase.add_mass_spectra-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectra-187"><a href="#MassSpectraBase.add_mass_spectra-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scan_list must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-188"><a href="#MassSpectraBase.add_mass_spectra-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_list</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-189"><a href="#MassSpectraBase.add_mass_spectra-189"><span class="linenos">189</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectra-190"><a href="#MassSpectraBase.add_mass_spectra-190"><span class="linenos">190</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scan_list must be a list of integers&quot;</span><span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-191"><a href="#MassSpectraBase.add_mass_spectra-191"><span class="linenos">191</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-192"><a href="#MassSpectraBase.add_mass_spectra-192"><span class="linenos">192</span></a>        <span class="c1"># set polarity to -1 if negative mode, 1 if positive mode (for mass spectrum creation)</span>
</span><span id="MassSpectraBase.add_mass_spectra-193"><a href="#MassSpectraBase.add_mass_spectra-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-194"><a href="#MassSpectraBase.add_mass_spectra-194"><span class="linenos">194</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="MassSpectraBase.add_mass_spectra-195"><a href="#MassSpectraBase.add_mass_spectra-195"><span class="linenos">195</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-196"><a href="#MassSpectraBase.add_mass_spectra-196"><span class="linenos">196</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MassSpectraBase.add_mass_spectra-197"><a href="#MassSpectraBase.add_mass_spectra-197"><span class="linenos">197</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-198"><a href="#MassSpectraBase.add_mass_spectra-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-199"><a href="#MassSpectraBase.add_mass_spectra-199"><span class="linenos">199</span></a>                <span class="s2">&quot;Polarity not set for dataset, must be a either &#39;positive&#39; or &#39;negative&#39;&quot;</span>
</span><span id="MassSpectraBase.add_mass_spectra-200"><a href="#MassSpectraBase.add_mass_spectra-200"><span class="linenos">200</span></a>            <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-201"><a href="#MassSpectraBase.add_mass_spectra-201"><span class="linenos">201</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-202"><a href="#MassSpectraBase.add_mass_spectra-202"><span class="linenos">202</span></a>        <span class="c1"># is not using_parser, check that ms1 and ms2 are not None</span>
</span><span id="MassSpectraBase.add_mass_spectra-203"><a href="#MassSpectraBase.add_mass_spectra-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-204"><a href="#MassSpectraBase.add_mass_spectra-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="MassSpectraBase.add_mass_spectra-205"><a href="#MassSpectraBase.add_mass_spectra-205"><span class="linenos">205</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-206"><a href="#MassSpectraBase.add_mass_spectra-206"><span class="linenos">206</span></a>                    <span class="s2">&quot;ms_level </span><span class="si">{}</span><span class="s2"> not found in _ms_unprocessed dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-207"><a href="#MassSpectraBase.add_mass_spectra-207"><span class="linenos">207</span></a>                        <span class="n">ms_level</span>
</span><span id="MassSpectraBase.add_mass_spectra-208"><a href="#MassSpectraBase.add_mass_spectra-208"><span class="linenos">208</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-209"><a href="#MassSpectraBase.add_mass_spectra-209"><span class="linenos">209</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-210"><a href="#MassSpectraBase.add_mass_spectra-210"><span class="linenos">210</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-211"><a href="#MassSpectraBase.add_mass_spectra-211"><span class="linenos">211</span></a>        <span class="n">scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_list</span><span class="p">))</span>
</span><span id="MassSpectraBase.add_mass_spectra-212"><a href="#MassSpectraBase.add_mass_spectra-212"><span class="linenos">212</span></a>        <span class="n">scan_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="MassSpectraBase.add_mass_spectra-213"><a href="#MassSpectraBase.add_mass_spectra-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-214"><a href="#MassSpectraBase.add_mass_spectra-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-215"><a href="#MassSpectraBase.add_mass_spectra-215"><span class="linenos">215</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-216"><a href="#MassSpectraBase.add_mass_spectra-216"><span class="linenos">216</span></a>                    <span class="s2">&quot;No unprocessed data found for ms_level </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-217"><a href="#MassSpectraBase.add_mass_spectra-217"><span class="linenos">217</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-218"><a href="#MassSpectraBase.add_mass_spectra-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-219"><a href="#MassSpectraBase.add_mass_spectra-219"><span class="linenos">219</span></a>                <span class="nb">len</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-220"><a href="#MassSpectraBase.add_mass_spectra-220"><span class="linenos">220</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-221"><a href="#MassSpectraBase.add_mass_spectra-221"><span class="linenos">221</span></a>                        <span class="n">scan_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="MassSpectraBase.add_mass_spectra-222"><a href="#MassSpectraBase.add_mass_spectra-222"><span class="linenos">222</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-223"><a href="#MassSpectraBase.add_mass_spectra-223"><span class="linenos">223</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-224"><a href="#MassSpectraBase.add_mass_spectra-224"><span class="linenos">224</span></a>                <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="MassSpectraBase.add_mass_spectra-225"><a href="#MassSpectraBase.add_mass_spectra-225"><span class="linenos">225</span></a>            <span class="p">):</span>
</span><span id="MassSpectraBase.add_mass_spectra-226"><a href="#MassSpectraBase.add_mass_spectra-226"><span class="linenos">226</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-227"><a href="#MassSpectraBase.add_mass_spectra-227"><span class="linenos">227</span></a>                    <span class="s2">&quot;Not all scans in scan_list are present in the unprocessed data&quot;</span>
</span><span id="MassSpectraBase.add_mass_spectra-228"><a href="#MassSpectraBase.add_mass_spectra-228"><span class="linenos">228</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-229"><a href="#MassSpectraBase.add_mass_spectra-229"><span class="linenos">229</span></a>            <span class="c1"># Prepare the ms_df for parsing</span>
</span><span id="MassSpectraBase.add_mass_spectra-230"><a href="#MassSpectraBase.add_mass_spectra-230"><span class="linenos">230</span></a>            <span class="n">ms_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-231"><a href="#MassSpectraBase.add_mass_spectra-231"><span class="linenos">231</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-232"><a href="#MassSpectraBase.add_mass_spectra-232"><span class="linenos">232</span></a>        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_list</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-233"><a href="#MassSpectraBase.add_mass_spectra-233"><span class="linenos">233</span></a>            <span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MassSpectraBase.add_mass_spectra-234"><a href="#MassSpectraBase.add_mass_spectra-234"><span class="linenos">234</span></a>            <span class="k">if</span> <span class="n">spectrum_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-235"><a href="#MassSpectraBase.add_mass_spectra-235"><span class="linenos">235</span></a>                <span class="c1"># get spectrum mode from _scan_info</span>
</span><span id="MassSpectraBase.add_mass_spectra-236"><a href="#MassSpectraBase.add_mass_spectra-236"><span class="linenos">236</span></a>                <span class="n">spectrum_mode_scan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;ms_format&quot;</span><span class="p">]</span>
</span><span id="MassSpectraBase.add_mass_spectra-237"><a href="#MassSpectraBase.add_mass_spectra-237"><span class="linenos">237</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-238"><a href="#MassSpectraBase.add_mass_spectra-238"><span class="linenos">238</span></a>                <span class="n">spectrum_mode_scan</span> <span class="o">=</span> <span class="n">spectrum_mode</span>
</span><span id="MassSpectraBase.add_mass_spectra-239"><a href="#MassSpectraBase.add_mass_spectra-239"><span class="linenos">239</span></a>            <span class="c1"># Instantiate the mass spectrum object using the parser or the unprocessed data</span>
</span><span id="MassSpectraBase.add_mass_spectra-240"><a href="#MassSpectraBase.add_mass_spectra-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-241"><a href="#MassSpectraBase.add_mass_spectra-241"><span class="linenos">241</span></a>                <span class="n">my_ms_df</span> <span class="o">=</span> <span class="n">ms_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scan</span><span class="p">]</span>
</span><span id="MassSpectraBase.add_mass_spectra-242"><a href="#MassSpectraBase.add_mass_spectra-242"><span class="linenos">242</span></a>                <span class="k">if</span> <span class="n">spectrum_mode_scan</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-243"><a href="#MassSpectraBase.add_mass_spectra-243"><span class="linenos">243</span></a>                    <span class="c1"># Check this - it might be better to use the MassSpectrumProfile class to instantiate the mass spectrum</span>
</span><span id="MassSpectraBase.add_mass_spectra-244"><a href="#MassSpectraBase.add_mass_spectra-244"><span class="linenos">244</span></a>                    <span class="n">ms</span> <span class="o">=</span> <span class="n">ms_from_array_profile</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-245"><a href="#MassSpectraBase.add_mass_spectra-245"><span class="linenos">245</span></a>                        <span class="n">my_ms_df</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-246"><a href="#MassSpectraBase.add_mass_spectra-246"><span class="linenos">246</span></a>                        <span class="n">my_ms_df</span><span class="o">.</span><span class="n">intensity</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-247"><a href="#MassSpectraBase.add_mass_spectra-247"><span class="linenos">247</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-248"><a href="#MassSpectraBase.add_mass_spectra-248"><span class="linenos">248</span></a>                        <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-249"><a href="#MassSpectraBase.add_mass_spectra-249"><span class="linenos">249</span></a>                        <span class="n">auto_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-250"><a href="#MassSpectraBase.add_mass_spectra-250"><span class="linenos">250</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-251"><a href="#MassSpectraBase.add_mass_spectra-251"><span class="linenos">251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-252"><a href="#MassSpectraBase.add_mass_spectra-252"><span class="linenos">252</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-253"><a href="#MassSpectraBase.add_mass_spectra-253"><span class="linenos">253</span></a>                        <span class="s2">&quot;Only profile mode is supported for unprocessed data&quot;</span>
</span><span id="MassSpectraBase.add_mass_spectra-254"><a href="#MassSpectraBase.add_mass_spectra-254"><span class="linenos">254</span></a>                    <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-255"><a href="#MassSpectraBase.add_mass_spectra-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-256"><a href="#MassSpectraBase.add_mass_spectra-256"><span class="linenos">256</span></a>                <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_parser</span><span class="o">.</span><span class="n">get_mass_spectrum_from_scan</span><span class="p">(</span>
</span><span id="MassSpectraBase.add_mass_spectra-257"><a href="#MassSpectraBase.add_mass_spectra-257"><span class="linenos">257</span></a>                    <span class="n">scan_number</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-258"><a href="#MassSpectraBase.add_mass_spectra-258"><span class="linenos">258</span></a>                    <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode_scan</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-259"><a href="#MassSpectraBase.add_mass_spectra-259"><span class="linenos">259</span></a>                    <span class="n">auto_process</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MassSpectraBase.add_mass_spectra-260"><a href="#MassSpectraBase.add_mass_spectra-260"><span class="linenos">260</span></a>                <span class="p">)</span>
</span><span id="MassSpectraBase.add_mass_spectra-261"><a href="#MassSpectraBase.add_mass_spectra-261"><span class="linenos">261</span></a>
</span><span id="MassSpectraBase.add_mass_spectra-262"><a href="#MassSpectraBase.add_mass_spectra-262"><span class="linenos">262</span></a>            <span class="c1"># Set the mass spectrum parameters, auto-process if auto_process is True, and add to the dataset</span>
</span><span id="MassSpectraBase.add_mass_spectra-263"><a href="#MassSpectraBase.add_mass_spectra-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="n">ms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-264"><a href="#MassSpectraBase.add_mass_spectra-264"><span class="linenos">264</span></a>                <span class="k">if</span> <span class="n">ms_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-265"><a href="#MassSpectraBase.add_mass_spectra-265"><span class="linenos">265</span></a>                    <span class="n">ms</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">ms_params</span>
</span><span id="MassSpectraBase.add_mass_spectra-266"><a href="#MassSpectraBase.add_mass_spectra-266"><span class="linenos">266</span></a>                <span class="n">ms</span><span class="o">.</span><span class="n">scan_number</span> <span class="o">=</span> <span class="n">scan</span>
</span><span id="MassSpectraBase.add_mass_spectra-267"><a href="#MassSpectraBase.add_mass_spectra-267"><span class="linenos">267</span></a>                <span class="k">if</span> <span class="n">auto_process</span><span class="p">:</span>
</span><span id="MassSpectraBase.add_mass_spectra-268"><a href="#MassSpectraBase.add_mass_spectra-268"><span class="linenos">268</span></a>                    <span class="n">ms</span><span class="o">.</span><span class="n">process_mass_spec</span><span class="p">()</span>
</span><span id="MassSpectraBase.add_mass_spectra-269"><a href="#MassSpectraBase.add_mass_spectra-269"><span class="linenos">269</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectrum</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add mass spectra to _ms dictionary, from a list of scans or single scan</p>

<h6 id="notes">Notes</h6>

<p>The mass spectra will inherit the mass_spectrum, ms_peak, and molecular_search parameters from the LCMSBase object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>scan_list</strong> (list of ints):
List of scans to use to populate _ms slot</li>
<li><strong>spectrum_mode</strong> (str or None):
The spectrum mode to use for the mass spectra.
If None, method will use the spectrum mode from the spectra parser to ascertain the spectrum mode (this allows for mixed types).
Defaults to None.</li>
<li><strong>ms_level</strong> (int, optional):
The MS level to use for the mass spectra.
This is used to pass the molecular_search parameters from the LCMS object to the individual MassSpectrum objects.
Defaults to 1.</li>
<li><strong>using_parser</strong> (bool):
Whether to use the mass spectra parser to get the mass spectra.  Defaults to True.</li>
<li><strong>auto_process</strong> (bool):
Whether to auto-process the mass spectra.  Defaults to True.</li>
<li><strong>ms_params</strong> (MSParameters or None):
The mass spectrum parameters to use for the mass spectra.  If None, uses the globally set MSParameters.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError</strong>: If scan_list is not a list of ints</li>
<li><strong>ValueError</strong>: If polarity is not 'positive' or 'negative'
If ms_level is not 1 or 2</li>
</ul>
</div>


                            </div>
                            <div id="MassSpectraBase.get_time_of_scan_id" class="classattr">
                                        <input id="MassSpectraBase.get_time_of_scan_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_time_of_scan_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">scan</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MassSpectraBase.get_time_of_scan_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MassSpectraBase.get_time_of_scan_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MassSpectraBase.get_time_of_scan_id-271"><a href="#MassSpectraBase.get_time_of_scan_id-271"><span class="linenos">271</span></a>    <span class="k">def</span> <span class="nf">get_time_of_scan_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">):</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-272"><a href="#MassSpectraBase.get_time_of_scan_id-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the scan time for the specified scan number.</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-273"><a href="#MassSpectraBase.get_time_of_scan_id-273"><span class="linenos">273</span></a>
</span><span id="MassSpectraBase.get_time_of_scan_id-274"><a href="#MassSpectraBase.get_time_of_scan_id-274"><span class="linenos">274</span></a><span class="sd">        Parameters</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-275"><a href="#MassSpectraBase.get_time_of_scan_id-275"><span class="linenos">275</span></a><span class="sd">        -----------</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-276"><a href="#MassSpectraBase.get_time_of_scan_id-276"><span class="linenos">276</span></a><span class="sd">        scan : int</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-277"><a href="#MassSpectraBase.get_time_of_scan_id-277"><span class="linenos">277</span></a><span class="sd">            The scan number of the desired scan time.</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-278"><a href="#MassSpectraBase.get_time_of_scan_id-278"><span class="linenos">278</span></a>
</span><span id="MassSpectraBase.get_time_of_scan_id-279"><a href="#MassSpectraBase.get_time_of_scan_id-279"><span class="linenos">279</span></a><span class="sd">        Returns</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-280"><a href="#MassSpectraBase.get_time_of_scan_id-280"><span class="linenos">280</span></a><span class="sd">        --------</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-281"><a href="#MassSpectraBase.get_time_of_scan_id-281"><span class="linenos">281</span></a><span class="sd">        float</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-282"><a href="#MassSpectraBase.get_time_of_scan_id-282"><span class="linenos">282</span></a><span class="sd">            The scan time for the specified scan number (in minutes).</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-283"><a href="#MassSpectraBase.get_time_of_scan_id-283"><span class="linenos">283</span></a>
</span><span id="MassSpectraBase.get_time_of_scan_id-284"><a href="#MassSpectraBase.get_time_of_scan_id-284"><span class="linenos">284</span></a><span class="sd">        Raises</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-285"><a href="#MassSpectraBase.get_time_of_scan_id-285"><span class="linenos">285</span></a><span class="sd">        ------</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-286"><a href="#MassSpectraBase.get_time_of_scan_id-286"><span class="linenos">286</span></a><span class="sd">        ValueError</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-287"><a href="#MassSpectraBase.get_time_of_scan_id-287"><span class="linenos">287</span></a><span class="sd">            If no scan time is found for the specified scan number.</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-288"><a href="#MassSpectraBase.get_time_of_scan_id-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-289"><a href="#MassSpectraBase.get_time_of_scan_id-289"><span class="linenos">289</span></a>        <span class="c1"># Check if _retenion_time_list is empty and raise error if so</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-290"><a href="#MassSpectraBase.get_time_of_scan_id-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-291"><a href="#MassSpectraBase.get_time_of_scan_id-291"><span class="linenos">291</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No retention times found in dataset&quot;</span><span class="p">)</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-292"><a href="#MassSpectraBase.get_time_of_scan_id-292"><span class="linenos">292</span></a>        <span class="n">rt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">scan</span><span class="p">)]</span>
</span><span id="MassSpectraBase.get_time_of_scan_id-293"><a href="#MassSpectraBase.get_time_of_scan_id-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">rt</span>
</span></pre></div>


            <div class="docstring"><p>Returns the scan time for the specified scan number.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>scan</strong> (int):
The scan number of the desired scan time.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: The scan time for the specified scan number (in minutes).</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If no scan time is found for the specified scan number.</li>
</ul>
</div>


                            </div>
                            <div id="MassSpectraBase.scan_df" class="classattr">
                                <div class="attr variable">
            <span class="name">scan_df</span>

        
    </div>
    <a class="headerlink" href="#MassSpectraBase.scan_df"></a>
    
            <div class="docstring"><p>pandas.DataFrame : A pandas DataFrame containing the scan info data with columns for scan number, scan time, ms level, precursor m/z, scan text, and scan window (lower and upper).</p>
</div>


                            </div>
                            <div id="MassSpectraBase.ms" class="classattr">
                                <div class="attr variable">
            <span class="name">ms</span>

        
    </div>
    <a class="headerlink" href="#MassSpectraBase.ms"></a>
    
            <div class="docstring"><p>dictionary : contains the key associated with mass spectra and values are the associated MassSpecProfiles</p>
</div>


                            </div>
                </section>
                <section id="LCMSBase">
                            <input id="LCMSBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LCMSBase</span><wbr>(<span class="base"><a href="#MassSpectraBase">MassSpectraBase</a></span>, <span class="base"><a href="../calc/lc_calc.html#LCCalculations">corems.mass_spectra.calc.lc_calc.LCCalculations</a></span>, <span class="base"><a href="../calc/lc_calc.html#PHCalculations">corems.mass_spectra.calc.lc_calc.PHCalculations</a></span>, <span class="base"><a href="../../molecular_id/search/lcms_spectral_search.html#LCMSSpectralSearch">corems.molecular_id.search.lcms_spectral_search.LCMSSpectralSearch</a></span>):

                <label class="view-source-button" for="LCMSBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase-328"><a href="#LCMSBase-328"><span class="linenos"> 328</span></a><span class="k">class</span> <span class="nc">LCMSBase</span><span class="p">(</span><span class="n">MassSpectraBase</span><span class="p">,</span> <span class="n">LCCalculations</span><span class="p">,</span> <span class="n">PHCalculations</span><span class="p">,</span> <span class="n">LCMSSpectralSearch</span><span class="p">):</span>
</span><span id="LCMSBase-329"><a href="#LCMSBase-329"><span class="linenos"> 329</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A class representing a liquid chromatography-mass spectrometry (LC-MS) data object.</span>
</span><span id="LCMSBase-330"><a href="#LCMSBase-330"><span class="linenos"> 330</span></a>
</span><span id="LCMSBase-331"><a href="#LCMSBase-331"><span class="linenos"> 331</span></a><span class="sd">    This class is not intended to be instantiated directly, but rather to be instantiated by an appropriate mass spectra parser using the get_lcms_obj() method.</span>
</span><span id="LCMSBase-332"><a href="#LCMSBase-332"><span class="linenos"> 332</span></a>
</span><span id="LCMSBase-333"><a href="#LCMSBase-333"><span class="linenos"> 333</span></a><span class="sd">    Parameters</span>
</span><span id="LCMSBase-334"><a href="#LCMSBase-334"><span class="linenos"> 334</span></a><span class="sd">    -----------</span>
</span><span id="LCMSBase-335"><a href="#LCMSBase-335"><span class="linenos"> 335</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="LCMSBase-336"><a href="#LCMSBase-336"><span class="linenos"> 336</span></a><span class="sd">        The location of the file containing the mass spectra data.</span>
</span><span id="LCMSBase-337"><a href="#LCMSBase-337"><span class="linenos"> 337</span></a><span class="sd">    analyzer : str, optional</span>
</span><span id="LCMSBase-338"><a href="#LCMSBase-338"><span class="linenos"> 338</span></a><span class="sd">        The type of analyzer used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="LCMSBase-339"><a href="#LCMSBase-339"><span class="linenos"> 339</span></a><span class="sd">    instrument_label : str, optional</span>
</span><span id="LCMSBase-340"><a href="#LCMSBase-340"><span class="linenos"> 340</span></a><span class="sd">        The type of instrument used to generate the mass spectra data. Defaults to &#39;Unknown&#39;.</span>
</span><span id="LCMSBase-341"><a href="#LCMSBase-341"><span class="linenos"> 341</span></a><span class="sd">    sample_name : str, optional</span>
</span><span id="LCMSBase-342"><a href="#LCMSBase-342"><span class="linenos"> 342</span></a><span class="sd">        The name of the sample; defaults to the file name if not provided to the parser. Defaults to None.</span>
</span><span id="LCMSBase-343"><a href="#LCMSBase-343"><span class="linenos"> 343</span></a><span class="sd">    spectra_parser : object, optional</span>
</span><span id="LCMSBase-344"><a href="#LCMSBase-344"><span class="linenos"> 344</span></a><span class="sd">        The spectra parser object used to create the mass spectra object. Defaults to None.</span>
</span><span id="LCMSBase-345"><a href="#LCMSBase-345"><span class="linenos"> 345</span></a>
</span><span id="LCMSBase-346"><a href="#LCMSBase-346"><span class="linenos"> 346</span></a><span class="sd">    Attributes</span>
</span><span id="LCMSBase-347"><a href="#LCMSBase-347"><span class="linenos"> 347</span></a><span class="sd">    -----------</span>
</span><span id="LCMSBase-348"><a href="#LCMSBase-348"><span class="linenos"> 348</span></a><span class="sd">    polarity : str</span>
</span><span id="LCMSBase-349"><a href="#LCMSBase-349"><span class="linenos"> 349</span></a><span class="sd">        The polarity of the ionization mode used for the dataset.</span>
</span><span id="LCMSBase-350"><a href="#LCMSBase-350"><span class="linenos"> 350</span></a><span class="sd">    _parameters : LCMSParameters</span>
</span><span id="LCMSBase-351"><a href="#LCMSBase-351"><span class="linenos"> 351</span></a><span class="sd">        The parameters used for all methods called on the LCMSBase object. Set upon instantiation from LCMSParameters.</span>
</span><span id="LCMSBase-352"><a href="#LCMSBase-352"><span class="linenos"> 352</span></a><span class="sd">    _retention_time_list : numpy.ndarray</span>
</span><span id="LCMSBase-353"><a href="#LCMSBase-353"><span class="linenos"> 353</span></a><span class="sd">        An array of retention times for the dataset.</span>
</span><span id="LCMSBase-354"><a href="#LCMSBase-354"><span class="linenos"> 354</span></a><span class="sd">    _scans_number_list : list</span>
</span><span id="LCMSBase-355"><a href="#LCMSBase-355"><span class="linenos"> 355</span></a><span class="sd">        A list of scan numbers for the dataset.</span>
</span><span id="LCMSBase-356"><a href="#LCMSBase-356"><span class="linenos"> 356</span></a><span class="sd">    _tic_list : numpy.ndarray</span>
</span><span id="LCMSBase-357"><a href="#LCMSBase-357"><span class="linenos"> 357</span></a><span class="sd">        An array of total ion current (TIC) values for the dataset.</span>
</span><span id="LCMSBase-358"><a href="#LCMSBase-358"><span class="linenos"> 358</span></a><span class="sd">    eics : dict</span>
</span><span id="LCMSBase-359"><a href="#LCMSBase-359"><span class="linenos"> 359</span></a><span class="sd">        A dictionary containing extracted ion chromatograms (EICs) for the dataset.</span>
</span><span id="LCMSBase-360"><a href="#LCMSBase-360"><span class="linenos"> 360</span></a><span class="sd">        Key is the mz of the EIC. Initialized as an empty dictionary.</span>
</span><span id="LCMSBase-361"><a href="#LCMSBase-361"><span class="linenos"> 361</span></a><span class="sd">    mass_features : dictionary of LCMSMassFeature objects</span>
</span><span id="LCMSBase-362"><a href="#LCMSBase-362"><span class="linenos"> 362</span></a><span class="sd">        A dictionary containing mass features for the dataset.</span>
</span><span id="LCMSBase-363"><a href="#LCMSBase-363"><span class="linenos"> 363</span></a><span class="sd">        Key is mass feature ID. Initialized as an empty dictionary.</span>
</span><span id="LCMSBase-364"><a href="#LCMSBase-364"><span class="linenos"> 364</span></a><span class="sd">    spectral_search_results : dictionary of MS2SearchResults objects</span>
</span><span id="LCMSBase-365"><a href="#LCMSBase-365"><span class="linenos"> 365</span></a><span class="sd">        A dictionary containing spectral search results for the dataset.</span>
</span><span id="LCMSBase-366"><a href="#LCMSBase-366"><span class="linenos"> 366</span></a><span class="sd">        Key is scan number : precursor mz. Initialized as an empty dictionary.</span>
</span><span id="LCMSBase-367"><a href="#LCMSBase-367"><span class="linenos"> 367</span></a>
</span><span id="LCMSBase-368"><a href="#LCMSBase-368"><span class="linenos"> 368</span></a><span class="sd">    Methods</span>
</span><span id="LCMSBase-369"><a href="#LCMSBase-369"><span class="linenos"> 369</span></a><span class="sd">    --------</span>
</span><span id="LCMSBase-370"><a href="#LCMSBase-370"><span class="linenos"> 370</span></a><span class="sd">    * get_parameters_json().</span>
</span><span id="LCMSBase-371"><a href="#LCMSBase-371"><span class="linenos"> 371</span></a><span class="sd">        Returns the parameters used for the LC-MS analysis in JSON format.</span>
</span><span id="LCMSBase-372"><a href="#LCMSBase-372"><span class="linenos"> 372</span></a><span class="sd">    * add_associated_ms2_dda(add_to_lcmsobj=True, auto_process=True, use_parser=True)</span>
</span><span id="LCMSBase-373"><a href="#LCMSBase-373"><span class="linenos"> 373</span></a><span class="sd">        Adds which MS2 scans are associated with each mass feature to the</span>
</span><span id="LCMSBase-374"><a href="#LCMSBase-374"><span class="linenos"> 374</span></a><span class="sd">        mass_features dictionary and optionally adds the MS2 spectra to the _ms dictionary.</span>
</span><span id="LCMSBase-375"><a href="#LCMSBase-375"><span class="linenos"> 375</span></a><span class="sd">    * add_associated_ms1(add_to_lcmsobj=True, auto_process=True, use_parser=True)</span>
</span><span id="LCMSBase-376"><a href="#LCMSBase-376"><span class="linenos"> 376</span></a><span class="sd">        Adds the MS1 spectra associated with each mass feature to the</span>
</span><span id="LCMSBase-377"><a href="#LCMSBase-377"><span class="linenos"> 377</span></a><span class="sd">        mass_features dictionary and adds the MS1 spectra to the _ms dictionary.</span>
</span><span id="LCMSBase-378"><a href="#LCMSBase-378"><span class="linenos"> 378</span></a><span class="sd">    * mass_features_to_df()</span>
</span><span id="LCMSBase-379"><a href="#LCMSBase-379"><span class="linenos"> 379</span></a><span class="sd">        Returns a pandas dataframe summarizing the mass features in the dataset.</span>
</span><span id="LCMSBase-380"><a href="#LCMSBase-380"><span class="linenos"> 380</span></a><span class="sd">    * set_tic_list_from_data(overwrite=False)</span>
</span><span id="LCMSBase-381"><a href="#LCMSBase-381"><span class="linenos"> 381</span></a><span class="sd">        Sets the TIC list from the mass spectrum objects within the _ms dictionary.</span>
</span><span id="LCMSBase-382"><a href="#LCMSBase-382"><span class="linenos"> 382</span></a><span class="sd">    * set_retention_time_from_data(overwrite=False)</span>
</span><span id="LCMSBase-383"><a href="#LCMSBase-383"><span class="linenos"> 383</span></a><span class="sd">        Sets the retention time list from the data in the _ms dictionary.</span>
</span><span id="LCMSBase-384"><a href="#LCMSBase-384"><span class="linenos"> 384</span></a><span class="sd">    * set_scans_number_from_data(overwrite=False)</span>
</span><span id="LCMSBase-385"><a href="#LCMSBase-385"><span class="linenos"> 385</span></a><span class="sd">        Sets the scan number list from the data in the _ms dictionary.</span>
</span><span id="LCMSBase-386"><a href="#LCMSBase-386"><span class="linenos"> 386</span></a><span class="sd">    * plot_composite_mz_features(binsize = 1e-4, ph_int_min_thresh = 0.001, mf_plot = True, ms2_plot = True, return_fig = False)</span>
</span><span id="LCMSBase-387"><a href="#LCMSBase-387"><span class="linenos"> 387</span></a><span class="sd">        Generates plot of M/Z features comparing scan time vs M/Z value</span>
</span><span id="LCMSBase-388"><a href="#LCMSBase-388"><span class="linenos"> 388</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LCMSBase-389"><a href="#LCMSBase-389"><span class="linenos"> 389</span></a>
</span><span id="LCMSBase-390"><a href="#LCMSBase-390"><span class="linenos"> 390</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="LCMSBase-391"><a href="#LCMSBase-391"><span class="linenos"> 391</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LCMSBase-392"><a href="#LCMSBase-392"><span class="linenos"> 392</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="LCMSBase-393"><a href="#LCMSBase-393"><span class="linenos"> 393</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-394"><a href="#LCMSBase-394"><span class="linenos"> 394</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-395"><a href="#LCMSBase-395"><span class="linenos"> 395</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase-396"><a href="#LCMSBase-396"><span class="linenos"> 396</span></a>        <span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase-397"><a href="#LCMSBase-397"><span class="linenos"> 397</span></a>    <span class="p">):</span>
</span><span id="LCMSBase-398"><a href="#LCMSBase-398"><span class="linenos"> 398</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="LCMSBase-399"><a href="#LCMSBase-399"><span class="linenos"> 399</span></a>            <span class="n">file_location</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">instrument_label</span><span class="p">,</span> <span class="n">sample_name</span><span class="p">,</span> <span class="n">spectra_parser</span>
</span><span id="LCMSBase-400"><a href="#LCMSBase-400"><span class="linenos"> 400</span></a>        <span class="p">)</span>
</span><span id="LCMSBase-401"><a href="#LCMSBase-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="LCMSBase-402"><a href="#LCMSBase-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">LCMSParameters</span><span class="p">()</span>
</span><span id="LCMSBase-403"><a href="#LCMSBase-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-404"><a href="#LCMSBase-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-405"><a href="#LCMSBase-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-406"><a href="#LCMSBase-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase-407"><a href="#LCMSBase-407"><span class="linenos"> 407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase-408"><a href="#LCMSBase-408"><span class="linenos"> 408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_search_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase-409"><a href="#LCMSBase-409"><span class="linenos"> 409</span></a>
</span><span id="LCMSBase-410"><a href="#LCMSBase-410"><span class="linenos"> 410</span></a>    <span class="k">def</span> <span class="nf">get_parameters_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-411"><a href="#LCMSBase-411"><span class="linenos"> 411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the parameters stored for the LC-MS object in JSON format.</span>
</span><span id="LCMSBase-412"><a href="#LCMSBase-412"><span class="linenos"> 412</span></a>
</span><span id="LCMSBase-413"><a href="#LCMSBase-413"><span class="linenos"> 413</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-414"><a href="#LCMSBase-414"><span class="linenos"> 414</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-415"><a href="#LCMSBase-415"><span class="linenos"> 415</span></a><span class="sd">        str</span>
</span><span id="LCMSBase-416"><a href="#LCMSBase-416"><span class="linenos"> 416</span></a><span class="sd">            The parameters used for the LC-MS analysis in JSON format.</span>
</span><span id="LCMSBase-417"><a href="#LCMSBase-417"><span class="linenos"> 417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-418"><a href="#LCMSBase-418"><span class="linenos"> 418</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
</span><span id="LCMSBase-419"><a href="#LCMSBase-419"><span class="linenos"> 419</span></a>
</span><span id="LCMSBase-420"><a href="#LCMSBase-420"><span class="linenos"> 420</span></a>    <span class="k">def</span> <span class="nf">remove_unprocessed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms_level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="LCMSBase-421"><a href="#LCMSBase-421"><span class="linenos"> 421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the unprocessed data from the LCMSBase object.</span>
</span><span id="LCMSBase-422"><a href="#LCMSBase-422"><span class="linenos"> 422</span></a>
</span><span id="LCMSBase-423"><a href="#LCMSBase-423"><span class="linenos"> 423</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-424"><a href="#LCMSBase-424"><span class="linenos"> 424</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-425"><a href="#LCMSBase-425"><span class="linenos"> 425</span></a><span class="sd">        ms_level : int, optional</span>
</span><span id="LCMSBase-426"><a href="#LCMSBase-426"><span class="linenos"> 426</span></a><span class="sd">            The MS level to remove the unprocessed data for. If None, removes unprocessed data for all MS levels.</span>
</span><span id="LCMSBase-427"><a href="#LCMSBase-427"><span class="linenos"> 427</span></a>
</span><span id="LCMSBase-428"><a href="#LCMSBase-428"><span class="linenos"> 428</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-429"><a href="#LCMSBase-429"><span class="linenos"> 429</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-430"><a href="#LCMSBase-430"><span class="linenos"> 430</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase-431"><a href="#LCMSBase-431"><span class="linenos"> 431</span></a><span class="sd">            If ms_level is not 1 or 2.</span>
</span><span id="LCMSBase-432"><a href="#LCMSBase-432"><span class="linenos"> 432</span></a>
</span><span id="LCMSBase-433"><a href="#LCMSBase-433"><span class="linenos"> 433</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase-434"><a href="#LCMSBase-434"><span class="linenos"> 434</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase-435"><a href="#LCMSBase-435"><span class="linenos"> 435</span></a><span class="sd">        This method is useful for freeing up memory after the data has been processed.</span>
</span><span id="LCMSBase-436"><a href="#LCMSBase-436"><span class="linenos"> 436</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-437"><a href="#LCMSBase-437"><span class="linenos"> 437</span></a>        <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-438"><a href="#LCMSBase-438"><span class="linenos"> 438</span></a>            <span class="k">for</span> <span class="n">ms_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase-439"><a href="#LCMSBase-439"><span class="linenos"> 439</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase-440"><a href="#LCMSBase-440"><span class="linenos"> 440</span></a>        <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
</span><span id="LCMSBase-441"><a href="#LCMSBase-441"><span class="linenos"> 441</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ms_level must be 1 or 2&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-442"><a href="#LCMSBase-442"><span class="linenos"> 442</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase-443"><a href="#LCMSBase-443"><span class="linenos"> 443</span></a>
</span><span id="LCMSBase-444"><a href="#LCMSBase-444"><span class="linenos"> 444</span></a>    <span class="k">def</span> <span class="nf">add_associated_ms2_dda</span><span class="p">(</span>
</span><span id="LCMSBase-445"><a href="#LCMSBase-445"><span class="linenos"> 445</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LCMSBase-446"><a href="#LCMSBase-446"><span class="linenos"> 446</span></a>        <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LCMSBase-447"><a href="#LCMSBase-447"><span class="linenos"> 447</span></a>        <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LCMSBase-448"><a href="#LCMSBase-448"><span class="linenos"> 448</span></a>        <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase-449"><a href="#LCMSBase-449"><span class="linenos"> 449</span></a>        <span class="n">ms_params_key</span><span class="o">=</span><span class="s2">&quot;ms2&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-450"><a href="#LCMSBase-450"><span class="linenos"> 450</span></a>        <span class="n">scan_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase-451"><a href="#LCMSBase-451"><span class="linenos"> 451</span></a>    <span class="p">):</span>
</span><span id="LCMSBase-452"><a href="#LCMSBase-452"><span class="linenos"> 452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MS2 spectra associated with mass features to the dataset.</span>
</span><span id="LCMSBase-453"><a href="#LCMSBase-453"><span class="linenos"> 453</span></a>
</span><span id="LCMSBase-454"><a href="#LCMSBase-454"><span class="linenos"> 454</span></a><span class="sd">        Populates the mass_features ms2_scan_numbers attribute (on mass_features dictionary on LCMSObject)</span>
</span><span id="LCMSBase-455"><a href="#LCMSBase-455"><span class="linenos"> 455</span></a>
</span><span id="LCMSBase-456"><a href="#LCMSBase-456"><span class="linenos"> 456</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-457"><a href="#LCMSBase-457"><span class="linenos"> 457</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-458"><a href="#LCMSBase-458"><span class="linenos"> 458</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="LCMSBase-459"><a href="#LCMSBase-459"><span class="linenos"> 459</span></a><span class="sd">            If True, auto-processes the MS2 spectra before adding it to the object&#39;s _ms dictionary. Default is True.</span>
</span><span id="LCMSBase-460"><a href="#LCMSBase-460"><span class="linenos"> 460</span></a><span class="sd">        use_parser : bool, optional</span>
</span><span id="LCMSBase-461"><a href="#LCMSBase-461"><span class="linenos"> 461</span></a><span class="sd">            If True, envoke the spectra parser to get the MS2 spectra. Default is True.</span>
</span><span id="LCMSBase-462"><a href="#LCMSBase-462"><span class="linenos"> 462</span></a><span class="sd">        spectrum_mode : str or None, optional</span>
</span><span id="LCMSBase-463"><a href="#LCMSBase-463"><span class="linenos"> 463</span></a><span class="sd">            The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode</span>
</span><span id="LCMSBase-464"><a href="#LCMSBase-464"><span class="linenos"> 464</span></a><span class="sd">            from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="LCMSBase-465"><a href="#LCMSBase-465"><span class="linenos"> 465</span></a><span class="sd">            Defaults to None. (faster if defined, otherwise will check each scan)</span>
</span><span id="LCMSBase-466"><a href="#LCMSBase-466"><span class="linenos"> 466</span></a><span class="sd">        ms_params_key : string, optional</span>
</span><span id="LCMSBase-467"><a href="#LCMSBase-467"><span class="linenos"> 467</span></a><span class="sd">            The key of the mass spectrum parameters to use for the mass spectra, accessed from the LCMSObject.parameters.mass_spectrum attribute.</span>
</span><span id="LCMSBase-468"><a href="#LCMSBase-468"><span class="linenos"> 468</span></a><span class="sd">            Defaults to &#39;ms2&#39;.</span>
</span><span id="LCMSBase-469"><a href="#LCMSBase-469"><span class="linenos"> 469</span></a><span class="sd">        scan_filter : str</span>
</span><span id="LCMSBase-470"><a href="#LCMSBase-470"><span class="linenos"> 470</span></a><span class="sd">            A string to filter the scans to add to the _ms dictionary.  If None, all scans are added.  Defaults to None.</span>
</span><span id="LCMSBase-471"><a href="#LCMSBase-471"><span class="linenos"> 471</span></a><span class="sd">            &quot;hcd&quot; will pull out only HCD scans.</span>
</span><span id="LCMSBase-472"><a href="#LCMSBase-472"><span class="linenos"> 472</span></a>
</span><span id="LCMSBase-473"><a href="#LCMSBase-473"><span class="linenos"> 473</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-474"><a href="#LCMSBase-474"><span class="linenos"> 474</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-475"><a href="#LCMSBase-475"><span class="linenos"> 475</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase-476"><a href="#LCMSBase-476"><span class="linenos"> 476</span></a><span class="sd">            If mass_features is not set, must run find_mass_features() first.</span>
</span><span id="LCMSBase-477"><a href="#LCMSBase-477"><span class="linenos"> 477</span></a><span class="sd">            If no MS2 scans are found in the dataset.</span>
</span><span id="LCMSBase-478"><a href="#LCMSBase-478"><span class="linenos"> 478</span></a><span class="sd">            If no precursor m/z values are found in MS2 scans, not a DDA dataset.</span>
</span><span id="LCMSBase-479"><a href="#LCMSBase-479"><span class="linenos"> 479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-480"><a href="#LCMSBase-480"><span class="linenos"> 480</span></a>        <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase-481"><a href="#LCMSBase-481"><span class="linenos"> 481</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-482"><a href="#LCMSBase-482"><span class="linenos"> 482</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-483"><a href="#LCMSBase-483"><span class="linenos"> 483</span></a>                <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase-484"><a href="#LCMSBase-484"><span class="linenos"> 484</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-485"><a href="#LCMSBase-485"><span class="linenos"> 485</span></a>
</span><span id="LCMSBase-486"><a href="#LCMSBase-486"><span class="linenos"> 486</span></a>        <span class="c1"># reconfigure ms_params to get the correct mass spectrum parameters from the key</span>
</span><span id="LCMSBase-487"><a href="#LCMSBase-487"><span class="linenos"> 487</span></a>        <span class="n">ms_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="n">ms_params_key</span><span class="p">]</span>
</span><span id="LCMSBase-488"><a href="#LCMSBase-488"><span class="linenos"> 488</span></a>
</span><span id="LCMSBase-489"><a href="#LCMSBase-489"><span class="linenos"> 489</span></a>        <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase-490"><a href="#LCMSBase-490"><span class="linenos"> 490</span></a>        <span class="c1"># Find ms2 scans that have a precursor m/z value</span>
</span><span id="LCMSBase-491"><a href="#LCMSBase-491"><span class="linenos"> 491</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="LCMSBase-492"><a href="#LCMSBase-492"><span class="linenos"> 492</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="o">~</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">precursor_mz</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</span><span id="LCMSBase-493"><a href="#LCMSBase-493"><span class="linenos"> 493</span></a>        <span class="c1"># drop ms2 scans that have no tic</span>
</span><span id="LCMSBase-494"><a href="#LCMSBase-494"><span class="linenos"> 494</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">tic</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="LCMSBase-495"><a href="#LCMSBase-495"><span class="linenos"> 495</span></a>        <span class="k">if</span> <span class="n">ms2_scans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-496"><a href="#LCMSBase-496"><span class="linenos"> 496</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No DDA scans found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-497"><a href="#LCMSBase-497"><span class="linenos"> 497</span></a>
</span><span id="LCMSBase-498"><a href="#LCMSBase-498"><span class="linenos"> 498</span></a>        <span class="k">if</span> <span class="n">scan_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-499"><a href="#LCMSBase-499"><span class="linenos"> 499</span></a>            <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">scan_text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">scan_filter</span><span class="p">)]</span>
</span><span id="LCMSBase-500"><a href="#LCMSBase-500"><span class="linenos"> 500</span></a>        <span class="c1"># set tolerance in rt space (in minutes) and mz space (in daltons)</span>
</span><span id="LCMSBase-501"><a href="#LCMSBase-501"><span class="linenos"> 501</span></a>        <span class="n">time_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms2_dda_rt_tolerance</span>
</span><span id="LCMSBase-502"><a href="#LCMSBase-502"><span class="linenos"> 502</span></a>        <span class="n">mz_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms2_dda_mz_tolerance</span>
</span><span id="LCMSBase-503"><a href="#LCMSBase-503"><span class="linenos"> 503</span></a>
</span><span id="LCMSBase-504"><a href="#LCMSBase-504"><span class="linenos"> 504</span></a>        <span class="c1"># for each mass feature, find the ms2 scans that are within the roi scan time and mz range</span>
</span><span id="LCMSBase-505"><a href="#LCMSBase-505"><span class="linenos"> 505</span></a>        <span class="n">dda_scans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-506"><a href="#LCMSBase-506"><span class="linenos"> 506</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="LCMSBase-507"><a href="#LCMSBase-507"><span class="linenos"> 507</span></a>            <span class="n">ms2_scans_filtered</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span>
</span><span id="LCMSBase-508"><a href="#LCMSBase-508"><span class="linenos"> 508</span></a>                <span class="n">ms2_scans</span><span class="o">.</span><span class="n">scan_time</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
</span><span id="LCMSBase-509"><a href="#LCMSBase-509"><span class="linenos"> 509</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">scan_time</span> <span class="o">-</span> <span class="n">time_tol</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">scan_time</span> <span class="o">+</span> <span class="n">time_tol</span>
</span><span id="LCMSBase-510"><a href="#LCMSBase-510"><span class="linenos"> 510</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-511"><a href="#LCMSBase-511"><span class="linenos"> 511</span></a>            <span class="p">]</span>
</span><span id="LCMSBase-512"><a href="#LCMSBase-512"><span class="linenos"> 512</span></a>            <span class="n">ms2_scans_filtered</span> <span class="o">=</span> <span class="n">ms2_scans_filtered</span><span class="p">[</span>
</span><span id="LCMSBase-513"><a href="#LCMSBase-513"><span class="linenos"> 513</span></a>                <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">precursor_mz</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
</span><span id="LCMSBase-514"><a href="#LCMSBase-514"><span class="linenos"> 514</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">mz</span> <span class="o">-</span> <span class="n">mz_tol</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">mz</span> <span class="o">+</span> <span class="n">mz_tol</span>
</span><span id="LCMSBase-515"><a href="#LCMSBase-515"><span class="linenos"> 515</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-516"><a href="#LCMSBase-516"><span class="linenos"> 516</span></a>            <span class="p">]</span>
</span><span id="LCMSBase-517"><a href="#LCMSBase-517"><span class="linenos"> 517</span></a>            <span class="n">dda_scans</span> <span class="o">=</span> <span class="n">dda_scans</span> <span class="o">+</span> <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase-518"><a href="#LCMSBase-518"><span class="linenos"> 518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="LCMSBase-519"><a href="#LCMSBase-519"><span class="linenos"> 519</span></a>                <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase-520"><a href="#LCMSBase-520"><span class="linenos"> 520</span></a>                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span>
</span><span id="LCMSBase-521"><a href="#LCMSBase-521"><span class="linenos"> 521</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-522"><a href="#LCMSBase-522"><span class="linenos"> 522</span></a>        <span class="c1"># add to _ms attribute</span>
</span><span id="LCMSBase-523"><a href="#LCMSBase-523"><span class="linenos"> 523</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectra</span><span class="p">(</span>
</span><span id="LCMSBase-524"><a href="#LCMSBase-524"><span class="linenos"> 524</span></a>            <span class="n">scan_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dda_scans</span><span class="p">)),</span>
</span><span id="LCMSBase-525"><a href="#LCMSBase-525"><span class="linenos"> 525</span></a>            <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="LCMSBase-526"><a href="#LCMSBase-526"><span class="linenos"> 526</span></a>            <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode</span><span class="p">,</span>
</span><span id="LCMSBase-527"><a href="#LCMSBase-527"><span class="linenos"> 527</span></a>            <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="LCMSBase-528"><a href="#LCMSBase-528"><span class="linenos"> 528</span></a>            <span class="n">ms_params</span><span class="o">=</span><span class="n">ms_params</span><span class="p">,</span>
</span><span id="LCMSBase-529"><a href="#LCMSBase-529"><span class="linenos"> 529</span></a>        <span class="p">)</span>
</span><span id="LCMSBase-530"><a href="#LCMSBase-530"><span class="linenos"> 530</span></a>        <span class="c1"># associate appropriate _ms attribute to appropriate mass feature&#39;s ms2_mass_spectra attribute</span>
</span><span id="LCMSBase-531"><a href="#LCMSBase-531"><span class="linenos"> 531</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">:</span>
</span><span id="LCMSBase-532"><a href="#LCMSBase-532"><span class="linenos"> 532</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-533"><a href="#LCMSBase-533"><span class="linenos"> 533</span></a>                <span class="k">for</span> <span class="n">dda_scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span><span class="p">:</span>
</span><span id="LCMSBase-534"><a href="#LCMSBase-534"><span class="linenos"> 534</span></a>                    <span class="k">if</span> <span class="n">dda_scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase-535"><a href="#LCMSBase-535"><span class="linenos"> 535</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_mass_spectra</span><span class="p">[</span><span class="n">dda_scan</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span>
</span><span id="LCMSBase-536"><a href="#LCMSBase-536"><span class="linenos"> 536</span></a>                            <span class="n">dda_scan</span>
</span><span id="LCMSBase-537"><a href="#LCMSBase-537"><span class="linenos"> 537</span></a>                        <span class="p">]</span>
</span><span id="LCMSBase-538"><a href="#LCMSBase-538"><span class="linenos"> 538</span></a>
</span><span id="LCMSBase-539"><a href="#LCMSBase-539"><span class="linenos"> 539</span></a>    <span class="k">def</span> <span class="nf">add_associated_ms1</span><span class="p">(</span>
</span><span id="LCMSBase-540"><a href="#LCMSBase-540"><span class="linenos"> 540</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span>
</span><span id="LCMSBase-541"><a href="#LCMSBase-541"><span class="linenos"> 541</span></a>    <span class="p">):</span>
</span><span id="LCMSBase-542"><a href="#LCMSBase-542"><span class="linenos"> 542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MS1 spectra associated with mass features to the dataset.</span>
</span><span id="LCMSBase-543"><a href="#LCMSBase-543"><span class="linenos"> 543</span></a>
</span><span id="LCMSBase-544"><a href="#LCMSBase-544"><span class="linenos"> 544</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-545"><a href="#LCMSBase-545"><span class="linenos"> 545</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-546"><a href="#LCMSBase-546"><span class="linenos"> 546</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="LCMSBase-547"><a href="#LCMSBase-547"><span class="linenos"> 547</span></a><span class="sd">            If True, auto-processes the MS1 spectra before adding it to the object&#39;s _ms dictionary. Default is True.</span>
</span><span id="LCMSBase-548"><a href="#LCMSBase-548"><span class="linenos"> 548</span></a><span class="sd">        use_parser : bool, optional</span>
</span><span id="LCMSBase-549"><a href="#LCMSBase-549"><span class="linenos"> 549</span></a><span class="sd">            If True, envoke the spectra parser to get the MS1 spectra. Default is True.</span>
</span><span id="LCMSBase-550"><a href="#LCMSBase-550"><span class="linenos"> 550</span></a><span class="sd">        spectrum_mode : str or None, optional</span>
</span><span id="LCMSBase-551"><a href="#LCMSBase-551"><span class="linenos"> 551</span></a><span class="sd">            The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode</span>
</span><span id="LCMSBase-552"><a href="#LCMSBase-552"><span class="linenos"> 552</span></a><span class="sd">            from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="LCMSBase-553"><a href="#LCMSBase-553"><span class="linenos"> 553</span></a><span class="sd">            Defaults to None. (faster if defined, otherwise will check each scan)</span>
</span><span id="LCMSBase-554"><a href="#LCMSBase-554"><span class="linenos"> 554</span></a>
</span><span id="LCMSBase-555"><a href="#LCMSBase-555"><span class="linenos"> 555</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-556"><a href="#LCMSBase-556"><span class="linenos"> 556</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-557"><a href="#LCMSBase-557"><span class="linenos"> 557</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase-558"><a href="#LCMSBase-558"><span class="linenos"> 558</span></a><span class="sd">            If mass_features is not set, must run find_mass_features() first.</span>
</span><span id="LCMSBase-559"><a href="#LCMSBase-559"><span class="linenos"> 559</span></a><span class="sd">            If apex scans are not profile mode, all apex scans must be profile mode for averaging.</span>
</span><span id="LCMSBase-560"><a href="#LCMSBase-560"><span class="linenos"> 560</span></a><span class="sd">            If number of scans to average is not  1 or an integer with an integer median (i.e. 3, 5, 7, 9).</span>
</span><span id="LCMSBase-561"><a href="#LCMSBase-561"><span class="linenos"> 561</span></a><span class="sd">            If deconvolute is True and no EICs are found, did you run integrate_mass_features() first?</span>
</span><span id="LCMSBase-562"><a href="#LCMSBase-562"><span class="linenos"> 562</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-563"><a href="#LCMSBase-563"><span class="linenos"> 563</span></a>        <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase-564"><a href="#LCMSBase-564"><span class="linenos"> 564</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-565"><a href="#LCMSBase-565"><span class="linenos"> 565</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-566"><a href="#LCMSBase-566"><span class="linenos"> 566</span></a>                <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase-567"><a href="#LCMSBase-567"><span class="linenos"> 567</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-568"><a href="#LCMSBase-568"><span class="linenos"> 568</span></a>        <span class="n">scans_to_average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms1_scans_to_average</span>
</span><span id="LCMSBase-569"><a href="#LCMSBase-569"><span class="linenos"> 569</span></a>
</span><span id="LCMSBase-570"><a href="#LCMSBase-570"><span class="linenos"> 570</span></a>        <span class="k">if</span> <span class="n">scans_to_average</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LCMSBase-571"><a href="#LCMSBase-571"><span class="linenos"> 571</span></a>            <span class="c1"># Add to LCMSobj</span>
</span><span id="LCMSBase-572"><a href="#LCMSBase-572"><span class="linenos"> 572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectra</span><span class="p">(</span>
</span><span id="LCMSBase-573"><a href="#LCMSBase-573"><span class="linenos"> 573</span></a>                <span class="n">scan_list</span><span class="o">=</span><span class="p">[</span>
</span><span id="LCMSBase-574"><a href="#LCMSBase-574"><span class="linenos"> 574</span></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">apex_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase-575"><a href="#LCMSBase-575"><span class="linenos"> 575</span></a>                <span class="p">],</span>
</span><span id="LCMSBase-576"><a href="#LCMSBase-576"><span class="linenos"> 576</span></a>                <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="LCMSBase-577"><a href="#LCMSBase-577"><span class="linenos"> 577</span></a>                <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="LCMSBase-578"><a href="#LCMSBase-578"><span class="linenos"> 578</span></a>                <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode</span><span class="p">,</span>
</span><span id="LCMSBase-579"><a href="#LCMSBase-579"><span class="linenos"> 579</span></a>                <span class="n">ms_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="s2">&quot;ms1&quot;</span><span class="p">],</span>
</span><span id="LCMSBase-580"><a href="#LCMSBase-580"><span class="linenos"> 580</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-581"><a href="#LCMSBase-581"><span class="linenos"> 581</span></a>
</span><span id="LCMSBase-582"><a href="#LCMSBase-582"><span class="linenos"> 582</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="LCMSBase-583"><a href="#LCMSBase-583"><span class="linenos"> 583</span></a>            <span class="p">(</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="LCMSBase-584"><a href="#LCMSBase-584"><span class="linenos"> 584</span></a>        <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># scans_to_average = 3, 5, 7 etc, mirror l/r around apex</span>
</span><span id="LCMSBase-585"><a href="#LCMSBase-585"><span class="linenos"> 585</span></a>            <span class="n">apex_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">apex_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</span><span id="LCMSBase-586"><a href="#LCMSBase-586"><span class="linenos"> 586</span></a>            <span class="c1"># Check if all apex scans are profile mode, raise error if not</span>
</span><span id="LCMSBase-587"><a href="#LCMSBase-587"><span class="linenos"> 587</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">apex_scans</span><span class="p">,</span> <span class="s2">&quot;ms_format&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">):</span>
</span><span id="LCMSBase-588"><a href="#LCMSBase-588"><span class="linenos"> 588</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All apex scans must be profile mode for averaging&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-589"><a href="#LCMSBase-589"><span class="linenos"> 589</span></a>
</span><span id="LCMSBase-590"><a href="#LCMSBase-590"><span class="linenos"> 590</span></a>            <span class="c1"># First get sets of scans to average</span>
</span><span id="LCMSBase-591"><a href="#LCMSBase-591"><span class="linenos"> 591</span></a>            <span class="k">def</span> <span class="nf">get_scans_from_apex</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">,</span> <span class="n">apex_scan</span><span class="p">,</span> <span class="n">scans_to_average</span><span class="p">):</span>
</span><span id="LCMSBase-592"><a href="#LCMSBase-592"><span class="linenos"> 592</span></a>                <span class="n">ms1_idx_start</span> <span class="o">=</span> <span class="n">ms1_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">apex_scan</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="LCMSBase-593"><a href="#LCMSBase-593"><span class="linenos"> 593</span></a>                    <span class="p">(</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="LCMSBase-594"><a href="#LCMSBase-594"><span class="linenos"> 594</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-595"><a href="#LCMSBase-595"><span class="linenos"> 595</span></a>                <span class="k">if</span> <span class="n">ms1_idx_start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-596"><a href="#LCMSBase-596"><span class="linenos"> 596</span></a>                    <span class="n">ms1_idx_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LCMSBase-597"><a href="#LCMSBase-597"><span class="linenos"> 597</span></a>                <span class="n">ms1_idx_end</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="LCMSBase-598"><a href="#LCMSBase-598"><span class="linenos"> 598</span></a>                    <span class="n">ms1_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">apex_scan</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LCMSBase-599"><a href="#LCMSBase-599"><span class="linenos"> 599</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-600"><a href="#LCMSBase-600"><span class="linenos"> 600</span></a>                <span class="k">if</span> <span class="n">ms1_idx_end</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="LCMSBase-601"><a href="#LCMSBase-601"><span class="linenos"> 601</span></a>                    <span class="n">ms1_idx_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="LCMSBase-602"><a href="#LCMSBase-602"><span class="linenos"> 602</span></a>                <span class="n">scan_list</span> <span class="o">=</span> <span class="n">ms1_scans</span><span class="p">[</span><span class="n">ms1_idx_start</span><span class="p">:</span><span class="n">ms1_idx_end</span><span class="p">]</span>
</span><span id="LCMSBase-603"><a href="#LCMSBase-603"><span class="linenos"> 603</span></a>                <span class="k">return</span> <span class="n">scan_list</span>
</span><span id="LCMSBase-604"><a href="#LCMSBase-604"><span class="linenos"> 604</span></a>
</span><span id="LCMSBase-605"><a href="#LCMSBase-605"><span class="linenos"> 605</span></a>            <span class="n">ms1_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_scans</span>
</span><span id="LCMSBase-606"><a href="#LCMSBase-606"><span class="linenos"> 606</span></a>            <span class="n">scans_lists</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase-607"><a href="#LCMSBase-607"><span class="linenos"> 607</span></a>                <span class="n">get_scans_from_apex</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">,</span> <span class="n">apex_scan</span><span class="p">,</span> <span class="n">scans_to_average</span><span class="p">)</span>
</span><span id="LCMSBase-608"><a href="#LCMSBase-608"><span class="linenos"> 608</span></a>                <span class="k">for</span> <span class="n">apex_scan</span> <span class="ow">in</span> <span class="n">apex_scans</span>
</span><span id="LCMSBase-609"><a href="#LCMSBase-609"><span class="linenos"> 609</span></a>            <span class="p">]</span>
</span><span id="LCMSBase-610"><a href="#LCMSBase-610"><span class="linenos"> 610</span></a>
</span><span id="LCMSBase-611"><a href="#LCMSBase-611"><span class="linenos"> 611</span></a>            <span class="c1"># set polarity to -1 if negative mode, 1 if positive mode (for mass spectrum creation)</span>
</span><span id="LCMSBase-612"><a href="#LCMSBase-612"><span class="linenos"> 612</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
</span><span id="LCMSBase-613"><a href="#LCMSBase-613"><span class="linenos"> 613</span></a>                <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="LCMSBase-614"><a href="#LCMSBase-614"><span class="linenos"> 614</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
</span><span id="LCMSBase-615"><a href="#LCMSBase-615"><span class="linenos"> 615</span></a>                <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="LCMSBase-616"><a href="#LCMSBase-616"><span class="linenos"> 616</span></a>
</span><span id="LCMSBase-617"><a href="#LCMSBase-617"><span class="linenos"> 617</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="LCMSBase-618"><a href="#LCMSBase-618"><span class="linenos"> 618</span></a>                <span class="c1"># Perform checks and prepare _ms_unprocessed dictionary if use_parser is False (saves time to do this once)</span>
</span><span id="LCMSBase-619"><a href="#LCMSBase-619"><span class="linenos"> 619</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase-620"><a href="#LCMSBase-620"><span class="linenos"> 620</span></a>                <span class="c1"># Set the index on _ms_unprocessed[1] to scan number</span>
</span><span id="LCMSBase-621"><a href="#LCMSBase-621"><span class="linenos"> 621</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="LCMSBase-622"><a href="#LCMSBase-622"><span class="linenos"> 622</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span>
</span><span id="LCMSBase-623"><a href="#LCMSBase-623"><span class="linenos"> 623</span></a>
</span><span id="LCMSBase-624"><a href="#LCMSBase-624"><span class="linenos"> 624</span></a>                <span class="c1"># Check that all the scans in scan_lists are indexs in self._ms_unprocessed[1]</span>
</span><span id="LCMSBase-625"><a href="#LCMSBase-625"><span class="linenos"> 625</span></a>                <span class="n">scans_lists_flat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="LCMSBase-626"><a href="#LCMSBase-626"><span class="linenos"> 626</span></a>                    <span class="nb">set</span><span class="p">([</span><span class="n">scan</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">scans_lists</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
</span><span id="LCMSBase-627"><a href="#LCMSBase-627"><span class="linenos"> 627</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-628"><a href="#LCMSBase-628"><span class="linenos"> 628</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="LCMSBase-629"><a href="#LCMSBase-629"><span class="linenos"> 629</span></a>                    <span class="nb">len</span><span class="p">(</span>
</span><span id="LCMSBase-630"><a href="#LCMSBase-630"><span class="linenos"> 630</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
</span><span id="LCMSBase-631"><a href="#LCMSBase-631"><span class="linenos"> 631</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">scans_lists_flat</span><span class="p">),</span>
</span><span id="LCMSBase-632"><a href="#LCMSBase-632"><span class="linenos"> 632</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
</span><span id="LCMSBase-633"><a href="#LCMSBase-633"><span class="linenos"> 633</span></a>                        <span class="p">)</span>
</span><span id="LCMSBase-634"><a href="#LCMSBase-634"><span class="linenos"> 634</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase-635"><a href="#LCMSBase-635"><span class="linenos"> 635</span></a>                    <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="LCMSBase-636"><a href="#LCMSBase-636"><span class="linenos"> 636</span></a>                <span class="p">):</span>
</span><span id="LCMSBase-637"><a href="#LCMSBase-637"><span class="linenos"> 637</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-638"><a href="#LCMSBase-638"><span class="linenos"> 638</span></a>                        <span class="s2">&quot;Not all scans to average are present in the unprocessed data&quot;</span>
</span><span id="LCMSBase-639"><a href="#LCMSBase-639"><span class="linenos"> 639</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase-640"><a href="#LCMSBase-640"><span class="linenos"> 640</span></a>
</span><span id="LCMSBase-641"><a href="#LCMSBase-641"><span class="linenos"> 641</span></a>            <span class="k">for</span> <span class="n">scan_list_average</span><span class="p">,</span> <span class="n">apex_scan</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans_lists</span><span class="p">,</span> <span class="n">apex_scans</span><span class="p">):</span>
</span><span id="LCMSBase-642"><a href="#LCMSBase-642"><span class="linenos"> 642</span></a>                <span class="c1"># Get unprocessed mass spectrum from scans</span>
</span><span id="LCMSBase-643"><a href="#LCMSBase-643"><span class="linenos"> 643</span></a>                <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_mass_spectrum</span><span class="p">(</span>
</span><span id="LCMSBase-644"><a href="#LCMSBase-644"><span class="linenos"> 644</span></a>                    <span class="n">scan_list</span><span class="o">=</span><span class="n">scan_list_average</span><span class="p">,</span>
</span><span id="LCMSBase-645"><a href="#LCMSBase-645"><span class="linenos"> 645</span></a>                    <span class="n">apex_scan</span><span class="o">=</span><span class="n">apex_scan</span><span class="p">,</span>
</span><span id="LCMSBase-646"><a href="#LCMSBase-646"><span class="linenos"> 646</span></a>                    <span class="n">spectrum_mode</span><span class="o">=</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-647"><a href="#LCMSBase-647"><span class="linenos"> 647</span></a>                    <span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="LCMSBase-648"><a href="#LCMSBase-648"><span class="linenos"> 648</span></a>                    <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="LCMSBase-649"><a href="#LCMSBase-649"><span class="linenos"> 649</span></a>                    <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="LCMSBase-650"><a href="#LCMSBase-650"><span class="linenos"> 650</span></a>                    <span class="n">perform_checks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LCMSBase-651"><a href="#LCMSBase-651"><span class="linenos"> 651</span></a>                    <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span>
</span><span id="LCMSBase-652"><a href="#LCMSBase-652"><span class="linenos"> 652</span></a>                    <span class="n">ms_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="s2">&quot;ms1&quot;</span><span class="p">],</span>
</span><span id="LCMSBase-653"><a href="#LCMSBase-653"><span class="linenos"> 653</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-654"><a href="#LCMSBase-654"><span class="linenos"> 654</span></a>                <span class="c1"># Add mass spectrum to LCMS object and associated with mass feature</span>
</span><span id="LCMSBase-655"><a href="#LCMSBase-655"><span class="linenos"> 655</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectrum</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</span><span id="LCMSBase-656"><a href="#LCMSBase-656"><span class="linenos"> 656</span></a>
</span><span id="LCMSBase-657"><a href="#LCMSBase-657"><span class="linenos"> 657</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="LCMSBase-658"><a href="#LCMSBase-658"><span class="linenos"> 658</span></a>                <span class="c1"># Reset the index on _ms_unprocessed[1] to not be scan number</span>
</span><span id="LCMSBase-659"><a href="#LCMSBase-659"><span class="linenos"> 659</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LCMSBase-660"><a href="#LCMSBase-660"><span class="linenos"> 660</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span>
</span><span id="LCMSBase-661"><a href="#LCMSBase-661"><span class="linenos"> 661</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase-662"><a href="#LCMSBase-662"><span class="linenos"> 662</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-663"><a href="#LCMSBase-663"><span class="linenos"> 663</span></a>                <span class="s2">&quot;Number of scans to average must be 1 or an integer with an integer median (i.e. 3, 5, 7, 9)&quot;</span>
</span><span id="LCMSBase-664"><a href="#LCMSBase-664"><span class="linenos"> 664</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-665"><a href="#LCMSBase-665"><span class="linenos"> 665</span></a>
</span><span id="LCMSBase-666"><a href="#LCMSBase-666"><span class="linenos"> 666</span></a>        <span class="c1"># Associate the ms1 spectra with the mass features</span>
</span><span id="LCMSBase-667"><a href="#LCMSBase-667"><span class="linenos"> 667</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">:</span>
</span><span id="LCMSBase-668"><a href="#LCMSBase-668"><span class="linenos"> 668</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span>
</span><span id="LCMSBase-669"><a href="#LCMSBase-669"><span class="linenos"> 669</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">apex_scan</span>
</span><span id="LCMSBase-670"><a href="#LCMSBase-670"><span class="linenos"> 670</span></a>            <span class="p">]</span>
</span><span id="LCMSBase-671"><a href="#LCMSBase-671"><span class="linenos"> 671</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">update_mz</span><span class="p">()</span>
</span><span id="LCMSBase-672"><a href="#LCMSBase-672"><span class="linenos"> 672</span></a>
</span><span id="LCMSBase-673"><a href="#LCMSBase-673"><span class="linenos"> 673</span></a>        <span class="c1"># Re-process clustering if persistent homology is selected to remove duplicate mass features after adding and processing MS1 spectra</span>
</span><span id="LCMSBase-674"><a href="#LCMSBase-674"><span class="linenos"> 674</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">peak_picking_method</span> <span class="o">==</span> <span class="s2">&quot;persistent homology&quot;</span><span class="p">:</span>
</span><span id="LCMSBase-675"><a href="#LCMSBase-675"><span class="linenos"> 675</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cluster_mass_features</span><span class="p">(</span><span class="n">drop_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;persistence&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-676"><a href="#LCMSBase-676"><span class="linenos"> 676</span></a>
</span><span id="LCMSBase-677"><a href="#LCMSBase-677"><span class="linenos"> 677</span></a>    <span class="k">def</span> <span class="nf">mass_features_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-678"><a href="#LCMSBase-678"><span class="linenos"> 678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the mass features.</span>
</span><span id="LCMSBase-679"><a href="#LCMSBase-679"><span class="linenos"> 679</span></a>
</span><span id="LCMSBase-680"><a href="#LCMSBase-680"><span class="linenos"> 680</span></a><span class="sd">        The dataframe contains the following columns: mf_id, mz, apex_scan, scan_time, intensity,</span>
</span><span id="LCMSBase-681"><a href="#LCMSBase-681"><span class="linenos"> 681</span></a><span class="sd">        persistence, area, monoisotopic_mf_id, and isotopologue_type.  The index is set to mf_id (mass feature ID).</span>
</span><span id="LCMSBase-682"><a href="#LCMSBase-682"><span class="linenos"> 682</span></a>
</span><span id="LCMSBase-683"><a href="#LCMSBase-683"><span class="linenos"> 683</span></a>
</span><span id="LCMSBase-684"><a href="#LCMSBase-684"><span class="linenos"> 684</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-685"><a href="#LCMSBase-685"><span class="linenos"> 685</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-686"><a href="#LCMSBase-686"><span class="linenos"> 686</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="LCMSBase-687"><a href="#LCMSBase-687"><span class="linenos"> 687</span></a><span class="sd">            A pandas dataframe of mass features with the following columns:</span>
</span><span id="LCMSBase-688"><a href="#LCMSBase-688"><span class="linenos"> 688</span></a><span class="sd">            mf_id, mz, apex_scan, scan_time, intensity, persistence, area.</span>
</span><span id="LCMSBase-689"><a href="#LCMSBase-689"><span class="linenos"> 689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-690"><a href="#LCMSBase-690"><span class="linenos"> 690</span></a>
</span><span id="LCMSBase-691"><a href="#LCMSBase-691"><span class="linenos"> 691</span></a>        <span class="k">def</span> <span class="nf">mass_spectrum_to_string</span><span class="p">(</span>
</span><span id="LCMSBase-692"><a href="#LCMSBase-692"><span class="linenos"> 692</span></a>            <span class="n">mass_spec</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_normalized_abun</span><span class="o">=</span><span class="mf">0.01</span>
</span><span id="LCMSBase-693"><a href="#LCMSBase-693"><span class="linenos"> 693</span></a>        <span class="p">):</span>
</span><span id="LCMSBase-694"><a href="#LCMSBase-694"><span class="linenos"> 694</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Converts a mass spectrum to a string of m/z:abundance pairs.</span>
</span><span id="LCMSBase-695"><a href="#LCMSBase-695"><span class="linenos"> 695</span></a>
</span><span id="LCMSBase-696"><a href="#LCMSBase-696"><span class="linenos"> 696</span></a><span class="sd">            Parameters</span>
</span><span id="LCMSBase-697"><a href="#LCMSBase-697"><span class="linenos"> 697</span></a><span class="sd">            -----------</span>
</span><span id="LCMSBase-698"><a href="#LCMSBase-698"><span class="linenos"> 698</span></a><span class="sd">            mass_spec : MassSpectrum</span>
</span><span id="LCMSBase-699"><a href="#LCMSBase-699"><span class="linenos"> 699</span></a><span class="sd">                A MassSpectrum object to be converted to a string.</span>
</span><span id="LCMSBase-700"><a href="#LCMSBase-700"><span class="linenos"> 700</span></a><span class="sd">            normalize : bool, optional</span>
</span><span id="LCMSBase-701"><a href="#LCMSBase-701"><span class="linenos"> 701</span></a><span class="sd">                If True, normalizes the abundance values to a maximum of 1. Defaults to True.</span>
</span><span id="LCMSBase-702"><a href="#LCMSBase-702"><span class="linenos"> 702</span></a><span class="sd">            min_normalized_abun : float, optional</span>
</span><span id="LCMSBase-703"><a href="#LCMSBase-703"><span class="linenos"> 703</span></a><span class="sd">                The minimum normalized abundance value to include in the string, only used if normalize is True. Defaults to 0.01.</span>
</span><span id="LCMSBase-704"><a href="#LCMSBase-704"><span class="linenos"> 704</span></a>
</span><span id="LCMSBase-705"><a href="#LCMSBase-705"><span class="linenos"> 705</span></a><span class="sd">            Returns</span>
</span><span id="LCMSBase-706"><a href="#LCMSBase-706"><span class="linenos"> 706</span></a><span class="sd">            --------</span>
</span><span id="LCMSBase-707"><a href="#LCMSBase-707"><span class="linenos"> 707</span></a><span class="sd">            str</span>
</span><span id="LCMSBase-708"><a href="#LCMSBase-708"><span class="linenos"> 708</span></a><span class="sd">                A string of m/z:abundance pairs from the mass spectrum, separated by a semicolon.</span>
</span><span id="LCMSBase-709"><a href="#LCMSBase-709"><span class="linenos"> 709</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="LCMSBase-710"><a href="#LCMSBase-710"><span class="linenos"> 710</span></a>            <span class="n">mz_np</span> <span class="o">=</span> <span class="n">mass_spec</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s2">&quot;m/z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LCMSBase-711"><a href="#LCMSBase-711"><span class="linenos"> 711</span></a>            <span class="n">abun_np</span> <span class="o">=</span> <span class="n">mass_spec</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s2">&quot;Peak Height&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LCMSBase-712"><a href="#LCMSBase-712"><span class="linenos"> 712</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="LCMSBase-713"><a href="#LCMSBase-713"><span class="linenos"> 713</span></a>                <span class="n">abun_np</span> <span class="o">=</span> <span class="n">abun_np</span> <span class="o">/</span> <span class="n">abun_np</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="LCMSBase-714"><a href="#LCMSBase-714"><span class="linenos"> 714</span></a>            <span class="n">mz_abun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">mz_np</span><span class="p">,</span> <span class="n">abun_np</span><span class="p">))</span>
</span><span id="LCMSBase-715"><a href="#LCMSBase-715"><span class="linenos"> 715</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="LCMSBase-716"><a href="#LCMSBase-716"><span class="linenos"> 716</span></a>                <span class="n">mz_abun</span> <span class="o">=</span> <span class="n">mz_abun</span><span class="p">[</span><span class="n">mz_abun</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_normalized_abun</span><span class="p">]</span>
</span><span id="LCMSBase-717"><a href="#LCMSBase-717"><span class="linenos"> 717</span></a>            <span class="n">mz_abun_str</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase-718"><a href="#LCMSBase-718"><span class="linenos"> 718</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">abun</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span><span id="LCMSBase-719"><a href="#LCMSBase-719"><span class="linenos"> 719</span></a>                <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">abun</span> <span class="ow">in</span> <span class="n">mz_abun</span>
</span><span id="LCMSBase-720"><a href="#LCMSBase-720"><span class="linenos"> 720</span></a>            <span class="p">]</span>
</span><span id="LCMSBase-721"><a href="#LCMSBase-721"><span class="linenos"> 721</span></a>            <span class="k">return</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mz_abun_str</span><span class="p">)</span>
</span><span id="LCMSBase-722"><a href="#LCMSBase-722"><span class="linenos"> 722</span></a>
</span><span id="LCMSBase-723"><a href="#LCMSBase-723"><span class="linenos"> 723</span></a>        <span class="n">cols_in_df</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase-724"><a href="#LCMSBase-724"><span class="linenos"> 724</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-725"><a href="#LCMSBase-725"><span class="linenos"> 725</span></a>            <span class="s2">&quot;_apex_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-726"><a href="#LCMSBase-726"><span class="linenos"> 726</span></a>            <span class="s2">&quot;start_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-727"><a href="#LCMSBase-727"><span class="linenos"> 727</span></a>            <span class="s2">&quot;final_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-728"><a href="#LCMSBase-728"><span class="linenos"> 728</span></a>            <span class="s2">&quot;_retention_time&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-729"><a href="#LCMSBase-729"><span class="linenos"> 729</span></a>            <span class="s2">&quot;_intensity&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-730"><a href="#LCMSBase-730"><span class="linenos"> 730</span></a>            <span class="s2">&quot;_persistence&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-731"><a href="#LCMSBase-731"><span class="linenos"> 731</span></a>            <span class="s2">&quot;_area&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-732"><a href="#LCMSBase-732"><span class="linenos"> 732</span></a>            <span class="s2">&quot;_dispersity_index&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-733"><a href="#LCMSBase-733"><span class="linenos"> 733</span></a>            <span class="s2">&quot;_tailing_factor&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-734"><a href="#LCMSBase-734"><span class="linenos"> 734</span></a>            <span class="s2">&quot;monoisotopic_mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-735"><a href="#LCMSBase-735"><span class="linenos"> 735</span></a>            <span class="s2">&quot;isotopologue_type&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-736"><a href="#LCMSBase-736"><span class="linenos"> 736</span></a>            <span class="s2">&quot;mass_spectrum_deconvoluted_parent&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-737"><a href="#LCMSBase-737"><span class="linenos"> 737</span></a>        <span class="p">]</span>
</span><span id="LCMSBase-738"><a href="#LCMSBase-738"><span class="linenos"> 738</span></a>        <span class="n">df_mf_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-739"><a href="#LCMSBase-739"><span class="linenos"> 739</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase-740"><a href="#LCMSBase-740"><span class="linenos"> 740</span></a>            <span class="c1"># Find cols_in_df that are in single_mf</span>
</span><span id="LCMSBase-741"><a href="#LCMSBase-741"><span class="linenos"> 741</span></a>            <span class="n">df_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="LCMSBase-742"><a href="#LCMSBase-742"><span class="linenos"> 742</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">cols_in_df</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span>
</span><span id="LCMSBase-743"><a href="#LCMSBase-743"><span class="linenos"> 743</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-744"><a href="#LCMSBase-744"><span class="linenos"> 744</span></a>            <span class="n">dict_mf</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase-745"><a href="#LCMSBase-745"><span class="linenos"> 745</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">df_keys</span><span class="p">:</span>
</span><span id="LCMSBase-746"><a href="#LCMSBase-746"><span class="linenos"> 746</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
</span><span id="LCMSBase-747"><a href="#LCMSBase-747"><span class="linenos"> 747</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-748"><a href="#LCMSBase-748"><span class="linenos"> 748</span></a>                <span class="c1"># Add MS2 spectra info</span>
</span><span id="LCMSBase-749"><a href="#LCMSBase-749"><span class="linenos"> 749</span></a>                <span class="n">best_ms2_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">best_ms2</span>
</span><span id="LCMSBase-750"><a href="#LCMSBase-750"><span class="linenos"> 750</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;ms2_spectrum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_spectrum_to_string</span><span class="p">(</span><span class="n">best_ms2_spectrum</span><span class="p">)</span>
</span><span id="LCMSBase-751"><a href="#LCMSBase-751"><span class="linenos"> 751</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">associated_mass_features_deconvoluted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-752"><a href="#LCMSBase-752"><span class="linenos"> 752</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;associated_mass_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="LCMSBase-753"><a href="#LCMSBase-753"><span class="linenos"> 753</span></a>                    <span class="nb">map</span><span class="p">(</span>
</span><span id="LCMSBase-754"><a href="#LCMSBase-754"><span class="linenos"> 754</span></a>                        <span class="nb">str</span><span class="p">,</span>
</span><span id="LCMSBase-755"><a href="#LCMSBase-755"><span class="linenos"> 755</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">associated_mass_features_deconvoluted</span><span class="p">,</span>
</span><span id="LCMSBase-756"><a href="#LCMSBase-756"><span class="linenos"> 756</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase-757"><a href="#LCMSBase-757"><span class="linenos"> 757</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-758"><a href="#LCMSBase-758"><span class="linenos"> 758</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">_half_height_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-759"><a href="#LCMSBase-759"><span class="linenos"> 759</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;half_height_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span>
</span><span id="LCMSBase-760"><a href="#LCMSBase-760"><span class="linenos"> 760</span></a>                    <span class="n">mf_id</span>
</span><span id="LCMSBase-761"><a href="#LCMSBase-761"><span class="linenos"> 761</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">half_height_width</span>
</span><span id="LCMSBase-762"><a href="#LCMSBase-762"><span class="linenos"> 762</span></a>            <span class="c1"># Check if EIC for mass feature is set</span>
</span><span id="LCMSBase-763"><a href="#LCMSBase-763"><span class="linenos"> 763</span></a>            <span class="n">df_mf_single</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_mf</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">mf_id</span><span class="p">])</span>
</span><span id="LCMSBase-764"><a href="#LCMSBase-764"><span class="linenos"> 764</span></a>            <span class="n">df_mf_single</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mz</span>
</span><span id="LCMSBase-765"><a href="#LCMSBase-765"><span class="linenos"> 765</span></a>            <span class="n">df_mf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_mf_single</span><span class="p">)</span>
</span><span id="LCMSBase-766"><a href="#LCMSBase-766"><span class="linenos"> 766</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_mf_list</span><span class="p">)</span>
</span><span id="LCMSBase-767"><a href="#LCMSBase-767"><span class="linenos"> 767</span></a>
</span><span id="LCMSBase-768"><a href="#LCMSBase-768"><span class="linenos"> 768</span></a>        <span class="c1"># rename _area to area and id to mf_id</span>
</span><span id="LCMSBase-769"><a href="#LCMSBase-769"><span class="linenos"> 769</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="LCMSBase-770"><a href="#LCMSBase-770"><span class="linenos"> 770</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="LCMSBase-771"><a href="#LCMSBase-771"><span class="linenos"> 771</span></a>                <span class="s2">&quot;_area&quot;</span><span class="p">:</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-772"><a href="#LCMSBase-772"><span class="linenos"> 772</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-773"><a href="#LCMSBase-773"><span class="linenos"> 773</span></a>                <span class="s2">&quot;_apex_scan&quot;</span><span class="p">:</span> <span class="s2">&quot;apex_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-774"><a href="#LCMSBase-774"><span class="linenos"> 774</span></a>                <span class="s2">&quot;_retention_time&quot;</span><span class="p">:</span> <span class="s2">&quot;scan_time&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-775"><a href="#LCMSBase-775"><span class="linenos"> 775</span></a>                <span class="s2">&quot;_intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-776"><a href="#LCMSBase-776"><span class="linenos"> 776</span></a>                <span class="s2">&quot;_persistence&quot;</span><span class="p">:</span> <span class="s2">&quot;persistence&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-777"><a href="#LCMSBase-777"><span class="linenos"> 777</span></a>                <span class="s2">&quot;_dispersity_index&quot;</span><span class="p">:</span> <span class="s2">&quot;dispersity_index&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-778"><a href="#LCMSBase-778"><span class="linenos"> 778</span></a>                <span class="s2">&quot;_tailing_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;tailing_factor&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-779"><a href="#LCMSBase-779"><span class="linenos"> 779</span></a>            <span class="p">}</span>
</span><span id="LCMSBase-780"><a href="#LCMSBase-780"><span class="linenos"> 780</span></a>        <span class="p">)</span>
</span><span id="LCMSBase-781"><a href="#LCMSBase-781"><span class="linenos"> 781</span></a>
</span><span id="LCMSBase-782"><a href="#LCMSBase-782"><span class="linenos"> 782</span></a>        <span class="c1"># reorder columns</span>
</span><span id="LCMSBase-783"><a href="#LCMSBase-783"><span class="linenos"> 783</span></a>        <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase-784"><a href="#LCMSBase-784"><span class="linenos"> 784</span></a>            <span class="s2">&quot;mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-785"><a href="#LCMSBase-785"><span class="linenos"> 785</span></a>            <span class="s2">&quot;scan_time&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-786"><a href="#LCMSBase-786"><span class="linenos"> 786</span></a>            <span class="s2">&quot;mz&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-787"><a href="#LCMSBase-787"><span class="linenos"> 787</span></a>            <span class="s2">&quot;apex_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-788"><a href="#LCMSBase-788"><span class="linenos"> 788</span></a>            <span class="s2">&quot;start_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-789"><a href="#LCMSBase-789"><span class="linenos"> 789</span></a>            <span class="s2">&quot;final_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-790"><a href="#LCMSBase-790"><span class="linenos"> 790</span></a>            <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-791"><a href="#LCMSBase-791"><span class="linenos"> 791</span></a>            <span class="s2">&quot;persistence&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-792"><a href="#LCMSBase-792"><span class="linenos"> 792</span></a>            <span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-793"><a href="#LCMSBase-793"><span class="linenos"> 793</span></a>            <span class="s2">&quot;half_height_width&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-794"><a href="#LCMSBase-794"><span class="linenos"> 794</span></a>            <span class="s2">&quot;tailing_factor&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-795"><a href="#LCMSBase-795"><span class="linenos"> 795</span></a>            <span class="s2">&quot;dispersity_index&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-796"><a href="#LCMSBase-796"><span class="linenos"> 796</span></a>            <span class="s2">&quot;monoisotopic_mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-797"><a href="#LCMSBase-797"><span class="linenos"> 797</span></a>            <span class="s2">&quot;isotopologue_type&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-798"><a href="#LCMSBase-798"><span class="linenos"> 798</span></a>            <span class="s2">&quot;mass_spectrum_deconvoluted_parent&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-799"><a href="#LCMSBase-799"><span class="linenos"> 799</span></a>            <span class="s2">&quot;associated_mass_features&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-800"><a href="#LCMSBase-800"><span class="linenos"> 800</span></a>            <span class="s2">&quot;ms2_spectrum&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-801"><a href="#LCMSBase-801"><span class="linenos"> 801</span></a>        <span class="p">]</span>
</span><span id="LCMSBase-802"><a href="#LCMSBase-802"><span class="linenos"> 802</span></a>        <span class="c1"># drop columns that are not in col_order</span>
</span><span id="LCMSBase-803"><a href="#LCMSBase-803"><span class="linenos"> 803</span></a>        <span class="n">cols_to_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_order</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="LCMSBase-804"><a href="#LCMSBase-804"><span class="linenos"> 804</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="p">[</span><span class="n">cols_to_order</span><span class="p">]</span>
</span><span id="LCMSBase-805"><a href="#LCMSBase-805"><span class="linenos"> 805</span></a>
</span><span id="LCMSBase-806"><a href="#LCMSBase-806"><span class="linenos"> 806</span></a>        <span class="c1"># reset index to mf_id</span>
</span><span id="LCMSBase-807"><a href="#LCMSBase-807"><span class="linenos"> 807</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-808"><a href="#LCMSBase-808"><span class="linenos"> 808</span></a>        <span class="n">df_mf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="LCMSBase-809"><a href="#LCMSBase-809"><span class="linenos"> 809</span></a>
</span><span id="LCMSBase-810"><a href="#LCMSBase-810"><span class="linenos"> 810</span></a>        <span class="k">return</span> <span class="n">df_mf</span>
</span><span id="LCMSBase-811"><a href="#LCMSBase-811"><span class="linenos"> 811</span></a>
</span><span id="LCMSBase-812"><a href="#LCMSBase-812"><span class="linenos"> 812</span></a>    <span class="k">def</span> <span class="nf">mass_features_ms1_annot_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-813"><a href="#LCMSBase-813"><span class="linenos"> 813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the MS1 annotations for the mass features in the dataset.</span>
</span><span id="LCMSBase-814"><a href="#LCMSBase-814"><span class="linenos"> 814</span></a>
</span><span id="LCMSBase-815"><a href="#LCMSBase-815"><span class="linenos"> 815</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-816"><a href="#LCMSBase-816"><span class="linenos"> 816</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-817"><a href="#LCMSBase-817"><span class="linenos"> 817</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="LCMSBase-818"><a href="#LCMSBase-818"><span class="linenos"> 818</span></a><span class="sd">            A pandas dataframe of MS1 annotations for the mass features in the dataset.</span>
</span><span id="LCMSBase-819"><a href="#LCMSBase-819"><span class="linenos"> 819</span></a><span class="sd">            The index is set to mf_id (mass feature ID)</span>
</span><span id="LCMSBase-820"><a href="#LCMSBase-820"><span class="linenos"> 820</span></a>
</span><span id="LCMSBase-821"><a href="#LCMSBase-821"><span class="linenos"> 821</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-822"><a href="#LCMSBase-822"><span class="linenos"> 822</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-823"><a href="#LCMSBase-823"><span class="linenos"> 823</span></a><span class="sd">        Warning</span>
</span><span id="LCMSBase-824"><a href="#LCMSBase-824"><span class="linenos"> 824</span></a><span class="sd">            If no MS1 annotations were found for the mass features in the dataset.</span>
</span><span id="LCMSBase-825"><a href="#LCMSBase-825"><span class="linenos"> 825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-826"><a href="#LCMSBase-826"><span class="linenos"> 826</span></a>        <span class="n">annot_df_list_ms1</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-827"><a href="#LCMSBase-827"><span class="linenos"> 827</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase-828"><a href="#LCMSBase-828"><span class="linenos"> 828</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-829"><a href="#LCMSBase-829"><span class="linenos"> 829</span></a>                <span class="k">pass</span>
</span><span id="LCMSBase-830"><a href="#LCMSBase-830"><span class="linenos"> 830</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase-831"><a href="#LCMSBase-831"><span class="linenos"> 831</span></a>                <span class="c1"># Add ms1 annotations to ms1 annotation list</span>
</span><span id="LCMSBase-832"><a href="#LCMSBase-832"><span class="linenos"> 832</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="LCMSBase-833"><a href="#LCMSBase-833"><span class="linenos"> 833</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="LCMSBase-834"><a href="#LCMSBase-834"><span class="linenos"> 834</span></a>                        <span class="p">(</span>
</span><span id="LCMSBase-835"><a href="#LCMSBase-835"><span class="linenos"> 835</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms1_peak</span><span class="o">.</span><span class="n">mz_exp</span>
</span><span id="LCMSBase-836"><a href="#LCMSBase-836"><span class="linenos"> 836</span></a>                            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mz</span>
</span><span id="LCMSBase-837"><a href="#LCMSBase-837"><span class="linenos"> 837</span></a>                        <span class="p">)</span>
</span><span id="LCMSBase-838"><a href="#LCMSBase-838"><span class="linenos"> 838</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase-839"><a href="#LCMSBase-839"><span class="linenos"> 839</span></a>                    <span class="o">&lt;</span> <span class="mf">0.01</span>
</span><span id="LCMSBase-840"><a href="#LCMSBase-840"><span class="linenos"> 840</span></a>                <span class="p">):</span>
</span><span id="LCMSBase-841"><a href="#LCMSBase-841"><span class="linenos"> 841</span></a>                    <span class="c1"># Get the molecular formula from the mass spectrum</span>
</span><span id="LCMSBase-842"><a href="#LCMSBase-842"><span class="linenos"> 842</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="LCMSBase-843"><a href="#LCMSBase-843"><span class="linenos"> 843</span></a>                    <span class="c1"># Subset to pull out only the peak associated with the mass feature</span>
</span><span id="LCMSBase-844"><a href="#LCMSBase-844"><span class="linenos"> 844</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="n">annot_df</span><span class="p">[</span>
</span><span id="LCMSBase-845"><a href="#LCMSBase-845"><span class="linenos"> 845</span></a>                        <span class="n">annot_df</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms1_peak</span><span class="o">.</span><span class="n">index</span>
</span><span id="LCMSBase-846"><a href="#LCMSBase-846"><span class="linenos"> 846</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase-847"><a href="#LCMSBase-847"><span class="linenos"> 847</span></a>
</span><span id="LCMSBase-848"><a href="#LCMSBase-848"><span class="linenos"> 848</span></a>                    <span class="c1"># Remove the index column and add column for mf_id</span>
</span><span id="LCMSBase-849"><a href="#LCMSBase-849"><span class="linenos"> 849</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="n">annot_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
</span><span id="LCMSBase-850"><a href="#LCMSBase-850"><span class="linenos"> 850</span></a>                    <span class="n">annot_df</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf_id</span>
</span><span id="LCMSBase-851"><a href="#LCMSBase-851"><span class="linenos"> 851</span></a>                    <span class="n">annot_df_list_ms1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot_df</span><span class="p">)</span>
</span><span id="LCMSBase-852"><a href="#LCMSBase-852"><span class="linenos"> 852</span></a>
</span><span id="LCMSBase-853"><a href="#LCMSBase-853"><span class="linenos"> 853</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_df_list_ms1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-854"><a href="#LCMSBase-854"><span class="linenos"> 854</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">annot_df_list_ms1</span><span class="p">)</span>
</span><span id="LCMSBase-855"><a href="#LCMSBase-855"><span class="linenos"> 855</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="n">annot_ms1_df_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-856"><a href="#LCMSBase-856"><span class="linenos"> 856</span></a>            <span class="n">annot_ms1_df_full</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="LCMSBase-857"><a href="#LCMSBase-857"><span class="linenos"> 857</span></a>
</span><span id="LCMSBase-858"><a href="#LCMSBase-858"><span class="linenos"> 858</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase-859"><a href="#LCMSBase-859"><span class="linenos"> 859</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase-860"><a href="#LCMSBase-860"><span class="linenos"> 860</span></a>            <span class="c1"># Warn that no ms1 annotations were found</span>
</span><span id="LCMSBase-861"><a href="#LCMSBase-861"><span class="linenos"> 861</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="LCMSBase-862"><a href="#LCMSBase-862"><span class="linenos"> 862</span></a>                <span class="s2">&quot;No MS1 annotations found for mass features in dataset, were MS1 spectra added and processed within the dataset?&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-863"><a href="#LCMSBase-863"><span class="linenos"> 863</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="LCMSBase-864"><a href="#LCMSBase-864"><span class="linenos"> 864</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-865"><a href="#LCMSBase-865"><span class="linenos"> 865</span></a>
</span><span id="LCMSBase-866"><a href="#LCMSBase-866"><span class="linenos"> 866</span></a>        <span class="k">return</span> <span class="n">annot_ms1_df_full</span>
</span><span id="LCMSBase-867"><a href="#LCMSBase-867"><span class="linenos"> 867</span></a>
</span><span id="LCMSBase-868"><a href="#LCMSBase-868"><span class="linenos"> 868</span></a>    <span class="k">def</span> <span class="nf">mass_features_ms2_annot_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecular_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="LCMSBase-869"><a href="#LCMSBase-869"><span class="linenos"> 869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the MS2 annotations for the mass features in the dataset.</span>
</span><span id="LCMSBase-870"><a href="#LCMSBase-870"><span class="linenos"> 870</span></a>
</span><span id="LCMSBase-871"><a href="#LCMSBase-871"><span class="linenos"> 871</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-872"><a href="#LCMSBase-872"><span class="linenos"> 872</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-873"><a href="#LCMSBase-873"><span class="linenos"> 873</span></a><span class="sd">        molecular_metadata :  dict of MolecularMetadata objects</span>
</span><span id="LCMSBase-874"><a href="#LCMSBase-874"><span class="linenos"> 874</span></a><span class="sd">            A dictionary of MolecularMetadata objects, keyed by metabref_mol_id.  Defaults to None.</span>
</span><span id="LCMSBase-875"><a href="#LCMSBase-875"><span class="linenos"> 875</span></a>
</span><span id="LCMSBase-876"><a href="#LCMSBase-876"><span class="linenos"> 876</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-877"><a href="#LCMSBase-877"><span class="linenos"> 877</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-878"><a href="#LCMSBase-878"><span class="linenos"> 878</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="LCMSBase-879"><a href="#LCMSBase-879"><span class="linenos"> 879</span></a><span class="sd">            A pandas dataframe of MS2 annotations for the mass features in the dataset,</span>
</span><span id="LCMSBase-880"><a href="#LCMSBase-880"><span class="linenos"> 880</span></a><span class="sd">            and optionally molecular metadata. The index is set to mf_id (mass feature ID)</span>
</span><span id="LCMSBase-881"><a href="#LCMSBase-881"><span class="linenos"> 881</span></a>
</span><span id="LCMSBase-882"><a href="#LCMSBase-882"><span class="linenos"> 882</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-883"><a href="#LCMSBase-883"><span class="linenos"> 883</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-884"><a href="#LCMSBase-884"><span class="linenos"> 884</span></a><span class="sd">        Warning</span>
</span><span id="LCMSBase-885"><a href="#LCMSBase-885"><span class="linenos"> 885</span></a><span class="sd">            If no MS2 annotations were found for the mass features in the dataset.</span>
</span><span id="LCMSBase-886"><a href="#LCMSBase-886"><span class="linenos"> 886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-887"><a href="#LCMSBase-887"><span class="linenos"> 887</span></a>        <span class="n">annot_df_list_ms2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-888"><a href="#LCMSBase-888"><span class="linenos"> 888</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase-889"><a href="#LCMSBase-889"><span class="linenos"> 889</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_similarity_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-890"><a href="#LCMSBase-890"><span class="linenos"> 890</span></a>                <span class="c1"># Add ms2 annotations to ms2 annotation list</span>
</span><span id="LCMSBase-891"><a href="#LCMSBase-891"><span class="linenos"> 891</span></a>                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_similarity_results</span><span class="p">:</span>
</span><span id="LCMSBase-892"><a href="#LCMSBase-892"><span class="linenos"> 892</span></a>                    <span class="n">annot_df_ms2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="LCMSBase-893"><a href="#LCMSBase-893"><span class="linenos"> 893</span></a>                    <span class="n">annot_df_ms2</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf_id</span>
</span><span id="LCMSBase-894"><a href="#LCMSBase-894"><span class="linenos"> 894</span></a>                    <span class="n">annot_df_list_ms2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot_df_ms2</span><span class="p">)</span>
</span><span id="LCMSBase-895"><a href="#LCMSBase-895"><span class="linenos"> 895</span></a>
</span><span id="LCMSBase-896"><a href="#LCMSBase-896"><span class="linenos"> 896</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_df_list_ms2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-897"><a href="#LCMSBase-897"><span class="linenos"> 897</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">annot_df_list_ms2</span><span class="p">)</span>
</span><span id="LCMSBase-898"><a href="#LCMSBase-898"><span class="linenos"> 898</span></a>            <span class="k">if</span> <span class="n">molecular_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-899"><a href="#LCMSBase-899"><span class="linenos"> 899</span></a>                <span class="n">molecular_metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="LCMSBase-900"><a href="#LCMSBase-900"><span class="linenos"> 900</span></a>                    <span class="p">[</span>
</span><span id="LCMSBase-901"><a href="#LCMSBase-901"><span class="linenos"> 901</span></a>                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span id="LCMSBase-902"><a href="#LCMSBase-902"><span class="linenos"> 902</span></a>                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">molecular_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="LCMSBase-903"><a href="#LCMSBase-903"><span class="linenos"> 903</span></a>                    <span class="p">],</span>
</span><span id="LCMSBase-904"><a href="#LCMSBase-904"><span class="linenos"> 904</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LCMSBase-905"><a href="#LCMSBase-905"><span class="linenos"> 905</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-906"><a href="#LCMSBase-906"><span class="linenos"> 906</span></a>                <span class="n">molecular_metadata_df</span> <span class="o">=</span> <span class="n">molecular_metadata_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="LCMSBase-907"><a href="#LCMSBase-907"><span class="linenos"> 907</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ref_mol_id&quot;</span><span class="p">}</span>
</span><span id="LCMSBase-908"><a href="#LCMSBase-908"><span class="linenos"> 908</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-909"><a href="#LCMSBase-909"><span class="linenos"> 909</span></a>                <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="LCMSBase-910"><a href="#LCMSBase-910"><span class="linenos"> 910</span></a>                    <span class="n">molecular_metadata_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ref_mol_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
</span><span id="LCMSBase-911"><a href="#LCMSBase-911"><span class="linenos"> 911</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-912"><a href="#LCMSBase-912"><span class="linenos"> 912</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
</span><span id="LCMSBase-913"><a href="#LCMSBase-913"><span class="linenos"> 913</span></a>                <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">,</span> <span class="s2">&quot;query_spectrum_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_ms_id&quot;</span><span class="p">]</span>
</span><span id="LCMSBase-914"><a href="#LCMSBase-914"><span class="linenos"> 914</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase-915"><a href="#LCMSBase-915"><span class="linenos"> 915</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-916"><a href="#LCMSBase-916"><span class="linenos"> 916</span></a>            <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="LCMSBase-917"><a href="#LCMSBase-917"><span class="linenos"> 917</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase-918"><a href="#LCMSBase-918"><span class="linenos"> 918</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase-919"><a href="#LCMSBase-919"><span class="linenos"> 919</span></a>            <span class="c1"># Warn that no ms2 annotations were found</span>
</span><span id="LCMSBase-920"><a href="#LCMSBase-920"><span class="linenos"> 920</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="LCMSBase-921"><a href="#LCMSBase-921"><span class="linenos"> 921</span></a>                <span class="s2">&quot;No MS2 annotations found for mass features in dataset, were MS2 spectra added and searched against a database?&quot;</span><span class="p">,</span>
</span><span id="LCMSBase-922"><a href="#LCMSBase-922"><span class="linenos"> 922</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="LCMSBase-923"><a href="#LCMSBase-923"><span class="linenos"> 923</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-924"><a href="#LCMSBase-924"><span class="linenos"> 924</span></a>
</span><span id="LCMSBase-925"><a href="#LCMSBase-925"><span class="linenos"> 925</span></a>        <span class="k">return</span> <span class="n">annot_ms2_df_full</span>
</span><span id="LCMSBase-926"><a href="#LCMSBase-926"><span class="linenos"> 926</span></a>
</span><span id="LCMSBase-927"><a href="#LCMSBase-927"><span class="linenos"> 927</span></a>    <span class="k">def</span> <span class="nf">plot_composite_mz_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binsize</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">ph_int_min_thresh</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">mf_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ms2_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase-928"><a href="#LCMSBase-928"><span class="linenos"> 928</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a figure displaying </span>
</span><span id="LCMSBase-929"><a href="#LCMSBase-929"><span class="linenos"> 929</span></a><span class="sd">            (1) thresholded, unprocessed data</span>
</span><span id="LCMSBase-930"><a href="#LCMSBase-930"><span class="linenos"> 930</span></a><span class="sd">            (2) the m/z features</span>
</span><span id="LCMSBase-931"><a href="#LCMSBase-931"><span class="linenos"> 931</span></a><span class="sd">            (3) which m/z features are associated with MS2 spectra</span>
</span><span id="LCMSBase-932"><a href="#LCMSBase-932"><span class="linenos"> 932</span></a>
</span><span id="LCMSBase-933"><a href="#LCMSBase-933"><span class="linenos"> 933</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-934"><a href="#LCMSBase-934"><span class="linenos"> 934</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-935"><a href="#LCMSBase-935"><span class="linenos"> 935</span></a><span class="sd">        binsize :  float</span>
</span><span id="LCMSBase-936"><a href="#LCMSBase-936"><span class="linenos"> 936</span></a><span class="sd">            Desired binsize for the m/z axis of the composite feature map.  Defaults to 1e-4.</span>
</span><span id="LCMSBase-937"><a href="#LCMSBase-937"><span class="linenos"> 937</span></a><span class="sd">        mf_plot : boolean</span>
</span><span id="LCMSBase-938"><a href="#LCMSBase-938"><span class="linenos"> 938</span></a><span class="sd">            Indicates whether to plot the m/z features. Defaults to True.</span>
</span><span id="LCMSBase-939"><a href="#LCMSBase-939"><span class="linenos"> 939</span></a><span class="sd">        ms2_plot : boolean</span>
</span><span id="LCMSBase-940"><a href="#LCMSBase-940"><span class="linenos"> 940</span></a><span class="sd">            Indicates whether to identify m/z features with associated MS2 spectra. Defaults to True.</span>
</span><span id="LCMSBase-941"><a href="#LCMSBase-941"><span class="linenos"> 941</span></a><span class="sd">        return_fig : boolean</span>
</span><span id="LCMSBase-942"><a href="#LCMSBase-942"><span class="linenos"> 942</span></a><span class="sd">            Indicates whether to plot composite feature map (False) or return figure object (True). Defaults to False.</span>
</span><span id="LCMSBase-943"><a href="#LCMSBase-943"><span class="linenos"> 943</span></a>
</span><span id="LCMSBase-944"><a href="#LCMSBase-944"><span class="linenos"> 944</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-945"><a href="#LCMSBase-945"><span class="linenos"> 945</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-946"><a href="#LCMSBase-946"><span class="linenos"> 946</span></a><span class="sd">        matplotlib.pyplot.Figure</span>
</span><span id="LCMSBase-947"><a href="#LCMSBase-947"><span class="linenos"> 947</span></a><span class="sd">            A figure with the thresholded, unprocessed data on an axis of m/z value with respect to </span>
</span><span id="LCMSBase-948"><a href="#LCMSBase-948"><span class="linenos"> 948</span></a><span class="sd">            scan time. Unprocessed data is displayed in gray scale with darker colors indicating </span>
</span><span id="LCMSBase-949"><a href="#LCMSBase-949"><span class="linenos"> 949</span></a><span class="sd">            higher intensities. If m/z features are plotted, they are displayed in cyan. If m/z</span>
</span><span id="LCMSBase-950"><a href="#LCMSBase-950"><span class="linenos"> 950</span></a><span class="sd">            features with associated with MS2 spectra are plotted, they are displayed in red.</span>
</span><span id="LCMSBase-951"><a href="#LCMSBase-951"><span class="linenos"> 951</span></a>
</span><span id="LCMSBase-952"><a href="#LCMSBase-952"><span class="linenos"> 952</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-953"><a href="#LCMSBase-953"><span class="linenos"> 953</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-954"><a href="#LCMSBase-954"><span class="linenos"> 954</span></a><span class="sd">        Warning</span>
</span><span id="LCMSBase-955"><a href="#LCMSBase-955"><span class="linenos"> 955</span></a><span class="sd">            If m/z features are set to be plot but aren&#39;t in the dataset.</span>
</span><span id="LCMSBase-956"><a href="#LCMSBase-956"><span class="linenos"> 956</span></a><span class="sd">            If m/z features with associated MS2 data are set to be plot but no MS2 annotations </span>
</span><span id="LCMSBase-957"><a href="#LCMSBase-957"><span class="linenos"> 957</span></a><span class="sd">            were found for the m/z features in the dataset.</span>
</span><span id="LCMSBase-958"><a href="#LCMSBase-958"><span class="linenos"> 958</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-959"><a href="#LCMSBase-959"><span class="linenos"> 959</span></a>        <span class="k">if</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="LCMSBase-960"><a href="#LCMSBase-960"><span class="linenos"> 960</span></a>            <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase-961"><a href="#LCMSBase-961"><span class="linenos"> 961</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-962"><a href="#LCMSBase-962"><span class="linenos"> 962</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-963"><a href="#LCMSBase-963"><span class="linenos"> 963</span></a>                    <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase-964"><a href="#LCMSBase-964"><span class="linenos"> 964</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-965"><a href="#LCMSBase-965"><span class="linenos"> 965</span></a>            <span class="c1">## call mass feature data</span>
</span><span id="LCMSBase-966"><a href="#LCMSBase-966"><span class="linenos"> 966</span></a>            <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span>
</span><span id="LCMSBase-967"><a href="#LCMSBase-967"><span class="linenos"> 967</span></a>
</span><span id="LCMSBase-968"><a href="#LCMSBase-968"><span class="linenos"> 968</span></a>        <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span>
</span><span id="LCMSBase-969"><a href="#LCMSBase-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="LCMSBase-970"><a href="#LCMSBase-970"><span class="linenos"> 970</span></a>                <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase-971"><a href="#LCMSBase-971"><span class="linenos"> 971</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase-972"><a href="#LCMSBase-972"><span class="linenos"> 972</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-973"><a href="#LCMSBase-973"><span class="linenos"> 973</span></a>                        <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase-974"><a href="#LCMSBase-974"><span class="linenos"> 974</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase-975"><a href="#LCMSBase-975"><span class="linenos"> 975</span></a>
</span><span id="LCMSBase-976"><a href="#LCMSBase-976"><span class="linenos"> 976</span></a>            <span class="c1">## call m/z feature data</span>
</span><span id="LCMSBase-977"><a href="#LCMSBase-977"><span class="linenos"> 977</span></a>            <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span>
</span><span id="LCMSBase-978"><a href="#LCMSBase-978"><span class="linenos"> 978</span></a>
</span><span id="LCMSBase-979"><a href="#LCMSBase-979"><span class="linenos"> 979</span></a>            <span class="c1"># Check if ms2_spectrum is set, raise error if not</span>
</span><span id="LCMSBase-980"><a href="#LCMSBase-980"><span class="linenos"> 980</span></a>            <span class="k">if</span> <span class="s1">&#39;ms2_spectrum&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="LCMSBase-981"><a href="#LCMSBase-981"><span class="linenos"> 981</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>                
</span><span id="LCMSBase-982"><a href="#LCMSBase-982"><span class="linenos"> 982</span></a>                    <span class="s2">&quot;ms2_spectrum not set, must run add_associated_ms2_dda() first&quot;</span>            
</span><span id="LCMSBase-983"><a href="#LCMSBase-983"><span class="linenos"> 983</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-984"><a href="#LCMSBase-984"><span class="linenos"> 984</span></a>    
</span><span id="LCMSBase-985"><a href="#LCMSBase-985"><span class="linenos"> 985</span></a>        <span class="c1">## threshold and grid unprocessed data</span>
</span><span id="LCMSBase-986"><a href="#LCMSBase-986"><span class="linenos"> 986</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase-987"><a href="#LCMSBase-987"><span class="linenos"> 987</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="LCMSBase-988"><a href="#LCMSBase-988"><span class="linenos"> 988</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">ph_int_min_thresh</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="LCMSBase-989"><a href="#LCMSBase-989"><span class="linenos"> 989</span></a>        <span class="n">df_thres</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase-990"><a href="#LCMSBase-990"><span class="linenos"> 990</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="p">(</span><span class="n">df_thres</span><span class="p">)</span>
</span><span id="LCMSBase-991"><a href="#LCMSBase-991"><span class="linenos"> 991</span></a>    
</span><span id="LCMSBase-992"><a href="#LCMSBase-992"><span class="linenos"> 992</span></a>        <span class="c1">## format unprocessed data for plotting</span>
</span><span id="LCMSBase-993"><a href="#LCMSBase-993"><span class="linenos"> 993</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">]],</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;scan&#39;</span><span class="p">)</span>
</span><span id="LCMSBase-994"><a href="#LCMSBase-994"><span class="linenos"> 994</span></a>        <span class="n">mz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">),</span> <span class="n">binsize</span><span class="p">)</span>
</span><span id="LCMSBase-995"><a href="#LCMSBase-995"><span class="linenos"> 995</span></a>        <span class="n">mz_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">)</span>
</span><span id="LCMSBase-996"><a href="#LCMSBase-996"><span class="linenos"> 996</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mz_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_closest</span><span class="p">(</span><span class="n">mz_grid</span><span class="p">,</span> <span class="n">mz_data</span><span class="p">)</span>
</span><span id="LCMSBase-997"><a href="#LCMSBase-997"><span class="linenos"> 997</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ab_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;mz_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
</span><span id="LCMSBase-998"><a href="#LCMSBase-998"><span class="linenos"> 998</span></a>        <span class="n">unproc_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;scan_time&#39;</span><span class="p">,</span> <span class="s1">&#39;mz_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;ab_bin&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="LCMSBase-999"><a href="#LCMSBase-999"><span class="linenos"> 999</span></a>
</span><span id="LCMSBase-1000"><a href="#LCMSBase-1000"><span class="linenos">1000</span></a>        <span class="c1">## generate figure</span>
</span><span id="LCMSBase-1001"><a href="#LCMSBase-1001"><span class="linenos">1001</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="LCMSBase-1002"><a href="#LCMSBase-1002"><span class="linenos">1002</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase-1003"><a href="#LCMSBase-1003"><span class="linenos">1003</span></a>            <span class="n">unproc_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase-1004"><a href="#LCMSBase-1004"><span class="linenos">1004</span></a>            <span class="n">unproc_df</span><span class="o">.</span><span class="n">mz_bin</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span>
</span><span id="LCMSBase-1005"><a href="#LCMSBase-1005"><span class="linenos">1005</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="p">),</span>
</span><span id="LCMSBase-1006"><a href="#LCMSBase-1006"><span class="linenos">1006</span></a>            <span class="n">alpha</span> <span class="o">=</span> <span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="p">),</span> 
</span><span id="LCMSBase-1007"><a href="#LCMSBase-1007"><span class="linenos">1007</span></a>            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span>
</span><span id="LCMSBase-1008"><a href="#LCMSBase-1008"><span class="linenos">1008</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="LCMSBase-1009"><a href="#LCMSBase-1009"><span class="linenos">1009</span></a>        <span class="p">)</span>
</span><span id="LCMSBase-1010"><a href="#LCMSBase-1010"><span class="linenos">1010</span></a>
</span><span id="LCMSBase-1011"><a href="#LCMSBase-1011"><span class="linenos">1011</span></a>        <span class="k">if</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="LCMSBase-1012"><a href="#LCMSBase-1012"><span class="linenos">1012</span></a>            <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span>
</span><span id="LCMSBase-1013"><a href="#LCMSBase-1013"><span class="linenos">1013</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase-1014"><a href="#LCMSBase-1014"><span class="linenos">1014</span></a>                    <span class="n">mf_df</span><span class="p">[</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase-1015"><a href="#LCMSBase-1015"><span class="linenos">1015</span></a>                    <span class="n">mf_df</span><span class="p">[</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="LCMSBase-1016"><a href="#LCMSBase-1016"><span class="linenos">1016</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
</span><span id="LCMSBase-1017"><a href="#LCMSBase-1017"><span class="linenos">1017</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="LCMSBase-1018"><a href="#LCMSBase-1018"><span class="linenos">1018</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features without MS2&#39;</span>
</span><span id="LCMSBase-1019"><a href="#LCMSBase-1019"><span class="linenos">1019</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-1020"><a href="#LCMSBase-1020"><span class="linenos">1020</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase-1021"><a href="#LCMSBase-1021"><span class="linenos">1021</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase-1022"><a href="#LCMSBase-1022"><span class="linenos">1022</span></a>                    <span class="n">mf_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase-1023"><a href="#LCMSBase-1023"><span class="linenos">1023</span></a>                    <span class="n">mf_df</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="LCMSBase-1024"><a href="#LCMSBase-1024"><span class="linenos">1024</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
</span><span id="LCMSBase-1025"><a href="#LCMSBase-1025"><span class="linenos">1025</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="LCMSBase-1026"><a href="#LCMSBase-1026"><span class="linenos">1026</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features&#39;</span>
</span><span id="LCMSBase-1027"><a href="#LCMSBase-1027"><span class="linenos">1027</span></a>                <span class="p">)</span>
</span><span id="LCMSBase-1028"><a href="#LCMSBase-1028"><span class="linenos">1028</span></a>
</span><span id="LCMSBase-1029"><a href="#LCMSBase-1029"><span class="linenos">1029</span></a>        <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span> 
</span><span id="LCMSBase-1030"><a href="#LCMSBase-1030"><span class="linenos">1030</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase-1031"><a href="#LCMSBase-1031"><span class="linenos">1031</span></a>                <span class="n">mf_df</span><span class="p">[</span><span class="o">~</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase-1032"><a href="#LCMSBase-1032"><span class="linenos">1032</span></a>                <span class="n">mf_df</span><span class="p">[</span><span class="o">~</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="LCMSBase-1033"><a href="#LCMSBase-1033"><span class="linenos">1033</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
</span><span id="LCMSBase-1034"><a href="#LCMSBase-1034"><span class="linenos">1034</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="LCMSBase-1035"><a href="#LCMSBase-1035"><span class="linenos">1035</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features with MS2&#39;</span>
</span><span id="LCMSBase-1036"><a href="#LCMSBase-1036"><span class="linenos">1036</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-1037"><a href="#LCMSBase-1037"><span class="linenos">1037</span></a>
</span><span id="LCMSBase-1038"><a href="#LCMSBase-1038"><span class="linenos">1038</span></a>        <span class="k">if</span> <span class="n">mf_plot</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">ms2_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="LCMSBase-1039"><a href="#LCMSBase-1039"><span class="linenos">1039</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">),</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="LCMSBase-1040"><a href="#LCMSBase-1040"><span class="linenos">1040</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Scan time&#39;</span><span class="p">)</span>
</span><span id="LCMSBase-1041"><a href="#LCMSBase-1041"><span class="linenos">1041</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;m/z&#39;</span><span class="p">)</span>
</span><span id="LCMSBase-1042"><a href="#LCMSBase-1042"><span class="linenos">1042</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">)))</span>
</span><span id="LCMSBase-1043"><a href="#LCMSBase-1043"><span class="linenos">1043</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">)))</span>
</span><span id="LCMSBase-1044"><a href="#LCMSBase-1044"><span class="linenos">1044</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Composite Feature Map&#39;</span><span class="p">)</span>
</span><span id="LCMSBase-1045"><a href="#LCMSBase-1045"><span class="linenos">1045</span></a>
</span><span id="LCMSBase-1046"><a href="#LCMSBase-1046"><span class="linenos">1046</span></a>        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
</span><span id="LCMSBase-1047"><a href="#LCMSBase-1047"><span class="linenos">1047</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="LCMSBase-1048"><a href="#LCMSBase-1048"><span class="linenos">1048</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="LCMSBase-1049"><a href="#LCMSBase-1049"><span class="linenos">1049</span></a>
</span><span id="LCMSBase-1050"><a href="#LCMSBase-1050"><span class="linenos">1050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase-1051"><a href="#LCMSBase-1051"><span class="linenos">1051</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="LCMSBase-1052"><a href="#LCMSBase-1052"><span class="linenos">1052</span></a>
</span><span id="LCMSBase-1053"><a href="#LCMSBase-1053"><span class="linenos">1053</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1054"><a href="#LCMSBase-1054"><span class="linenos">1054</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1055"><a href="#LCMSBase-1055"><span class="linenos">1055</span></a><span class="sd">        Returns the number of mass spectra in the dataset.</span>
</span><span id="LCMSBase-1056"><a href="#LCMSBase-1056"><span class="linenos">1056</span></a>
</span><span id="LCMSBase-1057"><a href="#LCMSBase-1057"><span class="linenos">1057</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-1058"><a href="#LCMSBase-1058"><span class="linenos">1058</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-1059"><a href="#LCMSBase-1059"><span class="linenos">1059</span></a><span class="sd">        int</span>
</span><span id="LCMSBase-1060"><a href="#LCMSBase-1060"><span class="linenos">1060</span></a><span class="sd">            The number of mass spectra in the dataset.</span>
</span><span id="LCMSBase-1061"><a href="#LCMSBase-1061"><span class="linenos">1061</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1062"><a href="#LCMSBase-1062"><span class="linenos">1062</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span>
</span><span id="LCMSBase-1063"><a href="#LCMSBase-1063"><span class="linenos">1063</span></a>
</span><span id="LCMSBase-1064"><a href="#LCMSBase-1064"><span class="linenos">1064</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">):</span>
</span><span id="LCMSBase-1065"><a href="#LCMSBase-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1066"><a href="#LCMSBase-1066"><span class="linenos">1066</span></a><span class="sd">        Returns the mass spectrum corresponding to the specified scan number.</span>
</span><span id="LCMSBase-1067"><a href="#LCMSBase-1067"><span class="linenos">1067</span></a>
</span><span id="LCMSBase-1068"><a href="#LCMSBase-1068"><span class="linenos">1068</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1069"><a href="#LCMSBase-1069"><span class="linenos">1069</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1070"><a href="#LCMSBase-1070"><span class="linenos">1070</span></a><span class="sd">        scan_number : int</span>
</span><span id="LCMSBase-1071"><a href="#LCMSBase-1071"><span class="linenos">1071</span></a><span class="sd">            The scan number of the desired mass spectrum.</span>
</span><span id="LCMSBase-1072"><a href="#LCMSBase-1072"><span class="linenos">1072</span></a>
</span><span id="LCMSBase-1073"><a href="#LCMSBase-1073"><span class="linenos">1073</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-1074"><a href="#LCMSBase-1074"><span class="linenos">1074</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-1075"><a href="#LCMSBase-1075"><span class="linenos">1075</span></a><span class="sd">        MassSpectrum</span>
</span><span id="LCMSBase-1076"><a href="#LCMSBase-1076"><span class="linenos">1076</span></a><span class="sd">            The mass spectrum corresponding to the specified scan number.</span>
</span><span id="LCMSBase-1077"><a href="#LCMSBase-1077"><span class="linenos">1077</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1078"><a href="#LCMSBase-1078"><span class="linenos">1078</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scan_number</span><span class="p">)</span>
</span><span id="LCMSBase-1079"><a href="#LCMSBase-1079"><span class="linenos">1079</span></a>
</span><span id="LCMSBase-1080"><a href="#LCMSBase-1080"><span class="linenos">1080</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1081"><a href="#LCMSBase-1081"><span class="linenos">1081</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an iterator over the mass spectra in the dataset.</span>
</span><span id="LCMSBase-1082"><a href="#LCMSBase-1082"><span class="linenos">1082</span></a>
</span><span id="LCMSBase-1083"><a href="#LCMSBase-1083"><span class="linenos">1083</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase-1084"><a href="#LCMSBase-1084"><span class="linenos">1084</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase-1085"><a href="#LCMSBase-1085"><span class="linenos">1085</span></a><span class="sd">        iterator</span>
</span><span id="LCMSBase-1086"><a href="#LCMSBase-1086"><span class="linenos">1086</span></a><span class="sd">            An iterator over the mass spectra in the dataset.</span>
</span><span id="LCMSBase-1087"><a href="#LCMSBase-1087"><span class="linenos">1087</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1088"><a href="#LCMSBase-1088"><span class="linenos">1088</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="LCMSBase-1089"><a href="#LCMSBase-1089"><span class="linenos">1089</span></a>
</span><span id="LCMSBase-1090"><a href="#LCMSBase-1090"><span class="linenos">1090</span></a>    <span class="k">def</span> <span class="nf">set_tic_list_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase-1091"><a href="#LCMSBase-1091"><span class="linenos">1091</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the TIC list from the mass spectrum objects within the _ms dictionary.</span>
</span><span id="LCMSBase-1092"><a href="#LCMSBase-1092"><span class="linenos">1092</span></a>
</span><span id="LCMSBase-1093"><a href="#LCMSBase-1093"><span class="linenos">1093</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1094"><a href="#LCMSBase-1094"><span class="linenos">1094</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1095"><a href="#LCMSBase-1095"><span class="linenos">1095</span></a><span class="sd">        overwrite : bool, optional</span>
</span><span id="LCMSBase-1096"><a href="#LCMSBase-1096"><span class="linenos">1096</span></a><span class="sd">            If True, overwrites the TIC list if it is already set. Defaults to False.</span>
</span><span id="LCMSBase-1097"><a href="#LCMSBase-1097"><span class="linenos">1097</span></a>
</span><span id="LCMSBase-1098"><a href="#LCMSBase-1098"><span class="linenos">1098</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase-1099"><a href="#LCMSBase-1099"><span class="linenos">1099</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase-1100"><a href="#LCMSBase-1100"><span class="linenos">1100</span></a><span class="sd">        If the _ms dictionary is incomplete, sets the TIC list to an empty list.</span>
</span><span id="LCMSBase-1101"><a href="#LCMSBase-1101"><span class="linenos">1101</span></a>
</span><span id="LCMSBase-1102"><a href="#LCMSBase-1102"><span class="linenos">1102</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-1103"><a href="#LCMSBase-1103"><span class="linenos">1103</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-1104"><a href="#LCMSBase-1104"><span class="linenos">1104</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase-1105"><a href="#LCMSBase-1105"><span class="linenos">1105</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="LCMSBase-1106"><a href="#LCMSBase-1106"><span class="linenos">1106</span></a><span class="sd">            If the TIC list is already set and overwrite is False.</span>
</span><span id="LCMSBase-1107"><a href="#LCMSBase-1107"><span class="linenos">1107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1108"><a href="#LCMSBase-1108"><span class="linenos">1108</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="LCMSBase-1109"><a href="#LCMSBase-1109"><span class="linenos">1109</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-1110"><a href="#LCMSBase-1110"><span class="linenos">1110</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-1111"><a href="#LCMSBase-1111"><span class="linenos">1111</span></a>
</span><span id="LCMSBase-1112"><a href="#LCMSBase-1112"><span class="linenos">1112</span></a>        <span class="c1"># Check if tic_list is already set and raise error if so</span>
</span><span id="LCMSBase-1113"><a href="#LCMSBase-1113"><span class="linenos">1113</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="LCMSBase-1114"><a href="#LCMSBase-1114"><span class="linenos">1114</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TIC list already set, use overwrite=True to overwrite&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-1115"><a href="#LCMSBase-1115"><span class="linenos">1115</span></a>
</span><span id="LCMSBase-1116"><a href="#LCMSBase-1116"><span class="linenos">1116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tic</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">tic</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span><span class="p">]</span>
</span><span id="LCMSBase-1117"><a href="#LCMSBase-1117"><span class="linenos">1117</span></a>
</span><span id="LCMSBase-1118"><a href="#LCMSBase-1118"><span class="linenos">1118</span></a>    <span class="k">def</span> <span class="nf">set_retention_time_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase-1119"><a href="#LCMSBase-1119"><span class="linenos">1119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the retention time list from the data in the _ms dictionary.</span>
</span><span id="LCMSBase-1120"><a href="#LCMSBase-1120"><span class="linenos">1120</span></a>
</span><span id="LCMSBase-1121"><a href="#LCMSBase-1121"><span class="linenos">1121</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1122"><a href="#LCMSBase-1122"><span class="linenos">1122</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1123"><a href="#LCMSBase-1123"><span class="linenos">1123</span></a><span class="sd">        overwrite : bool, optional</span>
</span><span id="LCMSBase-1124"><a href="#LCMSBase-1124"><span class="linenos">1124</span></a><span class="sd">            If True, overwrites the retention time list if it is already set. Defaults to False.</span>
</span><span id="LCMSBase-1125"><a href="#LCMSBase-1125"><span class="linenos">1125</span></a>
</span><span id="LCMSBase-1126"><a href="#LCMSBase-1126"><span class="linenos">1126</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase-1127"><a href="#LCMSBase-1127"><span class="linenos">1127</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase-1128"><a href="#LCMSBase-1128"><span class="linenos">1128</span></a><span class="sd">        If the _ms dictionary is empty or incomplete, sets the retention time list to an empty list.</span>
</span><span id="LCMSBase-1129"><a href="#LCMSBase-1129"><span class="linenos">1129</span></a>
</span><span id="LCMSBase-1130"><a href="#LCMSBase-1130"><span class="linenos">1130</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-1131"><a href="#LCMSBase-1131"><span class="linenos">1131</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-1132"><a href="#LCMSBase-1132"><span class="linenos">1132</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase-1133"><a href="#LCMSBase-1133"><span class="linenos">1133</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="LCMSBase-1134"><a href="#LCMSBase-1134"><span class="linenos">1134</span></a><span class="sd">            If the retention time list is already set and overwrite is False.</span>
</span><span id="LCMSBase-1135"><a href="#LCMSBase-1135"><span class="linenos">1135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1136"><a href="#LCMSBase-1136"><span class="linenos">1136</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="LCMSBase-1137"><a href="#LCMSBase-1137"><span class="linenos">1137</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-1138"><a href="#LCMSBase-1138"><span class="linenos">1138</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-1139"><a href="#LCMSBase-1139"><span class="linenos">1139</span></a>
</span><span id="LCMSBase-1140"><a href="#LCMSBase-1140"><span class="linenos">1140</span></a>        <span class="c1"># Check if retention_time_list is already set and raise error if so</span>
</span><span id="LCMSBase-1141"><a href="#LCMSBase-1141"><span class="linenos">1141</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retention_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="LCMSBase-1142"><a href="#LCMSBase-1142"><span class="linenos">1142</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-1143"><a href="#LCMSBase-1143"><span class="linenos">1143</span></a>                <span class="s2">&quot;Retention time list already set, use overwrite=True to overwrite&quot;</span>
</span><span id="LCMSBase-1144"><a href="#LCMSBase-1144"><span class="linenos">1144</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-1145"><a href="#LCMSBase-1145"><span class="linenos">1145</span></a>
</span><span id="LCMSBase-1146"><a href="#LCMSBase-1146"><span class="linenos">1146</span></a>        <span class="n">retention_time_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase-1147"><a href="#LCMSBase-1147"><span class="linenos">1147</span></a>        <span class="k">for</span> <span class="n">key_ms</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="LCMSBase-1148"><a href="#LCMSBase-1148"><span class="linenos">1148</span></a>            <span class="n">retention_time_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_ms</span><span class="p">)</span><span class="o">.</span><span class="n">retention_time</span><span class="p">)</span>
</span><span id="LCMSBase-1149"><a href="#LCMSBase-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">retention_time</span> <span class="o">=</span> <span class="n">retention_time_list</span>
</span><span id="LCMSBase-1150"><a href="#LCMSBase-1150"><span class="linenos">1150</span></a>
</span><span id="LCMSBase-1151"><a href="#LCMSBase-1151"><span class="linenos">1151</span></a>    <span class="k">def</span> <span class="nf">set_scans_number_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase-1152"><a href="#LCMSBase-1152"><span class="linenos">1152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the scan number list from the data in the _ms dictionary.</span>
</span><span id="LCMSBase-1153"><a href="#LCMSBase-1153"><span class="linenos">1153</span></a>
</span><span id="LCMSBase-1154"><a href="#LCMSBase-1154"><span class="linenos">1154</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase-1155"><a href="#LCMSBase-1155"><span class="linenos">1155</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase-1156"><a href="#LCMSBase-1156"><span class="linenos">1156</span></a><span class="sd">        If the _ms dictionary is empty or incomplete, sets the scan number list to an empty list.</span>
</span><span id="LCMSBase-1157"><a href="#LCMSBase-1157"><span class="linenos">1157</span></a>
</span><span id="LCMSBase-1158"><a href="#LCMSBase-1158"><span class="linenos">1158</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase-1159"><a href="#LCMSBase-1159"><span class="linenos">1159</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase-1160"><a href="#LCMSBase-1160"><span class="linenos">1160</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase-1161"><a href="#LCMSBase-1161"><span class="linenos">1161</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="LCMSBase-1162"><a href="#LCMSBase-1162"><span class="linenos">1162</span></a><span class="sd">            If the scan number list is already set and overwrite is False.</span>
</span><span id="LCMSBase-1163"><a href="#LCMSBase-1163"><span class="linenos">1163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1164"><a href="#LCMSBase-1164"><span class="linenos">1164</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="LCMSBase-1165"><a href="#LCMSBase-1165"><span class="linenos">1165</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase-1166"><a href="#LCMSBase-1166"><span class="linenos">1166</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase-1167"><a href="#LCMSBase-1167"><span class="linenos">1167</span></a>
</span><span id="LCMSBase-1168"><a href="#LCMSBase-1168"><span class="linenos">1168</span></a>        <span class="c1"># Check if scans_number_list is already set and raise error if so</span>
</span><span id="LCMSBase-1169"><a href="#LCMSBase-1169"><span class="linenos">1169</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="LCMSBase-1170"><a href="#LCMSBase-1170"><span class="linenos">1170</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase-1171"><a href="#LCMSBase-1171"><span class="linenos">1171</span></a>                <span class="s2">&quot;Scan number list already set, use overwrite=True to overwrite&quot;</span>
</span><span id="LCMSBase-1172"><a href="#LCMSBase-1172"><span class="linenos">1172</span></a>            <span class="p">)</span>
</span><span id="LCMSBase-1173"><a href="#LCMSBase-1173"><span class="linenos">1173</span></a>
</span><span id="LCMSBase-1174"><a href="#LCMSBase-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="LCMSBase-1175"><a href="#LCMSBase-1175"><span class="linenos">1175</span></a>
</span><span id="LCMSBase-1176"><a href="#LCMSBase-1176"><span class="linenos">1176</span></a>    <span class="nd">@property</span>
</span><span id="LCMSBase-1177"><a href="#LCMSBase-1177"><span class="linenos">1177</span></a>    <span class="k">def</span> <span class="nf">ms1_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1178"><a href="#LCMSBase-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1179"><a href="#LCMSBase-1179"><span class="linenos">1179</span></a><span class="sd">        list : A list of MS1 scan numbers for the dataset.</span>
</span><span id="LCMSBase-1180"><a href="#LCMSBase-1180"><span class="linenos">1180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1181"><a href="#LCMSBase-1181"><span class="linenos">1181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase-1182"><a href="#LCMSBase-1182"><span class="linenos">1182</span></a>
</span><span id="LCMSBase-1183"><a href="#LCMSBase-1183"><span class="linenos">1183</span></a>    <span class="nd">@property</span>
</span><span id="LCMSBase-1184"><a href="#LCMSBase-1184"><span class="linenos">1184</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1185"><a href="#LCMSBase-1185"><span class="linenos">1185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1186"><a href="#LCMSBase-1186"><span class="linenos">1186</span></a><span class="sd">        LCMSParameters : The parameters used for the LC-MS analysis.</span>
</span><span id="LCMSBase-1187"><a href="#LCMSBase-1187"><span class="linenos">1187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1188"><a href="#LCMSBase-1188"><span class="linenos">1188</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>
</span><span id="LCMSBase-1189"><a href="#LCMSBase-1189"><span class="linenos">1189</span></a>
</span><span id="LCMSBase-1190"><a href="#LCMSBase-1190"><span class="linenos">1190</span></a>    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
</span><span id="LCMSBase-1191"><a href="#LCMSBase-1191"><span class="linenos">1191</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramsinstance</span><span class="p">):</span>
</span><span id="LCMSBase-1192"><a href="#LCMSBase-1192"><span class="linenos">1192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1193"><a href="#LCMSBase-1193"><span class="linenos">1193</span></a><span class="sd">        Sets the parameters used for the LC-MS analysis.</span>
</span><span id="LCMSBase-1194"><a href="#LCMSBase-1194"><span class="linenos">1194</span></a>
</span><span id="LCMSBase-1195"><a href="#LCMSBase-1195"><span class="linenos">1195</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1196"><a href="#LCMSBase-1196"><span class="linenos">1196</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1197"><a href="#LCMSBase-1197"><span class="linenos">1197</span></a><span class="sd">        paramsinstance : LCMSParameters</span>
</span><span id="LCMSBase-1198"><a href="#LCMSBase-1198"><span class="linenos">1198</span></a><span class="sd">            The parameters used for the LC-MS analysis.</span>
</span><span id="LCMSBase-1199"><a href="#LCMSBase-1199"><span class="linenos">1199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1200"><a href="#LCMSBase-1200"><span class="linenos">1200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">paramsinstance</span>
</span><span id="LCMSBase-1201"><a href="#LCMSBase-1201"><span class="linenos">1201</span></a>
</span><span id="LCMSBase-1202"><a href="#LCMSBase-1202"><span class="linenos">1202</span></a>    <span class="nd">@property</span>
</span><span id="LCMSBase-1203"><a href="#LCMSBase-1203"><span class="linenos">1203</span></a>    <span class="k">def</span> <span class="nf">scans_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1204"><a href="#LCMSBase-1204"><span class="linenos">1204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1205"><a href="#LCMSBase-1205"><span class="linenos">1205</span></a><span class="sd">        list : A list of scan numbers for the dataset.</span>
</span><span id="LCMSBase-1206"><a href="#LCMSBase-1206"><span class="linenos">1206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1207"><a href="#LCMSBase-1207"><span class="linenos">1207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span>
</span><span id="LCMSBase-1208"><a href="#LCMSBase-1208"><span class="linenos">1208</span></a>
</span><span id="LCMSBase-1209"><a href="#LCMSBase-1209"><span class="linenos">1209</span></a>    <span class="nd">@scans_number</span><span class="o">.</span><span class="n">setter</span>
</span><span id="LCMSBase-1210"><a href="#LCMSBase-1210"><span class="linenos">1210</span></a>    <span class="k">def</span> <span class="nf">scans_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_numbers_list</span><span class="p">):</span>
</span><span id="LCMSBase-1211"><a href="#LCMSBase-1211"><span class="linenos">1211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1212"><a href="#LCMSBase-1212"><span class="linenos">1212</span></a><span class="sd">        Sets the scan numbers for the dataset.</span>
</span><span id="LCMSBase-1213"><a href="#LCMSBase-1213"><span class="linenos">1213</span></a>
</span><span id="LCMSBase-1214"><a href="#LCMSBase-1214"><span class="linenos">1214</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1215"><a href="#LCMSBase-1215"><span class="linenos">1215</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1216"><a href="#LCMSBase-1216"><span class="linenos">1216</span></a><span class="sd">        scan_numbers_list : list</span>
</span><span id="LCMSBase-1217"><a href="#LCMSBase-1217"><span class="linenos">1217</span></a><span class="sd">            A list of scan numbers for the dataset.</span>
</span><span id="LCMSBase-1218"><a href="#LCMSBase-1218"><span class="linenos">1218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1219"><a href="#LCMSBase-1219"><span class="linenos">1219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="n">scan_numbers_list</span>
</span><span id="LCMSBase-1220"><a href="#LCMSBase-1220"><span class="linenos">1220</span></a>
</span><span id="LCMSBase-1221"><a href="#LCMSBase-1221"><span class="linenos">1221</span></a>    <span class="nd">@property</span>
</span><span id="LCMSBase-1222"><a href="#LCMSBase-1222"><span class="linenos">1222</span></a>    <span class="k">def</span> <span class="nf">retention_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1223"><a href="#LCMSBase-1223"><span class="linenos">1223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1224"><a href="#LCMSBase-1224"><span class="linenos">1224</span></a><span class="sd">        numpy.ndarray : An array of retention times for the dataset.</span>
</span><span id="LCMSBase-1225"><a href="#LCMSBase-1225"><span class="linenos">1225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1226"><a href="#LCMSBase-1226"><span class="linenos">1226</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span>
</span><span id="LCMSBase-1227"><a href="#LCMSBase-1227"><span class="linenos">1227</span></a>
</span><span id="LCMSBase-1228"><a href="#LCMSBase-1228"><span class="linenos">1228</span></a>    <span class="nd">@retention_time</span><span class="o">.</span><span class="n">setter</span>
</span><span id="LCMSBase-1229"><a href="#LCMSBase-1229"><span class="linenos">1229</span></a>    <span class="k">def</span> <span class="nf">retention_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rt_list</span><span class="p">):</span>
</span><span id="LCMSBase-1230"><a href="#LCMSBase-1230"><span class="linenos">1230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1231"><a href="#LCMSBase-1231"><span class="linenos">1231</span></a><span class="sd">        Sets the retention times for the dataset.</span>
</span><span id="LCMSBase-1232"><a href="#LCMSBase-1232"><span class="linenos">1232</span></a>
</span><span id="LCMSBase-1233"><a href="#LCMSBase-1233"><span class="linenos">1233</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1234"><a href="#LCMSBase-1234"><span class="linenos">1234</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1235"><a href="#LCMSBase-1235"><span class="linenos">1235</span></a><span class="sd">        rt_list : list</span>
</span><span id="LCMSBase-1236"><a href="#LCMSBase-1236"><span class="linenos">1236</span></a><span class="sd">            A list of retention times for the dataset.</span>
</span><span id="LCMSBase-1237"><a href="#LCMSBase-1237"><span class="linenos">1237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1238"><a href="#LCMSBase-1238"><span class="linenos">1238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rt_list</span><span class="p">)</span>
</span><span id="LCMSBase-1239"><a href="#LCMSBase-1239"><span class="linenos">1239</span></a>
</span><span id="LCMSBase-1240"><a href="#LCMSBase-1240"><span class="linenos">1240</span></a>    <span class="nd">@property</span>
</span><span id="LCMSBase-1241"><a href="#LCMSBase-1241"><span class="linenos">1241</span></a>    <span class="k">def</span> <span class="nf">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase-1242"><a href="#LCMSBase-1242"><span class="linenos">1242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1243"><a href="#LCMSBase-1243"><span class="linenos">1243</span></a><span class="sd">        numpy.ndarray : An array of TIC values for the dataset.</span>
</span><span id="LCMSBase-1244"><a href="#LCMSBase-1244"><span class="linenos">1244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1245"><a href="#LCMSBase-1245"><span class="linenos">1245</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span>
</span><span id="LCMSBase-1246"><a href="#LCMSBase-1246"><span class="linenos">1246</span></a>
</span><span id="LCMSBase-1247"><a href="#LCMSBase-1247"><span class="linenos">1247</span></a>    <span class="nd">@tic</span><span class="o">.</span><span class="n">setter</span>
</span><span id="LCMSBase-1248"><a href="#LCMSBase-1248"><span class="linenos">1248</span></a>    <span class="k">def</span> <span class="nf">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tic_list</span><span class="p">):</span>
</span><span id="LCMSBase-1249"><a href="#LCMSBase-1249"><span class="linenos">1249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LCMSBase-1250"><a href="#LCMSBase-1250"><span class="linenos">1250</span></a><span class="sd">        Sets the TIC values for the dataset.</span>
</span><span id="LCMSBase-1251"><a href="#LCMSBase-1251"><span class="linenos">1251</span></a>
</span><span id="LCMSBase-1252"><a href="#LCMSBase-1252"><span class="linenos">1252</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase-1253"><a href="#LCMSBase-1253"><span class="linenos">1253</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase-1254"><a href="#LCMSBase-1254"><span class="linenos">1254</span></a><span class="sd">        tic_list : list</span>
</span><span id="LCMSBase-1255"><a href="#LCMSBase-1255"><span class="linenos">1255</span></a><span class="sd">            A list of TIC values for the dataset.</span>
</span><span id="LCMSBase-1256"><a href="#LCMSBase-1256"><span class="linenos">1256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase-1257"><a href="#LCMSBase-1257"><span class="linenos">1257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tic_list</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class representing a liquid chromatography-mass spectrometry (LC-MS) data object.</p>

<p>This class is not intended to be instantiated directly, but rather to be instantiated by an appropriate mass spectra parser using the get_lcms_obj() method.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>file_location</strong> (str or Path):
The location of the file containing the mass spectra data.</li>
<li><strong>analyzer</strong> (str, optional):
The type of analyzer used to generate the mass spectra data. Defaults to 'Unknown'.</li>
<li><strong>instrument_label</strong> (str, optional):
The type of instrument used to generate the mass spectra data. Defaults to 'Unknown'.</li>
<li><strong>sample_name</strong> (str, optional):
The name of the sample; defaults to the file name if not provided to the parser. Defaults to None.</li>
<li><strong>spectra_parser</strong> (object, optional):
The spectra parser object used to create the mass spectra object. Defaults to None.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>polarity</strong> (str):
The polarity of the ionization mode used for the dataset.</li>
<li><strong>_parameters</strong> (LCMSParameters):
The parameters used for all methods called on the LCMSBase object. Set upon instantiation from LCMSParameters.</li>
<li><strong>_retention_time_list</strong> (numpy.ndarray):
An array of retention times for the dataset.</li>
<li><strong>_scans_number_list</strong> (list):
A list of scan numbers for the dataset.</li>
<li><strong>_tic_list</strong> (numpy.ndarray):
An array of total ion current (TIC) values for the dataset.</li>
<li><strong>eics</strong> (dict):
A dictionary containing extracted ion chromatograms (EICs) for the dataset.
Key is the mz of the EIC. Initialized as an empty dictionary.</li>
<li><strong>mass_features</strong> (dictionary of LCMSMassFeature objects):
A dictionary containing mass features for the dataset.
Key is mass feature ID. Initialized as an empty dictionary.</li>
<li><strong>spectral_search_results</strong> (dictionary of MS2SearchResults objects):
A dictionary containing spectral search results for the dataset.
Key is scan number : precursor mz. Initialized as an empty dictionary.</li>
</ul>

<h6 id="methods">Methods</h6>

<ul>
<li>get_parameters_json().
Returns the parameters used for the LC-MS analysis in JSON format.</li>
<li>add_associated_ms2_dda(add_to_lcmsobj=True, auto_process=True, use_parser=True)
Adds which MS2 scans are associated with each mass feature to the
mass_features dictionary and optionally adds the MS2 spectra to the _ms dictionary.</li>
<li>add_associated_ms1(add_to_lcmsobj=True, auto_process=True, use_parser=True)
Adds the MS1 spectra associated with each mass feature to the
mass_features dictionary and adds the MS1 spectra to the _ms dictionary.</li>
<li>mass_features_to_df()
Returns a pandas dataframe summarizing the mass features in the dataset.</li>
<li>set_tic_list_from_data(overwrite=False)
Sets the TIC list from the mass spectrum objects within the _ms dictionary.</li>
<li>set_retention_time_from_data(overwrite=False)
Sets the retention time list from the data in the _ms dictionary.</li>
<li>set_scans_number_from_data(overwrite=False)
Sets the scan number list from the data in the _ms dictionary.</li>
<li>plot_composite_mz_features(binsize = 1e-4, ph_int_min_thresh = 0.001, mf_plot = True, ms2_plot = True, return_fig = False)
Generates plot of M/Z features comparing scan time vs M/Z value</li>
</ul>
</div>


                            <div id="LCMSBase.__init__" class="classattr">
                                        <input id="LCMSBase.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LCMSBase</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_location</span>,</span><span class="param">	<span class="n">analyzer</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span>,</span><span class="param">	<span class="n">instrument_label</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span>,</span><span class="param">	<span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="LCMSBase.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.__init__-390"><a href="#LCMSBase.__init__-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="LCMSBase.__init__-391"><a href="#LCMSBase.__init__-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LCMSBase.__init__-392"><a href="#LCMSBase.__init__-392"><span class="linenos">392</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="LCMSBase.__init__-393"><a href="#LCMSBase.__init__-393"><span class="linenos">393</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.__init__-394"><a href="#LCMSBase.__init__-394"><span class="linenos">394</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.__init__-395"><a href="#LCMSBase.__init__-395"><span class="linenos">395</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase.__init__-396"><a href="#LCMSBase.__init__-396"><span class="linenos">396</span></a>        <span class="n">spectra_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase.__init__-397"><a href="#LCMSBase.__init__-397"><span class="linenos">397</span></a>    <span class="p">):</span>
</span><span id="LCMSBase.__init__-398"><a href="#LCMSBase.__init__-398"><span class="linenos">398</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="LCMSBase.__init__-399"><a href="#LCMSBase.__init__-399"><span class="linenos">399</span></a>            <span class="n">file_location</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">instrument_label</span><span class="p">,</span> <span class="n">sample_name</span><span class="p">,</span> <span class="n">spectra_parser</span>
</span><span id="LCMSBase.__init__-400"><a href="#LCMSBase.__init__-400"><span class="linenos">400</span></a>        <span class="p">)</span>
</span><span id="LCMSBase.__init__-401"><a href="#LCMSBase.__init__-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="LCMSBase.__init__-402"><a href="#LCMSBase.__init__-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">LCMSParameters</span><span class="p">()</span>
</span><span id="LCMSBase.__init__-403"><a href="#LCMSBase.__init__-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.__init__-404"><a href="#LCMSBase.__init__-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.__init__-405"><a href="#LCMSBase.__init__-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.__init__-406"><a href="#LCMSBase.__init__-406"><span class="linenos">406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase.__init__-407"><a href="#LCMSBase.__init__-407"><span class="linenos">407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase.__init__-408"><a href="#LCMSBase.__init__-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_search_results</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="LCMSBase.polarity" class="classattr">
                                <div class="attr variable">
            <span class="name">polarity</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.polarity"></a>
    
    

                            </div>
                            <div id="LCMSBase.eics" class="classattr">
                                <div class="attr variable">
            <span class="name">eics</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.eics"></a>
    
    

                            </div>
                            <div id="LCMSBase.mass_features" class="classattr">
                                <div class="attr variable">
            <span class="name">mass_features</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.mass_features"></a>
    
    

                            </div>
                            <div id="LCMSBase.spectral_search_results" class="classattr">
                                <div class="attr variable">
            <span class="name">spectral_search_results</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.spectral_search_results"></a>
    
    

                            </div>
                            <div id="LCMSBase.get_parameters_json" class="classattr">
                                        <input id="LCMSBase.get_parameters_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_parameters_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.get_parameters_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.get_parameters_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.get_parameters_json-410"><a href="#LCMSBase.get_parameters_json-410"><span class="linenos">410</span></a>    <span class="k">def</span> <span class="nf">get_parameters_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase.get_parameters_json-411"><a href="#LCMSBase.get_parameters_json-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the parameters stored for the LC-MS object in JSON format.</span>
</span><span id="LCMSBase.get_parameters_json-412"><a href="#LCMSBase.get_parameters_json-412"><span class="linenos">412</span></a>
</span><span id="LCMSBase.get_parameters_json-413"><a href="#LCMSBase.get_parameters_json-413"><span class="linenos">413</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase.get_parameters_json-414"><a href="#LCMSBase.get_parameters_json-414"><span class="linenos">414</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase.get_parameters_json-415"><a href="#LCMSBase.get_parameters_json-415"><span class="linenos">415</span></a><span class="sd">        str</span>
</span><span id="LCMSBase.get_parameters_json-416"><a href="#LCMSBase.get_parameters_json-416"><span class="linenos">416</span></a><span class="sd">            The parameters used for the LC-MS analysis in JSON format.</span>
</span><span id="LCMSBase.get_parameters_json-417"><a href="#LCMSBase.get_parameters_json-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.get_parameters_json-418"><a href="#LCMSBase.get_parameters_json-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns the parameters stored for the LC-MS object in JSON format.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: The parameters used for the LC-MS analysis in JSON format.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.remove_unprocessed_data" class="classattr">
                                        <input id="LCMSBase.remove_unprocessed_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_unprocessed_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ms_level</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.remove_unprocessed_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.remove_unprocessed_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.remove_unprocessed_data-420"><a href="#LCMSBase.remove_unprocessed_data-420"><span class="linenos">420</span></a>    <span class="k">def</span> <span class="nf">remove_unprocessed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms_level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="LCMSBase.remove_unprocessed_data-421"><a href="#LCMSBase.remove_unprocessed_data-421"><span class="linenos">421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes the unprocessed data from the LCMSBase object.</span>
</span><span id="LCMSBase.remove_unprocessed_data-422"><a href="#LCMSBase.remove_unprocessed_data-422"><span class="linenos">422</span></a>
</span><span id="LCMSBase.remove_unprocessed_data-423"><a href="#LCMSBase.remove_unprocessed_data-423"><span class="linenos">423</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.remove_unprocessed_data-424"><a href="#LCMSBase.remove_unprocessed_data-424"><span class="linenos">424</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.remove_unprocessed_data-425"><a href="#LCMSBase.remove_unprocessed_data-425"><span class="linenos">425</span></a><span class="sd">        ms_level : int, optional</span>
</span><span id="LCMSBase.remove_unprocessed_data-426"><a href="#LCMSBase.remove_unprocessed_data-426"><span class="linenos">426</span></a><span class="sd">            The MS level to remove the unprocessed data for. If None, removes unprocessed data for all MS levels.</span>
</span><span id="LCMSBase.remove_unprocessed_data-427"><a href="#LCMSBase.remove_unprocessed_data-427"><span class="linenos">427</span></a>
</span><span id="LCMSBase.remove_unprocessed_data-428"><a href="#LCMSBase.remove_unprocessed_data-428"><span class="linenos">428</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.remove_unprocessed_data-429"><a href="#LCMSBase.remove_unprocessed_data-429"><span class="linenos">429</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.remove_unprocessed_data-430"><a href="#LCMSBase.remove_unprocessed_data-430"><span class="linenos">430</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase.remove_unprocessed_data-431"><a href="#LCMSBase.remove_unprocessed_data-431"><span class="linenos">431</span></a><span class="sd">            If ms_level is not 1 or 2.</span>
</span><span id="LCMSBase.remove_unprocessed_data-432"><a href="#LCMSBase.remove_unprocessed_data-432"><span class="linenos">432</span></a>
</span><span id="LCMSBase.remove_unprocessed_data-433"><a href="#LCMSBase.remove_unprocessed_data-433"><span class="linenos">433</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase.remove_unprocessed_data-434"><a href="#LCMSBase.remove_unprocessed_data-434"><span class="linenos">434</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase.remove_unprocessed_data-435"><a href="#LCMSBase.remove_unprocessed_data-435"><span class="linenos">435</span></a><span class="sd">        This method is useful for freeing up memory after the data has been processed.</span>
</span><span id="LCMSBase.remove_unprocessed_data-436"><a href="#LCMSBase.remove_unprocessed_data-436"><span class="linenos">436</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.remove_unprocessed_data-437"><a href="#LCMSBase.remove_unprocessed_data-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.remove_unprocessed_data-438"><a href="#LCMSBase.remove_unprocessed_data-438"><span class="linenos">438</span></a>            <span class="k">for</span> <span class="n">ms_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase.remove_unprocessed_data-439"><a href="#LCMSBase.remove_unprocessed_data-439"><span class="linenos">439</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase.remove_unprocessed_data-440"><a href="#LCMSBase.remove_unprocessed_data-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">ms_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
</span><span id="LCMSBase.remove_unprocessed_data-441"><a href="#LCMSBase.remove_unprocessed_data-441"><span class="linenos">441</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ms_level must be 1 or 2&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.remove_unprocessed_data-442"><a href="#LCMSBase.remove_unprocessed_data-442"><span class="linenos">442</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">ms_level</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Removes the unprocessed data from the LCMSBase object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ms_level</strong> (int, optional):
The MS level to remove the unprocessed data for. If None, removes unprocessed data for all MS levels.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If ms_level is not 1 or 2.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This method is useful for freeing up memory after the data has been processed.</p>
</div>


                            </div>
                            <div id="LCMSBase.add_associated_ms2_dda" class="classattr">
                                        <input id="LCMSBase.add_associated_ms2_dda-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_associated_ms2_dda</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ms_params_key</span><span class="o">=</span><span class="s1">&#39;ms2&#39;</span>,</span><span class="param">	<span class="n">scan_filter</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.add_associated_ms2_dda-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.add_associated_ms2_dda"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.add_associated_ms2_dda-444"><a href="#LCMSBase.add_associated_ms2_dda-444"><span class="linenos">444</span></a>    <span class="k">def</span> <span class="nf">add_associated_ms2_dda</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms2_dda-445"><a href="#LCMSBase.add_associated_ms2_dda-445"><span class="linenos">445</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-446"><a href="#LCMSBase.add_associated_ms2_dda-446"><span class="linenos">446</span></a>        <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-447"><a href="#LCMSBase.add_associated_ms2_dda-447"><span class="linenos">447</span></a>        <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-448"><a href="#LCMSBase.add_associated_ms2_dda-448"><span class="linenos">448</span></a>        <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-449"><a href="#LCMSBase.add_associated_ms2_dda-449"><span class="linenos">449</span></a>        <span class="n">ms_params_key</span><span class="o">=</span><span class="s2">&quot;ms2&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-450"><a href="#LCMSBase.add_associated_ms2_dda-450"><span class="linenos">450</span></a>        <span class="n">scan_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-451"><a href="#LCMSBase.add_associated_ms2_dda-451"><span class="linenos">451</span></a>    <span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms2_dda-452"><a href="#LCMSBase.add_associated_ms2_dda-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MS2 spectra associated with mass features to the dataset.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-453"><a href="#LCMSBase.add_associated_ms2_dda-453"><span class="linenos">453</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-454"><a href="#LCMSBase.add_associated_ms2_dda-454"><span class="linenos">454</span></a><span class="sd">        Populates the mass_features ms2_scan_numbers attribute (on mass_features dictionary on LCMSObject)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-455"><a href="#LCMSBase.add_associated_ms2_dda-455"><span class="linenos">455</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-456"><a href="#LCMSBase.add_associated_ms2_dda-456"><span class="linenos">456</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.add_associated_ms2_dda-457"><a href="#LCMSBase.add_associated_ms2_dda-457"><span class="linenos">457</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.add_associated_ms2_dda-458"><a href="#LCMSBase.add_associated_ms2_dda-458"><span class="linenos">458</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="LCMSBase.add_associated_ms2_dda-459"><a href="#LCMSBase.add_associated_ms2_dda-459"><span class="linenos">459</span></a><span class="sd">            If True, auto-processes the MS2 spectra before adding it to the object&#39;s _ms dictionary. Default is True.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-460"><a href="#LCMSBase.add_associated_ms2_dda-460"><span class="linenos">460</span></a><span class="sd">        use_parser : bool, optional</span>
</span><span id="LCMSBase.add_associated_ms2_dda-461"><a href="#LCMSBase.add_associated_ms2_dda-461"><span class="linenos">461</span></a><span class="sd">            If True, envoke the spectra parser to get the MS2 spectra. Default is True.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-462"><a href="#LCMSBase.add_associated_ms2_dda-462"><span class="linenos">462</span></a><span class="sd">        spectrum_mode : str or None, optional</span>
</span><span id="LCMSBase.add_associated_ms2_dda-463"><a href="#LCMSBase.add_associated_ms2_dda-463"><span class="linenos">463</span></a><span class="sd">            The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode</span>
</span><span id="LCMSBase.add_associated_ms2_dda-464"><a href="#LCMSBase.add_associated_ms2_dda-464"><span class="linenos">464</span></a><span class="sd">            from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="LCMSBase.add_associated_ms2_dda-465"><a href="#LCMSBase.add_associated_ms2_dda-465"><span class="linenos">465</span></a><span class="sd">            Defaults to None. (faster if defined, otherwise will check each scan)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-466"><a href="#LCMSBase.add_associated_ms2_dda-466"><span class="linenos">466</span></a><span class="sd">        ms_params_key : string, optional</span>
</span><span id="LCMSBase.add_associated_ms2_dda-467"><a href="#LCMSBase.add_associated_ms2_dda-467"><span class="linenos">467</span></a><span class="sd">            The key of the mass spectrum parameters to use for the mass spectra, accessed from the LCMSObject.parameters.mass_spectrum attribute.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-468"><a href="#LCMSBase.add_associated_ms2_dda-468"><span class="linenos">468</span></a><span class="sd">            Defaults to &#39;ms2&#39;.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-469"><a href="#LCMSBase.add_associated_ms2_dda-469"><span class="linenos">469</span></a><span class="sd">        scan_filter : str</span>
</span><span id="LCMSBase.add_associated_ms2_dda-470"><a href="#LCMSBase.add_associated_ms2_dda-470"><span class="linenos">470</span></a><span class="sd">            A string to filter the scans to add to the _ms dictionary.  If None, all scans are added.  Defaults to None.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-471"><a href="#LCMSBase.add_associated_ms2_dda-471"><span class="linenos">471</span></a><span class="sd">            &quot;hcd&quot; will pull out only HCD scans.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-472"><a href="#LCMSBase.add_associated_ms2_dda-472"><span class="linenos">472</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-473"><a href="#LCMSBase.add_associated_ms2_dda-473"><span class="linenos">473</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.add_associated_ms2_dda-474"><a href="#LCMSBase.add_associated_ms2_dda-474"><span class="linenos">474</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.add_associated_ms2_dda-475"><a href="#LCMSBase.add_associated_ms2_dda-475"><span class="linenos">475</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase.add_associated_ms2_dda-476"><a href="#LCMSBase.add_associated_ms2_dda-476"><span class="linenos">476</span></a><span class="sd">            If mass_features is not set, must run find_mass_features() first.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-477"><a href="#LCMSBase.add_associated_ms2_dda-477"><span class="linenos">477</span></a><span class="sd">            If no MS2 scans are found in the dataset.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-478"><a href="#LCMSBase.add_associated_ms2_dda-478"><span class="linenos">478</span></a><span class="sd">            If no precursor m/z values are found in MS2 scans, not a DDA dataset.</span>
</span><span id="LCMSBase.add_associated_ms2_dda-479"><a href="#LCMSBase.add_associated_ms2_dda-479"><span class="linenos">479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.add_associated_ms2_dda-480"><a href="#LCMSBase.add_associated_ms2_dda-480"><span class="linenos">480</span></a>        <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase.add_associated_ms2_dda-481"><a href="#LCMSBase.add_associated_ms2_dda-481"><span class="linenos">481</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms2_dda-482"><a href="#LCMSBase.add_associated_ms2_dda-482"><span class="linenos">482</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms2_dda-483"><a href="#LCMSBase.add_associated_ms2_dda-483"><span class="linenos">483</span></a>                <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase.add_associated_ms2_dda-484"><a href="#LCMSBase.add_associated_ms2_dda-484"><span class="linenos">484</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-485"><a href="#LCMSBase.add_associated_ms2_dda-485"><span class="linenos">485</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-486"><a href="#LCMSBase.add_associated_ms2_dda-486"><span class="linenos">486</span></a>        <span class="c1"># reconfigure ms_params to get the correct mass spectrum parameters from the key</span>
</span><span id="LCMSBase.add_associated_ms2_dda-487"><a href="#LCMSBase.add_associated_ms2_dda-487"><span class="linenos">487</span></a>        <span class="n">ms_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="n">ms_params_key</span><span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-488"><a href="#LCMSBase.add_associated_ms2_dda-488"><span class="linenos">488</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-489"><a href="#LCMSBase.add_associated_ms2_dda-489"><span class="linenos">489</span></a>        <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase.add_associated_ms2_dda-490"><a href="#LCMSBase.add_associated_ms2_dda-490"><span class="linenos">490</span></a>        <span class="c1"># Find ms2 scans that have a precursor m/z value</span>
</span><span id="LCMSBase.add_associated_ms2_dda-491"><a href="#LCMSBase.add_associated_ms2_dda-491"><span class="linenos">491</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-492"><a href="#LCMSBase.add_associated_ms2_dda-492"><span class="linenos">492</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="o">~</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">precursor_mz</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-493"><a href="#LCMSBase.add_associated_ms2_dda-493"><span class="linenos">493</span></a>        <span class="c1"># drop ms2 scans that have no tic</span>
</span><span id="LCMSBase.add_associated_ms2_dda-494"><a href="#LCMSBase.add_associated_ms2_dda-494"><span class="linenos">494</span></a>        <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">tic</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-495"><a href="#LCMSBase.add_associated_ms2_dda-495"><span class="linenos">495</span></a>        <span class="k">if</span> <span class="n">ms2_scans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms2_dda-496"><a href="#LCMSBase.add_associated_ms2_dda-496"><span class="linenos">496</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No DDA scans found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-497"><a href="#LCMSBase.add_associated_ms2_dda-497"><span class="linenos">497</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-498"><a href="#LCMSBase.add_associated_ms2_dda-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="n">scan_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms2_dda-499"><a href="#LCMSBase.add_associated_ms2_dda-499"><span class="linenos">499</span></a>            <span class="n">ms2_scans</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span><span class="n">ms2_scans</span><span class="o">.</span><span class="n">scan_text</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">scan_filter</span><span class="p">)]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-500"><a href="#LCMSBase.add_associated_ms2_dda-500"><span class="linenos">500</span></a>        <span class="c1"># set tolerance in rt space (in minutes) and mz space (in daltons)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-501"><a href="#LCMSBase.add_associated_ms2_dda-501"><span class="linenos">501</span></a>        <span class="n">time_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms2_dda_rt_tolerance</span>
</span><span id="LCMSBase.add_associated_ms2_dda-502"><a href="#LCMSBase.add_associated_ms2_dda-502"><span class="linenos">502</span></a>        <span class="n">mz_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms2_dda_mz_tolerance</span>
</span><span id="LCMSBase.add_associated_ms2_dda-503"><a href="#LCMSBase.add_associated_ms2_dda-503"><span class="linenos">503</span></a>
</span><span id="LCMSBase.add_associated_ms2_dda-504"><a href="#LCMSBase.add_associated_ms2_dda-504"><span class="linenos">504</span></a>        <span class="c1"># for each mass feature, find the ms2 scans that are within the roi scan time and mz range</span>
</span><span id="LCMSBase.add_associated_ms2_dda-505"><a href="#LCMSBase.add_associated_ms2_dda-505"><span class="linenos">505</span></a>        <span class="n">dda_scans</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-506"><a href="#LCMSBase.add_associated_ms2_dda-506"><span class="linenos">506</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="LCMSBase.add_associated_ms2_dda-507"><a href="#LCMSBase.add_associated_ms2_dda-507"><span class="linenos">507</span></a>            <span class="n">ms2_scans_filtered</span> <span class="o">=</span> <span class="n">ms2_scans</span><span class="p">[</span>
</span><span id="LCMSBase.add_associated_ms2_dda-508"><a href="#LCMSBase.add_associated_ms2_dda-508"><span class="linenos">508</span></a>                <span class="n">ms2_scans</span><span class="o">.</span><span class="n">scan_time</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms2_dda-509"><a href="#LCMSBase.add_associated_ms2_dda-509"><span class="linenos">509</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">scan_time</span> <span class="o">-</span> <span class="n">time_tol</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">scan_time</span> <span class="o">+</span> <span class="n">time_tol</span>
</span><span id="LCMSBase.add_associated_ms2_dda-510"><a href="#LCMSBase.add_associated_ms2_dda-510"><span class="linenos">510</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-511"><a href="#LCMSBase.add_associated_ms2_dda-511"><span class="linenos">511</span></a>            <span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-512"><a href="#LCMSBase.add_associated_ms2_dda-512"><span class="linenos">512</span></a>            <span class="n">ms2_scans_filtered</span> <span class="o">=</span> <span class="n">ms2_scans_filtered</span><span class="p">[</span>
</span><span id="LCMSBase.add_associated_ms2_dda-513"><a href="#LCMSBase.add_associated_ms2_dda-513"><span class="linenos">513</span></a>                <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">precursor_mz</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms2_dda-514"><a href="#LCMSBase.add_associated_ms2_dda-514"><span class="linenos">514</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">mz</span> <span class="o">-</span> <span class="n">mz_tol</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">mz</span> <span class="o">+</span> <span class="n">mz_tol</span>
</span><span id="LCMSBase.add_associated_ms2_dda-515"><a href="#LCMSBase.add_associated_ms2_dda-515"><span class="linenos">515</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-516"><a href="#LCMSBase.add_associated_ms2_dda-516"><span class="linenos">516</span></a>            <span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms2_dda-517"><a href="#LCMSBase.add_associated_ms2_dda-517"><span class="linenos">517</span></a>            <span class="n">dda_scans</span> <span class="o">=</span> <span class="n">dda_scans</span> <span class="o">+</span> <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase.add_associated_ms2_dda-518"><a href="#LCMSBase.add_associated_ms2_dda-518"><span class="linenos">518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms2_dda-519"><a href="#LCMSBase.add_associated_ms2_dda-519"><span class="linenos">519</span></a>                <span class="n">ms2_scans_filtered</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase.add_associated_ms2_dda-520"><a href="#LCMSBase.add_associated_ms2_dda-520"><span class="linenos">520</span></a>                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span>
</span><span id="LCMSBase.add_associated_ms2_dda-521"><a href="#LCMSBase.add_associated_ms2_dda-521"><span class="linenos">521</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-522"><a href="#LCMSBase.add_associated_ms2_dda-522"><span class="linenos">522</span></a>        <span class="c1"># add to _ms attribute</span>
</span><span id="LCMSBase.add_associated_ms2_dda-523"><a href="#LCMSBase.add_associated_ms2_dda-523"><span class="linenos">523</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectra</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms2_dda-524"><a href="#LCMSBase.add_associated_ms2_dda-524"><span class="linenos">524</span></a>            <span class="n">scan_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dda_scans</span><span class="p">)),</span>
</span><span id="LCMSBase.add_associated_ms2_dda-525"><a href="#LCMSBase.add_associated_ms2_dda-525"><span class="linenos">525</span></a>            <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-526"><a href="#LCMSBase.add_associated_ms2_dda-526"><span class="linenos">526</span></a>            <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-527"><a href="#LCMSBase.add_associated_ms2_dda-527"><span class="linenos">527</span></a>            <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-528"><a href="#LCMSBase.add_associated_ms2_dda-528"><span class="linenos">528</span></a>            <span class="n">ms_params</span><span class="o">=</span><span class="n">ms_params</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms2_dda-529"><a href="#LCMSBase.add_associated_ms2_dda-529"><span class="linenos">529</span></a>        <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms2_dda-530"><a href="#LCMSBase.add_associated_ms2_dda-530"><span class="linenos">530</span></a>        <span class="c1"># associate appropriate _ms attribute to appropriate mass feature&#39;s ms2_mass_spectra attribute</span>
</span><span id="LCMSBase.add_associated_ms2_dda-531"><a href="#LCMSBase.add_associated_ms2_dda-531"><span class="linenos">531</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms2_dda-532"><a href="#LCMSBase.add_associated_ms2_dda-532"><span class="linenos">532</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms2_dda-533"><a href="#LCMSBase.add_associated_ms2_dda-533"><span class="linenos">533</span></a>                <span class="k">for</span> <span class="n">dda_scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms2_dda-534"><a href="#LCMSBase.add_associated_ms2_dda-534"><span class="linenos">534</span></a>                    <span class="k">if</span> <span class="n">dda_scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase.add_associated_ms2_dda-535"><a href="#LCMSBase.add_associated_ms2_dda-535"><span class="linenos">535</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_mass_spectra</span><span class="p">[</span><span class="n">dda_scan</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span>
</span><span id="LCMSBase.add_associated_ms2_dda-536"><a href="#LCMSBase.add_associated_ms2_dda-536"><span class="linenos">536</span></a>                            <span class="n">dda_scan</span>
</span><span id="LCMSBase.add_associated_ms2_dda-537"><a href="#LCMSBase.add_associated_ms2_dda-537"><span class="linenos">537</span></a>                        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Add MS2 spectra associated with mass features to the dataset.</p>

<p>Populates the mass_features ms2_scan_numbers attribute (on mass_features dictionary on LCMSObject)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>auto_process</strong> (bool, optional):
If True, auto-processes the MS2 spectra before adding it to the object's _ms dictionary. Default is True.</li>
<li><strong>use_parser</strong> (bool, optional):
If True, envoke the spectra parser to get the MS2 spectra. Default is True.</li>
<li><strong>spectrum_mode</strong> (str or None, optional):
The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode
from the spectra parser to ascertain the spectrum mode (this allows for mixed types).
Defaults to None. (faster if defined, otherwise will check each scan)</li>
<li><strong>ms_params_key</strong> (string, optional):
The key of the mass spectrum parameters to use for the mass spectra, accessed from the LCMSObject.parameters.mass_spectrum attribute.
Defaults to 'ms2'.</li>
<li><strong>scan_filter</strong> (str):
A string to filter the scans to add to the _ms dictionary.  If None, all scans are added.  Defaults to None.
"hcd" will pull out only HCD scans.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If mass_features is not set, must run find_mass_features() first.
If no MS2 scans are found in the dataset.
If no precursor m/z values are found in MS2 scans, not a DDA dataset.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.add_associated_ms1" class="classattr">
                                        <input id="LCMSBase.add_associated_ms1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_associated_ms1</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.add_associated_ms1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.add_associated_ms1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.add_associated_ms1-539"><a href="#LCMSBase.add_associated_ms1-539"><span class="linenos">539</span></a>    <span class="k">def</span> <span class="nf">add_associated_ms1</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-540"><a href="#LCMSBase.add_associated_ms1-540"><span class="linenos">540</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_parser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spectrum_mode</span><span class="o">=</span><span class="kc">None</span>
</span><span id="LCMSBase.add_associated_ms1-541"><a href="#LCMSBase.add_associated_ms1-541"><span class="linenos">541</span></a>    <span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms1-542"><a href="#LCMSBase.add_associated_ms1-542"><span class="linenos">542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add MS1 spectra associated with mass features to the dataset.</span>
</span><span id="LCMSBase.add_associated_ms1-543"><a href="#LCMSBase.add_associated_ms1-543"><span class="linenos">543</span></a>
</span><span id="LCMSBase.add_associated_ms1-544"><a href="#LCMSBase.add_associated_ms1-544"><span class="linenos">544</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.add_associated_ms1-545"><a href="#LCMSBase.add_associated_ms1-545"><span class="linenos">545</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.add_associated_ms1-546"><a href="#LCMSBase.add_associated_ms1-546"><span class="linenos">546</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="LCMSBase.add_associated_ms1-547"><a href="#LCMSBase.add_associated_ms1-547"><span class="linenos">547</span></a><span class="sd">            If True, auto-processes the MS1 spectra before adding it to the object&#39;s _ms dictionary. Default is True.</span>
</span><span id="LCMSBase.add_associated_ms1-548"><a href="#LCMSBase.add_associated_ms1-548"><span class="linenos">548</span></a><span class="sd">        use_parser : bool, optional</span>
</span><span id="LCMSBase.add_associated_ms1-549"><a href="#LCMSBase.add_associated_ms1-549"><span class="linenos">549</span></a><span class="sd">            If True, envoke the spectra parser to get the MS1 spectra. Default is True.</span>
</span><span id="LCMSBase.add_associated_ms1-550"><a href="#LCMSBase.add_associated_ms1-550"><span class="linenos">550</span></a><span class="sd">        spectrum_mode : str or None, optional</span>
</span><span id="LCMSBase.add_associated_ms1-551"><a href="#LCMSBase.add_associated_ms1-551"><span class="linenos">551</span></a><span class="sd">            The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode</span>
</span><span id="LCMSBase.add_associated_ms1-552"><a href="#LCMSBase.add_associated_ms1-552"><span class="linenos">552</span></a><span class="sd">            from the spectra parser to ascertain the spectrum mode (this allows for mixed types).</span>
</span><span id="LCMSBase.add_associated_ms1-553"><a href="#LCMSBase.add_associated_ms1-553"><span class="linenos">553</span></a><span class="sd">            Defaults to None. (faster if defined, otherwise will check each scan)</span>
</span><span id="LCMSBase.add_associated_ms1-554"><a href="#LCMSBase.add_associated_ms1-554"><span class="linenos">554</span></a>
</span><span id="LCMSBase.add_associated_ms1-555"><a href="#LCMSBase.add_associated_ms1-555"><span class="linenos">555</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.add_associated_ms1-556"><a href="#LCMSBase.add_associated_ms1-556"><span class="linenos">556</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.add_associated_ms1-557"><a href="#LCMSBase.add_associated_ms1-557"><span class="linenos">557</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase.add_associated_ms1-558"><a href="#LCMSBase.add_associated_ms1-558"><span class="linenos">558</span></a><span class="sd">            If mass_features is not set, must run find_mass_features() first.</span>
</span><span id="LCMSBase.add_associated_ms1-559"><a href="#LCMSBase.add_associated_ms1-559"><span class="linenos">559</span></a><span class="sd">            If apex scans are not profile mode, all apex scans must be profile mode for averaging.</span>
</span><span id="LCMSBase.add_associated_ms1-560"><a href="#LCMSBase.add_associated_ms1-560"><span class="linenos">560</span></a><span class="sd">            If number of scans to average is not  1 or an integer with an integer median (i.e. 3, 5, 7, 9).</span>
</span><span id="LCMSBase.add_associated_ms1-561"><a href="#LCMSBase.add_associated_ms1-561"><span class="linenos">561</span></a><span class="sd">            If deconvolute is True and no EICs are found, did you run integrate_mass_features() first?</span>
</span><span id="LCMSBase.add_associated_ms1-562"><a href="#LCMSBase.add_associated_ms1-562"><span class="linenos">562</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.add_associated_ms1-563"><a href="#LCMSBase.add_associated_ms1-563"><span class="linenos">563</span></a>        <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase.add_associated_ms1-564"><a href="#LCMSBase.add_associated_ms1-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-565"><a href="#LCMSBase.add_associated_ms1-565"><span class="linenos">565</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-566"><a href="#LCMSBase.add_associated_ms1-566"><span class="linenos">566</span></a>                <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase.add_associated_ms1-567"><a href="#LCMSBase.add_associated_ms1-567"><span class="linenos">567</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-568"><a href="#LCMSBase.add_associated_ms1-568"><span class="linenos">568</span></a>        <span class="n">scans_to_average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">ms1_scans_to_average</span>
</span><span id="LCMSBase.add_associated_ms1-569"><a href="#LCMSBase.add_associated_ms1-569"><span class="linenos">569</span></a>
</span><span id="LCMSBase.add_associated_ms1-570"><a href="#LCMSBase.add_associated_ms1-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="n">scans_to_average</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-571"><a href="#LCMSBase.add_associated_ms1-571"><span class="linenos">571</span></a>            <span class="c1"># Add to LCMSobj</span>
</span><span id="LCMSBase.add_associated_ms1-572"><a href="#LCMSBase.add_associated_ms1-572"><span class="linenos">572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectra</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-573"><a href="#LCMSBase.add_associated_ms1-573"><span class="linenos">573</span></a>                <span class="n">scan_list</span><span class="o">=</span><span class="p">[</span>
</span><span id="LCMSBase.add_associated_ms1-574"><a href="#LCMSBase.add_associated_ms1-574"><span class="linenos">574</span></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">apex_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="LCMSBase.add_associated_ms1-575"><a href="#LCMSBase.add_associated_ms1-575"><span class="linenos">575</span></a>                <span class="p">],</span>
</span><span id="LCMSBase.add_associated_ms1-576"><a href="#LCMSBase.add_associated_ms1-576"><span class="linenos">576</span></a>                <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-577"><a href="#LCMSBase.add_associated_ms1-577"><span class="linenos">577</span></a>                <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-578"><a href="#LCMSBase.add_associated_ms1-578"><span class="linenos">578</span></a>                <span class="n">spectrum_mode</span><span class="o">=</span><span class="n">spectrum_mode</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-579"><a href="#LCMSBase.add_associated_ms1-579"><span class="linenos">579</span></a>                <span class="n">ms_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="s2">&quot;ms1&quot;</span><span class="p">],</span>
</span><span id="LCMSBase.add_associated_ms1-580"><a href="#LCMSBase.add_associated_ms1-580"><span class="linenos">580</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-581"><a href="#LCMSBase.add_associated_ms1-581"><span class="linenos">581</span></a>
</span><span id="LCMSBase.add_associated_ms1-582"><a href="#LCMSBase.add_associated_ms1-582"><span class="linenos">582</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-583"><a href="#LCMSBase.add_associated_ms1-583"><span class="linenos">583</span></a>            <span class="p">(</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="LCMSBase.add_associated_ms1-584"><a href="#LCMSBase.add_associated_ms1-584"><span class="linenos">584</span></a>        <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># scans_to_average = 3, 5, 7 etc, mirror l/r around apex</span>
</span><span id="LCMSBase.add_associated_ms1-585"><a href="#LCMSBase.add_associated_ms1-585"><span class="linenos">585</span></a>            <span class="n">apex_scans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span><span class="o">.</span><span class="n">apex_scan</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</span><span id="LCMSBase.add_associated_ms1-586"><a href="#LCMSBase.add_associated_ms1-586"><span class="linenos">586</span></a>            <span class="c1"># Check if all apex scans are profile mode, raise error if not</span>
</span><span id="LCMSBase.add_associated_ms1-587"><a href="#LCMSBase.add_associated_ms1-587"><span class="linenos">587</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">apex_scans</span><span class="p">,</span> <span class="s2">&quot;ms_format&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms1-588"><a href="#LCMSBase.add_associated_ms1-588"><span class="linenos">588</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All apex scans must be profile mode for averaging&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-589"><a href="#LCMSBase.add_associated_ms1-589"><span class="linenos">589</span></a>
</span><span id="LCMSBase.add_associated_ms1-590"><a href="#LCMSBase.add_associated_ms1-590"><span class="linenos">590</span></a>            <span class="c1"># First get sets of scans to average</span>
</span><span id="LCMSBase.add_associated_ms1-591"><a href="#LCMSBase.add_associated_ms1-591"><span class="linenos">591</span></a>            <span class="k">def</span> <span class="nf">get_scans_from_apex</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">,</span> <span class="n">apex_scan</span><span class="p">,</span> <span class="n">scans_to_average</span><span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms1-592"><a href="#LCMSBase.add_associated_ms1-592"><span class="linenos">592</span></a>                <span class="n">ms1_idx_start</span> <span class="o">=</span> <span class="n">ms1_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">apex_scan</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-593"><a href="#LCMSBase.add_associated_ms1-593"><span class="linenos">593</span></a>                    <span class="p">(</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="LCMSBase.add_associated_ms1-594"><a href="#LCMSBase.add_associated_ms1-594"><span class="linenos">594</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-595"><a href="#LCMSBase.add_associated_ms1-595"><span class="linenos">595</span></a>                <span class="k">if</span> <span class="n">ms1_idx_start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-596"><a href="#LCMSBase.add_associated_ms1-596"><span class="linenos">596</span></a>                    <span class="n">ms1_idx_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LCMSBase.add_associated_ms1-597"><a href="#LCMSBase.add_associated_ms1-597"><span class="linenos">597</span></a>                <span class="n">ms1_idx_end</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-598"><a href="#LCMSBase.add_associated_ms1-598"><span class="linenos">598</span></a>                    <span class="n">ms1_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">apex_scan</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">scans_to_average</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="LCMSBase.add_associated_ms1-599"><a href="#LCMSBase.add_associated_ms1-599"><span class="linenos">599</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-600"><a href="#LCMSBase.add_associated_ms1-600"><span class="linenos">600</span></a>                <span class="k">if</span> <span class="n">ms1_idx_end</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms1-601"><a href="#LCMSBase.add_associated_ms1-601"><span class="linenos">601</span></a>                    <span class="n">ms1_idx_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="LCMSBase.add_associated_ms1-602"><a href="#LCMSBase.add_associated_ms1-602"><span class="linenos">602</span></a>                <span class="n">scan_list</span> <span class="o">=</span> <span class="n">ms1_scans</span><span class="p">[</span><span class="n">ms1_idx_start</span><span class="p">:</span><span class="n">ms1_idx_end</span><span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms1-603"><a href="#LCMSBase.add_associated_ms1-603"><span class="linenos">603</span></a>                <span class="k">return</span> <span class="n">scan_list</span>
</span><span id="LCMSBase.add_associated_ms1-604"><a href="#LCMSBase.add_associated_ms1-604"><span class="linenos">604</span></a>
</span><span id="LCMSBase.add_associated_ms1-605"><a href="#LCMSBase.add_associated_ms1-605"><span class="linenos">605</span></a>            <span class="n">ms1_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms1_scans</span>
</span><span id="LCMSBase.add_associated_ms1-606"><a href="#LCMSBase.add_associated_ms1-606"><span class="linenos">606</span></a>            <span class="n">scans_lists</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase.add_associated_ms1-607"><a href="#LCMSBase.add_associated_ms1-607"><span class="linenos">607</span></a>                <span class="n">get_scans_from_apex</span><span class="p">(</span><span class="n">ms1_scans</span><span class="p">,</span> <span class="n">apex_scan</span><span class="p">,</span> <span class="n">scans_to_average</span><span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-608"><a href="#LCMSBase.add_associated_ms1-608"><span class="linenos">608</span></a>                <span class="k">for</span> <span class="n">apex_scan</span> <span class="ow">in</span> <span class="n">apex_scans</span>
</span><span id="LCMSBase.add_associated_ms1-609"><a href="#LCMSBase.add_associated_ms1-609"><span class="linenos">609</span></a>            <span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms1-610"><a href="#LCMSBase.add_associated_ms1-610"><span class="linenos">610</span></a>
</span><span id="LCMSBase.add_associated_ms1-611"><a href="#LCMSBase.add_associated_ms1-611"><span class="linenos">611</span></a>            <span class="c1"># set polarity to -1 if negative mode, 1 if positive mode (for mass spectrum creation)</span>
</span><span id="LCMSBase.add_associated_ms1-612"><a href="#LCMSBase.add_associated_ms1-612"><span class="linenos">612</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;negative&quot;</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-613"><a href="#LCMSBase.add_associated_ms1-613"><span class="linenos">613</span></a>                <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="LCMSBase.add_associated_ms1-614"><a href="#LCMSBase.add_associated_ms1-614"><span class="linenos">614</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s2">&quot;positive&quot;</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-615"><a href="#LCMSBase.add_associated_ms1-615"><span class="linenos">615</span></a>                <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="LCMSBase.add_associated_ms1-616"><a href="#LCMSBase.add_associated_ms1-616"><span class="linenos">616</span></a>
</span><span id="LCMSBase.add_associated_ms1-617"><a href="#LCMSBase.add_associated_ms1-617"><span class="linenos">617</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-618"><a href="#LCMSBase.add_associated_ms1-618"><span class="linenos">618</span></a>                <span class="c1"># Perform checks and prepare _ms_unprocessed dictionary if use_parser is False (saves time to do this once)</span>
</span><span id="LCMSBase.add_associated_ms1-619"><a href="#LCMSBase.add_associated_ms1-619"><span class="linenos">619</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase.add_associated_ms1-620"><a href="#LCMSBase.add_associated_ms1-620"><span class="linenos">620</span></a>                <span class="c1"># Set the index on _ms_unprocessed[1] to scan number</span>
</span><span id="LCMSBase.add_associated_ms1-621"><a href="#LCMSBase.add_associated_ms1-621"><span class="linenos">621</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-622"><a href="#LCMSBase.add_associated_ms1-622"><span class="linenos">622</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span>
</span><span id="LCMSBase.add_associated_ms1-623"><a href="#LCMSBase.add_associated_ms1-623"><span class="linenos">623</span></a>
</span><span id="LCMSBase.add_associated_ms1-624"><a href="#LCMSBase.add_associated_ms1-624"><span class="linenos">624</span></a>                <span class="c1"># Check that all the scans in scan_lists are indexs in self._ms_unprocessed[1]</span>
</span><span id="LCMSBase.add_associated_ms1-625"><a href="#LCMSBase.add_associated_ms1-625"><span class="linenos">625</span></a>                <span class="n">scans_lists_flat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-626"><a href="#LCMSBase.add_associated_ms1-626"><span class="linenos">626</span></a>                    <span class="nb">set</span><span class="p">([</span><span class="n">scan</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">scans_lists</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
</span><span id="LCMSBase.add_associated_ms1-627"><a href="#LCMSBase.add_associated_ms1-627"><span class="linenos">627</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-628"><a href="#LCMSBase.add_associated_ms1-628"><span class="linenos">628</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-629"><a href="#LCMSBase.add_associated_ms1-629"><span class="linenos">629</span></a>                    <span class="nb">len</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-630"><a href="#LCMSBase.add_associated_ms1-630"><span class="linenos">630</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-631"><a href="#LCMSBase.add_associated_ms1-631"><span class="linenos">631</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">scans_lists_flat</span><span class="p">),</span>
</span><span id="LCMSBase.add_associated_ms1-632"><a href="#LCMSBase.add_associated_ms1-632"><span class="linenos">632</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
</span><span id="LCMSBase.add_associated_ms1-633"><a href="#LCMSBase.add_associated_ms1-633"><span class="linenos">633</span></a>                        <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-634"><a href="#LCMSBase.add_associated_ms1-634"><span class="linenos">634</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-635"><a href="#LCMSBase.add_associated_ms1-635"><span class="linenos">635</span></a>                    <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="LCMSBase.add_associated_ms1-636"><a href="#LCMSBase.add_associated_ms1-636"><span class="linenos">636</span></a>                <span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms1-637"><a href="#LCMSBase.add_associated_ms1-637"><span class="linenos">637</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-638"><a href="#LCMSBase.add_associated_ms1-638"><span class="linenos">638</span></a>                        <span class="s2">&quot;Not all scans to average are present in the unprocessed data&quot;</span>
</span><span id="LCMSBase.add_associated_ms1-639"><a href="#LCMSBase.add_associated_ms1-639"><span class="linenos">639</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-640"><a href="#LCMSBase.add_associated_ms1-640"><span class="linenos">640</span></a>
</span><span id="LCMSBase.add_associated_ms1-641"><a href="#LCMSBase.add_associated_ms1-641"><span class="linenos">641</span></a>            <span class="k">for</span> <span class="n">scan_list_average</span><span class="p">,</span> <span class="n">apex_scan</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans_lists</span><span class="p">,</span> <span class="n">apex_scans</span><span class="p">):</span>
</span><span id="LCMSBase.add_associated_ms1-642"><a href="#LCMSBase.add_associated_ms1-642"><span class="linenos">642</span></a>                <span class="c1"># Get unprocessed mass spectrum from scans</span>
</span><span id="LCMSBase.add_associated_ms1-643"><a href="#LCMSBase.add_associated_ms1-643"><span class="linenos">643</span></a>                <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_mass_spectrum</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-644"><a href="#LCMSBase.add_associated_ms1-644"><span class="linenos">644</span></a>                    <span class="n">scan_list</span><span class="o">=</span><span class="n">scan_list_average</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-645"><a href="#LCMSBase.add_associated_ms1-645"><span class="linenos">645</span></a>                    <span class="n">apex_scan</span><span class="o">=</span><span class="n">apex_scan</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-646"><a href="#LCMSBase.add_associated_ms1-646"><span class="linenos">646</span></a>                    <span class="n">spectrum_mode</span><span class="o">=</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-647"><a href="#LCMSBase.add_associated_ms1-647"><span class="linenos">647</span></a>                    <span class="n">ms_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-648"><a href="#LCMSBase.add_associated_ms1-648"><span class="linenos">648</span></a>                    <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-649"><a href="#LCMSBase.add_associated_ms1-649"><span class="linenos">649</span></a>                    <span class="n">use_parser</span><span class="o">=</span><span class="n">use_parser</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-650"><a href="#LCMSBase.add_associated_ms1-650"><span class="linenos">650</span></a>                    <span class="n">perform_checks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-651"><a href="#LCMSBase.add_associated_ms1-651"><span class="linenos">651</span></a>                    <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span>
</span><span id="LCMSBase.add_associated_ms1-652"><a href="#LCMSBase.add_associated_ms1-652"><span class="linenos">652</span></a>                    <span class="n">ms_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="p">[</span><span class="s2">&quot;ms1&quot;</span><span class="p">],</span>
</span><span id="LCMSBase.add_associated_ms1-653"><a href="#LCMSBase.add_associated_ms1-653"><span class="linenos">653</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-654"><a href="#LCMSBase.add_associated_ms1-654"><span class="linenos">654</span></a>                <span class="c1"># Add mass spectrum to LCMS object and associated with mass feature</span>
</span><span id="LCMSBase.add_associated_ms1-655"><a href="#LCMSBase.add_associated_ms1-655"><span class="linenos">655</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_mass_spectrum</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-656"><a href="#LCMSBase.add_associated_ms1-656"><span class="linenos">656</span></a>
</span><span id="LCMSBase.add_associated_ms1-657"><a href="#LCMSBase.add_associated_ms1-657"><span class="linenos">657</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_parser</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-658"><a href="#LCMSBase.add_associated_ms1-658"><span class="linenos">658</span></a>                <span class="c1"># Reset the index on _ms_unprocessed[1] to not be scan number</span>
</span><span id="LCMSBase.add_associated_ms1-659"><a href="#LCMSBase.add_associated_ms1-659"><span class="linenos">659</span></a>                <span class="n">ms1_unprocessed</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-660"><a href="#LCMSBase.add_associated_ms1-660"><span class="linenos">660</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms1_unprocessed</span>
</span><span id="LCMSBase.add_associated_ms1-661"><a href="#LCMSBase.add_associated_ms1-661"><span class="linenos">661</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-662"><a href="#LCMSBase.add_associated_ms1-662"><span class="linenos">662</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.add_associated_ms1-663"><a href="#LCMSBase.add_associated_ms1-663"><span class="linenos">663</span></a>                <span class="s2">&quot;Number of scans to average must be 1 or an integer with an integer median (i.e. 3, 5, 7, 9)&quot;</span>
</span><span id="LCMSBase.add_associated_ms1-664"><a href="#LCMSBase.add_associated_ms1-664"><span class="linenos">664</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.add_associated_ms1-665"><a href="#LCMSBase.add_associated_ms1-665"><span class="linenos">665</span></a>
</span><span id="LCMSBase.add_associated_ms1-666"><a href="#LCMSBase.add_associated_ms1-666"><span class="linenos">666</span></a>        <span class="c1"># Associate the ms1 spectra with the mass features</span>
</span><span id="LCMSBase.add_associated_ms1-667"><a href="#LCMSBase.add_associated_ms1-667"><span class="linenos">667</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-668"><a href="#LCMSBase.add_associated_ms1-668"><span class="linenos">668</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">[</span>
</span><span id="LCMSBase.add_associated_ms1-669"><a href="#LCMSBase.add_associated_ms1-669"><span class="linenos">669</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">apex_scan</span>
</span><span id="LCMSBase.add_associated_ms1-670"><a href="#LCMSBase.add_associated_ms1-670"><span class="linenos">670</span></a>            <span class="p">]</span>
</span><span id="LCMSBase.add_associated_ms1-671"><a href="#LCMSBase.add_associated_ms1-671"><span class="linenos">671</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">update_mz</span><span class="p">()</span>
</span><span id="LCMSBase.add_associated_ms1-672"><a href="#LCMSBase.add_associated_ms1-672"><span class="linenos">672</span></a>
</span><span id="LCMSBase.add_associated_ms1-673"><a href="#LCMSBase.add_associated_ms1-673"><span class="linenos">673</span></a>        <span class="c1"># Re-process clustering if persistent homology is selected to remove duplicate mass features after adding and processing MS1 spectra</span>
</span><span id="LCMSBase.add_associated_ms1-674"><a href="#LCMSBase.add_associated_ms1-674"><span class="linenos">674</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">lc_ms</span><span class="o">.</span><span class="n">peak_picking_method</span> <span class="o">==</span> <span class="s2">&quot;persistent homology&quot;</span><span class="p">:</span>
</span><span id="LCMSBase.add_associated_ms1-675"><a href="#LCMSBase.add_associated_ms1-675"><span class="linenos">675</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cluster_mass_features</span><span class="p">(</span><span class="n">drop_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;persistence&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add MS1 spectra associated with mass features to the dataset.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>auto_process</strong> (bool, optional):
If True, auto-processes the MS1 spectra before adding it to the object's _ms dictionary. Default is True.</li>
<li><strong>use_parser</strong> (bool, optional):
If True, envoke the spectra parser to get the MS1 spectra. Default is True.</li>
<li><strong>spectrum_mode</strong> (str or None, optional):
The spectrum mode to use for the mass spectra.  If None, method will use the spectrum mode
from the spectra parser to ascertain the spectrum mode (this allows for mixed types).
Defaults to None. (faster if defined, otherwise will check each scan)</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If mass_features is not set, must run find_mass_features() first.
If apex scans are not profile mode, all apex scans must be profile mode for averaging.
If number of scans to average is not  1 or an integer with an integer median (i.e. 3, 5, 7, 9).
If deconvolute is True and no EICs are found, did you run integrate_mass_features() first?</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.mass_features_to_df" class="classattr">
                                        <input id="LCMSBase.mass_features_to_df-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mass_features_to_df</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.mass_features_to_df-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.mass_features_to_df"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.mass_features_to_df-677"><a href="#LCMSBase.mass_features_to_df-677"><span class="linenos">677</span></a>    <span class="k">def</span> <span class="nf">mass_features_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase.mass_features_to_df-678"><a href="#LCMSBase.mass_features_to_df-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the mass features.</span>
</span><span id="LCMSBase.mass_features_to_df-679"><a href="#LCMSBase.mass_features_to_df-679"><span class="linenos">679</span></a>
</span><span id="LCMSBase.mass_features_to_df-680"><a href="#LCMSBase.mass_features_to_df-680"><span class="linenos">680</span></a><span class="sd">        The dataframe contains the following columns: mf_id, mz, apex_scan, scan_time, intensity,</span>
</span><span id="LCMSBase.mass_features_to_df-681"><a href="#LCMSBase.mass_features_to_df-681"><span class="linenos">681</span></a><span class="sd">        persistence, area, monoisotopic_mf_id, and isotopologue_type.  The index is set to mf_id (mass feature ID).</span>
</span><span id="LCMSBase.mass_features_to_df-682"><a href="#LCMSBase.mass_features_to_df-682"><span class="linenos">682</span></a>
</span><span id="LCMSBase.mass_features_to_df-683"><a href="#LCMSBase.mass_features_to_df-683"><span class="linenos">683</span></a>
</span><span id="LCMSBase.mass_features_to_df-684"><a href="#LCMSBase.mass_features_to_df-684"><span class="linenos">684</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase.mass_features_to_df-685"><a href="#LCMSBase.mass_features_to_df-685"><span class="linenos">685</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase.mass_features_to_df-686"><a href="#LCMSBase.mass_features_to_df-686"><span class="linenos">686</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="LCMSBase.mass_features_to_df-687"><a href="#LCMSBase.mass_features_to_df-687"><span class="linenos">687</span></a><span class="sd">            A pandas dataframe of mass features with the following columns:</span>
</span><span id="LCMSBase.mass_features_to_df-688"><a href="#LCMSBase.mass_features_to_df-688"><span class="linenos">688</span></a><span class="sd">            mf_id, mz, apex_scan, scan_time, intensity, persistence, area.</span>
</span><span id="LCMSBase.mass_features_to_df-689"><a href="#LCMSBase.mass_features_to_df-689"><span class="linenos">689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.mass_features_to_df-690"><a href="#LCMSBase.mass_features_to_df-690"><span class="linenos">690</span></a>
</span><span id="LCMSBase.mass_features_to_df-691"><a href="#LCMSBase.mass_features_to_df-691"><span class="linenos">691</span></a>        <span class="k">def</span> <span class="nf">mass_spectrum_to_string</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_to_df-692"><a href="#LCMSBase.mass_features_to_df-692"><span class="linenos">692</span></a>            <span class="n">mass_spec</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_normalized_abun</span><span class="o">=</span><span class="mf">0.01</span>
</span><span id="LCMSBase.mass_features_to_df-693"><a href="#LCMSBase.mass_features_to_df-693"><span class="linenos">693</span></a>        <span class="p">):</span>
</span><span id="LCMSBase.mass_features_to_df-694"><a href="#LCMSBase.mass_features_to_df-694"><span class="linenos">694</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Converts a mass spectrum to a string of m/z:abundance pairs.</span>
</span><span id="LCMSBase.mass_features_to_df-695"><a href="#LCMSBase.mass_features_to_df-695"><span class="linenos">695</span></a>
</span><span id="LCMSBase.mass_features_to_df-696"><a href="#LCMSBase.mass_features_to_df-696"><span class="linenos">696</span></a><span class="sd">            Parameters</span>
</span><span id="LCMSBase.mass_features_to_df-697"><a href="#LCMSBase.mass_features_to_df-697"><span class="linenos">697</span></a><span class="sd">            -----------</span>
</span><span id="LCMSBase.mass_features_to_df-698"><a href="#LCMSBase.mass_features_to_df-698"><span class="linenos">698</span></a><span class="sd">            mass_spec : MassSpectrum</span>
</span><span id="LCMSBase.mass_features_to_df-699"><a href="#LCMSBase.mass_features_to_df-699"><span class="linenos">699</span></a><span class="sd">                A MassSpectrum object to be converted to a string.</span>
</span><span id="LCMSBase.mass_features_to_df-700"><a href="#LCMSBase.mass_features_to_df-700"><span class="linenos">700</span></a><span class="sd">            normalize : bool, optional</span>
</span><span id="LCMSBase.mass_features_to_df-701"><a href="#LCMSBase.mass_features_to_df-701"><span class="linenos">701</span></a><span class="sd">                If True, normalizes the abundance values to a maximum of 1. Defaults to True.</span>
</span><span id="LCMSBase.mass_features_to_df-702"><a href="#LCMSBase.mass_features_to_df-702"><span class="linenos">702</span></a><span class="sd">            min_normalized_abun : float, optional</span>
</span><span id="LCMSBase.mass_features_to_df-703"><a href="#LCMSBase.mass_features_to_df-703"><span class="linenos">703</span></a><span class="sd">                The minimum normalized abundance value to include in the string, only used if normalize is True. Defaults to 0.01.</span>
</span><span id="LCMSBase.mass_features_to_df-704"><a href="#LCMSBase.mass_features_to_df-704"><span class="linenos">704</span></a>
</span><span id="LCMSBase.mass_features_to_df-705"><a href="#LCMSBase.mass_features_to_df-705"><span class="linenos">705</span></a><span class="sd">            Returns</span>
</span><span id="LCMSBase.mass_features_to_df-706"><a href="#LCMSBase.mass_features_to_df-706"><span class="linenos">706</span></a><span class="sd">            --------</span>
</span><span id="LCMSBase.mass_features_to_df-707"><a href="#LCMSBase.mass_features_to_df-707"><span class="linenos">707</span></a><span class="sd">            str</span>
</span><span id="LCMSBase.mass_features_to_df-708"><a href="#LCMSBase.mass_features_to_df-708"><span class="linenos">708</span></a><span class="sd">                A string of m/z:abundance pairs from the mass spectrum, separated by a semicolon.</span>
</span><span id="LCMSBase.mass_features_to_df-709"><a href="#LCMSBase.mass_features_to_df-709"><span class="linenos">709</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="LCMSBase.mass_features_to_df-710"><a href="#LCMSBase.mass_features_to_df-710"><span class="linenos">710</span></a>            <span class="n">mz_np</span> <span class="o">=</span> <span class="n">mass_spec</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s2">&quot;m/z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LCMSBase.mass_features_to_df-711"><a href="#LCMSBase.mass_features_to_df-711"><span class="linenos">711</span></a>            <span class="n">abun_np</span> <span class="o">=</span> <span class="n">mass_spec</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[</span><span class="s2">&quot;Peak Height&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LCMSBase.mass_features_to_df-712"><a href="#LCMSBase.mass_features_to_df-712"><span class="linenos">712</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_to_df-713"><a href="#LCMSBase.mass_features_to_df-713"><span class="linenos">713</span></a>                <span class="n">abun_np</span> <span class="o">=</span> <span class="n">abun_np</span> <span class="o">/</span> <span class="n">abun_np</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_to_df-714"><a href="#LCMSBase.mass_features_to_df-714"><span class="linenos">714</span></a>            <span class="n">mz_abun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">mz_np</span><span class="p">,</span> <span class="n">abun_np</span><span class="p">))</span>
</span><span id="LCMSBase.mass_features_to_df-715"><a href="#LCMSBase.mass_features_to_df-715"><span class="linenos">715</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_to_df-716"><a href="#LCMSBase.mass_features_to_df-716"><span class="linenos">716</span></a>                <span class="n">mz_abun</span> <span class="o">=</span> <span class="n">mz_abun</span><span class="p">[</span><span class="n">mz_abun</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_normalized_abun</span><span class="p">]</span>
</span><span id="LCMSBase.mass_features_to_df-717"><a href="#LCMSBase.mass_features_to_df-717"><span class="linenos">717</span></a>            <span class="n">mz_abun_str</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase.mass_features_to_df-718"><a href="#LCMSBase.mass_features_to_df-718"><span class="linenos">718</span></a>                <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">abun</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span><span id="LCMSBase.mass_features_to_df-719"><a href="#LCMSBase.mass_features_to_df-719"><span class="linenos">719</span></a>                <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">abun</span> <span class="ow">in</span> <span class="n">mz_abun</span>
</span><span id="LCMSBase.mass_features_to_df-720"><a href="#LCMSBase.mass_features_to_df-720"><span class="linenos">720</span></a>            <span class="p">]</span>
</span><span id="LCMSBase.mass_features_to_df-721"><a href="#LCMSBase.mass_features_to_df-721"><span class="linenos">721</span></a>            <span class="k">return</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mz_abun_str</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-722"><a href="#LCMSBase.mass_features_to_df-722"><span class="linenos">722</span></a>
</span><span id="LCMSBase.mass_features_to_df-723"><a href="#LCMSBase.mass_features_to_df-723"><span class="linenos">723</span></a>        <span class="n">cols_in_df</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase.mass_features_to_df-724"><a href="#LCMSBase.mass_features_to_df-724"><span class="linenos">724</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-725"><a href="#LCMSBase.mass_features_to_df-725"><span class="linenos">725</span></a>            <span class="s2">&quot;_apex_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-726"><a href="#LCMSBase.mass_features_to_df-726"><span class="linenos">726</span></a>            <span class="s2">&quot;start_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-727"><a href="#LCMSBase.mass_features_to_df-727"><span class="linenos">727</span></a>            <span class="s2">&quot;final_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-728"><a href="#LCMSBase.mass_features_to_df-728"><span class="linenos">728</span></a>            <span class="s2">&quot;_retention_time&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-729"><a href="#LCMSBase.mass_features_to_df-729"><span class="linenos">729</span></a>            <span class="s2">&quot;_intensity&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-730"><a href="#LCMSBase.mass_features_to_df-730"><span class="linenos">730</span></a>            <span class="s2">&quot;_persistence&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-731"><a href="#LCMSBase.mass_features_to_df-731"><span class="linenos">731</span></a>            <span class="s2">&quot;_area&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-732"><a href="#LCMSBase.mass_features_to_df-732"><span class="linenos">732</span></a>            <span class="s2">&quot;_dispersity_index&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-733"><a href="#LCMSBase.mass_features_to_df-733"><span class="linenos">733</span></a>            <span class="s2">&quot;_tailing_factor&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-734"><a href="#LCMSBase.mass_features_to_df-734"><span class="linenos">734</span></a>            <span class="s2">&quot;monoisotopic_mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-735"><a href="#LCMSBase.mass_features_to_df-735"><span class="linenos">735</span></a>            <span class="s2">&quot;isotopologue_type&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-736"><a href="#LCMSBase.mass_features_to_df-736"><span class="linenos">736</span></a>            <span class="s2">&quot;mass_spectrum_deconvoluted_parent&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-737"><a href="#LCMSBase.mass_features_to_df-737"><span class="linenos">737</span></a>        <span class="p">]</span>
</span><span id="LCMSBase.mass_features_to_df-738"><a href="#LCMSBase.mass_features_to_df-738"><span class="linenos">738</span></a>        <span class="n">df_mf_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.mass_features_to_df-739"><a href="#LCMSBase.mass_features_to_df-739"><span class="linenos">739</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase.mass_features_to_df-740"><a href="#LCMSBase.mass_features_to_df-740"><span class="linenos">740</span></a>            <span class="c1"># Find cols_in_df that are in single_mf</span>
</span><span id="LCMSBase.mass_features_to_df-741"><a href="#LCMSBase.mass_features_to_df-741"><span class="linenos">741</span></a>            <span class="n">df_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_to_df-742"><a href="#LCMSBase.mass_features_to_df-742"><span class="linenos">742</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">cols_in_df</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">())</span>
</span><span id="LCMSBase.mass_features_to_df-743"><a href="#LCMSBase.mass_features_to_df-743"><span class="linenos">743</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-744"><a href="#LCMSBase.mass_features_to_df-744"><span class="linenos">744</span></a>            <span class="n">dict_mf</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LCMSBase.mass_features_to_df-745"><a href="#LCMSBase.mass_features_to_df-745"><span class="linenos">745</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">df_keys</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_to_df-746"><a href="#LCMSBase.mass_features_to_df-746"><span class="linenos">746</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-747"><a href="#LCMSBase.mass_features_to_df-747"><span class="linenos">747</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_scan_numbers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_to_df-748"><a href="#LCMSBase.mass_features_to_df-748"><span class="linenos">748</span></a>                <span class="c1"># Add MS2 spectra info</span>
</span><span id="LCMSBase.mass_features_to_df-749"><a href="#LCMSBase.mass_features_to_df-749"><span class="linenos">749</span></a>                <span class="n">best_ms2_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">best_ms2</span>
</span><span id="LCMSBase.mass_features_to_df-750"><a href="#LCMSBase.mass_features_to_df-750"><span class="linenos">750</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;ms2_spectrum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_spectrum_to_string</span><span class="p">(</span><span class="n">best_ms2_spectrum</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-751"><a href="#LCMSBase.mass_features_to_df-751"><span class="linenos">751</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">associated_mass_features_deconvoluted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_to_df-752"><a href="#LCMSBase.mass_features_to_df-752"><span class="linenos">752</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;associated_mass_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_to_df-753"><a href="#LCMSBase.mass_features_to_df-753"><span class="linenos">753</span></a>                    <span class="nb">map</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_to_df-754"><a href="#LCMSBase.mass_features_to_df-754"><span class="linenos">754</span></a>                        <span class="nb">str</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-755"><a href="#LCMSBase.mass_features_to_df-755"><span class="linenos">755</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">associated_mass_features_deconvoluted</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-756"><a href="#LCMSBase.mass_features_to_df-756"><span class="linenos">756</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-757"><a href="#LCMSBase.mass_features_to_df-757"><span class="linenos">757</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-758"><a href="#LCMSBase.mass_features_to_df-758"><span class="linenos">758</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">_half_height_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_to_df-759"><a href="#LCMSBase.mass_features_to_df-759"><span class="linenos">759</span></a>                <span class="n">dict_mf</span><span class="p">[</span><span class="s2">&quot;half_height_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span>
</span><span id="LCMSBase.mass_features_to_df-760"><a href="#LCMSBase.mass_features_to_df-760"><span class="linenos">760</span></a>                    <span class="n">mf_id</span>
</span><span id="LCMSBase.mass_features_to_df-761"><a href="#LCMSBase.mass_features_to_df-761"><span class="linenos">761</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">half_height_width</span>
</span><span id="LCMSBase.mass_features_to_df-762"><a href="#LCMSBase.mass_features_to_df-762"><span class="linenos">762</span></a>            <span class="c1"># Check if EIC for mass feature is set</span>
</span><span id="LCMSBase.mass_features_to_df-763"><a href="#LCMSBase.mass_features_to_df-763"><span class="linenos">763</span></a>            <span class="n">df_mf_single</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_mf</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">mf_id</span><span class="p">])</span>
</span><span id="LCMSBase.mass_features_to_df-764"><a href="#LCMSBase.mass_features_to_df-764"><span class="linenos">764</span></a>            <span class="n">df_mf_single</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mz</span>
</span><span id="LCMSBase.mass_features_to_df-765"><a href="#LCMSBase.mass_features_to_df-765"><span class="linenos">765</span></a>            <span class="n">df_mf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_mf_single</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-766"><a href="#LCMSBase.mass_features_to_df-766"><span class="linenos">766</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_mf_list</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-767"><a href="#LCMSBase.mass_features_to_df-767"><span class="linenos">767</span></a>
</span><span id="LCMSBase.mass_features_to_df-768"><a href="#LCMSBase.mass_features_to_df-768"><span class="linenos">768</span></a>        <span class="c1"># rename _area to area and id to mf_id</span>
</span><span id="LCMSBase.mass_features_to_df-769"><a href="#LCMSBase.mass_features_to_df-769"><span class="linenos">769</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_to_df-770"><a href="#LCMSBase.mass_features_to_df-770"><span class="linenos">770</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="LCMSBase.mass_features_to_df-771"><a href="#LCMSBase.mass_features_to_df-771"><span class="linenos">771</span></a>                <span class="s2">&quot;_area&quot;</span><span class="p">:</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-772"><a href="#LCMSBase.mass_features_to_df-772"><span class="linenos">772</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-773"><a href="#LCMSBase.mass_features_to_df-773"><span class="linenos">773</span></a>                <span class="s2">&quot;_apex_scan&quot;</span><span class="p">:</span> <span class="s2">&quot;apex_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-774"><a href="#LCMSBase.mass_features_to_df-774"><span class="linenos">774</span></a>                <span class="s2">&quot;_retention_time&quot;</span><span class="p">:</span> <span class="s2">&quot;scan_time&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-775"><a href="#LCMSBase.mass_features_to_df-775"><span class="linenos">775</span></a>                <span class="s2">&quot;_intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-776"><a href="#LCMSBase.mass_features_to_df-776"><span class="linenos">776</span></a>                <span class="s2">&quot;_persistence&quot;</span><span class="p">:</span> <span class="s2">&quot;persistence&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-777"><a href="#LCMSBase.mass_features_to_df-777"><span class="linenos">777</span></a>                <span class="s2">&quot;_dispersity_index&quot;</span><span class="p">:</span> <span class="s2">&quot;dispersity_index&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-778"><a href="#LCMSBase.mass_features_to_df-778"><span class="linenos">778</span></a>                <span class="s2">&quot;_tailing_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;tailing_factor&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-779"><a href="#LCMSBase.mass_features_to_df-779"><span class="linenos">779</span></a>            <span class="p">}</span>
</span><span id="LCMSBase.mass_features_to_df-780"><a href="#LCMSBase.mass_features_to_df-780"><span class="linenos">780</span></a>        <span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-781"><a href="#LCMSBase.mass_features_to_df-781"><span class="linenos">781</span></a>
</span><span id="LCMSBase.mass_features_to_df-782"><a href="#LCMSBase.mass_features_to_df-782"><span class="linenos">782</span></a>        <span class="c1"># reorder columns</span>
</span><span id="LCMSBase.mass_features_to_df-783"><a href="#LCMSBase.mass_features_to_df-783"><span class="linenos">783</span></a>        <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LCMSBase.mass_features_to_df-784"><a href="#LCMSBase.mass_features_to_df-784"><span class="linenos">784</span></a>            <span class="s2">&quot;mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-785"><a href="#LCMSBase.mass_features_to_df-785"><span class="linenos">785</span></a>            <span class="s2">&quot;scan_time&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-786"><a href="#LCMSBase.mass_features_to_df-786"><span class="linenos">786</span></a>            <span class="s2">&quot;mz&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-787"><a href="#LCMSBase.mass_features_to_df-787"><span class="linenos">787</span></a>            <span class="s2">&quot;apex_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-788"><a href="#LCMSBase.mass_features_to_df-788"><span class="linenos">788</span></a>            <span class="s2">&quot;start_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-789"><a href="#LCMSBase.mass_features_to_df-789"><span class="linenos">789</span></a>            <span class="s2">&quot;final_scan&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-790"><a href="#LCMSBase.mass_features_to_df-790"><span class="linenos">790</span></a>            <span class="s2">&quot;intensity&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-791"><a href="#LCMSBase.mass_features_to_df-791"><span class="linenos">791</span></a>            <span class="s2">&quot;persistence&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-792"><a href="#LCMSBase.mass_features_to_df-792"><span class="linenos">792</span></a>            <span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-793"><a href="#LCMSBase.mass_features_to_df-793"><span class="linenos">793</span></a>            <span class="s2">&quot;half_height_width&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-794"><a href="#LCMSBase.mass_features_to_df-794"><span class="linenos">794</span></a>            <span class="s2">&quot;tailing_factor&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-795"><a href="#LCMSBase.mass_features_to_df-795"><span class="linenos">795</span></a>            <span class="s2">&quot;dispersity_index&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-796"><a href="#LCMSBase.mass_features_to_df-796"><span class="linenos">796</span></a>            <span class="s2">&quot;monoisotopic_mf_id&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-797"><a href="#LCMSBase.mass_features_to_df-797"><span class="linenos">797</span></a>            <span class="s2">&quot;isotopologue_type&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-798"><a href="#LCMSBase.mass_features_to_df-798"><span class="linenos">798</span></a>            <span class="s2">&quot;mass_spectrum_deconvoluted_parent&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-799"><a href="#LCMSBase.mass_features_to_df-799"><span class="linenos">799</span></a>            <span class="s2">&quot;associated_mass_features&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-800"><a href="#LCMSBase.mass_features_to_df-800"><span class="linenos">800</span></a>            <span class="s2">&quot;ms2_spectrum&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_to_df-801"><a href="#LCMSBase.mass_features_to_df-801"><span class="linenos">801</span></a>        <span class="p">]</span>
</span><span id="LCMSBase.mass_features_to_df-802"><a href="#LCMSBase.mass_features_to_df-802"><span class="linenos">802</span></a>        <span class="c1"># drop columns that are not in col_order</span>
</span><span id="LCMSBase.mass_features_to_df-803"><a href="#LCMSBase.mass_features_to_df-803"><span class="linenos">803</span></a>        <span class="n">cols_to_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_order</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="LCMSBase.mass_features_to_df-804"><a href="#LCMSBase.mass_features_to_df-804"><span class="linenos">804</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="p">[</span><span class="n">cols_to_order</span><span class="p">]</span>
</span><span id="LCMSBase.mass_features_to_df-805"><a href="#LCMSBase.mass_features_to_df-805"><span class="linenos">805</span></a>
</span><span id="LCMSBase.mass_features_to_df-806"><a href="#LCMSBase.mass_features_to_df-806"><span class="linenos">806</span></a>        <span class="c1"># reset index to mf_id</span>
</span><span id="LCMSBase.mass_features_to_df-807"><a href="#LCMSBase.mass_features_to_df-807"><span class="linenos">807</span></a>        <span class="n">df_mf</span> <span class="o">=</span> <span class="n">df_mf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_to_df-808"><a href="#LCMSBase.mass_features_to_df-808"><span class="linenos">808</span></a>        <span class="n">df_mf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="LCMSBase.mass_features_to_df-809"><a href="#LCMSBase.mass_features_to_df-809"><span class="linenos">809</span></a>
</span><span id="LCMSBase.mass_features_to_df-810"><a href="#LCMSBase.mass_features_to_df-810"><span class="linenos">810</span></a>        <span class="k">return</span> <span class="n">df_mf</span>
</span></pre></div>


            <div class="docstring"><p>Returns a pandas dataframe summarizing the mass features.</p>

<p>The dataframe contains the following columns: mf_id, mz, apex_scan, scan_time, intensity,
persistence, area, monoisotopic_mf_id, and isotopologue_type.  The index is set to mf_id (mass feature ID).</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: A pandas dataframe of mass features with the following columns:
mf_id, mz, apex_scan, scan_time, intensity, persistence, area.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.mass_features_ms1_annot_to_df" class="classattr">
                                        <input id="LCMSBase.mass_features_ms1_annot_to_df-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mass_features_ms1_annot_to_df</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.mass_features_ms1_annot_to_df-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.mass_features_ms1_annot_to_df"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.mass_features_ms1_annot_to_df-812"><a href="#LCMSBase.mass_features_ms1_annot_to_df-812"><span class="linenos">812</span></a>    <span class="k">def</span> <span class="nf">mass_features_ms1_annot_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-813"><a href="#LCMSBase.mass_features_ms1_annot_to_df-813"><span class="linenos">813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the MS1 annotations for the mass features in the dataset.</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-814"><a href="#LCMSBase.mass_features_ms1_annot_to_df-814"><span class="linenos">814</span></a>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-815"><a href="#LCMSBase.mass_features_ms1_annot_to_df-815"><span class="linenos">815</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-816"><a href="#LCMSBase.mass_features_ms1_annot_to_df-816"><span class="linenos">816</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-817"><a href="#LCMSBase.mass_features_ms1_annot_to_df-817"><span class="linenos">817</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-818"><a href="#LCMSBase.mass_features_ms1_annot_to_df-818"><span class="linenos">818</span></a><span class="sd">            A pandas dataframe of MS1 annotations for the mass features in the dataset.</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-819"><a href="#LCMSBase.mass_features_ms1_annot_to_df-819"><span class="linenos">819</span></a><span class="sd">            The index is set to mf_id (mass feature ID)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-820"><a href="#LCMSBase.mass_features_ms1_annot_to_df-820"><span class="linenos">820</span></a>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-821"><a href="#LCMSBase.mass_features_ms1_annot_to_df-821"><span class="linenos">821</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-822"><a href="#LCMSBase.mass_features_ms1_annot_to_df-822"><span class="linenos">822</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-823"><a href="#LCMSBase.mass_features_ms1_annot_to_df-823"><span class="linenos">823</span></a><span class="sd">        Warning</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-824"><a href="#LCMSBase.mass_features_ms1_annot_to_df-824"><span class="linenos">824</span></a><span class="sd">            If no MS1 annotations were found for the mass features in the dataset.</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-825"><a href="#LCMSBase.mass_features_ms1_annot_to_df-825"><span class="linenos">825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-826"><a href="#LCMSBase.mass_features_ms1_annot_to_df-826"><span class="linenos">826</span></a>        <span class="n">annot_df_list_ms1</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-827"><a href="#LCMSBase.mass_features_ms1_annot_to_df-827"><span class="linenos">827</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-828"><a href="#LCMSBase.mass_features_ms1_annot_to_df-828"><span class="linenos">828</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-829"><a href="#LCMSBase.mass_features_ms1_annot_to_df-829"><span class="linenos">829</span></a>                <span class="k">pass</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-830"><a href="#LCMSBase.mass_features_ms1_annot_to_df-830"><span class="linenos">830</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-831"><a href="#LCMSBase.mass_features_ms1_annot_to_df-831"><span class="linenos">831</span></a>                <span class="c1"># Add ms1 annotations to ms1 annotation list</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-832"><a href="#LCMSBase.mass_features_ms1_annot_to_df-832"><span class="linenos">832</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-833"><a href="#LCMSBase.mass_features_ms1_annot_to_df-833"><span class="linenos">833</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-834"><a href="#LCMSBase.mass_features_ms1_annot_to_df-834"><span class="linenos">834</span></a>                        <span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-835"><a href="#LCMSBase.mass_features_ms1_annot_to_df-835"><span class="linenos">835</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms1_peak</span><span class="o">.</span><span class="n">mz_exp</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-836"><a href="#LCMSBase.mass_features_ms1_annot_to_df-836"><span class="linenos">836</span></a>                            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mz</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-837"><a href="#LCMSBase.mass_features_ms1_annot_to_df-837"><span class="linenos">837</span></a>                        <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-838"><a href="#LCMSBase.mass_features_ms1_annot_to_df-838"><span class="linenos">838</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-839"><a href="#LCMSBase.mass_features_ms1_annot_to_df-839"><span class="linenos">839</span></a>                    <span class="o">&lt;</span> <span class="mf">0.01</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-840"><a href="#LCMSBase.mass_features_ms1_annot_to_df-840"><span class="linenos">840</span></a>                <span class="p">):</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-841"><a href="#LCMSBase.mass_features_ms1_annot_to_df-841"><span class="linenos">841</span></a>                    <span class="c1"># Get the molecular formula from the mass spectrum</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-842"><a href="#LCMSBase.mass_features_ms1_annot_to_df-842"><span class="linenos">842</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">mass_spectrum</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-843"><a href="#LCMSBase.mass_features_ms1_annot_to_df-843"><span class="linenos">843</span></a>                    <span class="c1"># Subset to pull out only the peak associated with the mass feature</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-844"><a href="#LCMSBase.mass_features_ms1_annot_to_df-844"><span class="linenos">844</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="n">annot_df</span><span class="p">[</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-845"><a href="#LCMSBase.mass_features_ms1_annot_to_df-845"><span class="linenos">845</span></a>                        <span class="n">annot_df</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms1_peak</span><span class="o">.</span><span class="n">index</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-846"><a href="#LCMSBase.mass_features_ms1_annot_to_df-846"><span class="linenos">846</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-847"><a href="#LCMSBase.mass_features_ms1_annot_to_df-847"><span class="linenos">847</span></a>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-848"><a href="#LCMSBase.mass_features_ms1_annot_to_df-848"><span class="linenos">848</span></a>                    <span class="c1"># Remove the index column and add column for mf_id</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-849"><a href="#LCMSBase.mass_features_ms1_annot_to_df-849"><span class="linenos">849</span></a>                    <span class="n">annot_df</span> <span class="o">=</span> <span class="n">annot_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-850"><a href="#LCMSBase.mass_features_ms1_annot_to_df-850"><span class="linenos">850</span></a>                    <span class="n">annot_df</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf_id</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-851"><a href="#LCMSBase.mass_features_ms1_annot_to_df-851"><span class="linenos">851</span></a>                    <span class="n">annot_df_list_ms1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot_df</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-852"><a href="#LCMSBase.mass_features_ms1_annot_to_df-852"><span class="linenos">852</span></a>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-853"><a href="#LCMSBase.mass_features_ms1_annot_to_df-853"><span class="linenos">853</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_df_list_ms1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-854"><a href="#LCMSBase.mass_features_ms1_annot_to_df-854"><span class="linenos">854</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">annot_df_list_ms1</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-855"><a href="#LCMSBase.mass_features_ms1_annot_to_df-855"><span class="linenos">855</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="n">annot_ms1_df_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-856"><a href="#LCMSBase.mass_features_ms1_annot_to_df-856"><span class="linenos">856</span></a>            <span class="n">annot_ms1_df_full</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-857"><a href="#LCMSBase.mass_features_ms1_annot_to_df-857"><span class="linenos">857</span></a>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-858"><a href="#LCMSBase.mass_features_ms1_annot_to_df-858"><span class="linenos">858</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-859"><a href="#LCMSBase.mass_features_ms1_annot_to_df-859"><span class="linenos">859</span></a>            <span class="n">annot_ms1_df_full</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-860"><a href="#LCMSBase.mass_features_ms1_annot_to_df-860"><span class="linenos">860</span></a>            <span class="c1"># Warn that no ms1 annotations were found</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-861"><a href="#LCMSBase.mass_features_ms1_annot_to_df-861"><span class="linenos">861</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-862"><a href="#LCMSBase.mass_features_ms1_annot_to_df-862"><span class="linenos">862</span></a>                <span class="s2">&quot;No MS1 annotations found for mass features in dataset, were MS1 spectra added and processed within the dataset?&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-863"><a href="#LCMSBase.mass_features_ms1_annot_to_df-863"><span class="linenos">863</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-864"><a href="#LCMSBase.mass_features_ms1_annot_to_df-864"><span class="linenos">864</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-865"><a href="#LCMSBase.mass_features_ms1_annot_to_df-865"><span class="linenos">865</span></a>
</span><span id="LCMSBase.mass_features_ms1_annot_to_df-866"><a href="#LCMSBase.mass_features_ms1_annot_to_df-866"><span class="linenos">866</span></a>        <span class="k">return</span> <span class="n">annot_ms1_df_full</span>
</span></pre></div>


            <div class="docstring"><p>Returns a pandas dataframe summarizing the MS1 annotations for the mass features in the dataset.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: A pandas dataframe of MS1 annotations for the mass features in the dataset.
The index is set to mf_id (mass feature ID)</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Warning</strong>: If no MS1 annotations were found for the mass features in the dataset.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.mass_features_ms2_annot_to_df" class="classattr">
                                        <input id="LCMSBase.mass_features_ms2_annot_to_df-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mass_features_ms2_annot_to_df</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">molecular_metadata</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.mass_features_ms2_annot_to_df-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.mass_features_ms2_annot_to_df"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.mass_features_ms2_annot_to_df-868"><a href="#LCMSBase.mass_features_ms2_annot_to_df-868"><span class="linenos">868</span></a>    <span class="k">def</span> <span class="nf">mass_features_ms2_annot_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecular_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-869"><a href="#LCMSBase.mass_features_ms2_annot_to_df-869"><span class="linenos">869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas dataframe summarizing the MS2 annotations for the mass features in the dataset.</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-870"><a href="#LCMSBase.mass_features_ms2_annot_to_df-870"><span class="linenos">870</span></a>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-871"><a href="#LCMSBase.mass_features_ms2_annot_to_df-871"><span class="linenos">871</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-872"><a href="#LCMSBase.mass_features_ms2_annot_to_df-872"><span class="linenos">872</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-873"><a href="#LCMSBase.mass_features_ms2_annot_to_df-873"><span class="linenos">873</span></a><span class="sd">        molecular_metadata :  dict of MolecularMetadata objects</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-874"><a href="#LCMSBase.mass_features_ms2_annot_to_df-874"><span class="linenos">874</span></a><span class="sd">            A dictionary of MolecularMetadata objects, keyed by metabref_mol_id.  Defaults to None.</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-875"><a href="#LCMSBase.mass_features_ms2_annot_to_df-875"><span class="linenos">875</span></a>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-876"><a href="#LCMSBase.mass_features_ms2_annot_to_df-876"><span class="linenos">876</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-877"><a href="#LCMSBase.mass_features_ms2_annot_to_df-877"><span class="linenos">877</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-878"><a href="#LCMSBase.mass_features_ms2_annot_to_df-878"><span class="linenos">878</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-879"><a href="#LCMSBase.mass_features_ms2_annot_to_df-879"><span class="linenos">879</span></a><span class="sd">            A pandas dataframe of MS2 annotations for the mass features in the dataset,</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-880"><a href="#LCMSBase.mass_features_ms2_annot_to_df-880"><span class="linenos">880</span></a><span class="sd">            and optionally molecular metadata. The index is set to mf_id (mass feature ID)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-881"><a href="#LCMSBase.mass_features_ms2_annot_to_df-881"><span class="linenos">881</span></a>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-882"><a href="#LCMSBase.mass_features_ms2_annot_to_df-882"><span class="linenos">882</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-883"><a href="#LCMSBase.mass_features_ms2_annot_to_df-883"><span class="linenos">883</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-884"><a href="#LCMSBase.mass_features_ms2_annot_to_df-884"><span class="linenos">884</span></a><span class="sd">        Warning</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-885"><a href="#LCMSBase.mass_features_ms2_annot_to_df-885"><span class="linenos">885</span></a><span class="sd">            If no MS2 annotations were found for the mass features in the dataset.</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-886"><a href="#LCMSBase.mass_features_ms2_annot_to_df-886"><span class="linenos">886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-887"><a href="#LCMSBase.mass_features_ms2_annot_to_df-887"><span class="linenos">887</span></a>        <span class="n">annot_df_list_ms2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-888"><a href="#LCMSBase.mass_features_ms2_annot_to_df-888"><span class="linenos">888</span></a>        <span class="k">for</span> <span class="n">mf_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-889"><a href="#LCMSBase.mass_features_ms2_annot_to_df-889"><span class="linenos">889</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_similarity_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-890"><a href="#LCMSBase.mass_features_ms2_annot_to_df-890"><span class="linenos">890</span></a>                <span class="c1"># Add ms2 annotations to ms2 annotation list</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-891"><a href="#LCMSBase.mass_features_ms2_annot_to_df-891"><span class="linenos">891</span></a>                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span><span class="p">[</span><span class="n">mf_id</span><span class="p">]</span><span class="o">.</span><span class="n">ms2_similarity_results</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-892"><a href="#LCMSBase.mass_features_ms2_annot_to_df-892"><span class="linenos">892</span></a>                    <span class="n">annot_df_ms2</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-893"><a href="#LCMSBase.mass_features_ms2_annot_to_df-893"><span class="linenos">893</span></a>                    <span class="n">annot_df_ms2</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf_id</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-894"><a href="#LCMSBase.mass_features_ms2_annot_to_df-894"><span class="linenos">894</span></a>                    <span class="n">annot_df_list_ms2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annot_df_ms2</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-895"><a href="#LCMSBase.mass_features_ms2_annot_to_df-895"><span class="linenos">895</span></a>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-896"><a href="#LCMSBase.mass_features_ms2_annot_to_df-896"><span class="linenos">896</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">annot_df_list_ms2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-897"><a href="#LCMSBase.mass_features_ms2_annot_to_df-897"><span class="linenos">897</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">annot_df_list_ms2</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-898"><a href="#LCMSBase.mass_features_ms2_annot_to_df-898"><span class="linenos">898</span></a>            <span class="k">if</span> <span class="n">molecular_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-899"><a href="#LCMSBase.mass_features_ms2_annot_to_df-899"><span class="linenos">899</span></a>                <span class="n">molecular_metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-900"><a href="#LCMSBase.mass_features_ms2_annot_to_df-900"><span class="linenos">900</span></a>                    <span class="p">[</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-901"><a href="#LCMSBase.mass_features_ms2_annot_to_df-901"><span class="linenos">901</span></a>                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-902"><a href="#LCMSBase.mass_features_ms2_annot_to_df-902"><span class="linenos">902</span></a>                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">molecular_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-903"><a href="#LCMSBase.mass_features_ms2_annot_to_df-903"><span class="linenos">903</span></a>                    <span class="p">],</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-904"><a href="#LCMSBase.mass_features_ms2_annot_to_df-904"><span class="linenos">904</span></a>                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-905"><a href="#LCMSBase.mass_features_ms2_annot_to_df-905"><span class="linenos">905</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-906"><a href="#LCMSBase.mass_features_ms2_annot_to_df-906"><span class="linenos">906</span></a>                <span class="n">molecular_metadata_df</span> <span class="o">=</span> <span class="n">molecular_metadata_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-907"><a href="#LCMSBase.mass_features_ms2_annot_to_df-907"><span class="linenos">907</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;ref_mol_id&quot;</span><span class="p">}</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-908"><a href="#LCMSBase.mass_features_ms2_annot_to_df-908"><span class="linenos">908</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-909"><a href="#LCMSBase.mass_features_ms2_annot_to_df-909"><span class="linenos">909</span></a>                <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-910"><a href="#LCMSBase.mass_features_ms2_annot_to_df-910"><span class="linenos">910</span></a>                    <span class="n">molecular_metadata_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;ref_mol_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-911"><a href="#LCMSBase.mass_features_ms2_annot_to_df-911"><span class="linenos">911</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-912"><a href="#LCMSBase.mass_features_ms2_annot_to_df-912"><span class="linenos">912</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-913"><a href="#LCMSBase.mass_features_ms2_annot_to_df-913"><span class="linenos">913</span></a>                <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mf_id&quot;</span><span class="p">,</span> <span class="s2">&quot;query_spectrum_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_ms_id&quot;</span><span class="p">]</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-914"><a href="#LCMSBase.mass_features_ms2_annot_to_df-914"><span class="linenos">914</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-915"><a href="#LCMSBase.mass_features_ms2_annot_to_df-915"><span class="linenos">915</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;mf_id&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-916"><a href="#LCMSBase.mass_features_ms2_annot_to_df-916"><span class="linenos">916</span></a>            <span class="n">annot_ms2_df_full</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mf_id&quot;</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-917"><a href="#LCMSBase.mass_features_ms2_annot_to_df-917"><span class="linenos">917</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-918"><a href="#LCMSBase.mass_features_ms2_annot_to_df-918"><span class="linenos">918</span></a>            <span class="n">annot_ms2_df_full</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-919"><a href="#LCMSBase.mass_features_ms2_annot_to_df-919"><span class="linenos">919</span></a>            <span class="c1"># Warn that no ms2 annotations were found</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-920"><a href="#LCMSBase.mass_features_ms2_annot_to_df-920"><span class="linenos">920</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-921"><a href="#LCMSBase.mass_features_ms2_annot_to_df-921"><span class="linenos">921</span></a>                <span class="s2">&quot;No MS2 annotations found for mass features in dataset, were MS2 spectra added and searched against a database?&quot;</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-922"><a href="#LCMSBase.mass_features_ms2_annot_to_df-922"><span class="linenos">922</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-923"><a href="#LCMSBase.mass_features_ms2_annot_to_df-923"><span class="linenos">923</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-924"><a href="#LCMSBase.mass_features_ms2_annot_to_df-924"><span class="linenos">924</span></a>
</span><span id="LCMSBase.mass_features_ms2_annot_to_df-925"><a href="#LCMSBase.mass_features_ms2_annot_to_df-925"><span class="linenos">925</span></a>        <span class="k">return</span> <span class="n">annot_ms2_df_full</span>
</span></pre></div>


            <div class="docstring"><p>Returns a pandas dataframe summarizing the MS2 annotations for the mass features in the dataset.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>molecular_metadata</strong> (dict of MolecularMetadata objects):
A dictionary of MolecularMetadata objects, keyed by metabref_mol_id.  Defaults to None.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: A pandas dataframe of MS2 annotations for the mass features in the dataset,
and optionally molecular metadata. The index is set to mf_id (mass feature ID)</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Warning</strong>: If no MS2 annotations were found for the mass features in the dataset.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.plot_composite_mz_features" class="classattr">
                                        <input id="LCMSBase.plot_composite_mz_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_composite_mz_features</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">binsize</span><span class="o">=</span><span class="mf">0.0001</span>,</span><span class="param">	<span class="n">ph_int_min_thresh</span><span class="o">=</span><span class="mf">0.001</span>,</span><span class="param">	<span class="n">mf_plot</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">ms2_plot</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">return_fig</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.plot_composite_mz_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.plot_composite_mz_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.plot_composite_mz_features-927"><a href="#LCMSBase.plot_composite_mz_features-927"><span class="linenos"> 927</span></a>    <span class="k">def</span> <span class="nf">plot_composite_mz_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binsize</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">ph_int_min_thresh</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">mf_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ms2_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_fig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase.plot_composite_mz_features-928"><a href="#LCMSBase.plot_composite_mz_features-928"><span class="linenos"> 928</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a figure displaying </span>
</span><span id="LCMSBase.plot_composite_mz_features-929"><a href="#LCMSBase.plot_composite_mz_features-929"><span class="linenos"> 929</span></a><span class="sd">            (1) thresholded, unprocessed data</span>
</span><span id="LCMSBase.plot_composite_mz_features-930"><a href="#LCMSBase.plot_composite_mz_features-930"><span class="linenos"> 930</span></a><span class="sd">            (2) the m/z features</span>
</span><span id="LCMSBase.plot_composite_mz_features-931"><a href="#LCMSBase.plot_composite_mz_features-931"><span class="linenos"> 931</span></a><span class="sd">            (3) which m/z features are associated with MS2 spectra</span>
</span><span id="LCMSBase.plot_composite_mz_features-932"><a href="#LCMSBase.plot_composite_mz_features-932"><span class="linenos"> 932</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-933"><a href="#LCMSBase.plot_composite_mz_features-933"><span class="linenos"> 933</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.plot_composite_mz_features-934"><a href="#LCMSBase.plot_composite_mz_features-934"><span class="linenos"> 934</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.plot_composite_mz_features-935"><a href="#LCMSBase.plot_composite_mz_features-935"><span class="linenos"> 935</span></a><span class="sd">        binsize :  float</span>
</span><span id="LCMSBase.plot_composite_mz_features-936"><a href="#LCMSBase.plot_composite_mz_features-936"><span class="linenos"> 936</span></a><span class="sd">            Desired binsize for the m/z axis of the composite feature map.  Defaults to 1e-4.</span>
</span><span id="LCMSBase.plot_composite_mz_features-937"><a href="#LCMSBase.plot_composite_mz_features-937"><span class="linenos"> 937</span></a><span class="sd">        mf_plot : boolean</span>
</span><span id="LCMSBase.plot_composite_mz_features-938"><a href="#LCMSBase.plot_composite_mz_features-938"><span class="linenos"> 938</span></a><span class="sd">            Indicates whether to plot the m/z features. Defaults to True.</span>
</span><span id="LCMSBase.plot_composite_mz_features-939"><a href="#LCMSBase.plot_composite_mz_features-939"><span class="linenos"> 939</span></a><span class="sd">        ms2_plot : boolean</span>
</span><span id="LCMSBase.plot_composite_mz_features-940"><a href="#LCMSBase.plot_composite_mz_features-940"><span class="linenos"> 940</span></a><span class="sd">            Indicates whether to identify m/z features with associated MS2 spectra. Defaults to True.</span>
</span><span id="LCMSBase.plot_composite_mz_features-941"><a href="#LCMSBase.plot_composite_mz_features-941"><span class="linenos"> 941</span></a><span class="sd">        return_fig : boolean</span>
</span><span id="LCMSBase.plot_composite_mz_features-942"><a href="#LCMSBase.plot_composite_mz_features-942"><span class="linenos"> 942</span></a><span class="sd">            Indicates whether to plot composite feature map (False) or return figure object (True). Defaults to False.</span>
</span><span id="LCMSBase.plot_composite_mz_features-943"><a href="#LCMSBase.plot_composite_mz_features-943"><span class="linenos"> 943</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-944"><a href="#LCMSBase.plot_composite_mz_features-944"><span class="linenos"> 944</span></a><span class="sd">        Returns</span>
</span><span id="LCMSBase.plot_composite_mz_features-945"><a href="#LCMSBase.plot_composite_mz_features-945"><span class="linenos"> 945</span></a><span class="sd">        --------</span>
</span><span id="LCMSBase.plot_composite_mz_features-946"><a href="#LCMSBase.plot_composite_mz_features-946"><span class="linenos"> 946</span></a><span class="sd">        matplotlib.pyplot.Figure</span>
</span><span id="LCMSBase.plot_composite_mz_features-947"><a href="#LCMSBase.plot_composite_mz_features-947"><span class="linenos"> 947</span></a><span class="sd">            A figure with the thresholded, unprocessed data on an axis of m/z value with respect to </span>
</span><span id="LCMSBase.plot_composite_mz_features-948"><a href="#LCMSBase.plot_composite_mz_features-948"><span class="linenos"> 948</span></a><span class="sd">            scan time. Unprocessed data is displayed in gray scale with darker colors indicating </span>
</span><span id="LCMSBase.plot_composite_mz_features-949"><a href="#LCMSBase.plot_composite_mz_features-949"><span class="linenos"> 949</span></a><span class="sd">            higher intensities. If m/z features are plotted, they are displayed in cyan. If m/z</span>
</span><span id="LCMSBase.plot_composite_mz_features-950"><a href="#LCMSBase.plot_composite_mz_features-950"><span class="linenos"> 950</span></a><span class="sd">            features with associated with MS2 spectra are plotted, they are displayed in red.</span>
</span><span id="LCMSBase.plot_composite_mz_features-951"><a href="#LCMSBase.plot_composite_mz_features-951"><span class="linenos"> 951</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-952"><a href="#LCMSBase.plot_composite_mz_features-952"><span class="linenos"> 952</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.plot_composite_mz_features-953"><a href="#LCMSBase.plot_composite_mz_features-953"><span class="linenos"> 953</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.plot_composite_mz_features-954"><a href="#LCMSBase.plot_composite_mz_features-954"><span class="linenos"> 954</span></a><span class="sd">        Warning</span>
</span><span id="LCMSBase.plot_composite_mz_features-955"><a href="#LCMSBase.plot_composite_mz_features-955"><span class="linenos"> 955</span></a><span class="sd">            If m/z features are set to be plot but aren&#39;t in the dataset.</span>
</span><span id="LCMSBase.plot_composite_mz_features-956"><a href="#LCMSBase.plot_composite_mz_features-956"><span class="linenos"> 956</span></a><span class="sd">            If m/z features with associated MS2 data are set to be plot but no MS2 annotations </span>
</span><span id="LCMSBase.plot_composite_mz_features-957"><a href="#LCMSBase.plot_composite_mz_features-957"><span class="linenos"> 957</span></a><span class="sd">            were found for the m/z features in the dataset.</span>
</span><span id="LCMSBase.plot_composite_mz_features-958"><a href="#LCMSBase.plot_composite_mz_features-958"><span class="linenos"> 958</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.plot_composite_mz_features-959"><a href="#LCMSBase.plot_composite_mz_features-959"><span class="linenos"> 959</span></a>        <span class="k">if</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-960"><a href="#LCMSBase.plot_composite_mz_features-960"><span class="linenos"> 960</span></a>            <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase.plot_composite_mz_features-961"><a href="#LCMSBase.plot_composite_mz_features-961"><span class="linenos"> 961</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-962"><a href="#LCMSBase.plot_composite_mz_features-962"><span class="linenos"> 962</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.plot_composite_mz_features-963"><a href="#LCMSBase.plot_composite_mz_features-963"><span class="linenos"> 963</span></a>                    <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase.plot_composite_mz_features-964"><a href="#LCMSBase.plot_composite_mz_features-964"><span class="linenos"> 964</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-965"><a href="#LCMSBase.plot_composite_mz_features-965"><span class="linenos"> 965</span></a>            <span class="c1">## call mass feature data</span>
</span><span id="LCMSBase.plot_composite_mz_features-966"><a href="#LCMSBase.plot_composite_mz_features-966"><span class="linenos"> 966</span></a>            <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span>
</span><span id="LCMSBase.plot_composite_mz_features-967"><a href="#LCMSBase.plot_composite_mz_features-967"><span class="linenos"> 967</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-968"><a href="#LCMSBase.plot_composite_mz_features-968"><span class="linenos"> 968</span></a>        <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-969"><a href="#LCMSBase.plot_composite_mz_features-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-970"><a href="#LCMSBase.plot_composite_mz_features-970"><span class="linenos"> 970</span></a>                <span class="c1"># Check if mass_features is set, raise error if not</span>
</span><span id="LCMSBase.plot_composite_mz_features-971"><a href="#LCMSBase.plot_composite_mz_features-971"><span class="linenos"> 971</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-972"><a href="#LCMSBase.plot_composite_mz_features-972"><span class="linenos"> 972</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.plot_composite_mz_features-973"><a href="#LCMSBase.plot_composite_mz_features-973"><span class="linenos"> 973</span></a>                        <span class="s2">&quot;mass_features not set, must run find_mass_features() first&quot;</span>
</span><span id="LCMSBase.plot_composite_mz_features-974"><a href="#LCMSBase.plot_composite_mz_features-974"><span class="linenos"> 974</span></a>                    <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-975"><a href="#LCMSBase.plot_composite_mz_features-975"><span class="linenos"> 975</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-976"><a href="#LCMSBase.plot_composite_mz_features-976"><span class="linenos"> 976</span></a>            <span class="c1">## call m/z feature data</span>
</span><span id="LCMSBase.plot_composite_mz_features-977"><a href="#LCMSBase.plot_composite_mz_features-977"><span class="linenos"> 977</span></a>            <span class="n">mf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_features_to_df</span><span class="p">()</span>
</span><span id="LCMSBase.plot_composite_mz_features-978"><a href="#LCMSBase.plot_composite_mz_features-978"><span class="linenos"> 978</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-979"><a href="#LCMSBase.plot_composite_mz_features-979"><span class="linenos"> 979</span></a>            <span class="c1"># Check if ms2_spectrum is set, raise error if not</span>
</span><span id="LCMSBase.plot_composite_mz_features-980"><a href="#LCMSBase.plot_composite_mz_features-980"><span class="linenos"> 980</span></a>            <span class="k">if</span> <span class="s1">&#39;ms2_spectrum&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mf_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-981"><a href="#LCMSBase.plot_composite_mz_features-981"><span class="linenos"> 981</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>                
</span><span id="LCMSBase.plot_composite_mz_features-982"><a href="#LCMSBase.plot_composite_mz_features-982"><span class="linenos"> 982</span></a>                    <span class="s2">&quot;ms2_spectrum not set, must run add_associated_ms2_dda() first&quot;</span>            
</span><span id="LCMSBase.plot_composite_mz_features-983"><a href="#LCMSBase.plot_composite_mz_features-983"><span class="linenos"> 983</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-984"><a href="#LCMSBase.plot_composite_mz_features-984"><span class="linenos"> 984</span></a>    
</span><span id="LCMSBase.plot_composite_mz_features-985"><a href="#LCMSBase.plot_composite_mz_features-985"><span class="linenos"> 985</span></a>        <span class="c1">## threshold and grid unprocessed data</span>
</span><span id="LCMSBase.plot_composite_mz_features-986"><a href="#LCMSBase.plot_composite_mz_features-986"><span class="linenos"> 986</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase.plot_composite_mz_features-987"><a href="#LCMSBase.plot_composite_mz_features-987"><span class="linenos"> 987</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-988"><a href="#LCMSBase.plot_composite_mz_features-988"><span class="linenos"> 988</span></a>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">ph_int_min_thresh</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="LCMSBase.plot_composite_mz_features-989"><a href="#LCMSBase.plot_composite_mz_features-989"><span class="linenos"> 989</span></a>        <span class="n">df_thres</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LCMSBase.plot_composite_mz_features-990"><a href="#LCMSBase.plot_composite_mz_features-990"><span class="linenos"> 990</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_data</span><span class="p">(</span><span class="n">df_thres</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-991"><a href="#LCMSBase.plot_composite_mz_features-991"><span class="linenos"> 991</span></a>    
</span><span id="LCMSBase.plot_composite_mz_features-992"><a href="#LCMSBase.plot_composite_mz_features-992"><span class="linenos"> 992</span></a>        <span class="c1">## format unprocessed data for plotting</span>
</span><span id="LCMSBase.plot_composite_mz_features-993"><a href="#LCMSBase.plot_composite_mz_features-993"><span class="linenos"> 993</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_df</span><span class="p">[[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">]],</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;scan&#39;</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-994"><a href="#LCMSBase.plot_composite_mz_features-994"><span class="linenos"> 994</span></a>        <span class="n">mz_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">),</span> <span class="n">binsize</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-995"><a href="#LCMSBase.plot_composite_mz_features-995"><span class="linenos"> 995</span></a>        <span class="n">mz_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-996"><a href="#LCMSBase.plot_composite_mz_features-996"><span class="linenos"> 996</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mz_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_closest</span><span class="p">(</span><span class="n">mz_grid</span><span class="p">,</span> <span class="n">mz_data</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-997"><a href="#LCMSBase.plot_composite_mz_features-997"><span class="linenos"> 997</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ab_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;mz_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-998"><a href="#LCMSBase.plot_composite_mz_features-998"><span class="linenos"> 998</span></a>        <span class="n">unproc_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;scan_time&#39;</span><span class="p">,</span> <span class="s1">&#39;mz_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;ab_bin&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-999"><a href="#LCMSBase.plot_composite_mz_features-999"><span class="linenos"> 999</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-1000"><a href="#LCMSBase.plot_composite_mz_features-1000"><span class="linenos">1000</span></a>        <span class="c1">## generate figure</span>
</span><span id="LCMSBase.plot_composite_mz_features-1001"><a href="#LCMSBase.plot_composite_mz_features-1001"><span class="linenos">1001</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="LCMSBase.plot_composite_mz_features-1002"><a href="#LCMSBase.plot_composite_mz_features-1002"><span class="linenos">1002</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase.plot_composite_mz_features-1003"><a href="#LCMSBase.plot_composite_mz_features-1003"><span class="linenos">1003</span></a>            <span class="n">unproc_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1004"><a href="#LCMSBase.plot_composite_mz_features-1004"><span class="linenos">1004</span></a>            <span class="n">unproc_df</span><span class="o">.</span><span class="n">mz_bin</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1005"><a href="#LCMSBase.plot_composite_mz_features-1005"><span class="linenos">1005</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="p">),</span>
</span><span id="LCMSBase.plot_composite_mz_features-1006"><a href="#LCMSBase.plot_composite_mz_features-1006"><span class="linenos">1006</span></a>            <span class="n">alpha</span> <span class="o">=</span> <span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">unproc_df</span><span class="o">.</span><span class="n">ab_bin</span><span class="p">),</span> 
</span><span id="LCMSBase.plot_composite_mz_features-1007"><a href="#LCMSBase.plot_composite_mz_features-1007"><span class="linenos">1007</span></a>            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1008"><a href="#LCMSBase.plot_composite_mz_features-1008"><span class="linenos">1008</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="LCMSBase.plot_composite_mz_features-1009"><a href="#LCMSBase.plot_composite_mz_features-1009"><span class="linenos">1009</span></a>        <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1010"><a href="#LCMSBase.plot_composite_mz_features-1010"><span class="linenos">1010</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-1011"><a href="#LCMSBase.plot_composite_mz_features-1011"><span class="linenos">1011</span></a>        <span class="k">if</span> <span class="n">mf_plot</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-1012"><a href="#LCMSBase.plot_composite_mz_features-1012"><span class="linenos">1012</span></a>            <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-1013"><a href="#LCMSBase.plot_composite_mz_features-1013"><span class="linenos">1013</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase.plot_composite_mz_features-1014"><a href="#LCMSBase.plot_composite_mz_features-1014"><span class="linenos">1014</span></a>                    <span class="n">mf_df</span><span class="p">[</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1015"><a href="#LCMSBase.plot_composite_mz_features-1015"><span class="linenos">1015</span></a>                    <span class="n">mf_df</span><span class="p">[</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1016"><a href="#LCMSBase.plot_composite_mz_features-1016"><span class="linenos">1016</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1017"><a href="#LCMSBase.plot_composite_mz_features-1017"><span class="linenos">1017</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1018"><a href="#LCMSBase.plot_composite_mz_features-1018"><span class="linenos">1018</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features without MS2&#39;</span>
</span><span id="LCMSBase.plot_composite_mz_features-1019"><a href="#LCMSBase.plot_composite_mz_features-1019"><span class="linenos">1019</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1020"><a href="#LCMSBase.plot_composite_mz_features-1020"><span class="linenos">1020</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-1021"><a href="#LCMSBase.plot_composite_mz_features-1021"><span class="linenos">1021</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase.plot_composite_mz_features-1022"><a href="#LCMSBase.plot_composite_mz_features-1022"><span class="linenos">1022</span></a>                    <span class="n">mf_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1023"><a href="#LCMSBase.plot_composite_mz_features-1023"><span class="linenos">1023</span></a>                    <span class="n">mf_df</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1024"><a href="#LCMSBase.plot_composite_mz_features-1024"><span class="linenos">1024</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1025"><a href="#LCMSBase.plot_composite_mz_features-1025"><span class="linenos">1025</span></a>                    <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1026"><a href="#LCMSBase.plot_composite_mz_features-1026"><span class="linenos">1026</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features&#39;</span>
</span><span id="LCMSBase.plot_composite_mz_features-1027"><a href="#LCMSBase.plot_composite_mz_features-1027"><span class="linenos">1027</span></a>                <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1028"><a href="#LCMSBase.plot_composite_mz_features-1028"><span class="linenos">1028</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-1029"><a href="#LCMSBase.plot_composite_mz_features-1029"><span class="linenos">1029</span></a>        <span class="k">if</span> <span class="n">ms2_plot</span><span class="p">:</span> 
</span><span id="LCMSBase.plot_composite_mz_features-1030"><a href="#LCMSBase.plot_composite_mz_features-1030"><span class="linenos">1030</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="LCMSBase.plot_composite_mz_features-1031"><a href="#LCMSBase.plot_composite_mz_features-1031"><span class="linenos">1031</span></a>                <span class="n">mf_df</span><span class="p">[</span><span class="o">~</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">scan_time</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1032"><a href="#LCMSBase.plot_composite_mz_features-1032"><span class="linenos">1032</span></a>                <span class="n">mf_df</span><span class="p">[</span><span class="o">~</span><span class="n">mf_df</span><span class="o">.</span><span class="n">ms2_spectrum</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1033"><a href="#LCMSBase.plot_composite_mz_features-1033"><span class="linenos">1033</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1034"><a href="#LCMSBase.plot_composite_mz_features-1034"><span class="linenos">1034</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="LCMSBase.plot_composite_mz_features-1035"><a href="#LCMSBase.plot_composite_mz_features-1035"><span class="linenos">1035</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;M/Z features with MS2&#39;</span>
</span><span id="LCMSBase.plot_composite_mz_features-1036"><a href="#LCMSBase.plot_composite_mz_features-1036"><span class="linenos">1036</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1037"><a href="#LCMSBase.plot_composite_mz_features-1037"><span class="linenos">1037</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-1038"><a href="#LCMSBase.plot_composite_mz_features-1038"><span class="linenos">1038</span></a>        <span class="k">if</span> <span class="n">mf_plot</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">ms2_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-1039"><a href="#LCMSBase.plot_composite_mz_features-1039"><span class="linenos">1039</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">),</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1040"><a href="#LCMSBase.plot_composite_mz_features-1040"><span class="linenos">1040</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Scan time&#39;</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1041"><a href="#LCMSBase.plot_composite_mz_features-1041"><span class="linenos">1041</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;m/z&#39;</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1042"><a href="#LCMSBase.plot_composite_mz_features-1042"><span class="linenos">1042</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mz</span><span class="p">)))</span>
</span><span id="LCMSBase.plot_composite_mz_features-1043"><a href="#LCMSBase.plot_composite_mz_features-1043"><span class="linenos">1043</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">)))</span>
</span><span id="LCMSBase.plot_composite_mz_features-1044"><a href="#LCMSBase.plot_composite_mz_features-1044"><span class="linenos">1044</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Composite Feature Map&#39;</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1045"><a href="#LCMSBase.plot_composite_mz_features-1045"><span class="linenos">1045</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-1046"><a href="#LCMSBase.plot_composite_mz_features-1046"><span class="linenos">1046</span></a>        <span class="k">if</span> <span class="n">return_fig</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-1047"><a href="#LCMSBase.plot_composite_mz_features-1047"><span class="linenos">1047</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="LCMSBase.plot_composite_mz_features-1048"><a href="#LCMSBase.plot_composite_mz_features-1048"><span class="linenos">1048</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="LCMSBase.plot_composite_mz_features-1049"><a href="#LCMSBase.plot_composite_mz_features-1049"><span class="linenos">1049</span></a>
</span><span id="LCMSBase.plot_composite_mz_features-1050"><a href="#LCMSBase.plot_composite_mz_features-1050"><span class="linenos">1050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LCMSBase.plot_composite_mz_features-1051"><a href="#LCMSBase.plot_composite_mz_features-1051"><span class="linenos">1051</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns a figure displaying 
    (1) thresholded, unprocessed data
    (2) the m/z features
    (3) which m/z features are associated with MS2 spectra</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>binsize</strong> (float):
Desired binsize for the m/z axis of the composite feature map.  Defaults to 1e-4.</li>
<li><strong>mf_plot</strong> (boolean):
Indicates whether to plot the m/z features. Defaults to True.</li>
<li><strong>ms2_plot</strong> (boolean):
Indicates whether to identify m/z features with associated MS2 spectra. Defaults to True.</li>
<li><strong>return_fig</strong> (boolean):
Indicates whether to plot composite feature map (False) or return figure object (True). Defaults to False.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>matplotlib.pyplot.Figure</strong>: A figure with the thresholded, unprocessed data on an axis of m/z value with respect to 
scan time. Unprocessed data is displayed in gray scale with darker colors indicating 
higher intensities. If m/z features are plotted, they are displayed in cyan. If m/z
features with associated with MS2 spectra are plotted, they are displayed in red.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Warning</strong>: If m/z features are set to be plot but aren't in the dataset.
If m/z features with associated MS2 data are set to be plot but no MS2 annotations 
were found for the m/z features in the dataset.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.set_tic_list_from_data" class="classattr">
                                        <input id="LCMSBase.set_tic_list_from_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_tic_list_from_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.set_tic_list_from_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.set_tic_list_from_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.set_tic_list_from_data-1090"><a href="#LCMSBase.set_tic_list_from_data-1090"><span class="linenos">1090</span></a>    <span class="k">def</span> <span class="nf">set_tic_list_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase.set_tic_list_from_data-1091"><a href="#LCMSBase.set_tic_list_from_data-1091"><span class="linenos">1091</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the TIC list from the mass spectrum objects within the _ms dictionary.</span>
</span><span id="LCMSBase.set_tic_list_from_data-1092"><a href="#LCMSBase.set_tic_list_from_data-1092"><span class="linenos">1092</span></a>
</span><span id="LCMSBase.set_tic_list_from_data-1093"><a href="#LCMSBase.set_tic_list_from_data-1093"><span class="linenos">1093</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.set_tic_list_from_data-1094"><a href="#LCMSBase.set_tic_list_from_data-1094"><span class="linenos">1094</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.set_tic_list_from_data-1095"><a href="#LCMSBase.set_tic_list_from_data-1095"><span class="linenos">1095</span></a><span class="sd">        overwrite : bool, optional</span>
</span><span id="LCMSBase.set_tic_list_from_data-1096"><a href="#LCMSBase.set_tic_list_from_data-1096"><span class="linenos">1096</span></a><span class="sd">            If True, overwrites the TIC list if it is already set. Defaults to False.</span>
</span><span id="LCMSBase.set_tic_list_from_data-1097"><a href="#LCMSBase.set_tic_list_from_data-1097"><span class="linenos">1097</span></a>
</span><span id="LCMSBase.set_tic_list_from_data-1098"><a href="#LCMSBase.set_tic_list_from_data-1098"><span class="linenos">1098</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase.set_tic_list_from_data-1099"><a href="#LCMSBase.set_tic_list_from_data-1099"><span class="linenos">1099</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase.set_tic_list_from_data-1100"><a href="#LCMSBase.set_tic_list_from_data-1100"><span class="linenos">1100</span></a><span class="sd">        If the _ms dictionary is incomplete, sets the TIC list to an empty list.</span>
</span><span id="LCMSBase.set_tic_list_from_data-1101"><a href="#LCMSBase.set_tic_list_from_data-1101"><span class="linenos">1101</span></a>
</span><span id="LCMSBase.set_tic_list_from_data-1102"><a href="#LCMSBase.set_tic_list_from_data-1102"><span class="linenos">1102</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.set_tic_list_from_data-1103"><a href="#LCMSBase.set_tic_list_from_data-1103"><span class="linenos">1103</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.set_tic_list_from_data-1104"><a href="#LCMSBase.set_tic_list_from_data-1104"><span class="linenos">1104</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase.set_tic_list_from_data-1105"><a href="#LCMSBase.set_tic_list_from_data-1105"><span class="linenos">1105</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="LCMSBase.set_tic_list_from_data-1106"><a href="#LCMSBase.set_tic_list_from_data-1106"><span class="linenos">1106</span></a><span class="sd">            If the TIC list is already set and overwrite is False.</span>
</span><span id="LCMSBase.set_tic_list_from_data-1107"><a href="#LCMSBase.set_tic_list_from_data-1107"><span class="linenos">1107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.set_tic_list_from_data-1108"><a href="#LCMSBase.set_tic_list_from_data-1108"><span class="linenos">1108</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="LCMSBase.set_tic_list_from_data-1109"><a href="#LCMSBase.set_tic_list_from_data-1109"><span class="linenos">1109</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.set_tic_list_from_data-1110"><a href="#LCMSBase.set_tic_list_from_data-1110"><span class="linenos">1110</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.set_tic_list_from_data-1111"><a href="#LCMSBase.set_tic_list_from_data-1111"><span class="linenos">1111</span></a>
</span><span id="LCMSBase.set_tic_list_from_data-1112"><a href="#LCMSBase.set_tic_list_from_data-1112"><span class="linenos">1112</span></a>        <span class="c1"># Check if tic_list is already set and raise error if so</span>
</span><span id="LCMSBase.set_tic_list_from_data-1113"><a href="#LCMSBase.set_tic_list_from_data-1113"><span class="linenos">1113</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="LCMSBase.set_tic_list_from_data-1114"><a href="#LCMSBase.set_tic_list_from_data-1114"><span class="linenos">1114</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TIC list already set, use overwrite=True to overwrite&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.set_tic_list_from_data-1115"><a href="#LCMSBase.set_tic_list_from_data-1115"><span class="linenos">1115</span></a>
</span><span id="LCMSBase.set_tic_list_from_data-1116"><a href="#LCMSBase.set_tic_list_from_data-1116"><span class="linenos">1116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tic</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">tic</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Sets the TIC list from the mass spectrum objects within the _ms dictionary.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>overwrite</strong> (bool, optional):
If True, overwrites the TIC list if it is already set. Defaults to False.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>If the _ms dictionary is incomplete, sets the TIC list to an empty list.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If no mass spectra are found in the dataset.
If the TIC list is already set and overwrite is False.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.set_retention_time_from_data" class="classattr">
                                        <input id="LCMSBase.set_retention_time_from_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_retention_time_from_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.set_retention_time_from_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.set_retention_time_from_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.set_retention_time_from_data-1118"><a href="#LCMSBase.set_retention_time_from_data-1118"><span class="linenos">1118</span></a>    <span class="k">def</span> <span class="nf">set_retention_time_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase.set_retention_time_from_data-1119"><a href="#LCMSBase.set_retention_time_from_data-1119"><span class="linenos">1119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the retention time list from the data in the _ms dictionary.</span>
</span><span id="LCMSBase.set_retention_time_from_data-1120"><a href="#LCMSBase.set_retention_time_from_data-1120"><span class="linenos">1120</span></a>
</span><span id="LCMSBase.set_retention_time_from_data-1121"><a href="#LCMSBase.set_retention_time_from_data-1121"><span class="linenos">1121</span></a><span class="sd">        Parameters</span>
</span><span id="LCMSBase.set_retention_time_from_data-1122"><a href="#LCMSBase.set_retention_time_from_data-1122"><span class="linenos">1122</span></a><span class="sd">        -----------</span>
</span><span id="LCMSBase.set_retention_time_from_data-1123"><a href="#LCMSBase.set_retention_time_from_data-1123"><span class="linenos">1123</span></a><span class="sd">        overwrite : bool, optional</span>
</span><span id="LCMSBase.set_retention_time_from_data-1124"><a href="#LCMSBase.set_retention_time_from_data-1124"><span class="linenos">1124</span></a><span class="sd">            If True, overwrites the retention time list if it is already set. Defaults to False.</span>
</span><span id="LCMSBase.set_retention_time_from_data-1125"><a href="#LCMSBase.set_retention_time_from_data-1125"><span class="linenos">1125</span></a>
</span><span id="LCMSBase.set_retention_time_from_data-1126"><a href="#LCMSBase.set_retention_time_from_data-1126"><span class="linenos">1126</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase.set_retention_time_from_data-1127"><a href="#LCMSBase.set_retention_time_from_data-1127"><span class="linenos">1127</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase.set_retention_time_from_data-1128"><a href="#LCMSBase.set_retention_time_from_data-1128"><span class="linenos">1128</span></a><span class="sd">        If the _ms dictionary is empty or incomplete, sets the retention time list to an empty list.</span>
</span><span id="LCMSBase.set_retention_time_from_data-1129"><a href="#LCMSBase.set_retention_time_from_data-1129"><span class="linenos">1129</span></a>
</span><span id="LCMSBase.set_retention_time_from_data-1130"><a href="#LCMSBase.set_retention_time_from_data-1130"><span class="linenos">1130</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.set_retention_time_from_data-1131"><a href="#LCMSBase.set_retention_time_from_data-1131"><span class="linenos">1131</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.set_retention_time_from_data-1132"><a href="#LCMSBase.set_retention_time_from_data-1132"><span class="linenos">1132</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase.set_retention_time_from_data-1133"><a href="#LCMSBase.set_retention_time_from_data-1133"><span class="linenos">1133</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="LCMSBase.set_retention_time_from_data-1134"><a href="#LCMSBase.set_retention_time_from_data-1134"><span class="linenos">1134</span></a><span class="sd">            If the retention time list is already set and overwrite is False.</span>
</span><span id="LCMSBase.set_retention_time_from_data-1135"><a href="#LCMSBase.set_retention_time_from_data-1135"><span class="linenos">1135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.set_retention_time_from_data-1136"><a href="#LCMSBase.set_retention_time_from_data-1136"><span class="linenos">1136</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="LCMSBase.set_retention_time_from_data-1137"><a href="#LCMSBase.set_retention_time_from_data-1137"><span class="linenos">1137</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.set_retention_time_from_data-1138"><a href="#LCMSBase.set_retention_time_from_data-1138"><span class="linenos">1138</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.set_retention_time_from_data-1139"><a href="#LCMSBase.set_retention_time_from_data-1139"><span class="linenos">1139</span></a>
</span><span id="LCMSBase.set_retention_time_from_data-1140"><a href="#LCMSBase.set_retention_time_from_data-1140"><span class="linenos">1140</span></a>        <span class="c1"># Check if retention_time_list is already set and raise error if so</span>
</span><span id="LCMSBase.set_retention_time_from_data-1141"><a href="#LCMSBase.set_retention_time_from_data-1141"><span class="linenos">1141</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retention_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="LCMSBase.set_retention_time_from_data-1142"><a href="#LCMSBase.set_retention_time_from_data-1142"><span class="linenos">1142</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.set_retention_time_from_data-1143"><a href="#LCMSBase.set_retention_time_from_data-1143"><span class="linenos">1143</span></a>                <span class="s2">&quot;Retention time list already set, use overwrite=True to overwrite&quot;</span>
</span><span id="LCMSBase.set_retention_time_from_data-1144"><a href="#LCMSBase.set_retention_time_from_data-1144"><span class="linenos">1144</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.set_retention_time_from_data-1145"><a href="#LCMSBase.set_retention_time_from_data-1145"><span class="linenos">1145</span></a>
</span><span id="LCMSBase.set_retention_time_from_data-1146"><a href="#LCMSBase.set_retention_time_from_data-1146"><span class="linenos">1146</span></a>        <span class="n">retention_time_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LCMSBase.set_retention_time_from_data-1147"><a href="#LCMSBase.set_retention_time_from_data-1147"><span class="linenos">1147</span></a>        <span class="k">for</span> <span class="n">key_ms</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="LCMSBase.set_retention_time_from_data-1148"><a href="#LCMSBase.set_retention_time_from_data-1148"><span class="linenos">1148</span></a>            <span class="n">retention_time_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_ms</span><span class="p">)</span><span class="o">.</span><span class="n">retention_time</span><span class="p">)</span>
</span><span id="LCMSBase.set_retention_time_from_data-1149"><a href="#LCMSBase.set_retention_time_from_data-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">retention_time</span> <span class="o">=</span> <span class="n">retention_time_list</span>
</span></pre></div>


            <div class="docstring"><p>Sets the retention time list from the data in the _ms dictionary.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>overwrite</strong> (bool, optional):
If True, overwrites the retention time list if it is already set. Defaults to False.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>If the _ms dictionary is empty or incomplete, sets the retention time list to an empty list.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If no mass spectra are found in the dataset.
If the retention time list is already set and overwrite is False.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.set_scans_number_from_data" class="classattr">
                                        <input id="LCMSBase.set_scans_number_from_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_scans_number_from_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LCMSBase.set_scans_number_from_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LCMSBase.set_scans_number_from_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LCMSBase.set_scans_number_from_data-1151"><a href="#LCMSBase.set_scans_number_from_data-1151"><span class="linenos">1151</span></a>    <span class="k">def</span> <span class="nf">set_scans_number_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="LCMSBase.set_scans_number_from_data-1152"><a href="#LCMSBase.set_scans_number_from_data-1152"><span class="linenos">1152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the scan number list from the data in the _ms dictionary.</span>
</span><span id="LCMSBase.set_scans_number_from_data-1153"><a href="#LCMSBase.set_scans_number_from_data-1153"><span class="linenos">1153</span></a>
</span><span id="LCMSBase.set_scans_number_from_data-1154"><a href="#LCMSBase.set_scans_number_from_data-1154"><span class="linenos">1154</span></a><span class="sd">        Notes</span>
</span><span id="LCMSBase.set_scans_number_from_data-1155"><a href="#LCMSBase.set_scans_number_from_data-1155"><span class="linenos">1155</span></a><span class="sd">        -----</span>
</span><span id="LCMSBase.set_scans_number_from_data-1156"><a href="#LCMSBase.set_scans_number_from_data-1156"><span class="linenos">1156</span></a><span class="sd">        If the _ms dictionary is empty or incomplete, sets the scan number list to an empty list.</span>
</span><span id="LCMSBase.set_scans_number_from_data-1157"><a href="#LCMSBase.set_scans_number_from_data-1157"><span class="linenos">1157</span></a>
</span><span id="LCMSBase.set_scans_number_from_data-1158"><a href="#LCMSBase.set_scans_number_from_data-1158"><span class="linenos">1158</span></a><span class="sd">        Raises</span>
</span><span id="LCMSBase.set_scans_number_from_data-1159"><a href="#LCMSBase.set_scans_number_from_data-1159"><span class="linenos">1159</span></a><span class="sd">        ------</span>
</span><span id="LCMSBase.set_scans_number_from_data-1160"><a href="#LCMSBase.set_scans_number_from_data-1160"><span class="linenos">1160</span></a><span class="sd">        ValueError</span>
</span><span id="LCMSBase.set_scans_number_from_data-1161"><a href="#LCMSBase.set_scans_number_from_data-1161"><span class="linenos">1161</span></a><span class="sd">            If no mass spectra are found in the dataset.</span>
</span><span id="LCMSBase.set_scans_number_from_data-1162"><a href="#LCMSBase.set_scans_number_from_data-1162"><span class="linenos">1162</span></a><span class="sd">            If the scan number list is already set and overwrite is False.</span>
</span><span id="LCMSBase.set_scans_number_from_data-1163"><a href="#LCMSBase.set_scans_number_from_data-1163"><span class="linenos">1163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LCMSBase.set_scans_number_from_data-1164"><a href="#LCMSBase.set_scans_number_from_data-1164"><span class="linenos">1164</span></a>        <span class="c1"># Check if _ms is empty and raise error if so</span>
</span><span id="LCMSBase.set_scans_number_from_data-1165"><a href="#LCMSBase.set_scans_number_from_data-1165"><span class="linenos">1165</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LCMSBase.set_scans_number_from_data-1166"><a href="#LCMSBase.set_scans_number_from_data-1166"><span class="linenos">1166</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mass spectra found in dataset&quot;</span><span class="p">)</span>
</span><span id="LCMSBase.set_scans_number_from_data-1167"><a href="#LCMSBase.set_scans_number_from_data-1167"><span class="linenos">1167</span></a>
</span><span id="LCMSBase.set_scans_number_from_data-1168"><a href="#LCMSBase.set_scans_number_from_data-1168"><span class="linenos">1168</span></a>        <span class="c1"># Check if scans_number_list is already set and raise error if so</span>
</span><span id="LCMSBase.set_scans_number_from_data-1169"><a href="#LCMSBase.set_scans_number_from_data-1169"><span class="linenos">1169</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
</span><span id="LCMSBase.set_scans_number_from_data-1170"><a href="#LCMSBase.set_scans_number_from_data-1170"><span class="linenos">1170</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="LCMSBase.set_scans_number_from_data-1171"><a href="#LCMSBase.set_scans_number_from_data-1171"><span class="linenos">1171</span></a>                <span class="s2">&quot;Scan number list already set, use overwrite=True to overwrite&quot;</span>
</span><span id="LCMSBase.set_scans_number_from_data-1172"><a href="#LCMSBase.set_scans_number_from_data-1172"><span class="linenos">1172</span></a>            <span class="p">)</span>
</span><span id="LCMSBase.set_scans_number_from_data-1173"><a href="#LCMSBase.set_scans_number_from_data-1173"><span class="linenos">1173</span></a>
</span><span id="LCMSBase.set_scans_number_from_data-1174"><a href="#LCMSBase.set_scans_number_from_data-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scans_number</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Sets the scan number list from the data in the _ms dictionary.</p>

<h6 id="notes">Notes</h6>

<p>If the _ms dictionary is empty or incomplete, sets the scan number list to an empty list.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If no mass spectra are found in the dataset.
If the scan number list is already set and overwrite is False.</li>
</ul>
</div>


                            </div>
                            <div id="LCMSBase.ms1_scans" class="classattr">
                                <div class="attr variable">
            <span class="name">ms1_scans</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.ms1_scans"></a>
    
            <div class="docstring"><p>list : A list of MS1 scan numbers for the dataset.</p>
</div>


                            </div>
                            <div id="LCMSBase.parameters" class="classattr">
                                <div class="attr variable">
            <span class="name">parameters</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.parameters"></a>
    
            <div class="docstring"><p>LCMSParameters : The parameters used for the LC-MS analysis.</p>
</div>


                            </div>
                            <div id="LCMSBase.scans_number" class="classattr">
                                <div class="attr variable">
            <span class="name">scans_number</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.scans_number"></a>
    
            <div class="docstring"><p>list : A list of scan numbers for the dataset.</p>
</div>


                            </div>
                            <div id="LCMSBase.retention_time" class="classattr">
                                <div class="attr variable">
            <span class="name">retention_time</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.retention_time"></a>
    
            <div class="docstring"><p>numpy.ndarray : An array of retention times for the dataset.</p>
</div>


                            </div>
                            <div id="LCMSBase.tic" class="classattr">
                                <div class="attr variable">
            <span class="name">tic</span>

        
    </div>
    <a class="headerlink" href="#LCMSBase.tic"></a>
    
            <div class="docstring"><p>numpy.ndarray : An array of TIC values for the dataset.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#MassSpectraBase">MassSpectraBase</a></dt>
                                <dd id="LCMSBase.file_location" class="variable"><a href="#MassSpectraBase.file_location">file_location</a></dd>
                <dd id="LCMSBase.analyzer" class="variable"><a href="#MassSpectraBase.analyzer">analyzer</a></dd>
                <dd id="LCMSBase.instrument_label" class="variable"><a href="#MassSpectraBase.instrument_label">instrument_label</a></dd>
                <dd id="LCMSBase.add_mass_spectrum" class="function"><a href="#MassSpectraBase.add_mass_spectrum">add_mass_spectrum</a></dd>
                <dd id="LCMSBase.add_mass_spectra" class="function"><a href="#MassSpectraBase.add_mass_spectra">add_mass_spectra</a></dd>
                <dd id="LCMSBase.get_time_of_scan_id" class="function"><a href="#MassSpectraBase.get_time_of_scan_id">get_time_of_scan_id</a></dd>
                <dd id="LCMSBase.scan_df" class="variable"><a href="#MassSpectraBase.scan_df">scan_df</a></dd>
                <dd id="LCMSBase.ms" class="variable"><a href="#MassSpectraBase.ms">ms</a></dd>

            </div>
            <div><dt><a href="../calc/lc_calc.html#LCCalculations">corems.mass_spectra.calc.lc_calc.LCCalculations</a></dt>
                                <dd id="LCMSBase.get_max_eic" class="function"><a href="../calc/lc_calc.html#LCCalculations.get_max_eic">get_max_eic</a></dd>
                <dd id="LCMSBase.smooth_tic" class="function"><a href="../calc/lc_calc.html#LCCalculations.smooth_tic">smooth_tic</a></dd>
                <dd id="LCMSBase.eic_centroid_detector" class="function"><a href="../calc/lc_calc.html#LCCalculations.eic_centroid_detector">eic_centroid_detector</a></dd>
                <dd id="LCMSBase.find_nearest_scan" class="function"><a href="../calc/lc_calc.html#LCCalculations.find_nearest_scan">find_nearest_scan</a></dd>
                <dd id="LCMSBase.add_peak_metrics" class="function"><a href="../calc/lc_calc.html#LCCalculations.add_peak_metrics">add_peak_metrics</a></dd>
                <dd id="LCMSBase.get_average_mass_spectrum" class="function"><a href="../calc/lc_calc.html#LCCalculations.get_average_mass_spectrum">get_average_mass_spectrum</a></dd>
                <dd id="LCMSBase.find_mass_features" class="function"><a href="../calc/lc_calc.html#LCCalculations.find_mass_features">find_mass_features</a></dd>
                <dd id="LCMSBase.integrate_mass_features" class="function"><a href="../calc/lc_calc.html#LCCalculations.integrate_mass_features">integrate_mass_features</a></dd>
                <dd id="LCMSBase.find_c13_mass_features" class="function"><a href="../calc/lc_calc.html#LCCalculations.find_c13_mass_features">find_c13_mass_features</a></dd>
                <dd id="LCMSBase.deconvolute_ms1_mass_features" class="function"><a href="../calc/lc_calc.html#LCCalculations.deconvolute_ms1_mass_features">deconvolute_ms1_mass_features</a></dd>

            </div>
            <div><dt><a href="../calc/lc_calc.html#PHCalculations">corems.mass_spectra.calc.lc_calc.PHCalculations</a></dt>
                                <dd id="LCMSBase.sparse_mean_filter" class="function"><a href="../calc/lc_calc.html#PHCalculations.sparse_mean_filter">sparse_mean_filter</a></dd>
                <dd id="LCMSBase.embed_unique_indices" class="function"><a href="../calc/lc_calc.html#PHCalculations.embed_unique_indices">embed_unique_indices</a></dd>
                <dd id="LCMSBase.sparse_upper_star" class="function"><a href="../calc/lc_calc.html#PHCalculations.sparse_upper_star">sparse_upper_star</a></dd>
                <dd id="LCMSBase.check_if_grid" class="function"><a href="../calc/lc_calc.html#PHCalculations.check_if_grid">check_if_grid</a></dd>
                <dd id="LCMSBase.grid_data" class="function"><a href="../calc/lc_calc.html#PHCalculations.grid_data">grid_data</a></dd>
                <dd id="LCMSBase.find_mass_features_ph" class="function"><a href="../calc/lc_calc.html#PHCalculations.find_mass_features_ph">find_mass_features_ph</a></dd>
                <dd id="LCMSBase.cluster_mass_features" class="function"><a href="../calc/lc_calc.html#PHCalculations.cluster_mass_features">cluster_mass_features</a></dd>

            </div>
            <div><dt><a href="../../molecular_id/search/lcms_spectral_search.html#LCMSSpectralSearch">corems.molecular_id.search.lcms_spectral_search.LCMSSpectralSearch</a></dt>
                                <dd id="LCMSBase.get_more_match_quals" class="function"><a href="../../molecular_id/search/lcms_spectral_search.html#LCMSSpectralSearch.get_more_match_quals">get_more_match_quals</a></dd>
                <dd id="LCMSBase.fe_search" class="function"><a href="../../molecular_id/search/lcms_spectral_search.html#LCMSSpectralSearch.fe_search">fe_search</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>