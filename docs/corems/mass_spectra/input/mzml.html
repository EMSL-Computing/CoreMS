<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>corems.mass_spectra.input.mzml API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../input.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;corems.mass_spectra.input</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#MZMLSpectraParser">MZMLSpectraParser</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MZMLSpectraParser.__init__">MZMLSpectraParser</a>
                        </li>
                        <li>
                                <a class="variable" href="#MZMLSpectraParser.file_location">file_location</a>
                        </li>
                        <li>
                                <a class="variable" href="#MZMLSpectraParser.analyzer">analyzer</a>
                        </li>
                        <li>
                                <a class="variable" href="#MZMLSpectraParser.instrument_label">instrument_label</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.load">load</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.get_scan_df">get_scan_df</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.get_ms_raw">get_ms_raw</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.get_mass_spectrum_from_scan">get_mass_spectrum_from_scan</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.get_mass_spectra_obj">get_mass_spectra_obj</a>
                        </li>
                        <li>
                                <a class="function" href="#MZMLSpectraParser.get_lcms_obj">get_lcms_obj</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../../corems.html">corems</a><wbr>.<a href="./../../mass_spectra.html">mass_spectra</a><wbr>.<a href="./../input.html">input</a><wbr>.mzml    </h1>

                
                        <input id="mod-mzml-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-mzml-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">pymzml</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">corems.encapsulation.constant</span> <span class="kn">import</span> <span class="n">Labels</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">corems.encapsulation.factory.parameters</span> <span class="kn">import</span> <span class="n">default_parameters</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">corems.mass_spectra.factory.lc_class</span> <span class="kn">import</span> <span class="n">LCMSBase</span><span class="p">,</span> <span class="n">MassSpectraBase</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">corems.mass_spectra.input.parserbase</span> <span class="kn">import</span> <span class="n">SpectraParserInterface</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">corems.mass_spectrum.factory.MassSpectrumClasses</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>    <span class="n">MassSpecCentroid</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="n">MassSpecProfile</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="p">)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="k">class</span> <span class="nc">MZMLSpectraParser</span><span class="p">(</span><span class="n">SpectraParserInterface</span><span class="p">):</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for parsing mzml spectrometry data files into MassSpectraBase or LCMSBase objects</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    Parameters</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    ----------</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        The path to the RAW file to be parsed.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    analyzer : str, optional</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        The type of mass analyzer used in the instrument. Default is &quot;Unknown&quot;.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    instrument_label : str, optional</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        The name of the instrument used to acquire the data. Default is &quot;Unknown&quot;.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    sample_name : str, optional</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        The name of the sample being analyzed. If not provided, the stem of the file_location path will be used.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    Attributes</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    ----------</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    file_location : Path</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        The path to the RAW file being parsed.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    analyzer : str</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        The type of mass analyzer used in the instrument.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    instrument_label : str</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        The name of the instrument used to acquire the data.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    sample_name : str</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        The name of the sample being analyzed.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    Methods</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    -------</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    * load().</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Load mzML file using pymzml.run.Reader and return the data as a numpy array.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    * run(spectra=True).</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        Parses the mzml file and returns a dictionary of mass spectra dataframes and a scan metadata dataframe.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    * get_mass_spectrum_from_scan(scan_number, polarity, auto_process=True)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Parses the mzml file and returns a MassSpecBase object from a single scan.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    * get_mass_spectra_obj().</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        Parses the mzml file and instantiates a MassSpectraBase object.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    * get_lcms_obj().</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        Parses the mzml file and instantiates an LCMSBase object.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    Inherits from ThermoBaseClass and SpectraParserInterface</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="c1"># implementation details</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="c1"># if obj is a string it defaults to create a Path obj, pass the S3Path if needed</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;File does not exist: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_location</span><span class="p">))</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">analyzer</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">=</span> <span class="n">instrument_label</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="n">sample_name</span><span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">sample_name</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">stem</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        Load mzML file using pymzml.run.Reader and return the data as a numpy array.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        Returns</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        -------</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">            The mass spectra data as a numpy array.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="nf">get_scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        Return scan data as a pandas DataFrame.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        Parameters</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        ----------</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        data : pymzml.run.Reader</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">            The mass spectra data.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        Returns</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        -------</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">            A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="c1"># Scan dict</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="c1"># instatinate scan dict, with empty lists of size of scans</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="n">n_scans</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_spectrum_count</span><span class="p">()</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="n">scan_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="s2">&quot;scan&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="s2">&quot;scan_time&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="s2">&quot;ms_level&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="s2">&quot;polarity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="s2">&quot;precursor_mz&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="s2">&quot;scan_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="s2">&quot;scan_window_lower&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="s2">&quot;scan_window_upper&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="s2">&quot;scan_precision&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>            <span class="s2">&quot;tic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="s2">&quot;ms_format&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="p">}</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="c1"># First pass: loop through scans to get scan info</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">ID</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_level&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_precision&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">_measured_precision</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;tic&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">TIC</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;precursor_mz&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                    <span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;negative&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                    <span class="s2">&quot;Error: scan </span><span class="si">{0}</span><span class="s2"> has both negative and positive polarity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>                        <span class="n">spec</span><span class="o">.</span><span class="n">ID</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                    <span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>                <span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000016&quot;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000512&quot;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_window_lower&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000501&quot;</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_window_upper&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000500&quot;</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000128&quot;</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;profile&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="k">elif</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000127&quot;</span><span class="p">):</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centroid&quot;</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scan_dict</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="n">scan_df</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">get_ms_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">scan_df</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dictionary of mass spectra data as a pandas DataFrame.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Parameters</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        ----------</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        spectra : str</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            Which mass spectra data to include in the output.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">            Options: None, &quot;ms1&quot;, &quot;ms2&quot;, &quot;all&quot;.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        scan_df : pandas.DataFrame</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">            Scan dataframe. Output from get_scan_df().</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        data : pymzml.run.Reader</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">            The mass spectra data.</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        Returns</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        -------</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        dict</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">            A dictionary containing the mass spectra data as pandas DataFrames, with keys corresponding to the MS level.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">elif</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;ms1&quot;</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span><span class="p">[</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="k">elif</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;ms2&quot;</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span><span class="p">[</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectra must be &#39;all&#39;, &#39;ms1&#39;, or &#39;ms2&#39;&quot;</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="c1"># Result container</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="c1"># Row count container</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">counter</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="c1"># Column name container</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="c1"># set at float32</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="c1"># First pass: get nrows</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scan_df_forspec</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                <span class="c1"># Get ms level</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;ms</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>                <span class="c1"># Number of rows</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="n">N</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="c1"># Second pass: parse</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scan_df_forspec</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                <span class="c1"># Number of rows</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                <span class="c1"># No measurements</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>                    <span class="k">continue</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>                <span class="c1"># Dimension check</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                    <span class="c1"># raise an error if the mz and intensity arrays are not the same length</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;m/z and intensity array dimension mismatch&quot;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                <span class="c1"># Scan/frame info</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                <span class="n">id_dict</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">id_dict</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                <span class="c1"># Get ms level</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;ms</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                <span class="c1"># Columns</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">id_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">]</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                <span class="c1"># Subarray init</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="n">inx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                <span class="c1"># Populate scan/frame info</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                    <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                    <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>                <span class="c1"># Populate m/z</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>                <span class="c1"># Populate intensity</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="c1"># Initialize output container</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                    <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                    <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="c1"># Insert subarray</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="p">:</span> <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">arr</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="c1"># Construct ms1 and ms2 mz dataframes</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;controllerType&quot;</span><span class="p">,</span> <span class="s2">&quot;controllerNumber&quot;</span><span class="p">],</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">scan_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the mzML file and return a dictionary of spectra dataframes and a scan metadata dataframe.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        Parameters</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        ----------</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        spectra : str, optional</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            Which mass spectra data to include in the output. Default is &quot;all&quot;.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">            Other options: None, &quot;ms1&quot;, &quot;ms2&quot;.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        scan_df : pandas.DataFrame, optional</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">            Scan dataframe.  If not provided, the scan dataframe is created from the mzML file.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        Returns</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        -------</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        tuple</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">            A tuple containing two elements:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">            - A dictionary containing the mass spectra data as numpy arrays, with keys corresponding to the MS level.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">            - A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="c1"># Open file</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="n">scan_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_df</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="n">spectra</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ms_raw</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">scan_df</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">scan_df</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">get_mass_spectrum_from_scan</span><span class="p">(</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">,</span> <span class="n">spectrum_mode</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiate a mass spectrum object from the mzML file.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        Parameters</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        ----------</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        scan_number : int</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            The scan number to be parsed.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        spectrum_mode : str</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">            The type of spectrum to instantiate.  Must be&#39;profile&#39; or &#39;centroid&#39;.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        polarity : int</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">            The polarity of the scan.  Must be -1 or 1.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">            If True, process the mass spectrum. Default is True.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        Returns</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">        -------</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        MassSpecProfile | MassSpecCentroid</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">            The MassSpecProfile or MassSpecCentroid object containing the parsed mass spectrum.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">def</span> <span class="nf">set_metadata</span><span class="p">(</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="n">scan_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="n">polarity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="n">file_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">thermo_profile</span><span class="p">,</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="p">):</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            Set the output parameters for creating a MassSpecProfile or MassSpecCentroid object.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">            Parameters</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            ----------</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">            scan_number : int</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">                The scan number.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            polarity : int</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">                The polarity of the data.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            file_location : str</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">                The file location.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">            label : str, optional</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">                The label for the mass spectrum. Default is Labels.thermo_profile.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">            Returns</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">            -------</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">            dict</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">                The output parameters ready for creating a MassSpecProfile or MassSpecCentroid object.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">default_parameters</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polarity</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;filename_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;scan_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_number</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="k">return</span> <span class="n">d_params</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="c1"># Open file</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="c1"># Pluck out individual scan mz and intensity</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">spec</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">scan_number</span><span class="p">]</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="c1"># Get polarity</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">elif</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="c1"># Get mass spectrum</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="k">if</span> <span class="n">spectrum_mode</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="c1"># Check if profile</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000128&quot;</span><span class="p">):</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectrum is not profile&quot;</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">mz</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">abundance</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="p">}</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">set_metadata</span><span class="p">(</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                <span class="n">scan_number</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                <span class="n">polarity</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">simulated_profile</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">MassSpecProfile</span><span class="p">(</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>                <span class="n">data_dict</span><span class="p">,</span> <span class="n">d_params</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="k">elif</span> <span class="n">spectrum_mode</span> <span class="o">==</span> <span class="s2">&quot;centroid&quot;</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="c1"># Check if centroided</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000127&quot;</span><span class="p">):</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectrum is not centroided&quot;</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">mz</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">abundance</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">rp</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">),</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">s2n</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">),</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="p">}</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">set_metadata</span><span class="p">(</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>                <span class="n">scan_number</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">corems_centroid</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>            <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">MassSpecCentroid</span><span class="p">(</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                <span class="n">data_dict</span><span class="p">,</span> <span class="n">d_params</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="n">mass_spectrum_obj</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">get_mass_spectra_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiate a MassSpectraBase object from the mzML file.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        Returns</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        -------</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        MassSpectraBase</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">            The MassSpectra object containing the parsed mass spectra.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">            The object is instatiated with the mzML file, analyzer, instrument, sample name, and scan dataframe.</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">spectra</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="n">mass_spectra_obj</span> <span class="o">=</span> <span class="n">MassSpectraBase</span><span class="p">(</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">,</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="n">mass_spectra_obj</span><span class="o">.</span><span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="k">return</span> <span class="n">mass_spectra_obj</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">get_lcms_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiates a LCMSBase object from the mzML file.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">        Parameters</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">        ----------</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">        spectra : str, optional</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">            Which mass spectra data to include in the output. Default is all.  Other options: none, ms1, ms2.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        Returns</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        -------</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        LCMSBase</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">            LCMS object containing mass spectra data.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">            The object is instatiated with the mzML file, analyzer, instrument, sample name, scan dataframe,</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">            and mz dataframe(s), as well as lists of scan numbers, retention times, and TICs.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>  <span class="c1"># first run it to just get scan info</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">res</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="n">scan_df</span><span class="o">=</span><span class="n">scan_df</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">spectra</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="p">)</span>  <span class="c1"># second run to parse data</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="n">lcms_obj</span> <span class="o">=</span> <span class="n">LCMSBase</span><span class="p">(</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">,</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span><span class="p">,</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="n">key_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">intensity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="s2">&quot;mz&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">key_int</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="c1"># Check if polarity is mixed</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">polarity</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mixed polarities detected in scan data&quot;</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">polarity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">scan</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">tic</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="k">return</span> <span class="n">lcms_obj</span>
</span></pre></div>


            </section>
                <section id="MZMLSpectraParser">
                            <input id="MZMLSpectraParser-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MZMLSpectraParser</span><wbr>(<span class="base"><a href="parserbase.html#SpectraParserInterface">corems.mass_spectra.input.parserbase.SpectraParserInterface</a></span>):

                <label class="view-source-button" for="MZMLSpectraParser-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser-19"><a href="#MZMLSpectraParser-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">MZMLSpectraParser</span><span class="p">(</span><span class="n">SpectraParserInterface</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-20"><a href="#MZMLSpectraParser-20"><span class="linenos"> 20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for parsing mzml spectrometry data files into MassSpectraBase or LCMSBase objects</span>
</span><span id="MZMLSpectraParser-21"><a href="#MZMLSpectraParser-21"><span class="linenos"> 21</span></a>
</span><span id="MZMLSpectraParser-22"><a href="#MZMLSpectraParser-22"><span class="linenos"> 22</span></a><span class="sd">    Parameters</span>
</span><span id="MZMLSpectraParser-23"><a href="#MZMLSpectraParser-23"><span class="linenos"> 23</span></a><span class="sd">    ----------</span>
</span><span id="MZMLSpectraParser-24"><a href="#MZMLSpectraParser-24"><span class="linenos"> 24</span></a><span class="sd">    file_location : str or Path</span>
</span><span id="MZMLSpectraParser-25"><a href="#MZMLSpectraParser-25"><span class="linenos"> 25</span></a><span class="sd">        The path to the RAW file to be parsed.</span>
</span><span id="MZMLSpectraParser-26"><a href="#MZMLSpectraParser-26"><span class="linenos"> 26</span></a><span class="sd">    analyzer : str, optional</span>
</span><span id="MZMLSpectraParser-27"><a href="#MZMLSpectraParser-27"><span class="linenos"> 27</span></a><span class="sd">        The type of mass analyzer used in the instrument. Default is &quot;Unknown&quot;.</span>
</span><span id="MZMLSpectraParser-28"><a href="#MZMLSpectraParser-28"><span class="linenos"> 28</span></a><span class="sd">    instrument_label : str, optional</span>
</span><span id="MZMLSpectraParser-29"><a href="#MZMLSpectraParser-29"><span class="linenos"> 29</span></a><span class="sd">        The name of the instrument used to acquire the data. Default is &quot;Unknown&quot;.</span>
</span><span id="MZMLSpectraParser-30"><a href="#MZMLSpectraParser-30"><span class="linenos"> 30</span></a><span class="sd">    sample_name : str, optional</span>
</span><span id="MZMLSpectraParser-31"><a href="#MZMLSpectraParser-31"><span class="linenos"> 31</span></a><span class="sd">        The name of the sample being analyzed. If not provided, the stem of the file_location path will be used.</span>
</span><span id="MZMLSpectraParser-32"><a href="#MZMLSpectraParser-32"><span class="linenos"> 32</span></a>
</span><span id="MZMLSpectraParser-33"><a href="#MZMLSpectraParser-33"><span class="linenos"> 33</span></a><span class="sd">    Attributes</span>
</span><span id="MZMLSpectraParser-34"><a href="#MZMLSpectraParser-34"><span class="linenos"> 34</span></a><span class="sd">    ----------</span>
</span><span id="MZMLSpectraParser-35"><a href="#MZMLSpectraParser-35"><span class="linenos"> 35</span></a><span class="sd">    file_location : Path</span>
</span><span id="MZMLSpectraParser-36"><a href="#MZMLSpectraParser-36"><span class="linenos"> 36</span></a><span class="sd">        The path to the RAW file being parsed.</span>
</span><span id="MZMLSpectraParser-37"><a href="#MZMLSpectraParser-37"><span class="linenos"> 37</span></a><span class="sd">    analyzer : str</span>
</span><span id="MZMLSpectraParser-38"><a href="#MZMLSpectraParser-38"><span class="linenos"> 38</span></a><span class="sd">        The type of mass analyzer used in the instrument.</span>
</span><span id="MZMLSpectraParser-39"><a href="#MZMLSpectraParser-39"><span class="linenos"> 39</span></a><span class="sd">    instrument_label : str</span>
</span><span id="MZMLSpectraParser-40"><a href="#MZMLSpectraParser-40"><span class="linenos"> 40</span></a><span class="sd">        The name of the instrument used to acquire the data.</span>
</span><span id="MZMLSpectraParser-41"><a href="#MZMLSpectraParser-41"><span class="linenos"> 41</span></a><span class="sd">    sample_name : str</span>
</span><span id="MZMLSpectraParser-42"><a href="#MZMLSpectraParser-42"><span class="linenos"> 42</span></a><span class="sd">        The name of the sample being analyzed.</span>
</span><span id="MZMLSpectraParser-43"><a href="#MZMLSpectraParser-43"><span class="linenos"> 43</span></a>
</span><span id="MZMLSpectraParser-44"><a href="#MZMLSpectraParser-44"><span class="linenos"> 44</span></a><span class="sd">    Methods</span>
</span><span id="MZMLSpectraParser-45"><a href="#MZMLSpectraParser-45"><span class="linenos"> 45</span></a><span class="sd">    -------</span>
</span><span id="MZMLSpectraParser-46"><a href="#MZMLSpectraParser-46"><span class="linenos"> 46</span></a><span class="sd">    * load().</span>
</span><span id="MZMLSpectraParser-47"><a href="#MZMLSpectraParser-47"><span class="linenos"> 47</span></a><span class="sd">        Load mzML file using pymzml.run.Reader and return the data as a numpy array.</span>
</span><span id="MZMLSpectraParser-48"><a href="#MZMLSpectraParser-48"><span class="linenos"> 48</span></a><span class="sd">    * run(spectra=True).</span>
</span><span id="MZMLSpectraParser-49"><a href="#MZMLSpectraParser-49"><span class="linenos"> 49</span></a><span class="sd">        Parses the mzml file and returns a dictionary of mass spectra dataframes and a scan metadata dataframe.</span>
</span><span id="MZMLSpectraParser-50"><a href="#MZMLSpectraParser-50"><span class="linenos"> 50</span></a><span class="sd">    * get_mass_spectrum_from_scan(scan_number, polarity, auto_process=True)</span>
</span><span id="MZMLSpectraParser-51"><a href="#MZMLSpectraParser-51"><span class="linenos"> 51</span></a><span class="sd">        Parses the mzml file and returns a MassSpecBase object from a single scan.</span>
</span><span id="MZMLSpectraParser-52"><a href="#MZMLSpectraParser-52"><span class="linenos"> 52</span></a><span class="sd">    * get_mass_spectra_obj().</span>
</span><span id="MZMLSpectraParser-53"><a href="#MZMLSpectraParser-53"><span class="linenos"> 53</span></a><span class="sd">        Parses the mzml file and instantiates a MassSpectraBase object.</span>
</span><span id="MZMLSpectraParser-54"><a href="#MZMLSpectraParser-54"><span class="linenos"> 54</span></a><span class="sd">    * get_lcms_obj().</span>
</span><span id="MZMLSpectraParser-55"><a href="#MZMLSpectraParser-55"><span class="linenos"> 55</span></a><span class="sd">        Parses the mzml file and instantiates an LCMSBase object.</span>
</span><span id="MZMLSpectraParser-56"><a href="#MZMLSpectraParser-56"><span class="linenos"> 56</span></a>
</span><span id="MZMLSpectraParser-57"><a href="#MZMLSpectraParser-57"><span class="linenos"> 57</span></a><span class="sd">    Inherits from ThermoBaseClass and SpectraParserInterface</span>
</span><span id="MZMLSpectraParser-58"><a href="#MZMLSpectraParser-58"><span class="linenos"> 58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-59"><a href="#MZMLSpectraParser-59"><span class="linenos"> 59</span></a>
</span><span id="MZMLSpectraParser-60"><a href="#MZMLSpectraParser-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-61"><a href="#MZMLSpectraParser-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-62"><a href="#MZMLSpectraParser-62"><span class="linenos"> 62</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-63"><a href="#MZMLSpectraParser-63"><span class="linenos"> 63</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-64"><a href="#MZMLSpectraParser-64"><span class="linenos"> 64</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-65"><a href="#MZMLSpectraParser-65"><span class="linenos"> 65</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-66"><a href="#MZMLSpectraParser-66"><span class="linenos"> 66</span></a>    <span class="p">):</span>
</span><span id="MZMLSpectraParser-67"><a href="#MZMLSpectraParser-67"><span class="linenos"> 67</span></a>        <span class="c1"># implementation details</span>
</span><span id="MZMLSpectraParser-68"><a href="#MZMLSpectraParser-68"><span class="linenos"> 68</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-69"><a href="#MZMLSpectraParser-69"><span class="linenos"> 69</span></a>            <span class="c1"># if obj is a string it defaults to create a Path obj, pass the S3Path if needed</span>
</span><span id="MZMLSpectraParser-70"><a href="#MZMLSpectraParser-70"><span class="linenos"> 70</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-71"><a href="#MZMLSpectraParser-71"><span class="linenos"> 71</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="MZMLSpectraParser-72"><a href="#MZMLSpectraParser-72"><span class="linenos"> 72</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;File does not exist: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_location</span><span class="p">))</span>
</span><span id="MZMLSpectraParser-73"><a href="#MZMLSpectraParser-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MZMLSpectraParser-74"><a href="#MZMLSpectraParser-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">analyzer</span>
</span><span id="MZMLSpectraParser-75"><a href="#MZMLSpectraParser-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">=</span> <span class="n">instrument_label</span>
</span><span id="MZMLSpectraParser-76"><a href="#MZMLSpectraParser-76"><span class="linenos"> 76</span></a>
</span><span id="MZMLSpectraParser-77"><a href="#MZMLSpectraParser-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="n">sample_name</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-78"><a href="#MZMLSpectraParser-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">sample_name</span>
</span><span id="MZMLSpectraParser-79"><a href="#MZMLSpectraParser-79"><span class="linenos"> 79</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-80"><a href="#MZMLSpectraParser-80"><span class="linenos"> 80</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">stem</span>
</span><span id="MZMLSpectraParser-81"><a href="#MZMLSpectraParser-81"><span class="linenos"> 81</span></a>
</span><span id="MZMLSpectraParser-82"><a href="#MZMLSpectraParser-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-83"><a href="#MZMLSpectraParser-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-84"><a href="#MZMLSpectraParser-84"><span class="linenos"> 84</span></a><span class="sd">        Load mzML file using pymzml.run.Reader and return the data as a numpy array.</span>
</span><span id="MZMLSpectraParser-85"><a href="#MZMLSpectraParser-85"><span class="linenos"> 85</span></a>
</span><span id="MZMLSpectraParser-86"><a href="#MZMLSpectraParser-86"><span class="linenos"> 86</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-87"><a href="#MZMLSpectraParser-87"><span class="linenos"> 87</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-88"><a href="#MZMLSpectraParser-88"><span class="linenos"> 88</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="MZMLSpectraParser-89"><a href="#MZMLSpectraParser-89"><span class="linenos"> 89</span></a><span class="sd">            The mass spectra data as a numpy array.</span>
</span><span id="MZMLSpectraParser-90"><a href="#MZMLSpectraParser-90"><span class="linenos"> 90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-91"><a href="#MZMLSpectraParser-91"><span class="linenos"> 91</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-92"><a href="#MZMLSpectraParser-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="MZMLSpectraParser-93"><a href="#MZMLSpectraParser-93"><span class="linenos"> 93</span></a>
</span><span id="MZMLSpectraParser-94"><a href="#MZMLSpectraParser-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">get_scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-95"><a href="#MZMLSpectraParser-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-96"><a href="#MZMLSpectraParser-96"><span class="linenos"> 96</span></a><span class="sd">        Return scan data as a pandas DataFrame.</span>
</span><span id="MZMLSpectraParser-97"><a href="#MZMLSpectraParser-97"><span class="linenos"> 97</span></a>
</span><span id="MZMLSpectraParser-98"><a href="#MZMLSpectraParser-98"><span class="linenos"> 98</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser-99"><a href="#MZMLSpectraParser-99"><span class="linenos"> 99</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser-100"><a href="#MZMLSpectraParser-100"><span class="linenos">100</span></a><span class="sd">        data : pymzml.run.Reader</span>
</span><span id="MZMLSpectraParser-101"><a href="#MZMLSpectraParser-101"><span class="linenos">101</span></a><span class="sd">            The mass spectra data.</span>
</span><span id="MZMLSpectraParser-102"><a href="#MZMLSpectraParser-102"><span class="linenos">102</span></a>
</span><span id="MZMLSpectraParser-103"><a href="#MZMLSpectraParser-103"><span class="linenos">103</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-104"><a href="#MZMLSpectraParser-104"><span class="linenos">104</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-105"><a href="#MZMLSpectraParser-105"><span class="linenos">105</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="MZMLSpectraParser-106"><a href="#MZMLSpectraParser-106"><span class="linenos">106</span></a><span class="sd">            A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</span>
</span><span id="MZMLSpectraParser-107"><a href="#MZMLSpectraParser-107"><span class="linenos">107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-108"><a href="#MZMLSpectraParser-108"><span class="linenos">108</span></a>        <span class="c1"># Scan dict</span>
</span><span id="MZMLSpectraParser-109"><a href="#MZMLSpectraParser-109"><span class="linenos">109</span></a>        <span class="c1"># instatinate scan dict, with empty lists of size of scans</span>
</span><span id="MZMLSpectraParser-110"><a href="#MZMLSpectraParser-110"><span class="linenos">110</span></a>        <span class="n">n_scans</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_spectrum_count</span><span class="p">()</span>
</span><span id="MZMLSpectraParser-111"><a href="#MZMLSpectraParser-111"><span class="linenos">111</span></a>        <span class="n">scan_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MZMLSpectraParser-112"><a href="#MZMLSpectraParser-112"><span class="linenos">112</span></a>            <span class="s2">&quot;scan&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-113"><a href="#MZMLSpectraParser-113"><span class="linenos">113</span></a>            <span class="s2">&quot;scan_time&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-114"><a href="#MZMLSpectraParser-114"><span class="linenos">114</span></a>            <span class="s2">&quot;ms_level&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-115"><a href="#MZMLSpectraParser-115"><span class="linenos">115</span></a>            <span class="s2">&quot;polarity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-116"><a href="#MZMLSpectraParser-116"><span class="linenos">116</span></a>            <span class="s2">&quot;precursor_mz&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-117"><a href="#MZMLSpectraParser-117"><span class="linenos">117</span></a>            <span class="s2">&quot;scan_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-118"><a href="#MZMLSpectraParser-118"><span class="linenos">118</span></a>            <span class="s2">&quot;scan_window_lower&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-119"><a href="#MZMLSpectraParser-119"><span class="linenos">119</span></a>            <span class="s2">&quot;scan_window_upper&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-120"><a href="#MZMLSpectraParser-120"><span class="linenos">120</span></a>            <span class="s2">&quot;scan_precision&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-121"><a href="#MZMLSpectraParser-121"><span class="linenos">121</span></a>            <span class="s2">&quot;tic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-122"><a href="#MZMLSpectraParser-122"><span class="linenos">122</span></a>            <span class="s2">&quot;ms_format&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-123"><a href="#MZMLSpectraParser-123"><span class="linenos">123</span></a>        <span class="p">}</span>
</span><span id="MZMLSpectraParser-124"><a href="#MZMLSpectraParser-124"><span class="linenos">124</span></a>
</span><span id="MZMLSpectraParser-125"><a href="#MZMLSpectraParser-125"><span class="linenos">125</span></a>        <span class="c1"># First pass: loop through scans to get scan info</span>
</span><span id="MZMLSpectraParser-126"><a href="#MZMLSpectraParser-126"><span class="linenos">126</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-127"><a href="#MZMLSpectraParser-127"><span class="linenos">127</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">ID</span>
</span><span id="MZMLSpectraParser-128"><a href="#MZMLSpectraParser-128"><span class="linenos">128</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_level&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span>
</span><span id="MZMLSpectraParser-129"><a href="#MZMLSpectraParser-129"><span class="linenos">129</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_precision&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">_measured_precision</span>
</span><span id="MZMLSpectraParser-130"><a href="#MZMLSpectraParser-130"><span class="linenos">130</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;tic&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">TIC</span>
</span><span id="MZMLSpectraParser-131"><a href="#MZMLSpectraParser-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-132"><a href="#MZMLSpectraParser-132"><span class="linenos">132</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;precursor_mz&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-133"><a href="#MZMLSpectraParser-133"><span class="linenos">133</span></a>                    <span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="MZMLSpectraParser-134"><a href="#MZMLSpectraParser-134"><span class="linenos">134</span></a>                <span class="p">)</span>
</span><span id="MZMLSpectraParser-135"><a href="#MZMLSpectraParser-135"><span class="linenos">135</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-136"><a href="#MZMLSpectraParser-136"><span class="linenos">136</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;negative&quot;</span>
</span><span id="MZMLSpectraParser-137"><a href="#MZMLSpectraParser-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-138"><a href="#MZMLSpectraParser-138"><span class="linenos">138</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span>
</span><span id="MZMLSpectraParser-139"><a href="#MZMLSpectraParser-139"><span class="linenos">139</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-140"><a href="#MZMLSpectraParser-140"><span class="linenos">140</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-141"><a href="#MZMLSpectraParser-141"><span class="linenos">141</span></a>                    <span class="s2">&quot;Error: scan </span><span class="si">{0}</span><span class="s2"> has both negative and positive polarity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-142"><a href="#MZMLSpectraParser-142"><span class="linenos">142</span></a>                        <span class="n">spec</span><span class="o">.</span><span class="n">ID</span>
</span><span id="MZMLSpectraParser-143"><a href="#MZMLSpectraParser-143"><span class="linenos">143</span></a>                    <span class="p">)</span>
</span><span id="MZMLSpectraParser-144"><a href="#MZMLSpectraParser-144"><span class="linenos">144</span></a>                <span class="p">)</span>
</span><span id="MZMLSpectraParser-145"><a href="#MZMLSpectraParser-145"><span class="linenos">145</span></a>
</span><span id="MZMLSpectraParser-146"><a href="#MZMLSpectraParser-146"><span class="linenos">146</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000016&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-147"><a href="#MZMLSpectraParser-147"><span class="linenos">147</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000512&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-148"><a href="#MZMLSpectraParser-148"><span class="linenos">148</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_window_lower&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000501&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-149"><a href="#MZMLSpectraParser-149"><span class="linenos">149</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_window_upper&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000500&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-150"><a href="#MZMLSpectraParser-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000128&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-151"><a href="#MZMLSpectraParser-151"><span class="linenos">151</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;profile&quot;</span>
</span><span id="MZMLSpectraParser-152"><a href="#MZMLSpectraParser-152"><span class="linenos">152</span></a>            <span class="k">elif</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000127&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-153"><a href="#MZMLSpectraParser-153"><span class="linenos">153</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centroid&quot;</span>
</span><span id="MZMLSpectraParser-154"><a href="#MZMLSpectraParser-154"><span class="linenos">154</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-155"><a href="#MZMLSpectraParser-155"><span class="linenos">155</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MZMLSpectraParser-156"><a href="#MZMLSpectraParser-156"><span class="linenos">156</span></a>
</span><span id="MZMLSpectraParser-157"><a href="#MZMLSpectraParser-157"><span class="linenos">157</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scan_dict</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-158"><a href="#MZMLSpectraParser-158"><span class="linenos">158</span></a>
</span><span id="MZMLSpectraParser-159"><a href="#MZMLSpectraParser-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="n">scan_df</span>
</span><span id="MZMLSpectraParser-160"><a href="#MZMLSpectraParser-160"><span class="linenos">160</span></a>
</span><span id="MZMLSpectraParser-161"><a href="#MZMLSpectraParser-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">get_ms_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">scan_df</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-162"><a href="#MZMLSpectraParser-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dictionary of mass spectra data as a pandas DataFrame.</span>
</span><span id="MZMLSpectraParser-163"><a href="#MZMLSpectraParser-163"><span class="linenos">163</span></a>
</span><span id="MZMLSpectraParser-164"><a href="#MZMLSpectraParser-164"><span class="linenos">164</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser-165"><a href="#MZMLSpectraParser-165"><span class="linenos">165</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser-166"><a href="#MZMLSpectraParser-166"><span class="linenos">166</span></a><span class="sd">        spectra : str</span>
</span><span id="MZMLSpectraParser-167"><a href="#MZMLSpectraParser-167"><span class="linenos">167</span></a><span class="sd">            Which mass spectra data to include in the output.</span>
</span><span id="MZMLSpectraParser-168"><a href="#MZMLSpectraParser-168"><span class="linenos">168</span></a><span class="sd">            Options: None, &quot;ms1&quot;, &quot;ms2&quot;, &quot;all&quot;.</span>
</span><span id="MZMLSpectraParser-169"><a href="#MZMLSpectraParser-169"><span class="linenos">169</span></a><span class="sd">        scan_df : pandas.DataFrame</span>
</span><span id="MZMLSpectraParser-170"><a href="#MZMLSpectraParser-170"><span class="linenos">170</span></a><span class="sd">            Scan dataframe. Output from get_scan_df().</span>
</span><span id="MZMLSpectraParser-171"><a href="#MZMLSpectraParser-171"><span class="linenos">171</span></a><span class="sd">        data : pymzml.run.Reader</span>
</span><span id="MZMLSpectraParser-172"><a href="#MZMLSpectraParser-172"><span class="linenos">172</span></a><span class="sd">            The mass spectra data.</span>
</span><span id="MZMLSpectraParser-173"><a href="#MZMLSpectraParser-173"><span class="linenos">173</span></a>
</span><span id="MZMLSpectraParser-174"><a href="#MZMLSpectraParser-174"><span class="linenos">174</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-175"><a href="#MZMLSpectraParser-175"><span class="linenos">175</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-176"><a href="#MZMLSpectraParser-176"><span class="linenos">176</span></a><span class="sd">        dict</span>
</span><span id="MZMLSpectraParser-177"><a href="#MZMLSpectraParser-177"><span class="linenos">177</span></a><span class="sd">            A dictionary containing the mass spectra data as pandas DataFrames, with keys corresponding to the MS level.</span>
</span><span id="MZMLSpectraParser-178"><a href="#MZMLSpectraParser-178"><span class="linenos">178</span></a>
</span><span id="MZMLSpectraParser-179"><a href="#MZMLSpectraParser-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-180"><a href="#MZMLSpectraParser-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-181"><a href="#MZMLSpectraParser-181"><span class="linenos">181</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span>
</span><span id="MZMLSpectraParser-182"><a href="#MZMLSpectraParser-182"><span class="linenos">182</span></a>        <span class="k">elif</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;ms1&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-183"><a href="#MZMLSpectraParser-183"><span class="linenos">183</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span><span class="p">[</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-184"><a href="#MZMLSpectraParser-184"><span class="linenos">184</span></a>        <span class="k">elif</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;ms2&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-185"><a href="#MZMLSpectraParser-185"><span class="linenos">185</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span><span class="p">[</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-186"><a href="#MZMLSpectraParser-186"><span class="linenos">186</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-187"><a href="#MZMLSpectraParser-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectra must be &#39;all&#39;, &#39;ms1&#39;, or &#39;ms2&#39;&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-188"><a href="#MZMLSpectraParser-188"><span class="linenos">188</span></a>
</span><span id="MZMLSpectraParser-189"><a href="#MZMLSpectraParser-189"><span class="linenos">189</span></a>        <span class="c1"># Result container</span>
</span><span id="MZMLSpectraParser-190"><a href="#MZMLSpectraParser-190"><span class="linenos">190</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MZMLSpectraParser-191"><a href="#MZMLSpectraParser-191"><span class="linenos">191</span></a>
</span><span id="MZMLSpectraParser-192"><a href="#MZMLSpectraParser-192"><span class="linenos">192</span></a>        <span class="c1"># Row count container</span>
</span><span id="MZMLSpectraParser-193"><a href="#MZMLSpectraParser-193"><span class="linenos">193</span></a>        <span class="n">counter</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MZMLSpectraParser-194"><a href="#MZMLSpectraParser-194"><span class="linenos">194</span></a>
</span><span id="MZMLSpectraParser-195"><a href="#MZMLSpectraParser-195"><span class="linenos">195</span></a>        <span class="c1"># Column name container</span>
</span><span id="MZMLSpectraParser-196"><a href="#MZMLSpectraParser-196"><span class="linenos">196</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MZMLSpectraParser-197"><a href="#MZMLSpectraParser-197"><span class="linenos">197</span></a>
</span><span id="MZMLSpectraParser-198"><a href="#MZMLSpectraParser-198"><span class="linenos">198</span></a>        <span class="c1"># set at float32</span>
</span><span id="MZMLSpectraParser-199"><a href="#MZMLSpectraParser-199"><span class="linenos">199</span></a>        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="MZMLSpectraParser-200"><a href="#MZMLSpectraParser-200"><span class="linenos">200</span></a>
</span><span id="MZMLSpectraParser-201"><a href="#MZMLSpectraParser-201"><span class="linenos">201</span></a>        <span class="c1"># First pass: get nrows</span>
</span><span id="MZMLSpectraParser-202"><a href="#MZMLSpectraParser-202"><span class="linenos">202</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-203"><a href="#MZMLSpectraParser-203"><span class="linenos">203</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-204"><a href="#MZMLSpectraParser-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scan_df_forspec</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-205"><a href="#MZMLSpectraParser-205"><span class="linenos">205</span></a>                <span class="c1"># Get ms level</span>
</span><span id="MZMLSpectraParser-206"><a href="#MZMLSpectraParser-206"><span class="linenos">206</span></a>                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;ms</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-207"><a href="#MZMLSpectraParser-207"><span class="linenos">207</span></a>
</span><span id="MZMLSpectraParser-208"><a href="#MZMLSpectraParser-208"><span class="linenos">208</span></a>                <span class="c1"># Number of rows</span>
</span><span id="MZMLSpectraParser-209"><a href="#MZMLSpectraParser-209"><span class="linenos">209</span></a>                <span class="n">N</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-210"><a href="#MZMLSpectraParser-210"><span class="linenos">210</span></a>
</span><span id="MZMLSpectraParser-211"><a href="#MZMLSpectraParser-211"><span class="linenos">211</span></a>        <span class="c1"># Second pass: parse</span>
</span><span id="MZMLSpectraParser-212"><a href="#MZMLSpectraParser-212"><span class="linenos">212</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-213"><a href="#MZMLSpectraParser-213"><span class="linenos">213</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scan_df_forspec</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-214"><a href="#MZMLSpectraParser-214"><span class="linenos">214</span></a>                <span class="c1"># Number of rows</span>
</span><span id="MZMLSpectraParser-215"><a href="#MZMLSpectraParser-215"><span class="linenos">215</span></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-216"><a href="#MZMLSpectraParser-216"><span class="linenos">216</span></a>
</span><span id="MZMLSpectraParser-217"><a href="#MZMLSpectraParser-217"><span class="linenos">217</span></a>                <span class="c1"># No measurements</span>
</span><span id="MZMLSpectraParser-218"><a href="#MZMLSpectraParser-218"><span class="linenos">218</span></a>                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-219"><a href="#MZMLSpectraParser-219"><span class="linenos">219</span></a>                    <span class="k">continue</span>
</span><span id="MZMLSpectraParser-220"><a href="#MZMLSpectraParser-220"><span class="linenos">220</span></a>
</span><span id="MZMLSpectraParser-221"><a href="#MZMLSpectraParser-221"><span class="linenos">221</span></a>                <span class="c1"># Dimension check</span>
</span><span id="MZMLSpectraParser-222"><a href="#MZMLSpectraParser-222"><span class="linenos">222</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-223"><a href="#MZMLSpectraParser-223"><span class="linenos">223</span></a>                    <span class="c1"># raise an error if the mz and intensity arrays are not the same length</span>
</span><span id="MZMLSpectraParser-224"><a href="#MZMLSpectraParser-224"><span class="linenos">224</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;m/z and intensity array dimension mismatch&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-225"><a href="#MZMLSpectraParser-225"><span class="linenos">225</span></a>
</span><span id="MZMLSpectraParser-226"><a href="#MZMLSpectraParser-226"><span class="linenos">226</span></a>                <span class="c1"># Scan/frame info</span>
</span><span id="MZMLSpectraParser-227"><a href="#MZMLSpectraParser-227"><span class="linenos">227</span></a>                <span class="n">id_dict</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">id_dict</span>
</span><span id="MZMLSpectraParser-228"><a href="#MZMLSpectraParser-228"><span class="linenos">228</span></a>
</span><span id="MZMLSpectraParser-229"><a href="#MZMLSpectraParser-229"><span class="linenos">229</span></a>                <span class="c1"># Get ms level</span>
</span><span id="MZMLSpectraParser-230"><a href="#MZMLSpectraParser-230"><span class="linenos">230</span></a>                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;ms</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-231"><a href="#MZMLSpectraParser-231"><span class="linenos">231</span></a>
</span><span id="MZMLSpectraParser-232"><a href="#MZMLSpectraParser-232"><span class="linenos">232</span></a>                <span class="c1"># Columns</span>
</span><span id="MZMLSpectraParser-233"><a href="#MZMLSpectraParser-233"><span class="linenos">233</span></a>                <span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">id_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-234"><a href="#MZMLSpectraParser-234"><span class="linenos">234</span></a>                <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
</span><span id="MZMLSpectraParser-235"><a href="#MZMLSpectraParser-235"><span class="linenos">235</span></a>
</span><span id="MZMLSpectraParser-236"><a href="#MZMLSpectraParser-236"><span class="linenos">236</span></a>                <span class="c1"># Subarray init</span>
</span><span id="MZMLSpectraParser-237"><a href="#MZMLSpectraParser-237"><span class="linenos">237</span></a>                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-238"><a href="#MZMLSpectraParser-238"><span class="linenos">238</span></a>                <span class="n">inx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MZMLSpectraParser-239"><a href="#MZMLSpectraParser-239"><span class="linenos">239</span></a>
</span><span id="MZMLSpectraParser-240"><a href="#MZMLSpectraParser-240"><span class="linenos">240</span></a>                <span class="c1"># Populate scan/frame info</span>
</span><span id="MZMLSpectraParser-241"><a href="#MZMLSpectraParser-241"><span class="linenos">241</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MZMLSpectraParser-242"><a href="#MZMLSpectraParser-242"><span class="linenos">242</span></a>                    <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="MZMLSpectraParser-243"><a href="#MZMLSpectraParser-243"><span class="linenos">243</span></a>                    <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser-244"><a href="#MZMLSpectraParser-244"><span class="linenos">244</span></a>
</span><span id="MZMLSpectraParser-245"><a href="#MZMLSpectraParser-245"><span class="linenos">245</span></a>                <span class="c1"># Populate m/z</span>
</span><span id="MZMLSpectraParser-246"><a href="#MZMLSpectraParser-246"><span class="linenos">246</span></a>                <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span>
</span><span id="MZMLSpectraParser-247"><a href="#MZMLSpectraParser-247"><span class="linenos">247</span></a>                <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser-248"><a href="#MZMLSpectraParser-248"><span class="linenos">248</span></a>
</span><span id="MZMLSpectraParser-249"><a href="#MZMLSpectraParser-249"><span class="linenos">249</span></a>                <span class="c1"># Populate intensity</span>
</span><span id="MZMLSpectraParser-250"><a href="#MZMLSpectraParser-250"><span class="linenos">250</span></a>                <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span>
</span><span id="MZMLSpectraParser-251"><a href="#MZMLSpectraParser-251"><span class="linenos">251</span></a>                <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser-252"><a href="#MZMLSpectraParser-252"><span class="linenos">252</span></a>
</span><span id="MZMLSpectraParser-253"><a href="#MZMLSpectraParser-253"><span class="linenos">253</span></a>                <span class="c1"># Initialize output container</span>
</span><span id="MZMLSpectraParser-254"><a href="#MZMLSpectraParser-254"><span class="linenos">254</span></a>                <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-255"><a href="#MZMLSpectraParser-255"><span class="linenos">255</span></a>                    <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-256"><a href="#MZMLSpectraParser-256"><span class="linenos">256</span></a>                    <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MZMLSpectraParser-257"><a href="#MZMLSpectraParser-257"><span class="linenos">257</span></a>
</span><span id="MZMLSpectraParser-258"><a href="#MZMLSpectraParser-258"><span class="linenos">258</span></a>                <span class="c1"># Insert subarray</span>
</span><span id="MZMLSpectraParser-259"><a href="#MZMLSpectraParser-259"><span class="linenos">259</span></a>                <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="p">:</span> <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">arr</span>
</span><span id="MZMLSpectraParser-260"><a href="#MZMLSpectraParser-260"><span class="linenos">260</span></a>                <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span>
</span><span id="MZMLSpectraParser-261"><a href="#MZMLSpectraParser-261"><span class="linenos">261</span></a>
</span><span id="MZMLSpectraParser-262"><a href="#MZMLSpectraParser-262"><span class="linenos">262</span></a>        <span class="c1"># Construct ms1 and ms2 mz dataframes</span>
</span><span id="MZMLSpectraParser-263"><a href="#MZMLSpectraParser-263"><span class="linenos">263</span></a>        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="MZMLSpectraParser-264"><a href="#MZMLSpectraParser-264"><span class="linenos">264</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-265"><a href="#MZMLSpectraParser-265"><span class="linenos">265</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;controllerType&quot;</span><span class="p">,</span> <span class="s2">&quot;controllerNumber&quot;</span><span class="p">],</span>
</span><span id="MZMLSpectraParser-266"><a href="#MZMLSpectraParser-266"><span class="linenos">266</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-267"><a href="#MZMLSpectraParser-267"><span class="linenos">267</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-268"><a href="#MZMLSpectraParser-268"><span class="linenos">268</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser-269"><a href="#MZMLSpectraParser-269"><span class="linenos">269</span></a>
</span><span id="MZMLSpectraParser-270"><a href="#MZMLSpectraParser-270"><span class="linenos">270</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="MZMLSpectraParser-271"><a href="#MZMLSpectraParser-271"><span class="linenos">271</span></a>
</span><span id="MZMLSpectraParser-272"><a href="#MZMLSpectraParser-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">scan_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-273"><a href="#MZMLSpectraParser-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the mzML file and return a dictionary of spectra dataframes and a scan metadata dataframe.</span>
</span><span id="MZMLSpectraParser-274"><a href="#MZMLSpectraParser-274"><span class="linenos">274</span></a>
</span><span id="MZMLSpectraParser-275"><a href="#MZMLSpectraParser-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser-276"><a href="#MZMLSpectraParser-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser-277"><a href="#MZMLSpectraParser-277"><span class="linenos">277</span></a><span class="sd">        spectra : str, optional</span>
</span><span id="MZMLSpectraParser-278"><a href="#MZMLSpectraParser-278"><span class="linenos">278</span></a><span class="sd">            Which mass spectra data to include in the output. Default is &quot;all&quot;.</span>
</span><span id="MZMLSpectraParser-279"><a href="#MZMLSpectraParser-279"><span class="linenos">279</span></a><span class="sd">            Other options: None, &quot;ms1&quot;, &quot;ms2&quot;.</span>
</span><span id="MZMLSpectraParser-280"><a href="#MZMLSpectraParser-280"><span class="linenos">280</span></a><span class="sd">        scan_df : pandas.DataFrame, optional</span>
</span><span id="MZMLSpectraParser-281"><a href="#MZMLSpectraParser-281"><span class="linenos">281</span></a><span class="sd">            Scan dataframe.  If not provided, the scan dataframe is created from the mzML file.</span>
</span><span id="MZMLSpectraParser-282"><a href="#MZMLSpectraParser-282"><span class="linenos">282</span></a>
</span><span id="MZMLSpectraParser-283"><a href="#MZMLSpectraParser-283"><span class="linenos">283</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-284"><a href="#MZMLSpectraParser-284"><span class="linenos">284</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-285"><a href="#MZMLSpectraParser-285"><span class="linenos">285</span></a><span class="sd">        tuple</span>
</span><span id="MZMLSpectraParser-286"><a href="#MZMLSpectraParser-286"><span class="linenos">286</span></a><span class="sd">            A tuple containing two elements:</span>
</span><span id="MZMLSpectraParser-287"><a href="#MZMLSpectraParser-287"><span class="linenos">287</span></a><span class="sd">            - A dictionary containing the mass spectra data as numpy arrays, with keys corresponding to the MS level.</span>
</span><span id="MZMLSpectraParser-288"><a href="#MZMLSpectraParser-288"><span class="linenos">288</span></a><span class="sd">            - A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</span>
</span><span id="MZMLSpectraParser-289"><a href="#MZMLSpectraParser-289"><span class="linenos">289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-290"><a href="#MZMLSpectraParser-290"><span class="linenos">290</span></a>
</span><span id="MZMLSpectraParser-291"><a href="#MZMLSpectraParser-291"><span class="linenos">291</span></a>        <span class="c1"># Open file</span>
</span><span id="MZMLSpectraParser-292"><a href="#MZMLSpectraParser-292"><span class="linenos">292</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="MZMLSpectraParser-293"><a href="#MZMLSpectraParser-293"><span class="linenos">293</span></a>
</span><span id="MZMLSpectraParser-294"><a href="#MZMLSpectraParser-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">scan_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-295"><a href="#MZMLSpectraParser-295"><span class="linenos">295</span></a>            <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_df</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-296"><a href="#MZMLSpectraParser-296"><span class="linenos">296</span></a>
</span><span id="MZMLSpectraParser-297"><a href="#MZMLSpectraParser-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">spectra</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-298"><a href="#MZMLSpectraParser-298"><span class="linenos">298</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ms_raw</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">scan_df</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-299"><a href="#MZMLSpectraParser-299"><span class="linenos">299</span></a>
</span><span id="MZMLSpectraParser-300"><a href="#MZMLSpectraParser-300"><span class="linenos">300</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-301"><a href="#MZMLSpectraParser-301"><span class="linenos">301</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MZMLSpectraParser-302"><a href="#MZMLSpectraParser-302"><span class="linenos">302</span></a>
</span><span id="MZMLSpectraParser-303"><a href="#MZMLSpectraParser-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">scan_df</span>
</span><span id="MZMLSpectraParser-304"><a href="#MZMLSpectraParser-304"><span class="linenos">304</span></a>
</span><span id="MZMLSpectraParser-305"><a href="#MZMLSpectraParser-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">get_mass_spectrum_from_scan</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-306"><a href="#MZMLSpectraParser-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">,</span> <span class="n">spectrum_mode</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span>
</span><span id="MZMLSpectraParser-307"><a href="#MZMLSpectraParser-307"><span class="linenos">307</span></a>    <span class="p">):</span>
</span><span id="MZMLSpectraParser-308"><a href="#MZMLSpectraParser-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiate a mass spectrum object from the mzML file.</span>
</span><span id="MZMLSpectraParser-309"><a href="#MZMLSpectraParser-309"><span class="linenos">309</span></a>
</span><span id="MZMLSpectraParser-310"><a href="#MZMLSpectraParser-310"><span class="linenos">310</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser-311"><a href="#MZMLSpectraParser-311"><span class="linenos">311</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser-312"><a href="#MZMLSpectraParser-312"><span class="linenos">312</span></a><span class="sd">        scan_number : int</span>
</span><span id="MZMLSpectraParser-313"><a href="#MZMLSpectraParser-313"><span class="linenos">313</span></a><span class="sd">            The scan number to be parsed.</span>
</span><span id="MZMLSpectraParser-314"><a href="#MZMLSpectraParser-314"><span class="linenos">314</span></a><span class="sd">        spectrum_mode : str</span>
</span><span id="MZMLSpectraParser-315"><a href="#MZMLSpectraParser-315"><span class="linenos">315</span></a><span class="sd">            The type of spectrum to instantiate.  Must be&#39;profile&#39; or &#39;centroid&#39;.</span>
</span><span id="MZMLSpectraParser-316"><a href="#MZMLSpectraParser-316"><span class="linenos">316</span></a><span class="sd">        polarity : int</span>
</span><span id="MZMLSpectraParser-317"><a href="#MZMLSpectraParser-317"><span class="linenos">317</span></a><span class="sd">            The polarity of the scan.  Must be -1 or 1.</span>
</span><span id="MZMLSpectraParser-318"><a href="#MZMLSpectraParser-318"><span class="linenos">318</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="MZMLSpectraParser-319"><a href="#MZMLSpectraParser-319"><span class="linenos">319</span></a><span class="sd">            If True, process the mass spectrum. Default is True.</span>
</span><span id="MZMLSpectraParser-320"><a href="#MZMLSpectraParser-320"><span class="linenos">320</span></a>
</span><span id="MZMLSpectraParser-321"><a href="#MZMLSpectraParser-321"><span class="linenos">321</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-322"><a href="#MZMLSpectraParser-322"><span class="linenos">322</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-323"><a href="#MZMLSpectraParser-323"><span class="linenos">323</span></a><span class="sd">        MassSpecProfile | MassSpecCentroid</span>
</span><span id="MZMLSpectraParser-324"><a href="#MZMLSpectraParser-324"><span class="linenos">324</span></a><span class="sd">            The MassSpecProfile or MassSpecCentroid object containing the parsed mass spectrum.</span>
</span><span id="MZMLSpectraParser-325"><a href="#MZMLSpectraParser-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-326"><a href="#MZMLSpectraParser-326"><span class="linenos">326</span></a>
</span><span id="MZMLSpectraParser-327"><a href="#MZMLSpectraParser-327"><span class="linenos">327</span></a>        <span class="k">def</span> <span class="nf">set_metadata</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-328"><a href="#MZMLSpectraParser-328"><span class="linenos">328</span></a>            <span class="n">scan_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-329"><a href="#MZMLSpectraParser-329"><span class="linenos">329</span></a>            <span class="n">polarity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-330"><a href="#MZMLSpectraParser-330"><span class="linenos">330</span></a>            <span class="n">file_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-331"><a href="#MZMLSpectraParser-331"><span class="linenos">331</span></a>            <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">thermo_profile</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-332"><a href="#MZMLSpectraParser-332"><span class="linenos">332</span></a>        <span class="p">):</span>
</span><span id="MZMLSpectraParser-333"><a href="#MZMLSpectraParser-333"><span class="linenos">333</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-334"><a href="#MZMLSpectraParser-334"><span class="linenos">334</span></a><span class="sd">            Set the output parameters for creating a MassSpecProfile or MassSpecCentroid object.</span>
</span><span id="MZMLSpectraParser-335"><a href="#MZMLSpectraParser-335"><span class="linenos">335</span></a>
</span><span id="MZMLSpectraParser-336"><a href="#MZMLSpectraParser-336"><span class="linenos">336</span></a><span class="sd">            Parameters</span>
</span><span id="MZMLSpectraParser-337"><a href="#MZMLSpectraParser-337"><span class="linenos">337</span></a><span class="sd">            ----------</span>
</span><span id="MZMLSpectraParser-338"><a href="#MZMLSpectraParser-338"><span class="linenos">338</span></a><span class="sd">            scan_number : int</span>
</span><span id="MZMLSpectraParser-339"><a href="#MZMLSpectraParser-339"><span class="linenos">339</span></a><span class="sd">                The scan number.</span>
</span><span id="MZMLSpectraParser-340"><a href="#MZMLSpectraParser-340"><span class="linenos">340</span></a><span class="sd">            polarity : int</span>
</span><span id="MZMLSpectraParser-341"><a href="#MZMLSpectraParser-341"><span class="linenos">341</span></a><span class="sd">                The polarity of the data.</span>
</span><span id="MZMLSpectraParser-342"><a href="#MZMLSpectraParser-342"><span class="linenos">342</span></a><span class="sd">            file_location : str</span>
</span><span id="MZMLSpectraParser-343"><a href="#MZMLSpectraParser-343"><span class="linenos">343</span></a><span class="sd">                The file location.</span>
</span><span id="MZMLSpectraParser-344"><a href="#MZMLSpectraParser-344"><span class="linenos">344</span></a><span class="sd">            label : str, optional</span>
</span><span id="MZMLSpectraParser-345"><a href="#MZMLSpectraParser-345"><span class="linenos">345</span></a><span class="sd">                The label for the mass spectrum. Default is Labels.thermo_profile.</span>
</span><span id="MZMLSpectraParser-346"><a href="#MZMLSpectraParser-346"><span class="linenos">346</span></a>
</span><span id="MZMLSpectraParser-347"><a href="#MZMLSpectraParser-347"><span class="linenos">347</span></a><span class="sd">            Returns</span>
</span><span id="MZMLSpectraParser-348"><a href="#MZMLSpectraParser-348"><span class="linenos">348</span></a><span class="sd">            -------</span>
</span><span id="MZMLSpectraParser-349"><a href="#MZMLSpectraParser-349"><span class="linenos">349</span></a><span class="sd">            dict</span>
</span><span id="MZMLSpectraParser-350"><a href="#MZMLSpectraParser-350"><span class="linenos">350</span></a><span class="sd">                The output parameters ready for creating a MassSpecProfile or MassSpecCentroid object.</span>
</span><span id="MZMLSpectraParser-351"><a href="#MZMLSpectraParser-351"><span class="linenos">351</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-352"><a href="#MZMLSpectraParser-352"><span class="linenos">352</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">default_parameters</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-353"><a href="#MZMLSpectraParser-353"><span class="linenos">353</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="MZMLSpectraParser-354"><a href="#MZMLSpectraParser-354"><span class="linenos">354</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polarity</span>
</span><span id="MZMLSpectraParser-355"><a href="#MZMLSpectraParser-355"><span class="linenos">355</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;filename_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MZMLSpectraParser-356"><a href="#MZMLSpectraParser-356"><span class="linenos">356</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;scan_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_number</span>
</span><span id="MZMLSpectraParser-357"><a href="#MZMLSpectraParser-357"><span class="linenos">357</span></a>
</span><span id="MZMLSpectraParser-358"><a href="#MZMLSpectraParser-358"><span class="linenos">358</span></a>            <span class="k">return</span> <span class="n">d_params</span>
</span><span id="MZMLSpectraParser-359"><a href="#MZMLSpectraParser-359"><span class="linenos">359</span></a>
</span><span id="MZMLSpectraParser-360"><a href="#MZMLSpectraParser-360"><span class="linenos">360</span></a>        <span class="c1"># Open file</span>
</span><span id="MZMLSpectraParser-361"><a href="#MZMLSpectraParser-361"><span class="linenos">361</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="MZMLSpectraParser-362"><a href="#MZMLSpectraParser-362"><span class="linenos">362</span></a>
</span><span id="MZMLSpectraParser-363"><a href="#MZMLSpectraParser-363"><span class="linenos">363</span></a>        <span class="c1"># Pluck out individual scan mz and intensity</span>
</span><span id="MZMLSpectraParser-364"><a href="#MZMLSpectraParser-364"><span class="linenos">364</span></a>        <span class="n">spec</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">scan_number</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-365"><a href="#MZMLSpectraParser-365"><span class="linenos">365</span></a>
</span><span id="MZMLSpectraParser-366"><a href="#MZMLSpectraParser-366"><span class="linenos">366</span></a>        <span class="c1"># Get polarity</span>
</span><span id="MZMLSpectraParser-367"><a href="#MZMLSpectraParser-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-368"><a href="#MZMLSpectraParser-368"><span class="linenos">368</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="MZMLSpectraParser-369"><a href="#MZMLSpectraParser-369"><span class="linenos">369</span></a>        <span class="k">elif</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-370"><a href="#MZMLSpectraParser-370"><span class="linenos">370</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser-371"><a href="#MZMLSpectraParser-371"><span class="linenos">371</span></a>
</span><span id="MZMLSpectraParser-372"><a href="#MZMLSpectraParser-372"><span class="linenos">372</span></a>        <span class="c1"># Get mass spectrum</span>
</span><span id="MZMLSpectraParser-373"><a href="#MZMLSpectraParser-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="n">spectrum_mode</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-374"><a href="#MZMLSpectraParser-374"><span class="linenos">374</span></a>            <span class="c1"># Check if profile</span>
</span><span id="MZMLSpectraParser-375"><a href="#MZMLSpectraParser-375"><span class="linenos">375</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000128&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-376"><a href="#MZMLSpectraParser-376"><span class="linenos">376</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectrum is not profile&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-377"><a href="#MZMLSpectraParser-377"><span class="linenos">377</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MZMLSpectraParser-378"><a href="#MZMLSpectraParser-378"><span class="linenos">378</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">mz</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-379"><a href="#MZMLSpectraParser-379"><span class="linenos">379</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">abundance</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-380"><a href="#MZMLSpectraParser-380"><span class="linenos">380</span></a>            <span class="p">}</span>
</span><span id="MZMLSpectraParser-381"><a href="#MZMLSpectraParser-381"><span class="linenos">381</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">set_metadata</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-382"><a href="#MZMLSpectraParser-382"><span class="linenos">382</span></a>                <span class="n">scan_number</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-383"><a href="#MZMLSpectraParser-383"><span class="linenos">383</span></a>                <span class="n">polarity</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-384"><a href="#MZMLSpectraParser-384"><span class="linenos">384</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-385"><a href="#MZMLSpectraParser-385"><span class="linenos">385</span></a>                <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">simulated_profile</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-386"><a href="#MZMLSpectraParser-386"><span class="linenos">386</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser-387"><a href="#MZMLSpectraParser-387"><span class="linenos">387</span></a>            <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">MassSpecProfile</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-388"><a href="#MZMLSpectraParser-388"><span class="linenos">388</span></a>                <span class="n">data_dict</span><span class="p">,</span> <span class="n">d_params</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span>
</span><span id="MZMLSpectraParser-389"><a href="#MZMLSpectraParser-389"><span class="linenos">389</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser-390"><a href="#MZMLSpectraParser-390"><span class="linenos">390</span></a>        <span class="k">elif</span> <span class="n">spectrum_mode</span> <span class="o">==</span> <span class="s2">&quot;centroid&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-391"><a href="#MZMLSpectraParser-391"><span class="linenos">391</span></a>            <span class="c1"># Check if centroided</span>
</span><span id="MZMLSpectraParser-392"><a href="#MZMLSpectraParser-392"><span class="linenos">392</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000127&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-393"><a href="#MZMLSpectraParser-393"><span class="linenos">393</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectrum is not centroided&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-394"><a href="#MZMLSpectraParser-394"><span class="linenos">394</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MZMLSpectraParser-395"><a href="#MZMLSpectraParser-395"><span class="linenos">395</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">mz</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-396"><a href="#MZMLSpectraParser-396"><span class="linenos">396</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">abundance</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-397"><a href="#MZMLSpectraParser-397"><span class="linenos">397</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">rp</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-398"><a href="#MZMLSpectraParser-398"><span class="linenos">398</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">s2n</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">),</span>
</span><span id="MZMLSpectraParser-399"><a href="#MZMLSpectraParser-399"><span class="linenos">399</span></a>            <span class="p">}</span>
</span><span id="MZMLSpectraParser-400"><a href="#MZMLSpectraParser-400"><span class="linenos">400</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">set_metadata</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-401"><a href="#MZMLSpectraParser-401"><span class="linenos">401</span></a>                <span class="n">scan_number</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">corems_centroid</span>
</span><span id="MZMLSpectraParser-402"><a href="#MZMLSpectraParser-402"><span class="linenos">402</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser-403"><a href="#MZMLSpectraParser-403"><span class="linenos">403</span></a>            <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">MassSpecCentroid</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-404"><a href="#MZMLSpectraParser-404"><span class="linenos">404</span></a>                <span class="n">data_dict</span><span class="p">,</span> <span class="n">d_params</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span>
</span><span id="MZMLSpectraParser-405"><a href="#MZMLSpectraParser-405"><span class="linenos">405</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser-406"><a href="#MZMLSpectraParser-406"><span class="linenos">406</span></a>
</span><span id="MZMLSpectraParser-407"><a href="#MZMLSpectraParser-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="n">mass_spectrum_obj</span>
</span><span id="MZMLSpectraParser-408"><a href="#MZMLSpectraParser-408"><span class="linenos">408</span></a>
</span><span id="MZMLSpectraParser-409"><a href="#MZMLSpectraParser-409"><span class="linenos">409</span></a>    <span class="k">def</span> <span class="nf">get_mass_spectra_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-410"><a href="#MZMLSpectraParser-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiate a MassSpectraBase object from the mzML file.</span>
</span><span id="MZMLSpectraParser-411"><a href="#MZMLSpectraParser-411"><span class="linenos">411</span></a>
</span><span id="MZMLSpectraParser-412"><a href="#MZMLSpectraParser-412"><span class="linenos">412</span></a>
</span><span id="MZMLSpectraParser-413"><a href="#MZMLSpectraParser-413"><span class="linenos">413</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-414"><a href="#MZMLSpectraParser-414"><span class="linenos">414</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-415"><a href="#MZMLSpectraParser-415"><span class="linenos">415</span></a><span class="sd">        MassSpectraBase</span>
</span><span id="MZMLSpectraParser-416"><a href="#MZMLSpectraParser-416"><span class="linenos">416</span></a><span class="sd">            The MassSpectra object containing the parsed mass spectra.</span>
</span><span id="MZMLSpectraParser-417"><a href="#MZMLSpectraParser-417"><span class="linenos">417</span></a><span class="sd">            The object is instatiated with the mzML file, analyzer, instrument, sample name, and scan dataframe.</span>
</span><span id="MZMLSpectraParser-418"><a href="#MZMLSpectraParser-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-419"><a href="#MZMLSpectraParser-419"><span class="linenos">419</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">spectra</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-420"><a href="#MZMLSpectraParser-420"><span class="linenos">420</span></a>        <span class="n">mass_spectra_obj</span> <span class="o">=</span> <span class="n">MassSpectraBase</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-421"><a href="#MZMLSpectraParser-421"><span class="linenos">421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-422"><a href="#MZMLSpectraParser-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-423"><a href="#MZMLSpectraParser-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-424"><a href="#MZMLSpectraParser-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-425"><a href="#MZMLSpectraParser-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-426"><a href="#MZMLSpectraParser-426"><span class="linenos">426</span></a>        <span class="p">)</span>
</span><span id="MZMLSpectraParser-427"><a href="#MZMLSpectraParser-427"><span class="linenos">427</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-428"><a href="#MZMLSpectraParser-428"><span class="linenos">428</span></a>        <span class="n">mass_spectra_obj</span><span class="o">.</span><span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span>
</span><span id="MZMLSpectraParser-429"><a href="#MZMLSpectraParser-429"><span class="linenos">429</span></a>
</span><span id="MZMLSpectraParser-430"><a href="#MZMLSpectraParser-430"><span class="linenos">430</span></a>        <span class="k">return</span> <span class="n">mass_spectra_obj</span>
</span><span id="MZMLSpectraParser-431"><a href="#MZMLSpectraParser-431"><span class="linenos">431</span></a>
</span><span id="MZMLSpectraParser-432"><a href="#MZMLSpectraParser-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">get_lcms_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser-433"><a href="#MZMLSpectraParser-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiates a LCMSBase object from the mzML file.</span>
</span><span id="MZMLSpectraParser-434"><a href="#MZMLSpectraParser-434"><span class="linenos">434</span></a>
</span><span id="MZMLSpectraParser-435"><a href="#MZMLSpectraParser-435"><span class="linenos">435</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser-436"><a href="#MZMLSpectraParser-436"><span class="linenos">436</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser-437"><a href="#MZMLSpectraParser-437"><span class="linenos">437</span></a><span class="sd">        spectra : str, optional</span>
</span><span id="MZMLSpectraParser-438"><a href="#MZMLSpectraParser-438"><span class="linenos">438</span></a><span class="sd">            Which mass spectra data to include in the output. Default is all.  Other options: none, ms1, ms2.</span>
</span><span id="MZMLSpectraParser-439"><a href="#MZMLSpectraParser-439"><span class="linenos">439</span></a>
</span><span id="MZMLSpectraParser-440"><a href="#MZMLSpectraParser-440"><span class="linenos">440</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser-441"><a href="#MZMLSpectraParser-441"><span class="linenos">441</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser-442"><a href="#MZMLSpectraParser-442"><span class="linenos">442</span></a><span class="sd">        LCMSBase</span>
</span><span id="MZMLSpectraParser-443"><a href="#MZMLSpectraParser-443"><span class="linenos">443</span></a><span class="sd">            LCMS object containing mass spectra data.</span>
</span><span id="MZMLSpectraParser-444"><a href="#MZMLSpectraParser-444"><span class="linenos">444</span></a><span class="sd">            The object is instatiated with the mzML file, analyzer, instrument, sample name, scan dataframe,</span>
</span><span id="MZMLSpectraParser-445"><a href="#MZMLSpectraParser-445"><span class="linenos">445</span></a><span class="sd">            and mz dataframe(s), as well as lists of scan numbers, retention times, and TICs.</span>
</span><span id="MZMLSpectraParser-446"><a href="#MZMLSpectraParser-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser-447"><a href="#MZMLSpectraParser-447"><span class="linenos">447</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>  <span class="c1"># first run it to just get scan info</span>
</span><span id="MZMLSpectraParser-448"><a href="#MZMLSpectraParser-448"><span class="linenos">448</span></a>        <span class="n">res</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-449"><a href="#MZMLSpectraParser-449"><span class="linenos">449</span></a>            <span class="n">scan_df</span><span class="o">=</span><span class="n">scan_df</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">spectra</span>
</span><span id="MZMLSpectraParser-450"><a href="#MZMLSpectraParser-450"><span class="linenos">450</span></a>        <span class="p">)</span>  <span class="c1"># second run to parse data</span>
</span><span id="MZMLSpectraParser-451"><a href="#MZMLSpectraParser-451"><span class="linenos">451</span></a>        <span class="n">lcms_obj</span> <span class="o">=</span> <span class="n">LCMSBase</span><span class="p">(</span>
</span><span id="MZMLSpectraParser-452"><a href="#MZMLSpectraParser-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-453"><a href="#MZMLSpectraParser-453"><span class="linenos">453</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-454"><a href="#MZMLSpectraParser-454"><span class="linenos">454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-455"><a href="#MZMLSpectraParser-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-456"><a href="#MZMLSpectraParser-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MZMLSpectraParser-457"><a href="#MZMLSpectraParser-457"><span class="linenos">457</span></a>        <span class="p">)</span>
</span><span id="MZMLSpectraParser-458"><a href="#MZMLSpectraParser-458"><span class="linenos">458</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-459"><a href="#MZMLSpectraParser-459"><span class="linenos">459</span></a>            <span class="n">key_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="MZMLSpectraParser-460"><a href="#MZMLSpectraParser-460"><span class="linenos">460</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">intensity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-461"><a href="#MZMLSpectraParser-461"><span class="linenos">461</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="s2">&quot;mz&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-462"><a href="#MZMLSpectraParser-462"><span class="linenos">462</span></a>            <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">key_int</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-463"><a href="#MZMLSpectraParser-463"><span class="linenos">463</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-464"><a href="#MZMLSpectraParser-464"><span class="linenos">464</span></a>        <span class="c1"># Check if polarity is mixed</span>
</span><span id="MZMLSpectraParser-465"><a href="#MZMLSpectraParser-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">polarity</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MZMLSpectraParser-466"><a href="#MZMLSpectraParser-466"><span class="linenos">466</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mixed polarities detected in scan data&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-467"><a href="#MZMLSpectraParser-467"><span class="linenos">467</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">polarity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser-468"><a href="#MZMLSpectraParser-468"><span class="linenos">468</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">scan</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-469"><a href="#MZMLSpectraParser-469"><span class="linenos">469</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-470"><a href="#MZMLSpectraParser-470"><span class="linenos">470</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">tic</span><span class="p">)</span>
</span><span id="MZMLSpectraParser-471"><a href="#MZMLSpectraParser-471"><span class="linenos">471</span></a>
</span><span id="MZMLSpectraParser-472"><a href="#MZMLSpectraParser-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="n">lcms_obj</span>
</span></pre></div>


            <div class="docstring"><p>A class for parsing mzml spectrometry data files into MassSpectraBase or LCMSBase objects</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>file_location</strong> (str or Path):
The path to the RAW file to be parsed.</li>
<li><strong>analyzer</strong> (str, optional):
The type of mass analyzer used in the instrument. Default is "Unknown".</li>
<li><strong>instrument_label</strong> (str, optional):
The name of the instrument used to acquire the data. Default is "Unknown".</li>
<li><strong>sample_name</strong> (str, optional):
The name of the sample being analyzed. If not provided, the stem of the file_location path will be used.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>file_location</strong> (Path):
The path to the RAW file being parsed.</li>
<li><strong>analyzer</strong> (str):
The type of mass analyzer used in the instrument.</li>
<li><strong>instrument_label</strong> (str):
The name of the instrument used to acquire the data.</li>
<li><strong>sample_name</strong> (str):
The name of the sample being analyzed.</li>
</ul>

<h6 id="methods">Methods</h6>

<ul>
<li>load().
Load mzML file using pymzml.run.Reader and return the data as a numpy array.</li>
<li>run(spectra=True).
Parses the mzml file and returns a dictionary of mass spectra dataframes and a scan metadata dataframe.</li>
<li>get_mass_spectrum_from_scan(scan_number, polarity, auto_process=True)
Parses the mzml file and returns a MassSpecBase object from a single scan.</li>
<li>get_mass_spectra_obj().
Parses the mzml file and instantiates a MassSpectraBase object.</li>
<li>get_lcms_obj().
Parses the mzml file and instantiates an LCMSBase object.</li>
</ul>

<p>Inherits from ThermoBaseClass and SpectraParserInterface</p>
</div>


                            <div id="MZMLSpectraParser.__init__" class="classattr">
                                        <input id="MZMLSpectraParser.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MZMLSpectraParser</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_location</span>,</span><span class="param">	<span class="n">analyzer</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span>,</span><span class="param">	<span class="n">instrument_label</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span>,</span><span class="param">	<span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MZMLSpectraParser.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.__init__-60"><a href="#MZMLSpectraParser.__init__-60"><span class="linenos">60</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.__init__-61"><a href="#MZMLSpectraParser.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.__init__-62"><a href="#MZMLSpectraParser.__init__-62"><span class="linenos">62</span></a>        <span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.__init__-63"><a href="#MZMLSpectraParser.__init__-63"><span class="linenos">63</span></a>        <span class="n">analyzer</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.__init__-64"><a href="#MZMLSpectraParser.__init__-64"><span class="linenos">64</span></a>        <span class="n">instrument_label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.__init__-65"><a href="#MZMLSpectraParser.__init__-65"><span class="linenos">65</span></a>        <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.__init__-66"><a href="#MZMLSpectraParser.__init__-66"><span class="linenos">66</span></a>    <span class="p">):</span>
</span><span id="MZMLSpectraParser.__init__-67"><a href="#MZMLSpectraParser.__init__-67"><span class="linenos">67</span></a>        <span class="c1"># implementation details</span>
</span><span id="MZMLSpectraParser.__init__-68"><a href="#MZMLSpectraParser.__init__-68"><span class="linenos">68</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.__init__-69"><a href="#MZMLSpectraParser.__init__-69"><span class="linenos">69</span></a>            <span class="c1"># if obj is a string it defaults to create a Path obj, pass the S3Path if needed</span>
</span><span id="MZMLSpectraParser.__init__-70"><a href="#MZMLSpectraParser.__init__-70"><span class="linenos">70</span></a>            <span class="n">file_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.__init__-71"><a href="#MZMLSpectraParser.__init__-71"><span class="linenos">71</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="MZMLSpectraParser.__init__-72"><a href="#MZMLSpectraParser.__init__-72"><span class="linenos">72</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;File does not exist: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_location</span><span class="p">))</span>
</span><span id="MZMLSpectraParser.__init__-73"><a href="#MZMLSpectraParser.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MZMLSpectraParser.__init__-74"><a href="#MZMLSpectraParser.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span> <span class="o">=</span> <span class="n">analyzer</span>
</span><span id="MZMLSpectraParser.__init__-75"><a href="#MZMLSpectraParser.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span> <span class="o">=</span> <span class="n">instrument_label</span>
</span><span id="MZMLSpectraParser.__init__-76"><a href="#MZMLSpectraParser.__init__-76"><span class="linenos">76</span></a>
</span><span id="MZMLSpectraParser.__init__-77"><a href="#MZMLSpectraParser.__init__-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="n">sample_name</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.__init__-78"><a href="#MZMLSpectraParser.__init__-78"><span class="linenos">78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">sample_name</span>
</span><span id="MZMLSpectraParser.__init__-79"><a href="#MZMLSpectraParser.__init__-79"><span class="linenos">79</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.__init__-80"><a href="#MZMLSpectraParser.__init__-80"><span class="linenos">80</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">stem</span>
</span></pre></div>


    

                            </div>
                            <div id="MZMLSpectraParser.file_location" class="classattr">
                                <div class="attr variable">
            <span class="name">file_location</span>

        
    </div>
    <a class="headerlink" href="#MZMLSpectraParser.file_location"></a>
    
    

                            </div>
                            <div id="MZMLSpectraParser.analyzer" class="classattr">
                                <div class="attr variable">
            <span class="name">analyzer</span>

        
    </div>
    <a class="headerlink" href="#MZMLSpectraParser.analyzer"></a>
    
    

                            </div>
                            <div id="MZMLSpectraParser.instrument_label" class="classattr">
                                <div class="attr variable">
            <span class="name">instrument_label</span>

        
    </div>
    <a class="headerlink" href="#MZMLSpectraParser.instrument_label"></a>
    
    

                            </div>
                            <div id="MZMLSpectraParser.load" class="classattr">
                                        <input id="MZMLSpectraParser.load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.load-82"><a href="#MZMLSpectraParser.load-82"><span class="linenos">82</span></a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.load-83"><a href="#MZMLSpectraParser.load-83"><span class="linenos">83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.load-84"><a href="#MZMLSpectraParser.load-84"><span class="linenos">84</span></a><span class="sd">        Load mzML file using pymzml.run.Reader and return the data as a numpy array.</span>
</span><span id="MZMLSpectraParser.load-85"><a href="#MZMLSpectraParser.load-85"><span class="linenos">85</span></a>
</span><span id="MZMLSpectraParser.load-86"><a href="#MZMLSpectraParser.load-86"><span class="linenos">86</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.load-87"><a href="#MZMLSpectraParser.load-87"><span class="linenos">87</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.load-88"><a href="#MZMLSpectraParser.load-88"><span class="linenos">88</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="MZMLSpectraParser.load-89"><a href="#MZMLSpectraParser.load-89"><span class="linenos">89</span></a><span class="sd">            The mass spectra data as a numpy array.</span>
</span><span id="MZMLSpectraParser.load-90"><a href="#MZMLSpectraParser.load-90"><span class="linenos">90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.load-91"><a href="#MZMLSpectraParser.load-91"><span class="linenos">91</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.load-92"><a href="#MZMLSpectraParser.load-92"><span class="linenos">92</span></a>        <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Load mzML file using pymzml.run.Reader and return the data as a numpy array.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray</strong>: The mass spectra data as a numpy array.</li>
</ul>
</div>


                            </div>
                            <div id="MZMLSpectraParser.get_scan_df" class="classattr">
                                        <input id="MZMLSpectraParser.get_scan_df-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_scan_df</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.get_scan_df-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.get_scan_df"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.get_scan_df-94"><a href="#MZMLSpectraParser.get_scan_df-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">get_scan_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_scan_df-95"><a href="#MZMLSpectraParser.get_scan_df-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_scan_df-96"><a href="#MZMLSpectraParser.get_scan_df-96"><span class="linenos"> 96</span></a><span class="sd">        Return scan data as a pandas DataFrame.</span>
</span><span id="MZMLSpectraParser.get_scan_df-97"><a href="#MZMLSpectraParser.get_scan_df-97"><span class="linenos"> 97</span></a>
</span><span id="MZMLSpectraParser.get_scan_df-98"><a href="#MZMLSpectraParser.get_scan_df-98"><span class="linenos"> 98</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser.get_scan_df-99"><a href="#MZMLSpectraParser.get_scan_df-99"><span class="linenos"> 99</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser.get_scan_df-100"><a href="#MZMLSpectraParser.get_scan_df-100"><span class="linenos">100</span></a><span class="sd">        data : pymzml.run.Reader</span>
</span><span id="MZMLSpectraParser.get_scan_df-101"><a href="#MZMLSpectraParser.get_scan_df-101"><span class="linenos">101</span></a><span class="sd">            The mass spectra data.</span>
</span><span id="MZMLSpectraParser.get_scan_df-102"><a href="#MZMLSpectraParser.get_scan_df-102"><span class="linenos">102</span></a>
</span><span id="MZMLSpectraParser.get_scan_df-103"><a href="#MZMLSpectraParser.get_scan_df-103"><span class="linenos">103</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.get_scan_df-104"><a href="#MZMLSpectraParser.get_scan_df-104"><span class="linenos">104</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.get_scan_df-105"><a href="#MZMLSpectraParser.get_scan_df-105"><span class="linenos">105</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="MZMLSpectraParser.get_scan_df-106"><a href="#MZMLSpectraParser.get_scan_df-106"><span class="linenos">106</span></a><span class="sd">            A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</span>
</span><span id="MZMLSpectraParser.get_scan_df-107"><a href="#MZMLSpectraParser.get_scan_df-107"><span class="linenos">107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_scan_df-108"><a href="#MZMLSpectraParser.get_scan_df-108"><span class="linenos">108</span></a>        <span class="c1"># Scan dict</span>
</span><span id="MZMLSpectraParser.get_scan_df-109"><a href="#MZMLSpectraParser.get_scan_df-109"><span class="linenos">109</span></a>        <span class="c1"># instatinate scan dict, with empty lists of size of scans</span>
</span><span id="MZMLSpectraParser.get_scan_df-110"><a href="#MZMLSpectraParser.get_scan_df-110"><span class="linenos">110</span></a>        <span class="n">n_scans</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_spectrum_count</span><span class="p">()</span>
</span><span id="MZMLSpectraParser.get_scan_df-111"><a href="#MZMLSpectraParser.get_scan_df-111"><span class="linenos">111</span></a>        <span class="n">scan_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MZMLSpectraParser.get_scan_df-112"><a href="#MZMLSpectraParser.get_scan_df-112"><span class="linenos">112</span></a>            <span class="s2">&quot;scan&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_scan_df-113"><a href="#MZMLSpectraParser.get_scan_df-113"><span class="linenos">113</span></a>            <span class="s2">&quot;scan_time&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_scan_df-114"><a href="#MZMLSpectraParser.get_scan_df-114"><span class="linenos">114</span></a>            <span class="s2">&quot;ms_level&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_scan_df-115"><a href="#MZMLSpectraParser.get_scan_df-115"><span class="linenos">115</span></a>            <span class="s2">&quot;polarity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_scan_df-116"><a href="#MZMLSpectraParser.get_scan_df-116"><span class="linenos">116</span></a>            <span class="s2">&quot;precursor_mz&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_scan_df-117"><a href="#MZMLSpectraParser.get_scan_df-117"><span class="linenos">117</span></a>            <span class="s2">&quot;scan_text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_scan_df-118"><a href="#MZMLSpectraParser.get_scan_df-118"><span class="linenos">118</span></a>            <span class="s2">&quot;scan_window_lower&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_scan_df-119"><a href="#MZMLSpectraParser.get_scan_df-119"><span class="linenos">119</span></a>            <span class="s2">&quot;scan_window_upper&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_scan_df-120"><a href="#MZMLSpectraParser.get_scan_df-120"><span class="linenos">120</span></a>            <span class="s2">&quot;scan_precision&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_scan_df-121"><a href="#MZMLSpectraParser.get_scan_df-121"><span class="linenos">121</span></a>            <span class="s2">&quot;tic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_scans</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_scan_df-122"><a href="#MZMLSpectraParser.get_scan_df-122"><span class="linenos">122</span></a>            <span class="s2">&quot;ms_format&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_scans</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_scan_df-123"><a href="#MZMLSpectraParser.get_scan_df-123"><span class="linenos">123</span></a>        <span class="p">}</span>
</span><span id="MZMLSpectraParser.get_scan_df-124"><a href="#MZMLSpectraParser.get_scan_df-124"><span class="linenos">124</span></a>
</span><span id="MZMLSpectraParser.get_scan_df-125"><a href="#MZMLSpectraParser.get_scan_df-125"><span class="linenos">125</span></a>        <span class="c1"># First pass: loop through scans to get scan info</span>
</span><span id="MZMLSpectraParser.get_scan_df-126"><a href="#MZMLSpectraParser.get_scan_df-126"><span class="linenos">126</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_scan_df-127"><a href="#MZMLSpectraParser.get_scan_df-127"><span class="linenos">127</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">ID</span>
</span><span id="MZMLSpectraParser.get_scan_df-128"><a href="#MZMLSpectraParser.get_scan_df-128"><span class="linenos">128</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_level&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span>
</span><span id="MZMLSpectraParser.get_scan_df-129"><a href="#MZMLSpectraParser.get_scan_df-129"><span class="linenos">129</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_precision&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">_measured_precision</span>
</span><span id="MZMLSpectraParser.get_scan_df-130"><a href="#MZMLSpectraParser.get_scan_df-130"><span class="linenos">130</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;tic&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">TIC</span>
</span><span id="MZMLSpectraParser.get_scan_df-131"><a href="#MZMLSpectraParser.get_scan_df-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_scan_df-132"><a href="#MZMLSpectraParser.get_scan_df-132"><span class="linenos">132</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;precursor_mz&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_scan_df-133"><a href="#MZMLSpectraParser.get_scan_df-133"><span class="linenos">133</span></a>                    <span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="MZMLSpectraParser.get_scan_df-134"><a href="#MZMLSpectraParser.get_scan_df-134"><span class="linenos">134</span></a>                <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-135"><a href="#MZMLSpectraParser.get_scan_df-135"><span class="linenos">135</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_scan_df-136"><a href="#MZMLSpectraParser.get_scan_df-136"><span class="linenos">136</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;negative&quot;</span>
</span><span id="MZMLSpectraParser.get_scan_df-137"><a href="#MZMLSpectraParser.get_scan_df-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_scan_df-138"><a href="#MZMLSpectraParser.get_scan_df-138"><span class="linenos">138</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span>
</span><span id="MZMLSpectraParser.get_scan_df-139"><a href="#MZMLSpectraParser.get_scan_df-139"><span class="linenos">139</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_scan_df-140"><a href="#MZMLSpectraParser.get_scan_df-140"><span class="linenos">140</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_scan_df-141"><a href="#MZMLSpectraParser.get_scan_df-141"><span class="linenos">141</span></a>                    <span class="s2">&quot;Error: scan </span><span class="si">{0}</span><span class="s2"> has both negative and positive polarity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_scan_df-142"><a href="#MZMLSpectraParser.get_scan_df-142"><span class="linenos">142</span></a>                        <span class="n">spec</span><span class="o">.</span><span class="n">ID</span>
</span><span id="MZMLSpectraParser.get_scan_df-143"><a href="#MZMLSpectraParser.get_scan_df-143"><span class="linenos">143</span></a>                    <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-144"><a href="#MZMLSpectraParser.get_scan_df-144"><span class="linenos">144</span></a>                <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-145"><a href="#MZMLSpectraParser.get_scan_df-145"><span class="linenos">145</span></a>
</span><span id="MZMLSpectraParser.get_scan_df-146"><a href="#MZMLSpectraParser.get_scan_df-146"><span class="linenos">146</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000016&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-147"><a href="#MZMLSpectraParser.get_scan_df-147"><span class="linenos">147</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000512&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-148"><a href="#MZMLSpectraParser.get_scan_df-148"><span class="linenos">148</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_window_lower&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000501&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-149"><a href="#MZMLSpectraParser.get_scan_df-149"><span class="linenos">149</span></a>            <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;scan_window_upper&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000500&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-150"><a href="#MZMLSpectraParser.get_scan_df-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000128&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_scan_df-151"><a href="#MZMLSpectraParser.get_scan_df-151"><span class="linenos">151</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;profile&quot;</span>
</span><span id="MZMLSpectraParser.get_scan_df-152"><a href="#MZMLSpectraParser.get_scan_df-152"><span class="linenos">152</span></a>            <span class="k">elif</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000127&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_scan_df-153"><a href="#MZMLSpectraParser.get_scan_df-153"><span class="linenos">153</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centroid&quot;</span>
</span><span id="MZMLSpectraParser.get_scan_df-154"><a href="#MZMLSpectraParser.get_scan_df-154"><span class="linenos">154</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_scan_df-155"><a href="#MZMLSpectraParser.get_scan_df-155"><span class="linenos">155</span></a>                <span class="n">scan_dict</span><span class="p">[</span><span class="s2">&quot;ms_format&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MZMLSpectraParser.get_scan_df-156"><a href="#MZMLSpectraParser.get_scan_df-156"><span class="linenos">156</span></a>
</span><span id="MZMLSpectraParser.get_scan_df-157"><a href="#MZMLSpectraParser.get_scan_df-157"><span class="linenos">157</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scan_dict</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_scan_df-158"><a href="#MZMLSpectraParser.get_scan_df-158"><span class="linenos">158</span></a>
</span><span id="MZMLSpectraParser.get_scan_df-159"><a href="#MZMLSpectraParser.get_scan_df-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="n">scan_df</span>
</span></pre></div>


            <div class="docstring"><p>Return scan data as a pandas DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong> (pymzml.run.Reader):
The mass spectra data.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</li>
</ul>
</div>


                            </div>
                            <div id="MZMLSpectraParser.get_ms_raw" class="classattr">
                                        <input id="MZMLSpectraParser.get_ms_raw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ms_raw</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">spectra</span>, </span><span class="param"><span class="n">scan_df</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.get_ms_raw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.get_ms_raw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.get_ms_raw-161"><a href="#MZMLSpectraParser.get_ms_raw-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">get_ms_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">scan_df</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_ms_raw-162"><a href="#MZMLSpectraParser.get_ms_raw-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dictionary of mass spectra data as a pandas DataFrame.</span>
</span><span id="MZMLSpectraParser.get_ms_raw-163"><a href="#MZMLSpectraParser.get_ms_raw-163"><span class="linenos">163</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-164"><a href="#MZMLSpectraParser.get_ms_raw-164"><span class="linenos">164</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser.get_ms_raw-165"><a href="#MZMLSpectraParser.get_ms_raw-165"><span class="linenos">165</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser.get_ms_raw-166"><a href="#MZMLSpectraParser.get_ms_raw-166"><span class="linenos">166</span></a><span class="sd">        spectra : str</span>
</span><span id="MZMLSpectraParser.get_ms_raw-167"><a href="#MZMLSpectraParser.get_ms_raw-167"><span class="linenos">167</span></a><span class="sd">            Which mass spectra data to include in the output.</span>
</span><span id="MZMLSpectraParser.get_ms_raw-168"><a href="#MZMLSpectraParser.get_ms_raw-168"><span class="linenos">168</span></a><span class="sd">            Options: None, &quot;ms1&quot;, &quot;ms2&quot;, &quot;all&quot;.</span>
</span><span id="MZMLSpectraParser.get_ms_raw-169"><a href="#MZMLSpectraParser.get_ms_raw-169"><span class="linenos">169</span></a><span class="sd">        scan_df : pandas.DataFrame</span>
</span><span id="MZMLSpectraParser.get_ms_raw-170"><a href="#MZMLSpectraParser.get_ms_raw-170"><span class="linenos">170</span></a><span class="sd">            Scan dataframe. Output from get_scan_df().</span>
</span><span id="MZMLSpectraParser.get_ms_raw-171"><a href="#MZMLSpectraParser.get_ms_raw-171"><span class="linenos">171</span></a><span class="sd">        data : pymzml.run.Reader</span>
</span><span id="MZMLSpectraParser.get_ms_raw-172"><a href="#MZMLSpectraParser.get_ms_raw-172"><span class="linenos">172</span></a><span class="sd">            The mass spectra data.</span>
</span><span id="MZMLSpectraParser.get_ms_raw-173"><a href="#MZMLSpectraParser.get_ms_raw-173"><span class="linenos">173</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-174"><a href="#MZMLSpectraParser.get_ms_raw-174"><span class="linenos">174</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.get_ms_raw-175"><a href="#MZMLSpectraParser.get_ms_raw-175"><span class="linenos">175</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.get_ms_raw-176"><a href="#MZMLSpectraParser.get_ms_raw-176"><span class="linenos">176</span></a><span class="sd">        dict</span>
</span><span id="MZMLSpectraParser.get_ms_raw-177"><a href="#MZMLSpectraParser.get_ms_raw-177"><span class="linenos">177</span></a><span class="sd">            A dictionary containing the mass spectra data as pandas DataFrames, with keys corresponding to the MS level.</span>
</span><span id="MZMLSpectraParser.get_ms_raw-178"><a href="#MZMLSpectraParser.get_ms_raw-178"><span class="linenos">178</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-179"><a href="#MZMLSpectraParser.get_ms_raw-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_ms_raw-180"><a href="#MZMLSpectraParser.get_ms_raw-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-181"><a href="#MZMLSpectraParser.get_ms_raw-181"><span class="linenos">181</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span>
</span><span id="MZMLSpectraParser.get_ms_raw-182"><a href="#MZMLSpectraParser.get_ms_raw-182"><span class="linenos">182</span></a>        <span class="k">elif</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;ms1&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-183"><a href="#MZMLSpectraParser.get_ms_raw-183"><span class="linenos">183</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span><span class="p">[</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_ms_raw-184"><a href="#MZMLSpectraParser.get_ms_raw-184"><span class="linenos">184</span></a>        <span class="k">elif</span> <span class="n">spectra</span> <span class="o">==</span> <span class="s2">&quot;ms2&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-185"><a href="#MZMLSpectraParser.get_ms_raw-185"><span class="linenos">185</span></a>            <span class="n">scan_df_forspec</span> <span class="o">=</span> <span class="n">scan_df</span><span class="p">[</span><span class="n">scan_df</span><span class="o">.</span><span class="n">ms_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_ms_raw-186"><a href="#MZMLSpectraParser.get_ms_raw-186"><span class="linenos">186</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-187"><a href="#MZMLSpectraParser.get_ms_raw-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectra must be &#39;all&#39;, &#39;ms1&#39;, or &#39;ms2&#39;&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-188"><a href="#MZMLSpectraParser.get_ms_raw-188"><span class="linenos">188</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-189"><a href="#MZMLSpectraParser.get_ms_raw-189"><span class="linenos">189</span></a>        <span class="c1"># Result container</span>
</span><span id="MZMLSpectraParser.get_ms_raw-190"><a href="#MZMLSpectraParser.get_ms_raw-190"><span class="linenos">190</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MZMLSpectraParser.get_ms_raw-191"><a href="#MZMLSpectraParser.get_ms_raw-191"><span class="linenos">191</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-192"><a href="#MZMLSpectraParser.get_ms_raw-192"><span class="linenos">192</span></a>        <span class="c1"># Row count container</span>
</span><span id="MZMLSpectraParser.get_ms_raw-193"><a href="#MZMLSpectraParser.get_ms_raw-193"><span class="linenos">193</span></a>        <span class="n">counter</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MZMLSpectraParser.get_ms_raw-194"><a href="#MZMLSpectraParser.get_ms_raw-194"><span class="linenos">194</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-195"><a href="#MZMLSpectraParser.get_ms_raw-195"><span class="linenos">195</span></a>        <span class="c1"># Column name container</span>
</span><span id="MZMLSpectraParser.get_ms_raw-196"><a href="#MZMLSpectraParser.get_ms_raw-196"><span class="linenos">196</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MZMLSpectraParser.get_ms_raw-197"><a href="#MZMLSpectraParser.get_ms_raw-197"><span class="linenos">197</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-198"><a href="#MZMLSpectraParser.get_ms_raw-198"><span class="linenos">198</span></a>        <span class="c1"># set at float32</span>
</span><span id="MZMLSpectraParser.get_ms_raw-199"><a href="#MZMLSpectraParser.get_ms_raw-199"><span class="linenos">199</span></a>        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="MZMLSpectraParser.get_ms_raw-200"><a href="#MZMLSpectraParser.get_ms_raw-200"><span class="linenos">200</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-201"><a href="#MZMLSpectraParser.get_ms_raw-201"><span class="linenos">201</span></a>        <span class="c1"># First pass: get nrows</span>
</span><span id="MZMLSpectraParser.get_ms_raw-202"><a href="#MZMLSpectraParser.get_ms_raw-202"><span class="linenos">202</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-203"><a href="#MZMLSpectraParser.get_ms_raw-203"><span class="linenos">203</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_ms_raw-204"><a href="#MZMLSpectraParser.get_ms_raw-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scan_df_forspec</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-205"><a href="#MZMLSpectraParser.get_ms_raw-205"><span class="linenos">205</span></a>                <span class="c1"># Get ms level</span>
</span><span id="MZMLSpectraParser.get_ms_raw-206"><a href="#MZMLSpectraParser.get_ms_raw-206"><span class="linenos">206</span></a>                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;ms</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-207"><a href="#MZMLSpectraParser.get_ms_raw-207"><span class="linenos">207</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-208"><a href="#MZMLSpectraParser.get_ms_raw-208"><span class="linenos">208</span></a>                <span class="c1"># Number of rows</span>
</span><span id="MZMLSpectraParser.get_ms_raw-209"><a href="#MZMLSpectraParser.get_ms_raw-209"><span class="linenos">209</span></a>                <span class="n">N</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_ms_raw-210"><a href="#MZMLSpectraParser.get_ms_raw-210"><span class="linenos">210</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-211"><a href="#MZMLSpectraParser.get_ms_raw-211"><span class="linenos">211</span></a>        <span class="c1"># Second pass: parse</span>
</span><span id="MZMLSpectraParser.get_ms_raw-212"><a href="#MZMLSpectraParser.get_ms_raw-212"><span class="linenos">212</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_ms_raw-213"><a href="#MZMLSpectraParser.get_ms_raw-213"><span class="linenos">213</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scan_df_forspec</span><span class="o">.</span><span class="n">scan</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-214"><a href="#MZMLSpectraParser.get_ms_raw-214"><span class="linenos">214</span></a>                <span class="c1"># Number of rows</span>
</span><span id="MZMLSpectraParser.get_ms_raw-215"><a href="#MZMLSpectraParser.get_ms_raw-215"><span class="linenos">215</span></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_ms_raw-216"><a href="#MZMLSpectraParser.get_ms_raw-216"><span class="linenos">216</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-217"><a href="#MZMLSpectraParser.get_ms_raw-217"><span class="linenos">217</span></a>                <span class="c1"># No measurements</span>
</span><span id="MZMLSpectraParser.get_ms_raw-218"><a href="#MZMLSpectraParser.get_ms_raw-218"><span class="linenos">218</span></a>                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-219"><a href="#MZMLSpectraParser.get_ms_raw-219"><span class="linenos">219</span></a>                    <span class="k">continue</span>
</span><span id="MZMLSpectraParser.get_ms_raw-220"><a href="#MZMLSpectraParser.get_ms_raw-220"><span class="linenos">220</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-221"><a href="#MZMLSpectraParser.get_ms_raw-221"><span class="linenos">221</span></a>                <span class="c1"># Dimension check</span>
</span><span id="MZMLSpectraParser.get_ms_raw-222"><a href="#MZMLSpectraParser.get_ms_raw-222"><span class="linenos">222</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_ms_raw-223"><a href="#MZMLSpectraParser.get_ms_raw-223"><span class="linenos">223</span></a>                    <span class="c1"># raise an error if the mz and intensity arrays are not the same length</span>
</span><span id="MZMLSpectraParser.get_ms_raw-224"><a href="#MZMLSpectraParser.get_ms_raw-224"><span class="linenos">224</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;m/z and intensity array dimension mismatch&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-225"><a href="#MZMLSpectraParser.get_ms_raw-225"><span class="linenos">225</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-226"><a href="#MZMLSpectraParser.get_ms_raw-226"><span class="linenos">226</span></a>                <span class="c1"># Scan/frame info</span>
</span><span id="MZMLSpectraParser.get_ms_raw-227"><a href="#MZMLSpectraParser.get_ms_raw-227"><span class="linenos">227</span></a>                <span class="n">id_dict</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">id_dict</span>
</span><span id="MZMLSpectraParser.get_ms_raw-228"><a href="#MZMLSpectraParser.get_ms_raw-228"><span class="linenos">228</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-229"><a href="#MZMLSpectraParser.get_ms_raw-229"><span class="linenos">229</span></a>                <span class="c1"># Get ms level</span>
</span><span id="MZMLSpectraParser.get_ms_raw-230"><a href="#MZMLSpectraParser.get_ms_raw-230"><span class="linenos">230</span></a>                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;ms</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">ms_level</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-231"><a href="#MZMLSpectraParser.get_ms_raw-231"><span class="linenos">231</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-232"><a href="#MZMLSpectraParser.get_ms_raw-232"><span class="linenos">232</span></a>                <span class="c1"># Columns</span>
</span><span id="MZMLSpectraParser.get_ms_raw-233"><a href="#MZMLSpectraParser.get_ms_raw-233"><span class="linenos">233</span></a>                <span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">id_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;intensity&quot;</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_ms_raw-234"><a href="#MZMLSpectraParser.get_ms_raw-234"><span class="linenos">234</span></a>                <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
</span><span id="MZMLSpectraParser.get_ms_raw-235"><a href="#MZMLSpectraParser.get_ms_raw-235"><span class="linenos">235</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-236"><a href="#MZMLSpectraParser.get_ms_raw-236"><span class="linenos">236</span></a>                <span class="c1"># Subarray init</span>
</span><span id="MZMLSpectraParser.get_ms_raw-237"><a href="#MZMLSpectraParser.get_ms_raw-237"><span class="linenos">237</span></a>                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-238"><a href="#MZMLSpectraParser.get_ms_raw-238"><span class="linenos">238</span></a>                <span class="n">inx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MZMLSpectraParser.get_ms_raw-239"><a href="#MZMLSpectraParser.get_ms_raw-239"><span class="linenos">239</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-240"><a href="#MZMLSpectraParser.get_ms_raw-240"><span class="linenos">240</span></a>                <span class="c1"># Populate scan/frame info</span>
</span><span id="MZMLSpectraParser.get_ms_raw-241"><a href="#MZMLSpectraParser.get_ms_raw-241"><span class="linenos">241</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MZMLSpectraParser.get_ms_raw-242"><a href="#MZMLSpectraParser.get_ms_raw-242"><span class="linenos">242</span></a>                    <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="MZMLSpectraParser.get_ms_raw-243"><a href="#MZMLSpectraParser.get_ms_raw-243"><span class="linenos">243</span></a>                    <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser.get_ms_raw-244"><a href="#MZMLSpectraParser.get_ms_raw-244"><span class="linenos">244</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-245"><a href="#MZMLSpectraParser.get_ms_raw-245"><span class="linenos">245</span></a>                <span class="c1"># Populate m/z</span>
</span><span id="MZMLSpectraParser.get_ms_raw-246"><a href="#MZMLSpectraParser.get_ms_raw-246"><span class="linenos">246</span></a>                <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span>
</span><span id="MZMLSpectraParser.get_ms_raw-247"><a href="#MZMLSpectraParser.get_ms_raw-247"><span class="linenos">247</span></a>                <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser.get_ms_raw-248"><a href="#MZMLSpectraParser.get_ms_raw-248"><span class="linenos">248</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-249"><a href="#MZMLSpectraParser.get_ms_raw-249"><span class="linenos">249</span></a>                <span class="c1"># Populate intensity</span>
</span><span id="MZMLSpectraParser.get_ms_raw-250"><a href="#MZMLSpectraParser.get_ms_raw-250"><span class="linenos">250</span></a>                <span class="n">arr</span><span class="p">[:,</span> <span class="n">inx</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span>
</span><span id="MZMLSpectraParser.get_ms_raw-251"><a href="#MZMLSpectraParser.get_ms_raw-251"><span class="linenos">251</span></a>                <span class="n">inx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser.get_ms_raw-252"><a href="#MZMLSpectraParser.get_ms_raw-252"><span class="linenos">252</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-253"><a href="#MZMLSpectraParser.get_ms_raw-253"><span class="linenos">253</span></a>                <span class="c1"># Initialize output container</span>
</span><span id="MZMLSpectraParser.get_ms_raw-254"><a href="#MZMLSpectraParser.get_ms_raw-254"><span class="linenos">254</span></a>                <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_ms_raw-255"><a href="#MZMLSpectraParser.get_ms_raw-255"><span class="linenos">255</span></a>                    <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-256"><a href="#MZMLSpectraParser.get_ms_raw-256"><span class="linenos">256</span></a>                    <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MZMLSpectraParser.get_ms_raw-257"><a href="#MZMLSpectraParser.get_ms_raw-257"><span class="linenos">257</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-258"><a href="#MZMLSpectraParser.get_ms_raw-258"><span class="linenos">258</span></a>                <span class="c1"># Insert subarray</span>
</span><span id="MZMLSpectraParser.get_ms_raw-259"><a href="#MZMLSpectraParser.get_ms_raw-259"><span class="linenos">259</span></a>                <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="p">:</span> <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">arr</span>
</span><span id="MZMLSpectraParser.get_ms_raw-260"><a href="#MZMLSpectraParser.get_ms_raw-260"><span class="linenos">260</span></a>                <span class="n">counter</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span>
</span><span id="MZMLSpectraParser.get_ms_raw-261"><a href="#MZMLSpectraParser.get_ms_raw-261"><span class="linenos">261</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-262"><a href="#MZMLSpectraParser.get_ms_raw-262"><span class="linenos">262</span></a>        <span class="c1"># Construct ms1 and ms2 mz dataframes</span>
</span><span id="MZMLSpectraParser.get_ms_raw-263"><a href="#MZMLSpectraParser.get_ms_raw-263"><span class="linenos">263</span></a>        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="MZMLSpectraParser.get_ms_raw-264"><a href="#MZMLSpectraParser.get_ms_raw-264"><span class="linenos">264</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">level</span><span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_ms_raw-265"><a href="#MZMLSpectraParser.get_ms_raw-265"><span class="linenos">265</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;controllerType&quot;</span><span class="p">,</span> <span class="s2">&quot;controllerNumber&quot;</span><span class="p">],</span>
</span><span id="MZMLSpectraParser.get_ms_raw-266"><a href="#MZMLSpectraParser.get_ms_raw-266"><span class="linenos">266</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_ms_raw-267"><a href="#MZMLSpectraParser.get_ms_raw-267"><span class="linenos">267</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_ms_raw-268"><a href="#MZMLSpectraParser.get_ms_raw-268"><span class="linenos">268</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_ms_raw-269"><a href="#MZMLSpectraParser.get_ms_raw-269"><span class="linenos">269</span></a>
</span><span id="MZMLSpectraParser.get_ms_raw-270"><a href="#MZMLSpectraParser.get_ms_raw-270"><span class="linenos">270</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Return a dictionary of mass spectra data as a pandas DataFrame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>spectra</strong> (str):
Which mass spectra data to include in the output.
Options: None, "ms1", "ms2", "all".</li>
<li><strong>scan_df</strong> (pandas.DataFrame):
Scan dataframe. Output from get_scan_df().</li>
<li><strong>data</strong> (pymzml.run.Reader):
The mass spectra data.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict</strong>: A dictionary containing the mass spectra data as pandas DataFrames, with keys corresponding to the MS level.</li>
</ul>
</div>


                            </div>
                            <div id="MZMLSpectraParser.run" class="classattr">
                                        <input id="MZMLSpectraParser.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">spectra</span><span class="o">=</span><span class="s1">&#39;all&#39;</span>, </span><span class="param"><span class="n">scan_df</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.run-272"><a href="#MZMLSpectraParser.run-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">scan_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.run-273"><a href="#MZMLSpectraParser.run-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the mzML file and return a dictionary of spectra dataframes and a scan metadata dataframe.</span>
</span><span id="MZMLSpectraParser.run-274"><a href="#MZMLSpectraParser.run-274"><span class="linenos">274</span></a>
</span><span id="MZMLSpectraParser.run-275"><a href="#MZMLSpectraParser.run-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser.run-276"><a href="#MZMLSpectraParser.run-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser.run-277"><a href="#MZMLSpectraParser.run-277"><span class="linenos">277</span></a><span class="sd">        spectra : str, optional</span>
</span><span id="MZMLSpectraParser.run-278"><a href="#MZMLSpectraParser.run-278"><span class="linenos">278</span></a><span class="sd">            Which mass spectra data to include in the output. Default is &quot;all&quot;.</span>
</span><span id="MZMLSpectraParser.run-279"><a href="#MZMLSpectraParser.run-279"><span class="linenos">279</span></a><span class="sd">            Other options: None, &quot;ms1&quot;, &quot;ms2&quot;.</span>
</span><span id="MZMLSpectraParser.run-280"><a href="#MZMLSpectraParser.run-280"><span class="linenos">280</span></a><span class="sd">        scan_df : pandas.DataFrame, optional</span>
</span><span id="MZMLSpectraParser.run-281"><a href="#MZMLSpectraParser.run-281"><span class="linenos">281</span></a><span class="sd">            Scan dataframe.  If not provided, the scan dataframe is created from the mzML file.</span>
</span><span id="MZMLSpectraParser.run-282"><a href="#MZMLSpectraParser.run-282"><span class="linenos">282</span></a>
</span><span id="MZMLSpectraParser.run-283"><a href="#MZMLSpectraParser.run-283"><span class="linenos">283</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.run-284"><a href="#MZMLSpectraParser.run-284"><span class="linenos">284</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.run-285"><a href="#MZMLSpectraParser.run-285"><span class="linenos">285</span></a><span class="sd">        tuple</span>
</span><span id="MZMLSpectraParser.run-286"><a href="#MZMLSpectraParser.run-286"><span class="linenos">286</span></a><span class="sd">            A tuple containing two elements:</span>
</span><span id="MZMLSpectraParser.run-287"><a href="#MZMLSpectraParser.run-287"><span class="linenos">287</span></a><span class="sd">            - A dictionary containing the mass spectra data as numpy arrays, with keys corresponding to the MS level.</span>
</span><span id="MZMLSpectraParser.run-288"><a href="#MZMLSpectraParser.run-288"><span class="linenos">288</span></a><span class="sd">            - A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</span>
</span><span id="MZMLSpectraParser.run-289"><a href="#MZMLSpectraParser.run-289"><span class="linenos">289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.run-290"><a href="#MZMLSpectraParser.run-290"><span class="linenos">290</span></a>
</span><span id="MZMLSpectraParser.run-291"><a href="#MZMLSpectraParser.run-291"><span class="linenos">291</span></a>        <span class="c1"># Open file</span>
</span><span id="MZMLSpectraParser.run-292"><a href="#MZMLSpectraParser.run-292"><span class="linenos">292</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="MZMLSpectraParser.run-293"><a href="#MZMLSpectraParser.run-293"><span class="linenos">293</span></a>
</span><span id="MZMLSpectraParser.run-294"><a href="#MZMLSpectraParser.run-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">scan_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.run-295"><a href="#MZMLSpectraParser.run-295"><span class="linenos">295</span></a>            <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scan_df</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.run-296"><a href="#MZMLSpectraParser.run-296"><span class="linenos">296</span></a>
</span><span id="MZMLSpectraParser.run-297"><a href="#MZMLSpectraParser.run-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">spectra</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.run-298"><a href="#MZMLSpectraParser.run-298"><span class="linenos">298</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ms_raw</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">scan_df</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.run-299"><a href="#MZMLSpectraParser.run-299"><span class="linenos">299</span></a>
</span><span id="MZMLSpectraParser.run-300"><a href="#MZMLSpectraParser.run-300"><span class="linenos">300</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.run-301"><a href="#MZMLSpectraParser.run-301"><span class="linenos">301</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MZMLSpectraParser.run-302"><a href="#MZMLSpectraParser.run-302"><span class="linenos">302</span></a>
</span><span id="MZMLSpectraParser.run-303"><a href="#MZMLSpectraParser.run-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">scan_df</span>
</span></pre></div>


            <div class="docstring"><p>Parse the mzML file and return a dictionary of spectra dataframes and a scan metadata dataframe.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>spectra</strong> (str, optional):
Which mass spectra data to include in the output. Default is "all".
Other options: None, "ms1", "ms2".</li>
<li><strong>scan_df</strong> (pandas.DataFrame, optional):
Scan dataframe.  If not provided, the scan dataframe is created from the mzML file.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple containing two elements:
<ul>
<li>A dictionary containing the mass spectra data as numpy arrays, with keys corresponding to the MS level.</li>
<li>A pandas DataFrame containing metadata for each scan, including scan number, MS level, polarity, and scan time.</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="MZMLSpectraParser.get_mass_spectrum_from_scan" class="classattr">
                                        <input id="MZMLSpectraParser.get_mass_spectrum_from_scan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mass_spectrum_from_scan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">scan_number</span>, </span><span class="param"><span class="n">spectrum_mode</span>, </span><span class="param"><span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.get_mass_spectrum_from_scan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.get_mass_spectrum_from_scan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-305"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">get_mass_spectrum_from_scan</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-306"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">scan_number</span><span class="p">,</span> <span class="n">spectrum_mode</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="kc">True</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-307"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-307"><span class="linenos">307</span></a>    <span class="p">):</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-308"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiate a mass spectrum object from the mzML file.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-309"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-309"><span class="linenos">309</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-310"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-310"><span class="linenos">310</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-311"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-311"><span class="linenos">311</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-312"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-312"><span class="linenos">312</span></a><span class="sd">        scan_number : int</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-313"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-313"><span class="linenos">313</span></a><span class="sd">            The scan number to be parsed.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-314"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-314"><span class="linenos">314</span></a><span class="sd">        spectrum_mode : str</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-315"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-315"><span class="linenos">315</span></a><span class="sd">            The type of spectrum to instantiate.  Must be&#39;profile&#39; or &#39;centroid&#39;.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-316"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-316"><span class="linenos">316</span></a><span class="sd">        polarity : int</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-317"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-317"><span class="linenos">317</span></a><span class="sd">            The polarity of the scan.  Must be -1 or 1.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-318"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-318"><span class="linenos">318</span></a><span class="sd">        auto_process : bool, optional</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-319"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-319"><span class="linenos">319</span></a><span class="sd">            If True, process the mass spectrum. Default is True.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-320"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-320"><span class="linenos">320</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-321"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-321"><span class="linenos">321</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-322"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-322"><span class="linenos">322</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-323"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-323"><span class="linenos">323</span></a><span class="sd">        MassSpecProfile | MassSpecCentroid</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-324"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-324"><span class="linenos">324</span></a><span class="sd">            The MassSpecProfile or MassSpecCentroid object containing the parsed mass spectrum.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-325"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-326"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-326"><span class="linenos">326</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-327"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-327"><span class="linenos">327</span></a>        <span class="k">def</span> <span class="nf">set_metadata</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-328"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-328"><span class="linenos">328</span></a>            <span class="n">scan_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-329"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-329"><span class="linenos">329</span></a>            <span class="n">polarity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-330"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-330"><span class="linenos">330</span></a>            <span class="n">file_location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-331"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-331"><span class="linenos">331</span></a>            <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">thermo_profile</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-332"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-332"><span class="linenos">332</span></a>        <span class="p">):</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-333"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-333"><span class="linenos">333</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-334"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-334"><span class="linenos">334</span></a><span class="sd">            Set the output parameters for creating a MassSpecProfile or MassSpecCentroid object.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-335"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-335"><span class="linenos">335</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-336"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-336"><span class="linenos">336</span></a><span class="sd">            Parameters</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-337"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-337"><span class="linenos">337</span></a><span class="sd">            ----------</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-338"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-338"><span class="linenos">338</span></a><span class="sd">            scan_number : int</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-339"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-339"><span class="linenos">339</span></a><span class="sd">                The scan number.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-340"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-340"><span class="linenos">340</span></a><span class="sd">            polarity : int</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-341"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-341"><span class="linenos">341</span></a><span class="sd">                The polarity of the data.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-342"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-342"><span class="linenos">342</span></a><span class="sd">            file_location : str</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-343"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-343"><span class="linenos">343</span></a><span class="sd">                The file location.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-344"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-344"><span class="linenos">344</span></a><span class="sd">            label : str, optional</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-345"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-345"><span class="linenos">345</span></a><span class="sd">                The label for the mass spectrum. Default is Labels.thermo_profile.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-346"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-346"><span class="linenos">346</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-347"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-347"><span class="linenos">347</span></a><span class="sd">            Returns</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-348"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-348"><span class="linenos">348</span></a><span class="sd">            -------</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-349"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-349"><span class="linenos">349</span></a><span class="sd">            dict</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-350"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-350"><span class="linenos">350</span></a><span class="sd">                The output parameters ready for creating a MassSpecProfile or MassSpecCentroid object.</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-351"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-351"><span class="linenos">351</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-352"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-352"><span class="linenos">352</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">default_parameters</span><span class="p">(</span><span class="n">file_location</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-353"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-353"><span class="linenos">353</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-354"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-354"><span class="linenos">354</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;polarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polarity</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-355"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-355"><span class="linenos">355</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;filename_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_location</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-356"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-356"><span class="linenos">356</span></a>            <span class="n">d_params</span><span class="p">[</span><span class="s2">&quot;scan_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_number</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-357"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-357"><span class="linenos">357</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-358"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-358"><span class="linenos">358</span></a>            <span class="k">return</span> <span class="n">d_params</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-359"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-359"><span class="linenos">359</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-360"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-360"><span class="linenos">360</span></a>        <span class="c1"># Open file</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-361"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-361"><span class="linenos">361</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-362"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-362"><span class="linenos">362</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-363"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-363"><span class="linenos">363</span></a>        <span class="c1"># Pluck out individual scan mz and intensity</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-364"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-364"><span class="linenos">364</span></a>        <span class="n">spec</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">scan_number</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-365"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-365"><span class="linenos">365</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-366"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-366"><span class="linenos">366</span></a>        <span class="c1"># Get polarity</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-367"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;negative scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-368"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-368"><span class="linenos">368</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-369"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-369"><span class="linenos">369</span></a>        <span class="k">elif</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;positive scan&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-370"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-370"><span class="linenos">370</span></a>            <span class="n">polarity</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-371"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-371"><span class="linenos">371</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-372"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-372"><span class="linenos">372</span></a>        <span class="c1"># Get mass spectrum</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-373"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="n">spectrum_mode</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-374"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-374"><span class="linenos">374</span></a>            <span class="c1"># Check if profile</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-375"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-375"><span class="linenos">375</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000128&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-376"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-376"><span class="linenos">376</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectrum is not profile&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-377"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-377"><span class="linenos">377</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-378"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-378"><span class="linenos">378</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">mz</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-379"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-379"><span class="linenos">379</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">abundance</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-380"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-380"><span class="linenos">380</span></a>            <span class="p">}</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-381"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-381"><span class="linenos">381</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">set_metadata</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-382"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-382"><span class="linenos">382</span></a>                <span class="n">scan_number</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-383"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-383"><span class="linenos">383</span></a>                <span class="n">polarity</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-384"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-384"><span class="linenos">384</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-385"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-385"><span class="linenos">385</span></a>                <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">simulated_profile</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-386"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-386"><span class="linenos">386</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-387"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-387"><span class="linenos">387</span></a>            <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">MassSpecProfile</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-388"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-388"><span class="linenos">388</span></a>                <span class="n">data_dict</span><span class="p">,</span> <span class="n">d_params</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-389"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-389"><span class="linenos">389</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-390"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-390"><span class="linenos">390</span></a>        <span class="k">elif</span> <span class="n">spectrum_mode</span> <span class="o">==</span> <span class="s2">&quot;centroid&quot;</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-391"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-391"><span class="linenos">391</span></a>            <span class="c1"># Check if centroided</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-392"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-392"><span class="linenos">392</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MS:1000127&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-393"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-393"><span class="linenos">393</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spectrum is not centroided&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-394"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-394"><span class="linenos">394</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-395"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-395"><span class="linenos">395</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">mz</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-396"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-396"><span class="linenos">396</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">abundance</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-397"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-397"><span class="linenos">397</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">rp</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">mz</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-398"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-398"><span class="linenos">398</span></a>                <span class="n">Labels</span><span class="o">.</span><span class="n">s2n</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">i</span><span class="p">),</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-399"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-399"><span class="linenos">399</span></a>            <span class="p">}</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-400"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-400"><span class="linenos">400</span></a>            <span class="n">d_params</span> <span class="o">=</span> <span class="n">set_metadata</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-401"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-401"><span class="linenos">401</span></a>                <span class="n">scan_number</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">Labels</span><span class="o">.</span><span class="n">corems_centroid</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-402"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-402"><span class="linenos">402</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-403"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-403"><span class="linenos">403</span></a>            <span class="n">mass_spectrum_obj</span> <span class="o">=</span> <span class="n">MassSpecCentroid</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-404"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-404"><span class="linenos">404</span></a>                <span class="n">data_dict</span><span class="p">,</span> <span class="n">d_params</span><span class="p">,</span> <span class="n">auto_process</span><span class="o">=</span><span class="n">auto_process</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-405"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-405"><span class="linenos">405</span></a>            <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-406"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-406"><span class="linenos">406</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectrum_from_scan-407"><a href="#MZMLSpectraParser.get_mass_spectrum_from_scan-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="n">mass_spectrum_obj</span>
</span></pre></div>


            <div class="docstring"><p>Instatiate a mass spectrum object from the mzML file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>scan_number</strong> (int):
The scan number to be parsed.</li>
<li><strong>spectrum_mode</strong> (str):
The type of spectrum to instantiate.  Must be'profile' or 'centroid'.</li>
<li><strong>polarity</strong> (int):
The polarity of the scan.  Must be -1 or 1.</li>
<li><strong>auto_process</strong> (bool, optional):
If True, process the mass spectrum. Default is True.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>MassSpecProfile | MassSpecCentroid</strong>: The MassSpecProfile or MassSpecCentroid object containing the parsed mass spectrum.</li>
</ul>
</div>


                            </div>
                            <div id="MZMLSpectraParser.get_mass_spectra_obj" class="classattr">
                                        <input id="MZMLSpectraParser.get_mass_spectra_obj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mass_spectra_obj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.get_mass_spectra_obj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.get_mass_spectra_obj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.get_mass_spectra_obj-409"><a href="#MZMLSpectraParser.get_mass_spectra_obj-409"><span class="linenos">409</span></a>    <span class="k">def</span> <span class="nf">get_mass_spectra_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-410"><a href="#MZMLSpectraParser.get_mass_spectra_obj-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiate a MassSpectraBase object from the mzML file.</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-411"><a href="#MZMLSpectraParser.get_mass_spectra_obj-411"><span class="linenos">411</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-412"><a href="#MZMLSpectraParser.get_mass_spectra_obj-412"><span class="linenos">412</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-413"><a href="#MZMLSpectraParser.get_mass_spectra_obj-413"><span class="linenos">413</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-414"><a href="#MZMLSpectraParser.get_mass_spectra_obj-414"><span class="linenos">414</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-415"><a href="#MZMLSpectraParser.get_mass_spectra_obj-415"><span class="linenos">415</span></a><span class="sd">        MassSpectraBase</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-416"><a href="#MZMLSpectraParser.get_mass_spectra_obj-416"><span class="linenos">416</span></a><span class="sd">            The MassSpectra object containing the parsed mass spectra.</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-417"><a href="#MZMLSpectraParser.get_mass_spectra_obj-417"><span class="linenos">417</span></a><span class="sd">            The object is instatiated with the mzML file, analyzer, instrument, sample name, and scan dataframe.</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-418"><a href="#MZMLSpectraParser.get_mass_spectra_obj-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-419"><a href="#MZMLSpectraParser.get_mass_spectra_obj-419"><span class="linenos">419</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">spectra</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-420"><a href="#MZMLSpectraParser.get_mass_spectra_obj-420"><span class="linenos">420</span></a>        <span class="n">mass_spectra_obj</span> <span class="o">=</span> <span class="n">MassSpectraBase</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-421"><a href="#MZMLSpectraParser.get_mass_spectra_obj-421"><span class="linenos">421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-422"><a href="#MZMLSpectraParser.get_mass_spectra_obj-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-423"><a href="#MZMLSpectraParser.get_mass_spectra_obj-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-424"><a href="#MZMLSpectraParser.get_mass_spectra_obj-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-425"><a href="#MZMLSpectraParser.get_mass_spectra_obj-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-426"><a href="#MZMLSpectraParser.get_mass_spectra_obj-426"><span class="linenos">426</span></a>        <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-427"><a href="#MZMLSpectraParser.get_mass_spectra_obj-427"><span class="linenos">427</span></a>        <span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-428"><a href="#MZMLSpectraParser.get_mass_spectra_obj-428"><span class="linenos">428</span></a>        <span class="n">mass_spectra_obj</span><span class="o">.</span><span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-429"><a href="#MZMLSpectraParser.get_mass_spectra_obj-429"><span class="linenos">429</span></a>
</span><span id="MZMLSpectraParser.get_mass_spectra_obj-430"><a href="#MZMLSpectraParser.get_mass_spectra_obj-430"><span class="linenos">430</span></a>        <span class="k">return</span> <span class="n">mass_spectra_obj</span>
</span></pre></div>


            <div class="docstring"><p>Instatiate a MassSpectraBase object from the mzML file.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>MassSpectraBase</strong>: The MassSpectra object containing the parsed mass spectra.
The object is instatiated with the mzML file, analyzer, instrument, sample name, and scan dataframe.</li>
</ul>
</div>


                            </div>
                            <div id="MZMLSpectraParser.get_lcms_obj" class="classattr">
                                        <input id="MZMLSpectraParser.get_lcms_obj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lcms_obj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">spectra</span><span class="o">=</span><span class="s1">&#39;all&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MZMLSpectraParser.get_lcms_obj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MZMLSpectraParser.get_lcms_obj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MZMLSpectraParser.get_lcms_obj-432"><a href="#MZMLSpectraParser.get_lcms_obj-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">get_lcms_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-433"><a href="#MZMLSpectraParser.get_lcms_obj-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instatiates a LCMSBase object from the mzML file.</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-434"><a href="#MZMLSpectraParser.get_lcms_obj-434"><span class="linenos">434</span></a>
</span><span id="MZMLSpectraParser.get_lcms_obj-435"><a href="#MZMLSpectraParser.get_lcms_obj-435"><span class="linenos">435</span></a><span class="sd">        Parameters</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-436"><a href="#MZMLSpectraParser.get_lcms_obj-436"><span class="linenos">436</span></a><span class="sd">        ----------</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-437"><a href="#MZMLSpectraParser.get_lcms_obj-437"><span class="linenos">437</span></a><span class="sd">        spectra : str, optional</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-438"><a href="#MZMLSpectraParser.get_lcms_obj-438"><span class="linenos">438</span></a><span class="sd">            Which mass spectra data to include in the output. Default is all.  Other options: none, ms1, ms2.</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-439"><a href="#MZMLSpectraParser.get_lcms_obj-439"><span class="linenos">439</span></a>
</span><span id="MZMLSpectraParser.get_lcms_obj-440"><a href="#MZMLSpectraParser.get_lcms_obj-440"><span class="linenos">440</span></a><span class="sd">        Returns</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-441"><a href="#MZMLSpectraParser.get_lcms_obj-441"><span class="linenos">441</span></a><span class="sd">        -------</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-442"><a href="#MZMLSpectraParser.get_lcms_obj-442"><span class="linenos">442</span></a><span class="sd">        LCMSBase</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-443"><a href="#MZMLSpectraParser.get_lcms_obj-443"><span class="linenos">443</span></a><span class="sd">            LCMS object containing mass spectra data.</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-444"><a href="#MZMLSpectraParser.get_lcms_obj-444"><span class="linenos">444</span></a><span class="sd">            The object is instatiated with the mzML file, analyzer, instrument, sample name, scan dataframe,</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-445"><a href="#MZMLSpectraParser.get_lcms_obj-445"><span class="linenos">445</span></a><span class="sd">            and mz dataframe(s), as well as lists of scan numbers, retention times, and TICs.</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-446"><a href="#MZMLSpectraParser.get_lcms_obj-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-447"><a href="#MZMLSpectraParser.get_lcms_obj-447"><span class="linenos">447</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">spectra</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>  <span class="c1"># first run it to just get scan info</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-448"><a href="#MZMLSpectraParser.get_lcms_obj-448"><span class="linenos">448</span></a>        <span class="n">res</span><span class="p">,</span> <span class="n">scan_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-449"><a href="#MZMLSpectraParser.get_lcms_obj-449"><span class="linenos">449</span></a>            <span class="n">scan_df</span><span class="o">=</span><span class="n">scan_df</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">spectra</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-450"><a href="#MZMLSpectraParser.get_lcms_obj-450"><span class="linenos">450</span></a>        <span class="p">)</span>  <span class="c1"># second run to parse data</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-451"><a href="#MZMLSpectraParser.get_lcms_obj-451"><span class="linenos">451</span></a>        <span class="n">lcms_obj</span> <span class="o">=</span> <span class="n">LCMSBase</span><span class="p">(</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-452"><a href="#MZMLSpectraParser.get_lcms_obj-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_location</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-453"><a href="#MZMLSpectraParser.get_lcms_obj-453"><span class="linenos">453</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-454"><a href="#MZMLSpectraParser.get_lcms_obj-454"><span class="linenos">454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_label</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-455"><a href="#MZMLSpectraParser.get_lcms_obj-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-456"><a href="#MZMLSpectraParser.get_lcms_obj-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-457"><a href="#MZMLSpectraParser.get_lcms_obj-457"><span class="linenos">457</span></a>        <span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-458"><a href="#MZMLSpectraParser.get_lcms_obj-458"><span class="linenos">458</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-459"><a href="#MZMLSpectraParser.get_lcms_obj-459"><span class="linenos">459</span></a>            <span class="n">key_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-460"><a href="#MZMLSpectraParser.get_lcms_obj-460"><span class="linenos">460</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">intensity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-461"><a href="#MZMLSpectraParser.get_lcms_obj-461"><span class="linenos">461</span></a>            <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="s2">&quot;mz&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-462"><a href="#MZMLSpectraParser.get_lcms_obj-462"><span class="linenos">462</span></a>            <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_ms_unprocessed</span><span class="p">[</span><span class="n">key_int</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-463"><a href="#MZMLSpectraParser.get_lcms_obj-463"><span class="linenos">463</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">scan_df</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-464"><a href="#MZMLSpectraParser.get_lcms_obj-464"><span class="linenos">464</span></a>        <span class="c1"># Check if polarity is mixed</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-465"><a href="#MZMLSpectraParser.get_lcms_obj-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">polarity</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-466"><a href="#MZMLSpectraParser.get_lcms_obj-466"><span class="linenos">466</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mixed polarities detected in scan data&quot;</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-467"><a href="#MZMLSpectraParser.get_lcms_obj-467"><span class="linenos">467</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="n">scan_df</span><span class="o">.</span><span class="n">polarity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-468"><a href="#MZMLSpectraParser.get_lcms_obj-468"><span class="linenos">468</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_scans_number_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">scan</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-469"><a href="#MZMLSpectraParser.get_lcms_obj-469"><span class="linenos">469</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_retention_time_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">scan_time</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-470"><a href="#MZMLSpectraParser.get_lcms_obj-470"><span class="linenos">470</span></a>        <span class="n">lcms_obj</span><span class="o">.</span><span class="n">_tic_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_df</span><span class="o">.</span><span class="n">tic</span><span class="p">)</span>
</span><span id="MZMLSpectraParser.get_lcms_obj-471"><a href="#MZMLSpectraParser.get_lcms_obj-471"><span class="linenos">471</span></a>
</span><span id="MZMLSpectraParser.get_lcms_obj-472"><a href="#MZMLSpectraParser.get_lcms_obj-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="n">lcms_obj</span>
</span></pre></div>


            <div class="docstring"><p>Instatiates a LCMSBase object from the mzML file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>spectra</strong> (str, optional):
Which mass spectra data to include in the output. Default is all.  Other options: none, ms1, ms2.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>LCMSBase</strong>: LCMS object containing mass spectra data.
The object is instatiated with the mzML file, analyzer, instrument, sample name, scan dataframe,
and mz dataframe(s), as well as lists of scan numbers, retention times, and TICs.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>